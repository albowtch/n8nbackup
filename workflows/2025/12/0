{
  "data": [
    {
      "updatedAt": "2025-05-23T04:48:45.650Z",
      "createdAt": "2025-05-23T04:48:45.650Z",
      "id": "0Z3dEyzJF1a3cKG5",
      "name": "ModuloPagosChiqBackup",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {},
            "path": "6c16a66c-4240-4afd-b14b-496ab14c1980"
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -420,
            -820
          ],
          "id": "804eed0c-dff8-4d28-8d2a-a24d199f867c",
          "name": "ID Cliente",
          "webhookId": "6c16a66c-4240-4afd-b14b-496ab14c1980"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -220,
            -820
          ],
          "id": "e6c2e6e2-09cf-486a-8bb8-7ec09d81a289",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -40,
            -780
          ],
          "id": "16ec38cd-60cf-419c-aa0f-d9d15ecc09d8",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      },
                      {
                        "option": "otro..."
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            },
            "path": "8beed9ef-8b92-4cfb-85ee-840c1e43e067"
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -160,
            -540
          ],
          "id": "c3e3ddc9-a392-4f30-b010-3cc411ad99d3",
          "name": "CargarPago",
          "webhookId": "8beed9ef-8b92-4cfb-85ee-840c1e43e067"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            500,
            -620
          ],
          "id": "0048e309-94cf-46bc-b719-a33f4533016f",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha'] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            460,
            -780
          ],
          "id": "984e752c-e41e-44ee-a7ce-1963000e6a56",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {},
            "path": "7c54842c-a7e0-4433-94d3-e9cc3e53ccd9"
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -380,
            -540
          ],
          "id": "c1168cb8-726e-48ee-a4e4-5723a2d89d19",
          "name": "Error",
          "webhookId": "7c54842c-a7e0-4433-94d3-e9cc3e53ccd9"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            720,
            -600
          ],
          "id": "81902b62-d055-41e3-8250-ce856360bff4",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            520,
            -380
          ],
          "id": "19f0429f-a4f4-4fe9-984a-f33f671bacd6",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            720,
            -800
          ],
          "id": "a090c746-950b-4ae7-b7aa-231025ccc261",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            920,
            -800
          ],
          "id": "561c3a90-f874-45b3-b4c8-eecd2e549eff",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            1020,
            -380
          ],
          "id": "9f7df606-62fe-4930-b9b6-700f0e8156ae",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global Mac \"{{ $('Existe?').item.json[\"MAC ID\"] }}\";\n:global Plan \"{{ $json.NuevoPlan }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            680,
            -340
          ],
          "id": "7d9836a9-5d15-4ea6-b315-17d5e132a6ae",
          "name": "CambiarPlan1"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {},
            "path": "5dc25b92-0493-44a9-85e7-c7ba6e94a24a"
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1220,
            -320
          ],
          "id": "59ec3a78-fb4a-40c1-950a-375abebb56ef",
          "name": "Form",
          "webhookId": "5dc25b92-0493-44a9-85e7-c7ba6e94a24a"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {},
            "path": "a640d258-abe0-443f-a627-e5ac6f81fb8e"
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            1400,
            -140
          ],
          "id": "35ecfac2-8e6b-4551-8dd8-9a759fbfa90d",
          "name": "Gmail",
          "webhookId": "a640d258-abe0-443f-a627-e5ac6f81fb8e",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1300,
            -800
          ],
          "id": "8bf0ae6b-d3ba-41d0-bd23-7a51787b7022",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            40,
            -540
          ],
          "id": "43820b95-7245-424f-9aa5-03bcc3bc3862",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            200,
            -600
          ],
          "id": "56b7d3a5-ffa8-4559-9a2f-706925c30307",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            280,
            -260
          ],
          "id": "7ab07715-1e08-487f-8eb1-398ed0285da8",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            160,
            -360
          ],
          "id": "5a45510c-b2e5-4656-9ad2-cded2d47fe75",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            320,
            -380
          ],
          "id": "551ed0eb-ad7d-4dce-bd51-fc4080aa677c",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            60,
            -280
          ],
          "id": "5e5d56bb-471f-4b4e-aef2-a5ac64108388",
          "name": "Exept1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            160,
            -820
          ],
          "id": "380a5519-f4c8-4ef1-9e7b-d71f5027f045",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -400,
            -320
          ],
          "id": "1bf7d66c-cc6c-4c0f-92b1-36bece6f126f",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                "Cuenta": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                "Cantidad": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}",
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            840,
            -340
          ],
          "id": "cf6a5c7b-4d2d-4cd0-8968-bcf97b8214e1",
          "name": "ActualizaPlan",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.ID }}",
                "Fecha de corte": "={{ $json.FechaCorte }}",
                "Cuenta": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                "Cantidad": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            940,
            -600
          ],
          "id": "09836657-5873-4c67-acea-2740df0058d3",
          "name": "FechaBD",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Ma. Gpe. term -0274 Azte' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Bertin term -9712 Azte' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Aldo term -5905 Sant.' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1100,
            -800
          ],
          "id": "9e22ccc0-5212-4db6-b3f7-377ce324eee4",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {},
            "path": "3bff8737-5bb9-4d71-82de-b39b4e1aaa8e"
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -200,
            -320
          ],
          "id": "a8e56739-55b1-4422-8f15-4b5d76712b4d",
          "name": "Error1",
          "webhookId": "3bff8737-5bb9-4d71-82de-b39b4e1aaa8e"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1180,
            -560
          ],
          "id": "668f15ee-1f30-427d-a4cb-8e8c40718f2b",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {},
            "path": "25222507-9a23-4858-a71e-3f309fc67a6c"
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1360,
            -520
          ],
          "id": "187c53d0-138d-4946-bf4c-3702fd37702b",
          "name": "Form1",
          "webhookId": "25222507-9a23-4858-a71e-3f309fc67a6c"
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "CambiarPlan1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CambiarPlan1": {
          "main": [
            [
              {
                "node": "ActualizaPlan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "FechaBD",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Exept1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Exept1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaPlan": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaBD": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "ed2aeb1e-f688-4d98-8ecb-0d769b30f46f",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-23T04:48:45.662Z",
          "createdAt": "2025-05-23T04:48:45.662Z",
          "role": "workflow:owner",
          "workflowId": "0Z3dEyzJF1a3cKG5",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-07-05T01:40:37.213Z",
      "createdAt": "2025-07-05T01:40:37.213Z",
      "id": "0vn1Gu3QtXXQcSYH",
      "name": "agenteyoutube",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            -140,
            160
          ],
          "id": "c2ce7207-f8d8-4fee-9ccb-0dc894f1ba01",
          "name": "When chat message received",
          "webhookId": "678f1f57-e7a4-4eef-9dd4-13757e951425"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            80,
            160
          ],
          "id": "19c33586-3d9d-4c9b-b251-44402d0de366",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            -60,
            440
          ],
          "id": "b3713c9c-7854-4e93-b632-0f2a1a1d84b0",
          "name": "OpenAI Chat Model"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
          "typeVersion": 1.3,
          "position": [
            100,
            440
          ],
          "id": "b6568688-ddcf-49e7-90d2-2d88ac0d1077",
          "name": "Postgres Chat Memory"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "techease_empresa",
            "toolDescription": "Utiliza esta herramienta para obtener información de la empresa TechEase y sus servicios",
            "tableName": {
              "__rl": true,
              "value": "documents",
              "mode": "list",
              "cachedResultName": "documents"
            },
            "options": {
              "queryName": "match_documents"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            260,
            400
          ],
          "id": "694dd75f-6895-4ef3-968e-638088db9f5c",
          "name": "Supabase Vector Store"
        },
        {
          "parameters": {
            "operation": "download",
            "fileId": {
              "__rl": true,
              "value": "1-D-Tkzc1soBBN99jq91RJpV1Vp99JEz_",
              "mode": "list",
              "cachedResultName": "TechEase Servicios IT.txt",
              "cachedResultUrl": "https://drive.google.com/file/d/1-D-Tkzc1soBBN99jq91RJpV1Vp99JEz_/view?usp=drivesdk"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -120,
            780
          ],
          "id": "6d8cdca7-8ecc-4dca-9c51-486f63fbd16d",
          "name": "Google Drive"
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "documents",
              "mode": "list",
              "cachedResultName": "documents"
            },
            "options": {
              "queryName": "match_documents"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            140,
            780
          ],
          "id": "fb165778-7638-44d8-9879-42eafc58da2c",
          "name": "Supabase Vector Store1"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            20,
            1000
          ],
          "id": "7549d65d-40f5-4c9c-99c3-73f58373c6f3",
          "name": "Embeddings OpenAI"
        },
        {
          "parameters": {
            "dataType": "binary",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            240,
            1000
          ],
          "id": "56c67543-4360-4a63-9a2e-a80b1c4cd7a3",
          "name": "Default Data Loader"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "typeVersion": 1,
          "position": [
            200,
            1220
          ],
          "id": "ecb7675d-af7d-4dbb-8e8f-1b19b10a7565",
          "name": "Recursive Character Text Splitter"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            260,
            580
          ],
          "id": "7bca0104-a66d-4ab4-ae9b-3553f02d15e7",
          "name": "Embeddings OpenAI1"
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Postgres Chat Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive": {
          "main": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "4621aa60-bf9c-4a24-89de-df5773e9bc83",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-07-05T01:40:37.223Z",
          "createdAt": "2025-07-05T01:40:37.223Z",
          "role": "workflow:owner",
          "workflowId": "0vn1Gu3QtXXQcSYH",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-11T22:01:47.000Z",
      "createdAt": "2025-09-11T04:07:42.333Z",
      "id": "1dr0cNS81t7eSc1o",
      "name": "My workflow 6",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "operation": "get",
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "requestOptions": {}
          },
          "id": "579ec3ee-9a21-45ce-9568-dd59fd0b0cdc",
          "name": "n8n | get wf",
          "type": "n8n-nodes-base.n8n",
          "position": [
            1072,
            384
          ],
          "typeVersion": 1,
          "executeOnce": true,
          "credentials": {
            "n8nApi": {
              "id": "cP6tDz3lFOYsjWeD",
              "name": "n8n account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "workflowObject": "={{ JSON.stringify($json) }}",
            "requestOptions": {}
          },
          "id": "c37afaff-010d-4e52-a7ad-ff12d7bb40c8",
          "name": "n8n | update",
          "type": "n8n-nodes-base.n8n",
          "position": [
            1584,
            384
          ],
          "typeVersion": 1,
          "credentials": {
            "n8nApi": {
              "id": "cP6tDz3lFOYsjWeD",
              "name": "n8n account"
            }
          }
        },
        {
          "parameters": {
            "formTitle": "Example Title",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Example text field"
                },
                {
                  "fieldLabel": "Example dropdown",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "test publieke ruimtes"
                      },
                      {
                        "option": "Demonstraties"
                      },
                      {
                        "option": "Demonstraties"
                      },
                      {
                        "option": "Juridisch medewerker IE-recht  Streetlife"
                      },
                      {
                        "option": "Bamboe"
                      },
                      {
                        "option": "Klaar?"
                      },
                      {
                        "option": "Dannu?"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {}
          },
          "id": "f0847bb4-064d-43e2-811f-27cf57483b19",
          "name": "On form submission",
          "type": "n8n-nodes-base.formTrigger",
          "position": [
            848,
            128
          ],
          "webhookId": "3e975d29-df26-49fb-8dcf-abe8fe8bc4e6",
          "typeVersion": 2.2
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyMinute"
                }
              ]
            },
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "includeInOutput": "both",
            "options": {}
          },
          "id": "c0d4d5e3-fa54-48ca-8013-8438a397c8ea",
          "name": "Google Sheets Trigger",
          "type": "n8n-nodes-base.googleSheetsTrigger",
          "position": [
            64,
            384
          ],
          "typeVersion": 1,
          "credentials": {
            "googleSheetsTriggerOAuth2Api": {
              "id": "cZo45ZjqHQdroFJd",
              "name": "Google Sheets Trigger account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "options": {}
          },
          "id": "773b0a7d-1676-4e91-8dd6-9594df4d6f67",
          "name": "Execute Workflow",
          "type": "n8n-nodes-base.executeWorkflow",
          "position": [
            1056,
            128
          ],
          "typeVersion": 1.1
        },
        {
          "parameters": {
            "content": "## Data source setup\n\n- Connect to your Google Sheet containing dropdown values\n- Node can be replaced with any other data source (API, database)\n- Set timing trigger",
            "height": 176,
            "width": 440
          },
          "id": "92ca704f-ad12-4e66-a0f8-9f8006630eae",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            48,
            208
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "content": "## Data formatting\n\n- Extracts needed data from source\n- Renames field to 'value' (do not change this name)",
            "height": 208,
            "width": 260
          },
          "id": "1db7d0d7-61c3-42c3-a569-617757c5a3ca",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            496,
            224
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "content": "## Nested properties\n\n- Transforms the data to the desired format",
            "height": 192
          },
          "id": "a94e6347-e83b-40de-8116-7b69cf5d9f81",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            752,
            256
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "content": "## Get Workflow \n\n- Gets the current workflow data",
            "height": 176
          },
          "id": "7ef16204-3ddf-4355-a616-cbce72bb3e08",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1008,
            256
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "content": "## Add Dropdown Values \n- Replaces the nested parameters of the Dropdown Form Field with the nested properties sourced from the data.",
            "height": 256
          },
          "id": "709eda93-a5f3-498e-a742-8c5e4b76fed0",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1248,
            224
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "content": "## Update Form \n\n- Replaces the current workflow’s JSON with the updated JSON containing the new Dropdown values.",
            "height": 224
          },
          "id": "bd074289-927a-4c04-b221-3a5e5747bad5",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1488,
            224
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "jsCode": "const inputArray = items.map(item => item.json);\n\nconst output = [\n  {\n    nodes: [\n      {\n        parameters: {\n          formFields: {\n            values: [\n              {\n                fieldOptions: {\n                  values: inputArray.map(entry => ({ option: entry.value }))\n                }\n              }\n            ]\n          }\n        }\n      }\n    ]\n  }\n];\n\n// Return the transformed output\nreturn output.map(item => ({ json: item }));"
          },
          "id": "712009f3-3e03-48ae-adb2-f1a5dec8e348",
          "name": "Write JSON",
          "type": "n8n-nodes-base.code",
          "position": [
            800,
            384
          ],
          "typeVersion": 2
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "38ef2b43-b903-4e96-b098-9da2d8c1c153",
                  "name": "={{ \n   (() => {\n      const nodeIndex = $json.nodes.findIndex(\n         node => node.parameters?.formFields?.values.some(\n            value => value.fieldType === 'dropdown' && value.fieldOptions?.values\n         )\n      );\n\n      if (nodeIndex === -1) return 'No matching node found';\n\n      const valueIndex = $json.nodes[nodeIndex].parameters.formFields.values.findIndex(\n         value => value.fieldType === 'dropdown' && value.fieldOptions?.values\n      );\n\n      if (valueIndex === -1) return `nodes[${nodeIndex}].parameters.formFields.values - No matching dropdown value found`;\n\n      return `nodes[${nodeIndex}].parameters.formFields.values[${valueIndex}].fieldOptions.values`;\n   })()\n}}",
                  "type": "array",
                  "value": "={{ $('Write JSON').item.json.nodes[0].parameters.formFields.values[0].fieldOptions.values }}"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "id": "2f14df67-c7f9-4a44-8490-68699f34dd78",
          "name": "Replace values",
          "type": "n8n-nodes-base.set",
          "position": [
            1344,
            384
          ],
          "typeVersion": 3.4
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "options": {}
          },
          "id": "12e0123f-9955-4e29-82d5-8d06b862a918",
          "name": "Get all values",
          "type": "n8n-nodes-base.googleSheets",
          "position": [
            288,
            384
          ],
          "typeVersion": 4.5,
          "executeOnce": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "e18aa12e-f277-4257-ba27-9262cc7b866a",
                  "name": "value",
                  "type": "string",
                  "value": "={{ $json.Nombre }}"
                }
              ]
            },
            "options": {}
          },
          "id": "b5f98eb4-a59c-4c98-b1a6-02e0157d9461",
          "name": "Format to 'values'",
          "type": "n8n-nodes-base.set",
          "position": [
            544,
            384
          ],
          "typeVersion": 3.4
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyMinute"
                }
              ]
            },
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?gid=983724897"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "options": {}
          },
          "id": "f1c8d9c1-0b12-43b7-a513-40e0ec33450b",
          "name": "Google Sheets Trigger1",
          "type": "n8n-nodes-base.googleSheetsTrigger",
          "position": [
            592,
            -208
          ],
          "typeVersion": 1,
          "credentials": {
            "googleSheetsTriggerOAuth2Api": {
              "id": "cZo45ZjqHQdroFJd",
              "name": "Google Sheets Trigger account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?gid=983724897"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "options": {}
          },
          "id": "0c021b9e-8301-4b65-b8df-6d8c6a504eb3",
          "name": "Get all values1",
          "type": "n8n-nodes-base.googleSheets",
          "position": [
            800,
            -208
          ],
          "typeVersion": 4.5,
          "executeOnce": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "e18aa12e-f277-4257-ba27-9262cc7b866a",
                  "name": "dropdown_options",
                  "type": "array",
                  "value": "={{ $json.map(item => ({ 'option': item.Nombre })) }}"
                }
              ]
            },
            "options": {}
          },
          "id": "9ff2c217-9c5c-4814-98ea-f62cc1febfc8",
          "name": "Format to 'values'1",
          "type": "n8n-nodes-base.set",
          "position": [
            992,
            -208
          ],
          "typeVersion": 3.4
        },
        {
          "parameters": {
            "formTitle": "Dynamic Dropdown Form",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {},
                      {}
                    ]
                  }
                }
              ]
            },
            "options": {}
          },
          "id": "f3a563e1-ea8d-4dc0-84ea-9af18f09adb5",
          "name": "On form submission1",
          "type": "n8n-nodes-base.formTrigger",
          "position": [
            1200,
            -208
          ],
          "webhookId": "84f1853f-4691-430c-8eab-0225d15e54a5",
          "typeVersion": 2.2
        }
      ],
      "connections": {
        "Write JSON": {
          "main": [
            [
              {
                "node": "n8n | get wf",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "n8n | get wf": {
          "main": [
            [
              {
                "node": "Replace values",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get all values": {
          "main": [
            [
              {
                "node": "Format to 'values'",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Replace values": {
          "main": [
            [
              {
                "node": "n8n | update",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format to 'values'": {
          "main": [
            [
              {
                "node": "Write JSON",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Execute Workflow",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets Trigger": {
          "main": [
            [
              {
                "node": "Get all values",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets Trigger1": {
          "main": [
            [
              {
                "node": "Get all values1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get all values1": {
          "main": [
            [
              {
                "node": "Format to 'values'1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "9e1a87c1-425c-4a03-b61c-1a92fc30ed2e",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-09-11T04:07:42.339Z",
          "createdAt": "2025-09-11T04:07:42.339Z",
          "role": "workflow:owner",
          "workflowId": "1dr0cNS81t7eSc1o",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-08T01:16:43.000Z",
      "createdAt": "2025-09-06T15:59:39.484Z",
      "id": "2BtEXd29SOEBbRfO",
      "name": "Chaneque$$",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "options": {
              "outputFormatting": {
                "values": {
                  "general": "UNFORMATTED_VALUE",
                  "date": "FORMATTED_STRING"
                }
              }
            }
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2144,
            128
          ],
          "id": "148a29b9-393c-4739-b620-bf215ac15cda",
          "name": "CargarUsuarios",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "cd46da9c-54a4-4ccd-9d09-f98959af96ce",
                  "name": "dropdown_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre).filter(name => name && name.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1952,
            128
          ],
          "id": "e649450d-028a-413d-bcaf-1d974e356474",
          "name": "Edit Fields",
          "executeOnce": true
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Nombre\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Nombre del Donante",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1760,
            128
          ],
          "id": "98ee2989-1699-48bc-920c-afdfaeb1f36f",
          "name": "Datos",
          "webhookId": "f5f9a577-29d8-4b27-a74e-de550b7619cf"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0fd6317d-f57a-4622-9dbc-cbd1dd893b05",
                  "leftValue": "={{ $json.Nombre }}",
                  "rightValue": "Otro",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1568,
            128
          ],
          "id": "5deaa934-145c-48bb-ab89-28bf495ab290",
          "name": "If"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Escribe el nombre del donante",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1376,
            128
          ],
          "id": "3d439933-f5d0-4a5b-b910-2cbc49142cf1",
          "name": "otro",
          "webhookId": "b4734f98-8e6a-401f-92f0-a1704a370123"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -1152,
            128
          ],
          "id": "6a2ad68c-509b-471c-8d8f-e18368b57d2c",
          "name": "Merge1"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Dinero",
                  "fieldType": "number"
                },
                {
                  "fieldLabel": "En especie:"
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number"
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Cantidades donadas por: ",
              "formDescription": "={{ $json.Nombre }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -976,
            128
          ],
          "id": "90fc8641-a1de-4d88-a44f-3d612cb7947e",
          "name": "Cantidades",
          "webhookId": "4e951a26-01f9-4221-92c9-f23ddb4170c3"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list",
              "cachedResultName": "Eventos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1904984712"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ $json.submittedAt.toDateTime().format('yyyy-MM-dd HH:mm:ss') }}",
                "Evento": "INGRESO",
                "Donante": "={{ $('Merge1').item.json.Nombre }}",
                "Especie": "={{ $json['En especie:'] || '' }}",
                "Cantidad": "={{ $json.Cantidad || 0 }}",
                "Dinero": "={{ $json.Dinero || 0 }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1024,
            320
          ],
          "id": "75879592-6356-48e9-8fa6-fe6b91a56293",
          "name": "RegistrarIngreso",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro exitoso",
            "completionMessage": "={{ $json.Donante }} Donò Dinero:${{ $json.Dinero }} Especie: {{ $json.Especie }} Cant.{{ $json.Cantidad }}",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -816,
            336
          ],
          "id": "a334cb0e-7344-47ec-9279-d2f482320ed5",
          "name": "Exito",
          "webhookId": "8b242983-bddf-4afc-8ba5-457dc1399667"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "leftValue": "={{ $json.Selecciona }}",
                  "rightValue": "Dinero",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  },
                  "id": "e7dffaef-2ab0-4777-a071-419fb0064bc2"
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1952,
            512
          ],
          "id": "150559dd-ec90-4dfb-a858-e598454a765d",
          "name": "IfTipoGasto"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1840,
            320
          ],
          "id": "51ee56b4-1cd9-44c9-ac52-9df4130dba48",
          "name": "LeerEventosDinero",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2272,
            688
          ],
          "id": "0abdc43f-0a99-45df-b743-4db1b8639d3c",
          "name": "LeerEventosEspecie",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Seleccionar Donación\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "options": {
              "formTitle": "Dinero Disponible",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1456,
            320
          ],
          "id": "e5073d56-b81b-4113-ab66-d15dd7d8d2c3",
          "name": "FormDinero",
          "webhookId": "f8e30269-5ac0-4dc2-9236-ce2c205dbcfb"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Seleccionar Donación\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Especies Disponibles",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1872,
            688
          ],
          "id": "32bdf15d-3027-4da4-b042-56b6a3c11655",
          "name": "FormEspecie",
          "webhookId": "63bd287b-6a0b-46ab-8107-c70bb5fe31a9"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "propuestas_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre_de_la_Propuesta).filter(value => value && value.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1488,
            688
          ],
          "id": "46438034-bd9b-4928-b9b8-6e27a50bab28",
          "name": "PreparePropuestas",
          "executeOnce": true
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\":\"Cantidad Usada\",\n      \"fieldType\":\"number\",\n      \"requiredField\":true\n   },\n   {\n      \"fieldLabel\":\"Se uso en:\",\n      \"fieldType\":\"dropdown\",\n      \"fieldOptions\": {\n      \"values\": {{ $json.propuestas_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n   }\n]",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "={{ $('FormEspecie').first().json['Seleccionar Donación'] }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1280,
            688
          ],
          "id": "a9a997ea-af49-4b61-9378-17487b7d6369",
          "name": "CantidadEspecie",
          "webhookId": "5c34a035-0413-457b-93b6-dd040df7f401"
        },
        {
          "parameters": {
            "jsCode": "const formData = $('CantidadDinero1').first().json;\nconst donationData = $('FormDinero').first().json;\n\nconst selection = donationData['Seleccionar Donación'];\nconst amount = parseFloat(formData['Cantidad usada']);\n\nconst donanteName = selection.split(' $')[0];\n\nreturn [{\n  json: {\n    donation_name: donanteName,\n    used_amount: amount,\n    use_for: 'Se uso en'\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1344,
            496
          ],
          "id": "c24dd480-b0e2-4336-af71-caedafa32e99",
          "name": "ExtractDataDinero"
        },
        {
          "parameters": {
            "jsCode": "const formData = $('CantidadEspecie').first().json;\nconst donationData = $('FormEspecie').first().json;\n\nconst selection = donationData['Seleccionar Donación'];\nconst amount = parseFloat(formData['Cantidad Usada']);\nconst useFor = formData['Se uso en:'];\n\n// Separar: \"Albo Jitomate + 2\" -> [\"Albo Jitomate\", \"2\"]\nconst parts = selection.split(' + ');\nconst donantePlusEspecie = parts[0]; // \"Albo Jitomate\"\nconst palabras = donantePlusEspecie.split(' ');\nconst donanteName = palabras[0]; // \"Albo\"\nconst especieName = palabras.slice(1).join(' '); // \"Jitomate\"\n\nreturn [{\n  json: {\n    donation_name: donanteName,\n    especie_name: especieName,\n    used_amount: amount,\n    use_for: useFor\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1072,
            688
          ],
          "id": "ba66764e-e781-448d-a1de-34571843c260",
          "name": "ExtractDataEspecie"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ new Date().toISOString().slice(0, 19).replace('T', ' ') }}",
                "Evento": "GASTO",
                "Donante": "={{ $json.donation_name }}",
                "Dinero": "={{ $json.used_amount }}",
                "Uso": "={{ $('CantidadDinero1').item.json[\"Se uso en:\"] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1136,
            496
          ],
          "id": "b3ad3935-0385-4389-a361-85469476e338",
          "name": "RegistrarGastoDinero",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list",
              "cachedResultName": "Eventos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1904984712"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ new Date().toISOString().slice(0, 19).replace('T', ' ') }}",
                "Evento": "GASTO",
                "Donante": "={{ $json.donation_name }}",
                "Especie": "={{ $json.especie_name }}",
                "Cantidad": "={{ $json.used_amount }}",
                "Uso": "={{ $json.use_for }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -864,
            688
          ],
          "id": "f57d564d-cee5-4036-a879-ca1763f52517",
          "name": "RegistrarGastoEspecie",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Gasto Registrado",
            "completionMessage": "=Gasto de dinero: ${{ $json.Dinero }} de {{ $json.Donante }} Se uso en: {{ $('CantidadDinero1').item.json[\"Se uso en:\"] }}",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -928,
            496
          ],
          "id": "763083bf-0960-4b52-858e-e0588f67a1eb",
          "name": "ExitoDinero",
          "webhookId": "3a2fbe5a-d1f5-4064-bacc-1a8c0bee13e0"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Gasto Registrado",
            "completionMessage": "=Gasto de {{ $json.Donante }}: {{ $json.Cantidad }} {{ $json.Especie }} en {{ $json.Uso }}",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -656,
            752
          ],
          "id": "b7fe4209-3feb-467b-90a0-9ead774f7958",
          "name": "ExitoEspecie",
          "webhookId": "f0872a0a-9062-44e7-8d2f-da905de07d48"
        },
        {
          "parameters": {
            "formTitle": "Registrar Movimientos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Tipo de Movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "path": "mov",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -2272,
            304
          ],
          "id": "fa1115a7-82e6-4e6e-9e60-82e268838c13",
          "name": "IngresoGasto1",
          "webhookId": "334246b0-080a-4eff-bdd9-e72e79030cbf"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json['Tipo de Movimiento'] }}",
                        "rightValue": "Ingreso",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2ebca8d7-929b-4f43-ba76-b2db0ff665d9"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json['Tipo de Movimiento'] }}",
                        "rightValue": "Gasto",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "deb2b7d4-faf3-47f2-a7a3-5d1510db9884"
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2048,
            304
          ],
          "id": "add8c108-9874-41b0-8224-b4b574ed2fa0",
          "name": "Switch1"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Selecciona",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Dinero"
                      },
                      {
                        "option": "Especie"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formTitle": "Tipo de Gasto",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -2144,
            512
          ],
          "id": "9489e9d7-afc9-4bcb-97aa-ae896cce1717",
          "name": "SelectGasto1",
          "webhookId": "6d22092c-1d5a-4955-8f43-c1867250546f"
        },
        {
          "parameters": {
            "jsCode": "const eventos = $input.all();\nconst dinero = {};\n\neventos.forEach(evento => {\n  if (parseFloat(evento.json.Dinero) > 0) {\n    const key = evento.json.Donante;\n    if (!dinero[key]) dinero[key] = { ingreso: 0, gasto: 0 };\n    \n    if (evento.json.Evento === 'INGRESO') {\n      dinero[key].ingreso += parseFloat(evento.json.Dinero);\n    } else if (evento.json.Evento === 'GASTO') {\n      dinero[key].gasto += parseFloat(evento.json.Dinero);\n    }\n  }\n});\n\nconst disponibles = Object.keys(dinero)\n  .filter(donante => (dinero[donante].ingreso - dinero[donante].gasto) > 0)\n  .map(donante => `${donante} $${(dinero[donante].ingreso - dinero[donante].gasto).toFixed(2)}`);\n\nreturn [{ json: { dropdown_values: disponibles } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1648,
            320
          ],
          "id": "ee371afb-fc0a-49e4-9d39-05777fc349f0",
          "name": "CalcularDinero1"
        },
        {
          "parameters": {
            "jsCode": "const eventos = $input.all();\nconst especies = {};\n\neventos.forEach(evento => {\n  if (evento.json.Especie && evento.json.Especie.trim() !== '') {\n    const key = `${evento.json.Donante}_${evento.json.Especie}`;\n    if (!especies[key]) especies[key] = { donante: evento.json.Donante, especie: evento.json.Especie, ingreso: 0, gasto: 0 };\n    \n    if (evento.json.Evento === 'INGRESO') {\n      especies[key].ingreso += parseFloat(evento.json.Cantidad) || 0;\n    } else if (evento.json.Evento === 'GASTO') {\n      especies[key].gasto += parseFloat(evento.json.Cantidad) || 0;\n    }\n  }\n});\n\nconst disponibles = Object.values(especies)\n  .filter(item => (item.ingreso - item.gasto) > 0)\n  .map(item => `${item.donante} ${item.especie} + ${item.ingreso - item.gasto}`);\n\nreturn [{ json: { dropdown_values: disponibles } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2064,
            688
          ],
          "id": "61a3d5a8-bdb1-43aa-9e4a-075d7faa8b88",
          "name": "CalcularEspecie1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1680,
            688
          ],
          "id": "623ccf24-3cda-487c-997b-31f2d643911f",
          "name": "Propuestas1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "propuestas_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre_de_la_Propuesta).filter(value => value && value.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1744,
            496
          ],
          "id": "faf12cb6-290d-4393-b80a-93a965c437a2",
          "name": "PreparePropuestas1",
          "executeOnce": true
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1248,
            320
          ],
          "id": "ba81adeb-ca9b-4ab7-975b-ce6d5f42f53e",
          "name": "Propuestas",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\":\"Cantidad usada\",\n      \"fieldType\":\"number\",\n      \"requiredField\":true\n   },\n   {\n      \"fieldLabel\":\"Se uso en:\",\n      \"fieldType\":\"dropdown\",\n      \"fieldOptions\": {\n      \"values\": {{ $json.propuestas_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n   }\n]",
            "options": {
              "formTitle": "={{ $('FormDinero').first().json['Seleccionar Donación'] }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1552,
            496
          ],
          "id": "65aa5c4c-0e01-41d4-96c2-c0c6d273a4dc",
          "name": "CantidadDinero1",
          "webhookId": "100cb684-2057-470a-b7ea-c942fe98b6c1"
        }
      ],
      "connections": {
        "CargarUsuarios": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Datos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datos": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "otro",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "otro": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Cantidades",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cantidades": {
          "main": [
            [
              {
                "node": "RegistrarIngreso",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarIngreso": {
          "main": [
            [
              {
                "node": "Exito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IfTipoGasto": {
          "main": [
            [
              {
                "node": "LeerEventosDinero",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "LeerEventosEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeerEventosDinero": {
          "main": [
            [
              {
                "node": "CalcularDinero1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeerEventosEspecie": {
          "main": [
            [
              {
                "node": "CalcularEspecie1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormDinero": {
          "main": [
            [
              {
                "node": "Propuestas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormEspecie": {
          "main": [
            [
              {
                "node": "Propuestas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PreparePropuestas": {
          "main": [
            [
              {
                "node": "CantidadEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CantidadEspecie": {
          "main": [
            [
              {
                "node": "ExtractDataEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtractDataDinero": {
          "main": [
            [
              {
                "node": "RegistrarGastoDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtractDataEspecie": {
          "main": [
            [
              {
                "node": "RegistrarGastoEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarGastoDinero": {
          "main": [
            [
              {
                "node": "ExitoDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarGastoEspecie": {
          "main": [
            [
              {
                "node": "ExitoEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IngresoGasto1": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "CargarUsuarios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SelectGasto1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SelectGasto1": {
          "main": [
            [
              {
                "node": "IfTipoGasto",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CalcularDinero1": {
          "main": [
            [
              {
                "node": "FormDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CalcularEspecie1": {
          "main": [
            [
              {
                "node": "FormEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Propuestas1": {
          "main": [
            [
              {
                "node": "PreparePropuestas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PreparePropuestas1": {
          "main": [
            [
              {
                "node": "CantidadDinero1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Propuestas": {
          "main": [
            [
              {
                "node": "PreparePropuestas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CantidadDinero1": {
          "main": [
            [
              {
                "node": "ExtractDataDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "CalcularDinero1": [
          {
            "json": {
              "dropdown_values": [
                "Canino $200.00",
                "Sayuri $50.00",
                "Jose Oscar $50.00",
                "cirpirani $500.00"
              ]
            }
          }
        ]
      },
      "versionId": "2c4c3c94-4297-48d6-9a94-edef61479011",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-06T15:59:39.490Z",
          "createdAt": "2025-09-06T15:59:39.490Z",
          "role": "workflow:owner",
          "workflowId": "2BtEXd29SOEBbRfO",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-08T03:38:47.000Z",
      "createdAt": "2025-08-06T21:52:21.665Z",
      "id": "2FuNCnxYxJxQH5KA",
      "name": "My workflow 3",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {
              "responseMode": "lastNode"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            -768,
            -224
          ],
          "id": "f7eac14b-45d1-4b91-84d5-0b303723d69e",
          "name": "When chat message received",
          "webhookId": "c2875938-bfa3-429c-baa7-9b0b04d1db8a"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -560,
            -16
          ],
          "id": "ecd3bd46-426c-4970-a7c0-24ea514c5da9",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Eres un experto. Si recibes un saludo contesta el saludo de manera breve y cordial\n\nTienes una herramienta llamada empresa que debes usar si recibes texto con palabras como \"quien eres\" \"que haces\" \"de donde son\" \"empresa\" \"horarios\" y cuestiones relacionadas a la empresa.\n\nsi el texto proporcionado tiene palabras como \"quiero internet\" \"donde dan servicio\" \"cobertura\" \"tiene servicio\" \"quiero internet\" o cuestiones similares, usa herramienta cobertura.\n\nsi el texto proporcionado tiene palabras como \"Cuanto cuesta\" \"cual es el precio\" \"pagar\" \"donde pago\" \"paquetes\" \"cuales son los planes\" y similares usa la herramienta cobertura\n\nsi el texto proporcionado tiene palabras como \"Contratar\" \"que necesito para contratar\" \"quiero el servicio\" \"como lo contrato\" \"informacion para tener el servicio\" y similares usa la herramienta contrata\n\nNo inventes cosas ni digas informaciòn que no se encuentre en las herramientas que tienes"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -560,
            -224
          ],
          "id": "5fdfe6a6-73eb-4c60-9722-2de28dd7dba9",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -704,
            -16
          ],
          "id": "1caed9d8-db0a-47e7-bcc4-83a1918a8fdb",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -96,
            -64
          ],
          "id": "508eb2b0-c4df-42f9-9fdc-122c5d10272d",
          "name": "Google Gemini Chat Model2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            48,
            -32
          ],
          "id": "f96c43ad-c048-4ff7-a11f-f7c3f05a1e50",
          "name": "Simple Memory1"
        },
        {
          "parameters": {
            "toolDescription": "Agente experto en informacion sobre la empresa",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres experto en buscar informacion sobre la empresa albored, una vez que recibas el texto llama a la herramienta \"EmpresaDoc\" para obtener informacion y responder de manera breve y concisa\n\nSi no encuentras informacion relacionada al texto recibido contesta con \"no entiendo, puedes agregar mas detalles?\""
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            -128,
            -208
          ],
          "id": "317dfd54-ea93-49ed-8acb-174ad3e7cb67",
          "name": "Empresa"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            224,
            -16
          ],
          "id": "1bb4626e-e23d-41e4-af27-162236ba7917",
          "name": "Embeddings Google Gemini",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "empresa"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "typeVersion": 1.3,
          "position": [
            192,
            -208
          ],
          "id": "1f122676-67fd-4ff1-8b71-815eba47dce5",
          "name": "EmpresaDoc",
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -112,
            320
          ],
          "id": "386b7c1c-196d-41e7-99b7-eea9fbea4bb8",
          "name": "Google Gemini Chat Model3",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            32,
            352
          ],
          "id": "7ab70e22-7f6f-44a9-af0e-c4e23902881b",
          "name": "Simple Memory2"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            224,
            320
          ],
          "id": "1592a264-5d9a-4332-8a3c-03e2661a43f5",
          "name": "Embeddings Google Gemini1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Agente experto en informacion sobre como contratar el servicio",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres experto en buscar informacion sobre como contratar el servicio de internet, una vez que recibas el texto llama a la herramienta \"ContrataDoc\" para obtener informacion y responder de manera breve y concisa\n\nSi no encuentras informacion relacionada al texto recibido contesta con \"no entiendo, puedes agregar mas detalles?\""
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            -64,
            160
          ],
          "id": "3f8c6c86-d3a2-4d85-8506-4af6cf2ca24a",
          "name": "contrata"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "contrata"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "typeVersion": 1.3,
          "position": [
            240,
            160
          ],
          "id": "f59788c4-bad7-4d9d-b91d-649bb4d07aac",
          "name": "ContrataDoc",
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {
            "options": {
              "maxOutputTokens": 100,
              "temperature": 0
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -736,
            208
          ],
          "id": "b56d6c48-e9fe-4ac5-aa0c-47e7764d8647",
          "name": "Google Gemini Chat Model4",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -544,
            224
          ],
          "id": "1583c1ea-56bd-4afd-a465-9d8d6da1da53",
          "name": "Simple Memory3"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -352,
            320
          ],
          "id": "65a7d5a2-587f-4a35-bb4b-301a679a8e9e",
          "name": "Embeddings Google Gemini2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Agente experto en informacion sobre la cobertura de la empresa, zonas para dar servicio",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres experto en buscar informacion sobre la cobertura y zonas, una vez que recibas el texto llama a la herramienta \"CoberturaDoc\" para obtener informacion y responder de manera breve y concisa\n\nSi no encuentras informacion relacionada al texto recibido contesta con \"no entiendo, puedes agregar mas detalles?\""
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            -416,
            16
          ],
          "id": "3c070a52-ae62-4bbc-b756-ecad98e6c8aa",
          "name": "cobertura"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "cobertura"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "typeVersion": 1.3,
          "position": [
            -352,
            160
          ],
          "id": "46cc2840-5252-4ef9-9025-67be3a9090fc",
          "name": "CoberturaDoc",
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            []
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Empresa",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory1": {
          "ai_memory": [
            [
              {
                "node": "Empresa",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Empresa": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "EmpresaDoc",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "EmpresaDoc": {
          "ai_tool": [
            [
              {
                "node": "Empresa",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "contrata",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory2": {
          "ai_memory": [
            [
              {
                "node": "contrata",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "ContrataDoc",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "ContrataDoc": {
          "ai_tool": [
            [
              {
                "node": "contrata",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "contrata": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model4": {
          "ai_languageModel": [
            [
              {
                "node": "cobertura",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory3": {
          "ai_memory": [
            [
              {
                "node": "cobertura",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini2": {
          "ai_embedding": [
            [
              {
                "node": "CoberturaDoc",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "cobertura": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "CoberturaDoc": {
          "ai_tool": [
            [
              {
                "node": "cobertura",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "36d77c82-f053-40af-b806-147a97879938",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-06T21:52:21.670Z",
          "createdAt": "2025-08-06T21:52:21.670Z",
          "role": "workflow:owner",
          "workflowId": "2FuNCnxYxJxQH5KA",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-10T17:05:22.000Z",
      "createdAt": "2025-10-07T05:09:38.942Z",
      "id": "3h4vIoadr0i3FuoF",
      "name": "simplificado",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 983724897,
              "mode": "list",
              "cachedResultName": "Filtro",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=983724897"
            },
            "options": {
              "outputFormatting": {
                "values": {
                  "general": "UNFORMATTED_VALUE",
                  "date": "FORMATTED_STRING"
                }
              }
            }
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1040,
            -160
          ],
          "id": "cc4227a6-d39e-4aa8-b02d-78c2977a9c24",
          "name": "CargarUsuarios",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "cd46da9c-54a4-4ccd-9d09-f98959af96ce",
                  "name": "dropdown_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre).filter(name => name && name.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -816,
            -160
          ],
          "id": "3324716a-8f76-4afe-a9e9-aa069efd29b2",
          "name": "Edit Fields",
          "executeOnce": true
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Nombre\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Nombre del Donante"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -592,
            -160
          ],
          "id": "54c376c7-c717-4c73-b7f9-208f0916bb73",
          "name": "Datos",
          "webhookId": "f5f9a577-29d8-4b27-a74e-de550b7619cf"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0fd6317d-f57a-4622-9dbc-cbd1dd893b05",
                  "leftValue": "={{ $json.Nombre }}",
                  "rightValue": "Otro",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -368,
            -160
          ],
          "id": "d0962a5a-5ede-4e7f-95f0-ba69bc994546",
          "name": "If"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Escribe el nombre del donante"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -144,
            -176
          ],
          "id": "0d17ed6f-0c23-4075-837e-7172ed6bba61",
          "name": "otro",
          "webhookId": "b4734f98-8e6a-401f-92f0-a1704a370123"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            80,
            -160
          ],
          "id": "2642c3a0-c09d-4534-b8c2-c5b6ebb0baec",
          "name": "Merge1"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Dinero",
                  "fieldType": "number"
                },
                {
                  "fieldLabel": "En especie:"
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number"
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Cantidades donadas por: ",
              "formDescription": "={{ $json.Nombre }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            304,
            -160
          ],
          "id": "43b378be-ba1b-4d36-819a-52b7f8badfea",
          "name": "Cantidades",
          "webhookId": "4e951a26-01f9-4221-92c9-f23ddb4170c3"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list",
              "cachedResultName": "Eventos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1904984712"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ $json.submittedAt.toDateTime().format('yyyy-MM-dd HH:mm:ss') }}",
                "Evento": "INGRESO",
                "Donante": "={{ $('Merge1').item.json.Nombre }}",
                "Especie": "={{ $json['En especie:'] || '' }}",
                "Cantidad": "={{ $json.Cantidad || 0 }}",
                "Dinero": "={{ $json.Dinero || 0 }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            224,
            32
          ],
          "id": "03159562-4938-42ab-8d5f-7f7d143b390e",
          "name": "RegistrarIngreso",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro exitoso",
            "completionMessage": "={{ $json.Donante }} Donò Dinero:${{ $json.Dinero }} Especie: {{ $json.Especie }} Cant.{{ $json.Cantidad }}",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            448,
            32
          ],
          "id": "cb29a267-6944-4cc2-a620-8d28cabb9fc9",
          "name": "Exito",
          "webhookId": "8b242983-bddf-4afc-8ba5-457dc1399667"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "leftValue": "={{ $json.Selecciona }}",
                  "rightValue": "Dinero",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  },
                  "id": "e7dffaef-2ab0-4777-a071-419fb0064bc2"
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -816,
            216
          ],
          "id": "b8e2f785-14d9-4a45-9e40-48b95713851f",
          "name": "IfTipoGasto"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -704,
            32
          ],
          "id": "e5e63b15-e33f-4bee-8f17-a13997138b3f",
          "name": "LeerEventosDinero",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1136,
            400
          ],
          "id": "c8e18cb0-4eca-4489-8b54-314376ebd231",
          "name": "LeerEventosEspecie",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Seleccionar Donación\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "options": {
              "formTitle": "Dinero Disponible"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -256,
            32
          ],
          "id": "dfac91dd-644a-4c63-8801-6895a800279a",
          "name": "FormDinero",
          "webhookId": "f8e30269-5ac0-4dc2-9236-ce2c205dbcfb"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Seleccionar Donación\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "options": {
              "formTitle": "Especies Disponibles"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -688,
            400
          ],
          "id": "d872428d-ae26-43f3-a74e-68728e57463c",
          "name": "FormEspecie",
          "webhookId": "63bd287b-6a0b-46ab-8107-c70bb5fe31a9"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "propuestas_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre_de_la_Propuesta).filter(value => value && value.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -240,
            400
          ],
          "id": "e9e1a7c0-aa4e-437a-b076-f71d1ac95459",
          "name": "PreparePropuestas",
          "executeOnce": true
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\":\"Cantidad Usada\",\n      \"fieldType\":\"number\",\n      \"requiredField\":true\n   },\n   {\n      \"fieldLabel\":\"Se uso en:\",\n      \"fieldType\":\"dropdown\",\n      \"fieldOptions\": {\n      \"values\": {{ $json.propuestas_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n   }\n]",
            "options": {
              "formTitle": "={{ $('FormEspecie').first().json['Seleccionar Donación'] }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -16,
            400
          ],
          "id": "69e21c11-6b61-468f-81ac-ad7b69cae235",
          "name": "CantidadEspecie",
          "webhookId": "5c34a035-0413-457b-93b6-dd040df7f401"
        },
        {
          "parameters": {
            "jsCode": "const formData = $('CantidadDinero1').first().json;\nconst donationData = $('FormDinero').first().json;\n\nconst selection = donationData['Seleccionar Donación'];\nconst amount = parseFloat(formData['Cantidad usada']);\n\nconst donanteName = selection.split(' $')[0];\n\nreturn [{\n  json: {\n    donation_name: donanteName,\n    used_amount: amount,\n    use_for: 'Se uso en'\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -128,
            208
          ],
          "id": "b41c05ab-eb80-4735-950a-42a9db71fd75",
          "name": "ExtractDataDinero"
        },
        {
          "parameters": {
            "jsCode": "const formData = $('CantidadEspecie').first().json;\nconst donationData = $('FormEspecie').first().json;\n\nconst selection = donationData['Seleccionar Donación'];\nconst amount = parseFloat(formData['Cantidad Usada']);\nconst useFor = formData['Se uso en:'];\n\n// Separar: \"Albo Jitomate + 2\" -> [\"Albo Jitomate\", \"2\"]\nconst parts = selection.split(' + ');\nconst donantePlusEspecie = parts[0]; // \"Albo Jitomate\"\nconst palabras = donantePlusEspecie.split(' ');\nconst donanteName = palabras[0]; // \"Albo\"\nconst especieName = palabras.slice(1).join(' '); // \"Jitomate\"\n\nreturn [{\n  json: {\n    donation_name: donanteName,\n    especie_name: especieName,\n    used_amount: amount,\n    use_for: useFor\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            208,
            400
          ],
          "id": "644ecd72-384f-42e9-bd5c-a723d625c902",
          "name": "ExtractDataEspecie"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ new Date().toISOString().slice(0, 19).replace('T', ' ') }}",
                "Evento": "GASTO",
                "Donante": "={{ $json.donation_name }}",
                "Dinero": "={{ $json.used_amount }}",
                "Uso": "={{ $('CantidadDinero1').item.json[\"Se uso en:\"] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            96,
            208
          ],
          "id": "739df312-78dd-4c3a-9961-068cfef6d7c3",
          "name": "RegistrarGastoDinero",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list",
              "cachedResultName": "Eventos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1904984712"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Timestamp": "={{ new Date().toISOString().slice(0, 19).replace('T', ' ') }}",
                "Evento": "GASTO",
                "Donante": "={{ $json.donation_name }}",
                "Especie": "={{ $json.especie_name }}",
                "Cantidad": "={{ $json.used_amount }}",
                "Uso": "={{ $json.use_for }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Evento",
                  "displayName": "Evento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Donante",
                  "displayName": "Donante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Especie",
                  "displayName": "Especie",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Dinero",
                  "displayName": "Dinero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Uso",
                  "displayName": "Uso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            432,
            400
          ],
          "id": "fcc7df22-d73d-40d2-a188-e8e8935ed41f",
          "name": "RegistrarGastoEspecie",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Gasto Registrado",
            "completionMessage": "=Gasto de dinero: ${{ $json.Dinero }} de {{ $json.Donante }} Se uso en: {{ $('CantidadDinero1').item.json[\"Se uso en:\"] }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            320,
            208
          ],
          "id": "7d098c3e-bbec-4eb1-8dd0-ca6713c65f83",
          "name": "ExitoDinero",
          "webhookId": "3a2fbe5a-d1f5-4064-bacc-1a8c0bee13e0"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Gasto Registrado",
            "completionMessage": "=Gasto de {{ $json.Donante }}: {{ $json.Cantidad }} {{ $json.Especie }} en {{ $json.Uso }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            656,
            464
          ],
          "id": "e2938949-261a-4b2b-867b-772c2b21234c",
          "name": "ExitoEspecie",
          "webhookId": "f0872a0a-9062-44e7-8d2f-da905de07d48"
        },
        {
          "parameters": {
            "formTitle": "Registrar Movimientos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Tipo de Movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "path": "mov"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1168,
            16
          ],
          "id": "d63c598a-2778-41e4-8e0c-28f11c9e9af6",
          "name": "IngresoGasto1",
          "webhookId": "334246b0-080a-4eff-bdd9-e72e79030cbf"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json['Tipo de Movimiento'] }}",
                        "rightValue": "Ingreso",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2ebca8d7-929b-4f43-ba76-b2db0ff665d9"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json['Tipo de Movimiento'] }}",
                        "rightValue": "Gasto",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "deb2b7d4-faf3-47f2-a7a3-5d1510db9884"
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -944,
            16
          ],
          "id": "3a6f3c86-32ac-4d4b-8db8-a8c76a431392",
          "name": "Switch1"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Selecciona",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Dinero"
                      },
                      {
                        "option": "Especie"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formTitle": "Tipo de Gasto"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -1040,
            216
          ],
          "id": "f8fc6856-aebb-4286-8a5c-0808cb9c1402",
          "name": "SelectGasto1",
          "webhookId": "6d22092c-1d5a-4955-8f43-c1867250546f"
        },
        {
          "parameters": {
            "jsCode": "const eventos = $input.all();\nconst dinero = {};\n\neventos.forEach(evento => {\n  if (parseFloat(evento.json.Dinero) > 0) {\n    const key = evento.json.Donante;\n    if (!dinero[key]) dinero[key] = { ingreso: 0, gasto: 0 };\n    \n    if (evento.json.Evento === 'INGRESO') {\n      dinero[key].ingreso += parseFloat(evento.json.Dinero);\n    } else if (evento.json.Evento === 'GASTO') {\n      dinero[key].gasto += parseFloat(evento.json.Dinero);\n    }\n  }\n});\n\nconst disponibles = Object.keys(dinero)\n  .filter(donante => (dinero[donante].ingreso - dinero[donante].gasto) > 0)\n  .map(donante => `${donante} $${(dinero[donante].ingreso - dinero[donante].gasto).toFixed(2)}`);\n\nreturn [{ json: { dropdown_values: disponibles } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -480,
            32
          ],
          "id": "cc14132a-1bb7-4783-9389-e7031bc23cf8",
          "name": "CalcularDinero1"
        },
        {
          "parameters": {
            "jsCode": "const eventos = $input.all();\nconst especies = {};\n\neventos.forEach(evento => {\n  if (evento.json.Especie && evento.json.Especie.trim() !== '') {\n    const key = `${evento.json.Donante}_${evento.json.Especie}`;\n    if (!especies[key]) especies[key] = { donante: evento.json.Donante, especie: evento.json.Especie, ingreso: 0, gasto: 0 };\n    \n    if (evento.json.Evento === 'INGRESO') {\n      especies[key].ingreso += parseFloat(evento.json.Cantidad) || 0;\n    } else if (evento.json.Evento === 'GASTO') {\n      especies[key].gasto += parseFloat(evento.json.Cantidad) || 0;\n    }\n  }\n});\n\nconst disponibles = Object.values(especies)\n  .filter(item => (item.ingreso - item.gasto) > 0)\n  .map(item => `${item.donante} ${item.especie} + ${item.ingreso - item.gasto}`);\n\nreturn [{ json: { dropdown_values: disponibles } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -912,
            400
          ],
          "id": "504ff096-4a08-40cf-a183-e19d7031a640",
          "name": "CalcularEspecie1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -464,
            400
          ],
          "id": "bd2e8d0c-af2b-4e60-bfe4-43c3e7380582",
          "name": "Propuestas1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "propuestas_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre_de_la_Propuesta).filter(value => value && value.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -576,
            208
          ],
          "id": "9bc7db26-2ecc-4133-b5f0-25ab10b94e20",
          "name": "PreparePropuestas1",
          "executeOnce": true
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -32,
            32
          ],
          "id": "8bf4c505-1d70-42f0-aa99-81b71c9f2926",
          "name": "Propuestas",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\":\"Cantidad usada\",\n      \"fieldType\":\"number\",\n      \"requiredField\":true\n   },\n   {\n      \"fieldLabel\":\"Se uso en:\",\n      \"fieldType\":\"dropdown\",\n      \"fieldOptions\": {\n      \"values\": {{ $json.propuestas_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n   }\n]",
            "options": {
              "formTitle": "={{ $('FormDinero').first().json['Seleccionar Donación'] }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -336,
            208
          ],
          "id": "1372fa0d-660b-4ed5-9071-702473b272f2",
          "name": "CantidadDinero1",
          "webhookId": "100cb684-2057-470a-b7ea-c942fe98b6c1"
        }
      ],
      "connections": {
        "CargarUsuarios": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Datos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datos": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "otro",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "otro": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Cantidades",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cantidades": {
          "main": [
            [
              {
                "node": "RegistrarIngreso",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarIngreso": {
          "main": [
            [
              {
                "node": "Exito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IfTipoGasto": {
          "main": [
            [
              {
                "node": "LeerEventosDinero",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "LeerEventosEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeerEventosDinero": {
          "main": [
            [
              {
                "node": "CalcularDinero1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeerEventosEspecie": {
          "main": [
            [
              {
                "node": "CalcularEspecie1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormDinero": {
          "main": [
            [
              {
                "node": "Propuestas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormEspecie": {
          "main": [
            [
              {
                "node": "Propuestas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PreparePropuestas": {
          "main": [
            [
              {
                "node": "CantidadEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CantidadEspecie": {
          "main": [
            [
              {
                "node": "ExtractDataEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtractDataDinero": {
          "main": [
            [
              {
                "node": "RegistrarGastoDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtractDataEspecie": {
          "main": [
            [
              {
                "node": "RegistrarGastoEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarGastoDinero": {
          "main": [
            [
              {
                "node": "ExitoDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarGastoEspecie": {
          "main": [
            [
              {
                "node": "ExitoEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IngresoGasto1": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "CargarUsuarios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SelectGasto1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SelectGasto1": {
          "main": [
            [
              {
                "node": "IfTipoGasto",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CalcularDinero1": {
          "main": [
            [
              {
                "node": "FormDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CalcularEspecie1": {
          "main": [
            [
              {
                "node": "FormEspecie",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Propuestas1": {
          "main": [
            [
              {
                "node": "PreparePropuestas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PreparePropuestas1": {
          "main": [
            [
              {
                "node": "CantidadDinero1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Propuestas": {
          "main": [
            [
              {
                "node": "PreparePropuestas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CantidadDinero1": {
          "main": [
            [
              {
                "node": "ExtractDataDinero",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {
        "CalcularDinero1": [
          {
            "json": {
              "dropdown_values": [
                "Canino $200.00",
                "Sayuri $50.00",
                "Jose Oscar $50.00",
                "cirpirani $500.00"
              ]
            }
          }
        ]
      },
      "versionId": "ab61b27d-8e4a-4b53-b858-4c5ae0186c14",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-10-07T05:09:38.948Z",
          "createdAt": "2025-10-07T05:09:38.948Z",
          "role": "workflow:owner",
          "workflowId": "3h4vIoadr0i3FuoF",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-27T18:55:39.000Z",
      "createdAt": "2025-11-17T17:11:56.194Z",
      "id": "3sQcBlf3VVgzO8HZ",
      "name": "Activacliente",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -640,
            -256
          ],
          "id": "2f2f2ed5-8e89-4c37-9a08-5c6cf9f0a427",
          "name": "Mensaje",
          "webhookId": "71a341bd-22d2-4675-9587-3be2e3fc6660",
          "credentials": {
            "telegramApi": {
              "id": "ewpSZ9botKj8vnAi",
              "name": "Activacliente"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            384,
            -256
          ],
          "id": "6b41f10d-9eb5-4f74-8768-1e0363415b35",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global Mac \"{{ $('Existe?').item.json[\"MAC ID\"] }}\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            192,
            -64
          ],
          "id": "c6b63492-de7a-4a2d-b416-bca83fd96029",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            400,
            -64
          ],
          "id": "c84a80a4-7f54-4a77-b904-6a52441e3ba9",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=Cliente  {{ $('Existe?').item.json[\"ID Cliente\"] }}, {{ $('Existe?').item.json[\"Nombre completo\"] }} Mac:{{ $('Existe?').item.json[\"MAC ID\"] }} Activado. Corte:{{ $('Existe?').item.json[\"Fecha de corte\"] }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            208,
            112
          ],
          "id": "17e6438e-74c3-47e4-bf8b-56fc6adb6e9d",
          "name": "Exito",
          "webhookId": "12ede80f-309e-4708-b5ae-40186d31885f",
          "credentials": {
            "telegramApi": {
              "id": "ewpSZ9botKj8vnAi",
              "name": "Activacliente"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "for (const item of items) {\n  const text = item.json.message.text; // Accede al campo 'text'\n  const words = text.split(' '); // Divide la cadena por espacios en un array\n\n  // Captura la primera palabra\n  if (words.length > 0) {\n    item.json.primeraPalabra = words[0];\n  }\n\n  // Captura la última palabra\n  if (words.length > 0) {\n    item.json.ultimaPalabra = words[words.length - 1];\n  }\n}\n\nreturn items; // Devuelve los items modificados"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -224,
            -256
          ],
          "id": "993f7d1e-62b1-4ea1-a2ae-32d952f0ffdf",
          "name": "Code"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.primeraPalabra.toLowerCase() }}",
                        "rightValue": "activar",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "36904758-dcb9-4b21-8717-07a37e3f234c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4cfbcc66-f9d5-4f28-92e1-5bf28355a1d9",
                        "leftValue": "={{ $json.primeraPalabra.toLowerCase() }}",
                        "rightValue": "activa",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0ca9f759-b65b-4ad5-b6ae-9ba4f67f7253",
                        "leftValue": "={{ $json.primeraPalabra.toLowerCase() }}",
                        "rightValue": "busca",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "ab1993ec-0a94-45e1-9218-1d42b5e1160b",
                        "leftValue": "={{ $json.primeraPalabra.toLowerCase() }}",
                        "rightValue": "buscar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -48,
            -256
          ],
          "id": "4a9c50c9-5a4e-46bb-a674-99bb1beb7c94",
          "name": "Switch"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json.ultimaPalabra.toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            192,
            -256
          ],
          "id": "2a84256f-599c-4fdd-8b9f-ef715a7e0ace",
          "name": "BuscaID",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -592,
            -96
          ],
          "id": "b02f6f28-3486-4171-a566-63aae76780f3",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3c9b5506-4c2e-4535-b13f-448b3c141d19",
                  "leftValue": "={{ $json['Nombre completo'].trim().toLowerCase() }}",
                  "rightValue": "={{ $('Switch').item.json.ultimaPalabra.toLowerCase() }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -576,
            96
          ],
          "id": "128ffdde-e238-4369-abdf-ca1da66fc753",
          "name": "Existe?1",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "jsCode": "// El input a este nodo 'Code1' son los resultados del filtro 'Existe?1'\n// que a su vez vienen de Google Sheets. Estos items NO CONTIENEN la estructura\n// original del mensaje de Telegram, por lo que 'items[0].json.message.chat.id'\n// causaría el error 'undefined'.\n\n// Para obtener el chat ID, debemos referenciar directamente al nodo original\n// 'Mensaje' (Telegram Trigger) usando la función '$()'.\n// '.first()' se usa para asegurar que tomamos el primer (y usualmente único)\n// ítem emitido por el Telegram Trigger en esta ejecución.\nconst chatId = $('Mensaje').first().json.message.chat.id; // ¡CORRECCIÓN CLAVE AQUÍ!\n\nlet mensajePrincipal = \"\";\n\n// 'items' aquí se refiere a los resultados filtrados de Google Sheets.\nif (items.length > 0) {\n  mensajePrincipal = \"Se encontró:\\n\" +\n                     items.map(item => {\n                       // 'item' aquí es un ítem de los resultados filtrados de Google Sheets\n                       const nombre = item.json['Nombre completo'] || \"N/D\";\n                       const id = item.json['ID Cliente'] || \"N/D\";\n                       return `${nombre} (ID: ${id})`;\n                     }).join('\\n');\n} else {\n  mensajePrincipal = \"No se encontraron clientes que coincidan con su búsqueda.\";\n}\n\n// Devolvemos un nuevo ítem que contiene tanto el mensaje construido como el chat ID.\nreturn [{\n  json: {\n    mensajeParaTelegram: mensajePrincipal,\n    chatId: chatId // El chat ID ya ha sido obtenido y se pasa como una nueva propiedad\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -320,
            48
          ],
          "id": "8c4e8ad4-d032-4776-b440-fe56ab3fe8bf",
          "name": "Code1"
        },
        {
          "parameters": {
            "chatId": "={{ $json.chatId }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -128,
            48
          ],
          "id": "63a883b6-eb75-4d77-b2c1-8d800813e0c3",
          "name": "Resultado",
          "webhookId": "12ede80f-309e-4708-b5ae-40186d31885f",
          "credentials": {
            "telegramApi": {
              "id": "ewpSZ9botKj8vnAi",
              "name": "Activacliente"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.message.chat.id }}",
            "text": "=Me no entender, puedes buscar el id de un nombre, ejem: busca id de juan. Puedes activar un cliente con su id, ejem: activar cliente a234",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            624,
            128
          ],
          "id": "b0473bce-d5a4-485a-b1e2-38bd18c26a8b",
          "name": "nose",
          "webhookId": "12ede80f-309e-4708-b5ae-40186d31885f",
          "credentials": {
            "telegramApi": {
              "id": "ewpSZ9botKj8vnAi",
              "name": "Activacliente"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9ded539e-510e-42d7-b6ef-5afe651acbf6",
                  "name": "message.chat.id",
                  "value": "={{ $('Mensaje').item.json.message.chat.id }}",
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            624,
            -192
          ],
          "id": "e951b0d4-747d-4f1a-90fd-8d9e4d9ebe9d",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.message.chat.id }}",
                        "rightValue": 8193170686,
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        },
                        "id": "b3ab719d-1360-4433-95c4-5dabb646e585"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b5219183-285c-42a2-b76d-1eedc744ba70",
                        "leftValue": "={{ $json.message.chat.id }}",
                        "rightValue": 7972655827,
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -448,
            -256
          ],
          "id": "cbcece2e-fc34-4050-b4e7-b12edd45dd80",
          "name": "Switch1"
        }
      ],
      "connections": {
        "Mensaje": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Exito",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "BuscaID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "BuscaID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaID": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?1": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Resultado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "nose",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "nose",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "3sQcBlf3VVgzO8HZ"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Mensaje": [
          {
            "json": {
              "update_id": 105930698,
              "message": {
                "message_id": 63,
                "from": {
                  "id": 8193170686,
                  "is_bot": false,
                  "first_name": "Canino",
                  "language_code": "es"
                },
                "chat": {
                  "id": 8193170686,
                  "first_name": "Canino",
                  "type": "private"
                },
                "date": 1764173705,
                "text": "Activar b850"
              }
            }
          }
        ]
      },
      "versionId": "6c128392-2316-45ef-8e7b-7959cd4026a5",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-17T17:11:56.210Z",
          "createdAt": "2025-11-17T17:11:56.210Z",
          "role": "workflow:owner",
          "workflowId": "3sQcBlf3VVgzO8HZ",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-11-02T02:44:21.343Z",
          "createdAt": "2025-11-02T02:44:21.343Z",
          "id": "vXjVUnKx0maaFRba",
          "name": "chiquis"
        }
      ]
    },
    {
      "updatedAt": "2025-10-12T19:31:15.000Z",
      "createdAt": "2025-10-11T05:12:01.416Z",
      "id": "4WhfH3wuYQ0mZ0vi",
      "name": "CyberBoxCar",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "carrit-nuevo",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -2032,
            368
          ],
          "id": "19027373-a976-4395-a85c-f9eb023f5d14",
          "name": "Caja",
          "webhookId": "carrit-nuevo"
        },
        {
          "parameters": {
            "jsCode": "const action = $('Switch1').item.json.intencion;\nconst cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nlet message, type;\n\nswitch(action) {\n  case 'modificar':\n    message = 'Cantidad modificada en el carrito.';\n    type = 'success';\n    break;\n  case 'vaciar':\n    message = 'El carrito ha sido vaciado.';\n    type = 'success';\n    break;\n  case 'finalizar':\n    if (cartItems.length === 0) {\n      message = 'No se puede finalizar: el carrito está vacío.';\n      type = 'error';\n    } else {\n      message = 'Compra finalizada exitosamente.';\n      type = 'success';\n    }\n    break;\n  case 'ver':\n    message = 'Contenido actual del carrito:';\n    type = 'info';\n    break;\n  default:\n    message = 'Operación completada.';\n    type = 'info';\n}\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: message,\n            currentCart: [],\n            cartTotal: 0,\n            type: type\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.product_id} - ${cantidad} x $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        text: message,\n        currentCart: formattedItems,\n        cartTotal: totalGeneral,\n        type: type\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -912,
            608
          ],
          "id": "5924ab53-9b5f-4f48-9090-001b80b594d8",
          "name": "FormatOtherResponses"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "52fd61d2-793b-4707-9bf0-a626728cca37",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1600,
            320
          ],
          "id": "374da625-d3a2-4d84-b20d-59c9261ded89",
          "name": "Switch1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('Find1').item.json }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1152,
            96
          ],
          "id": "213b361e-d8fa-4047-a07a-9a7328f7f3d2",
          "name": "If2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('Buscar1').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('Buscar1').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('Buscar1').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Switch1').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": false
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1376,
            96
          ],
          "id": "cf175a25-2a1f-439b-8193-1b1d5558dc5f",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            -640,
            720
          ],
          "id": "b4765f3c-9115-4a5a-8342-c7a0141c775d",
          "name": "Respond to Webhook1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "da24ee7f-0719-4be1-ae5c-d6d601393539",
                  "name": "text",
                  "value": "Producto añadido/actualizado al carrito.",
                  "type": "string"
                },
                {
                  "id": "329742e7-97b9-4ad9-9858-12b361dd1471",
                  "name": "currentCart",
                  "value": "={{ $('total1').item.json.currentCart }}",
                  "type": "array"
                },
                {
                  "id": "cart-total-fixed",
                  "name": "cartTotal",
                  "value": "={{ $('total1').item.json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "add-update-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -720,
            480
          ],
          "id": "921b3d5c-2d61-427c-96b3-e91aa4cc8c1d",
          "name": "Add/Update Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "vaciar-text",
                  "name": "text",
                  "value": "El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "vaciar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "vaciar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "vaciar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1376,
            608
          ],
          "id": "a79de6ca-85c5-4b72-b96e-ca41fa790767",
          "name": "Vaciar Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "error-text",
                  "name": "text",
                  "value": "Ha ocurrido un error inesperado.",
                  "type": "string"
                },
                {
                  "id": "error-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "error-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "error-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1152,
            608
          ],
          "id": "97b2f805-9daf-4f51-9fac-0479dea6ce3d",
          "name": "Error Response1"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' ');\n\nconst intencion = parts[0];\nconst id = parts[1];\nconst cantidad = parseInt(parts[2]) || 1;\n\n// Capturar datos del usuario del body\nconst user_id = $input.first().json.body.user_id;\nconst session_id = $input.first().json.body.session_id;\nconst username = $input.first().json.body.username;\n\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad,\n    user_id: user_id,\n    session_id: session_id,\n    username: username\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1808,
            368
          ],
          "id": "b236ddd0-c028-460a-91e9-3b7c1ea9e362",
          "name": "Intencion1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "not-found-text",
                  "name": "text",
                  "value": "={{ $json.mergedText }}",
                  "type": "string"
                },
                {
                  "id": "not-found-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "not-found-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "not-found-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -928,
            416
          ],
          "id": "385e8172-8788-4a02-981f-4cc9682b7961",
          "name": "Product Not Found Response1"
        },
        {
          "parameters": {
            "jsCode": "if (!items || items.length === 0) {\n    return [{ json: { mergedText: `No se encontraron productos con: ${$('Switch1').item.json.id}` } }];\n}\n\nconst result = [];\nfor (const item of items) {\n    if (item.json && item.json.id) {\n        result.push(`ID: ${item.json.id}, ${item.json.nombre}, Precio: ${item.json.precio}`);\n    }\n}\n\nreturn [{ json: { mergedText: result.length > 0 ? result.join('\\n') : 'No se encontraron productos válidos' } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1152,
            272
          ],
          "id": "ed7b0153-ee85-4ee4-a8bd-228a3d0d6fda",
          "name": "Code1",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "jsCode": "const cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: \"El carrito está vacío.\",\n            currentCart: [],\n            cartTotal: 0,\n            type: \"info\"\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.product_id} - ${cantidad} x $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        currentCart: formattedItems,\n        cartTotal: totalGeneral\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -720,
            288
          ],
          "id": "703cd6b2-d875-45be-a53e-e3dce54e01c5",
          "name": "total1"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "products",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Switch1').item.json.id.toUpperCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -2016,
            176
          ],
          "id": "e1c8a7f0-e79d-458c-821a-6837515d16e9",
          "name": "Buscar1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "product_id",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                },
                {
                  "keyName": "session_id",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1600,
            96
          ],
          "id": "5dcab58f-ad0e-4b60-abe7-fc5094fe43b7",
          "name": "Find1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $json.id }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "user_id",
                  "fieldValue": "={{ $('Switch1').item.json.user_id }}"
                },
                {
                  "fieldId": "session_id",
                  "fieldValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -928,
            80
          ],
          "id": "53cab07f-6ec3-4bef-8a61-fd2fc6087346",
          "name": "Create a row2",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "products",
            "limit": 10,
            "filters": {
              "conditions": [
                {
                  "keyName": "nombre",
                  "condition": "fullText",
                  "searchFunction": "plfts",
                  "keyValue": "={{ $('Switch1').item.json.id.toLowerCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1376,
            256
          ],
          "id": "aeda2a6a-b27d-472b-b156-7b645d2f776f",
          "name": "BuscaNombre1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart",
            "limit": 30,
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -720,
            80
          ],
          "id": "59dbcf32-e548-4c30-bc73-ed34788dfcb1",
          "name": "GetCart1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "product_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.id.toUpperCase() }}"
                },
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $('Switch1').item.json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1152,
            448
          ],
          "id": "35440de3-f796-443c-a444-8079017c3438",
          "name": "Modifica1",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "product_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                },
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $('Find1').item.json.cantidad + $('Switch1').item.json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -928,
            256
          ],
          "id": "46b40a3d-921b-4203-8b5c-8d242fd4f7cf",
          "name": "Update1",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -2016,
            608
          ],
          "id": "9b4e8739-63e8-4e3f-ab80-7828d6ff0b78",
          "name": "TraerCarrito1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $('Buscar1').item.json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1824,
            192
          ],
          "id": "c64427ed-e927-4f6c-83a9-0987b69df7da",
          "name": "existe?1",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Switch1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1376,
            448
          ],
          "id": "993f68e8-33f7-462c-a1fd-9d3b50144a67",
          "name": "Delete a row1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5f4d63ef-8888-4fc9-9d59-d0ea3b0062f0",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1824,
            624
          ],
          "id": "ad4bd36d-ad02-4ba7-a152-33146da4d5ae",
          "name": "If3"
        },
        {
          "parameters": {
            "tableId": "sales",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $json.product_id }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "precio_venta",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.cantidad * $json.precio }}"
                },
                {
                  "fieldId": "user_id",
                  "fieldValue": "={{ $('Intencion1').item.json.user_id }}"
                },
                {
                  "fieldId": "username",
                  "fieldValue": "={{ $('Intencion1').item.json.username }}"
                },
                {
                  "fieldId": "session_id",
                  "fieldValue": "={{ $('Intencion1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1600,
            640
          ],
          "id": "86ca47ff-7965-492b-ab13-38e3d1295af9",
          "name": "Create a row3",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        }
      ],
      "connections": {
        "Caja": {
          "main": [
            [
              {
                "node": "Intencion1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormatOtherResponses": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Buscar1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modifica1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "TraerCarrito1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Create a row2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add/Update Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion1": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Product Not Found Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Product Not Found Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "total1": {
          "main": [
            [
              {
                "node": "Add/Update Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar1": {
          "main": [
            [
              {
                "node": "existe?1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find1": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row2": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaNombre1": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GetCart1": {
          "main": [
            [
              {
                "node": "total1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modifica1": {
          "main": [
            [
              {
                "node": "FormatOtherResponses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update1": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TraerCarrito1": {
          "main": [
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?1": {
          "main": [
            [
              {
                "node": "BuscaNombre1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Find1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row1": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row3": {
          "main": [
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "CrQZH6IcS4O0J61T"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Caja": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",
                "content-length": "85",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "98d901a298fa2e19-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "3dfa04ea-ce22-43a1-8dc8-c39026dc5e2e",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "message": "finalizar",
                "user_id": 1,
                "username": "admin",
                "session_id": "1_1760297326956"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/carrit-nuevo",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "16aa4654-42ef-4fe8-956f-d230b342fd76",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-10-11T05:12:01.428Z",
          "createdAt": "2025-10-11T05:12:01.428Z",
          "role": "workflow:owner",
          "workflowId": "4WhfH3wuYQ0mZ0vi",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-05-28T03:47:22.000Z",
      "createdAt": "2025-05-22T04:33:43.161Z",
      "id": "5tTKIC7b0IdTVHCq",
      "name": "IngresosyGastosChi2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            -1320,
            -880
          ],
          "id": "f9a19b30-2cd5-4e2e-9a33-9c89bad0edfb",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c6e167ae-b485-4606-ad68-ece6352dfbf2",
                  "name": "Fecha actual",
                  "value": "={{ new Date().toLocaleDateString('es-MX') }}",
                  "type": "string"
                },
                {
                  "id": "e84595c9-917a-4f21-abb5-cc71c4be3271",
                  "name": "monto_calculo",
                  "value": "={{ $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad * -1 : $json.Cantidad }}",
                  "type": "number"
                },
                {
                  "id": "913223cf-2b7e-46fd-92e9-01804d18f130",
                  "name": "Nombre",
                  "value": "={{ $json.nombreUsuario }}",
                  "type": "string"
                },
                {
                  "id": "2b9561b2-de66-4feb-a308-e87e56d7882b",
                  "name": "Movimiento",
                  "value": "={{ $json.tipoMovimiento }}",
                  "type": "string"
                },
                {
                  "id": "e3c4c339-ce58-491f-bb0c-66c222c2919c",
                  "name": "cantidad",
                  "value": "={{ $json.cantidad }}",
                  "type": "string"
                },
                {
                  "id": "043a4948-4c00-4786-ace1-e8df6f97f0fa",
                  "name": "concepto",
                  "value": "={{ $json.concepto }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1720,
            -1100
          ],
          "id": "0bd3386d-c963-4e26-8b58-fc653bed33bf",
          "name": "CapturaDatos"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5727c573-ad23-4d04-8c02-ba2d35b64a8c",
                  "leftValue": "={{ $json.Comprobante != null }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1540,
            -1100
          ],
          "id": "731f2126-08a8-49ed-a378-254813d9991a",
          "name": "Comprobante?"
        },
        {
          "parameters": {
            "inputDataFieldName": "Comprobante",
            "name": "={{ $json.Concepto }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh",
              "mode": "list",
              "cachedResultName": "Gastos",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh"
            },
            "options": {
              "simplifyOutput": true
            }
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -1720,
            -880
          ],
          "id": "60a0b56f-137f-4c64-9d07-8ade8c517340",
          "name": "GuardComp",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "67019d5c-39a2-442a-bee2-b24cea72d202",
                  "name": "Comprobante",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1320,
            -1100
          ],
          "id": "210d05f4-36d7-4fba-8f75-46150cb503e4",
          "name": "SinComp"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "eed4cf15-ff7b-4786-bb29-f2bdd545c747",
                  "name": "link_comprobante_gsheet",
                  "value": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1520,
            -880
          ],
          "id": "e4a05cb0-3a17-469d-87cb-6765acbc206b",
          "name": "Linkcomp"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $json.formattedDate }}",
                "Cliente/Concepto": "={{ $('LimpiarDatos').item.json.Concepto }}",
                "Comprobante": "={{ $('LimpiarDatos').item.json.LinkCompro }}",
                "Lup-Ing": "={{ $('LimpiarDatos').item.json.LupitaIngr }}",
                "Lup-Gas": "={{ $('LimpiarDatos').item.json.LupitaGast }}",
                "Ber-Ing": "={{ $('LimpiarDatos').item.json.BertIng }}",
                "Ber-Gas": "={{ $('LimpiarDatos').item.json.BertGast }}",
                "Ald-Ing": "={{ $('LimpiarDatos').item.json.AldoIng }}",
                "Ald-Gas": "={{ $('LimpiarDatos').item.json.AldoGas }}",
                "--": "-"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -1380,
            -660
          ],
          "id": "dcb611d4-3db7-4450-ba63-3a91275db78a",
          "name": "RegMov.",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f8892c3a-51e9-4c0b-821b-2ae4a48e6638",
                  "name": "LupitaIngr",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "0586845b-1ea8-47b4-9ad5-bbe997006e1f",
                  "name": "LupitaGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "e7956a2e-3f3b-44ff-a43f-9c6a3f78c2d0",
                  "name": "BertIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "eac02c77-4700-498b-9f04-ad661d5dc576",
                  "name": "BertGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "108813e8-47f8-4bc0-affc-f55cc86c75fc",
                  "name": "AldoIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "83a6dc15-9a49-4f65-9ab3-564cf164fcf3",
                  "name": "AldoGas",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "f269177f-0744-46bf-a724-3efb5ee06dc2",
                  "name": "LinkCompro",
                  "value": "={{ $json.link_comprobante_gsheet }}",
                  "type": "string"
                },
                {
                  "id": "a5ad16ad-dd7e-4cdb-bc71-a54977ad4b8c",
                  "name": "Concepto",
                  "value": "={{ $('Comprobante?').item.json.Concepto }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1840,
            -660
          ],
          "id": "2a91ef40-a8cd-4008-9d25-d40589690674",
          "name": "LimpiarDatos"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $('Comprobante?').item.json.submittedAt }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -1600,
            -660
          ],
          "id": "e25ea28c-1b27-4890-a0ee-888fde0c44c7",
          "name": "Date & Time"
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "user_chat_id",
                  "type": "number"
                },
                {
                  "name": "Nombre"
                },
                {
                  "name": "Movimiento"
                },
                {
                  "name": "Concepto"
                },
                {
                  "name": "Cantidad",
                  "type": "number"
                },
                {
                  "name": "Comprobante",
                  "type": "any"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -1940,
            -900
          ],
          "id": "920e0a83-a726-426a-a8ae-75f2486dc07e",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "585c1fb4-21a6-447b-b773-1807dafd8cd5",
                  "name": "Nombre",
                  "value": "={{ $('LimpiarDatos').item.json.Nombre }}",
                  "type": "string"
                },
                {
                  "id": "2bc6154a-5ee1-4c83-a53e-f228037be435",
                  "name": "Movimiento",
                  "value": "={{ $('LimpiarDatos').item.json.Movimiento }}",
                  "type": "string"
                },
                {
                  "id": "eed33e2b-e8f1-4603-aeb0-45f8a45859bc",
                  "name": "Ingreso",
                  "value": "={{ $('LimpiarDatos').item.json.Cantidad }}",
                  "type": "string"
                },
                {
                  "id": "fce9a2bd-2ce4-4e7b-8b13-a22961f2ea97",
                  "name": "Fecha actual",
                  "value": "={{ $('LimpiarDatos').item.json[\"Fecha actual\"] }}",
                  "type": "string"
                },
                {
                  "id": "f71670a6-60c2-40dc-9ba2-3f4932067c9c",
                  "name": "Gasto",
                  "value": "={{ $('LimpiarDatos').item.json.monto_calculo }}",
                  "type": "string"
                },
                {
                  "id": "96b3868e-1ae3-4e6e-9403-cd0e77bb5280",
                  "name": "LinkCompro",
                  "value": "={{ $('LimpiarDatos').item.json.LinkCompro }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1120,
            -540
          ],
          "id": "f682aec2-a4c0-4f51-b095-698ab41129d4",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Lupita"
                      },
                      {
                        "option": "Bertin"
                      },
                      {
                        "option": "Aldo"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Tipo de Movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Concepto",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Comprobante",
                  "fieldType": "file",
                  "multipleFiles": false
                }
              ]
            },
            "options": {
              "formTitle": "Registrar Movimiento"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -1940,
            -1100
          ],
          "id": "42e146c4-d479-4dd3-8270-94d0a9a5bc0d",
          "name": "Form",
          "webhookId": "41c7c387-6594-4a05-b7f0-76caf0f28a3c"
        }
      ],
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "LimpiarDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CapturaDatos": {
          "main": [
            [
              {
                "node": "Comprobante?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Comprobante?": {
          "main": [
            [
              {
                "node": "GuardComp",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SinComp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardComp": {
          "main": [
            [
              {
                "node": "Linkcomp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SinComp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Linkcomp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "RegMov.": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarDatos": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "RegMov.",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "CapturaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            []
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "CapturaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "2ac7b1fd-3dcd-4c22-9031-71311c2db946",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-05-22T04:33:43.177Z",
          "createdAt": "2025-05-22T04:33:43.177Z",
          "role": "workflow:owner",
          "workflowId": "5tTKIC7b0IdTVHCq",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-18T01:45:14.000Z",
      "createdAt": "2025-05-20T01:40:55.468Z",
      "id": "6QNyHhxbFOTuqw92",
      "name": "MikrotikChiqis",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net ':global Mac \"{{ $json[\"MAC ID\"] }}\"; :global Name \"{{ $json[\"ID Cliente\"] }}\"; :put (\"Activado:\" . [/ip hotspot ip-binding print count-only where mac-address=$Mac]); :local leaseId [:pick [/ip dhcp-server lease find where mac-address=$Mac] 0]; :if ($leaseId != \"\") do={ :put (\"Conectado:\" . [/ip dhcp-server lease get $leaseId status]); } else={ :put \"Conectado:no-encontrado\"; }; :local schedulerId [:pick [/system scheduler find where name=$Name] 0]; :if ($schedulerId != \"\") do={ :put (\"FechaCorte:\" . [/system scheduler get $schedulerId next-run]); } else={ :put \"FechaCorte:no-encontrado\"; };'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -1280,
            -240
          ],
          "id": "19a070cf-722b-4018-b3be-c96ac91ea32f",
          "name": "ConsultaStatus"
        },
        {
          "parameters": {
            "formTitle": "Estado del Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Ingresa ID Cliente",
                  "requiredField": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1300,
            -480
          ],
          "id": "70522e3c-d10c-441b-978e-84d76f180c24",
          "name": "ID Cliente",
          "webhookId": "01fe4cf3-e452-4ed0-85dd-cb6512907072"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json[\"Ingresa ID Cliente\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -1060,
            -480
          ],
          "id": "9bb29ba4-cf0a-4aad-b9fe-79f6c24e8e84",
          "name": "Buscar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Resultado",
            "completionMessage": "={{ $('Buscar').item.json[\"ID Cliente\"] }} {{ $('Buscar').item.json[\"Nombre completo\"] }} {{ $('Buscar').item.json[\"MAC ID\"] }} {{ $json.output }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -660,
            -140
          ],
          "id": "6647593c-3dcf-493d-be1b-3d2819d9231f",
          "name": "Resultado",
          "webhookId": "e2cbaac1-cde5-4313-ac60-b867dfd0e876"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.stdout }}",
            "options": {
              "systemMessage": "Eres un asistente experto en reemplazar palabras, tienes ùnicamente la funcion de cambiar algunas palabras en el texto recibido, de la siguiente manera:\nSi Activado:1 entonces cambiar por Activado:Activado\nSi Activado:0 entonces cambiar por Activado:Desactivado\nSi Activado es distinto de 1, 0, cambiar por Activado:error\nSi Conectado:waiting cambiar por Conectado:Desconectado\nSi Conectado:bound cambiar por Conectado:Conectado\nSi Conectado es distinto de waiting, bound, cambiar por Conectado:error\n\nEl text recibido debe conservar su estructura original con las nuevas palabras."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -1100,
            -240
          ],
          "id": "f3f59ca1-255f-430d-a951-0f1f138c7382",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -800,
            -280
          ],
          "id": "6a996bbf-29d0-4c98-8b4e-1d1b82f4a956",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        }
      ],
      "connections": {
        "ConsultaStatus": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "ConsultaStatus",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Resultado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "b5c6271c-0f1e-4c58-8aae-3d88ad910c17",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-20T01:40:55.477Z",
          "createdAt": "2025-05-20T01:40:55.477Z",
          "role": "workflow:owner",
          "workflowId": "6QNyHhxbFOTuqw92",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-15T03:28:49.000Z",
      "createdAt": "2025-08-04T20:38:56.053Z",
      "id": "6qDeTkqGyaEvvHE7",
      "name": "1MesTicket",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "buttonLabel": "Enviar",
              "path": "1Mes"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -640,
            -576
          ],
          "id": "e50eab6d-8f19-48bb-9094-2e55c57bf3b7",
          "name": "ID Cliente",
          "webhookId": "ddc26433-a54c-4b1e-a3bb-3c1447eebd71"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -432,
            -576
          ],
          "id": "499c3cb6-4063-4f6e-8e17-c99aaa9a5f7c",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -224,
            -576
          ],
          "id": "7ea7362a-9ec6-4b30-bdf4-cf968329648b",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 10,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Cargar Comprobante para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -224,
            -160
          ],
          "id": "9d9bf231-2404-4552-98f4-16b48a74ddc8",
          "name": "CargarPago",
          "webhookId": "2be449ef-5a47-46df-baaf-e893c4a86f0a"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            400,
            -576
          ],
          "id": "57266b8c-6363-4599-8c97-a371efdbb3f5",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "timeUnit": "months",
            "duration": "={{ $('AddCant').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            608,
            -592
          ],
          "id": "e5e59758-d88f-4708-bf05-0d6d22e62cfe",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -16,
            -560
          ],
          "id": "cfe699c6-5159-40b1-8232-9d333137a786",
          "name": "Error",
          "webhookId": "c8553210-c36a-497c-b403-e7b6cc02a210"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $json.fecha }}",
            "timeUnit": "months",
            "duration": 1,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            448,
            -416
          ],
          "id": "e541b969-605e-4e0a-99dd-45a25e10bb28",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            224,
            -576
          ],
          "id": "4a0780a7-0cc4-4b70-94b5-68f20076af52",
          "name": "PlanNuevo",
          "alwaysOutputData": true
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            832,
            -576
          ],
          "id": "df1af4cf-0b46-449b-abe0-af0ab3dd40e7",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            848,
            -416
          ],
          "id": "12cda081-23f2-44f2-87c7-c69c128d2530",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            432,
            -240
          ],
          "id": "cb7dc39a-da9f-47cc-b57c-72a21d766d69",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "disabled": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "limitWaitTime": true,
            "resumeAmount": 20,
            "resumeUnit": "minutes",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            640,
            -432
          ],
          "id": "d6be5d3e-0682-48ca-8da2-f440f515fdb1",
          "name": "Form",
          "webhookId": "defa5022-2ebe-4b2d-95df-92e0b2b5fed9"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            224,
            -192
          ],
          "id": "d629968c-b226-4d1d-b517-4ba6c709122f",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $today.format('MMM-dd') }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -80,
            -48
          ],
          "id": "c172ae33-1225-4c7d-b40b-a688e66e23e9",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $json.cantidad }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $json.cantidad }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $json.cantidad }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -224,
            -368
          ],
          "id": "0d49783b-f4fd-4d28-a590-a7c6d6fa1ff5",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -48,
            -400
          ],
          "id": "0189bf15-07ea-44be-91da-621e78ed7042",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -64,
            -240
          ],
          "id": "be60166d-e141-42a8-bd40-63c51e978bff",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            64,
            -320
          ],
          "id": "03421538-8ada-4472-a491-c2663904c961",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -640,
            -384
          ],
          "id": "102f5ee2-169f-4703-ac7e-51632af4d1cd",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -432,
            -384
          ],
          "id": "0aa33602-ff3a-4d83-b624-26d9177e7801",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Code').item.json.fecha }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Code').item.json.cuenta_destino_ultima_parte == '***0274' ? $('Code').item.json.cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Code').item.json.cuenta_destino_ultima_parte == '***9712' ? $('Code').item.json.cantidad : null }} ",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Code').item.json.cuenta_destino_ultima_parte == '***905' ? $('Code').item.json.cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Code').item.json.cuenta_destino_ultima_parte }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Code').item.json.cantidad }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "1a71be0f-eb3c-4f01-b639-8731d3bc87b0",
                  "name": "NuevoPlan",
                  "value": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            256,
            -400
          ],
          "id": "198c70e9-2917-411b-8332-7f75db80ad9e",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Deseas agregar un nuevo pago?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Si, Nuevo Pago"
                      },
                      {
                        "option": "No, Cancelar"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formTitle": "EL PAGO YA HA SIDO REGISTRADO!! ... El pago de este periodo para el usuario:",
              "formDescription": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}",
              "buttonLabel": "Aceptar"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -640,
            -208
          ],
          "id": "43bb1fb5-9086-472d-b528-6ad0167dcd6d",
          "name": "Error1",
          "webhookId": "6599920f-a446-4a89-a2f1-1d0465650d73"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            640,
            -128
          ],
          "id": "6219991d-d996-48ce-8a24-808e50ef0c35",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            912,
            -32
          ],
          "id": "f671c821-eda5-4a66-92a7-6020a5380d28",
          "name": "Form1",
          "webhookId": "6fa51534-80c2-4f06-bd9f-8b5bb5aaf5fc"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            368,
            -96
          ],
          "id": "5f799800-7899-4c8b-b7a4-1ce098217bb9",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago {{ $('DatosListos').item.json['ID Cliente'] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Plan Pagado: {{ $('DatosListos').item.json.NuevoPlan }} y Cantidad pagada ${{ $('DatosListos').item.json['Cantidad Pagada'] }}, esten correctos, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            848,
            -208
          ],
          "id": "a51ec347-e087-4b91-a9c4-cb0dac1c7cd5",
          "name": "Sandra",
          "webhookId": "348fa3a7-d62d-4cc0-8925-68be6759c61c",
          "credentials": {
            "telegramApi": {
              "id": "zw8x3sw3diiq8YH3",
              "name": "Telegram account 2"
            }
          }
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Cancelado",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -640,
            -48
          ],
          "id": "68db4015-3553-4b24-ac7d-fd1300836655",
          "name": "canino1",
          "webhookId": "348fa3a7-d62d-4cc0-8925-68be6759c61c",
          "credentials": {
            "telegramApi": {
              "id": "zw8x3sw3diiq8YH3",
              "name": "Telegram account 2"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3d202440-2f61-46b2-9680-183bdcbf8038",
                  "leftValue": "={{ $json[\"Deseas agregar un nuevo pago?\"] }}",
                  "rightValue": "Si, Nuevo Pago",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -448,
            -224
          ],
          "id": "cd4d4426-8ec3-44ae-9d1d-78f801aa79a8",
          "name": "If"
        },
        {
          "parameters": {
            "resource": "image",
            "operation": "analyze",
            "modelId": {
              "__rl": true,
              "value": "models/gemini-1.5-pro-latest",
              "mode": "list",
              "cachedResultName": "models/gemini-1.5-pro-latest"
            },
            "text": "Extrae cantidad, fecha, cuenta, concepto",
            "inputType": "binary",
            "binaryPropertyName": "Cargar_comprobante",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.googleGemini",
          "typeVersion": 1,
          "position": [
            64,
            -144
          ],
          "id": "0c8ba483-43d5-49e5-900e-6797e5ece4bc",
          "name": "Analyze image",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const item = items[0];\n\n// Accede al texto extraído de la imagen.\n// La ruta es 'content.parts[0].text' según tu captura de pantalla.\nconst extractedText = item.json.content.parts[0].text;\n\nlet cantidad = null;\nlet fecha = null;\nlet cuentaDestinoUltimaParte = null;\nlet concepto = null;\n\n// --- Expresiones regulares para extraer la información ---\n\n// Cantidad: Busca \"**Amount:**\" o \"**Cantidad:**\"\nconst cantidadMatch = extractedText.match(/\\*\\*(?:Amount|Cantidad):\\*\\*[\\s\\S]*?\\$?([\\d.,]+)/i);\nif (cantidadMatch && cantidadMatch[1]) {\n    cantidad = parseFloat(cantidadMatch[1].replace(/,/g, ''));\n}\n\n// Fecha: Busca \"**Date:**\" o \"**Fecha:**\"\nconst fechaMatch = extractedText.match(/\\*\\*(?:Date|Fecha):\\*\\*[\\s\\S]*?(\\d{2}\\/\\w{3}\\/\\d{4})/i);\nif (fechaMatch && fechaMatch[1]) {\n    fecha = fechaMatch[1];\n}\n\n// Cuenta Destino (última parte)\nconst cuentaDestinoFullMatch = extractedText.match(/\\*\\*(?:Receiver Account \\(Cuenta\\s*destino\\)|Cuenta Destino):\\*\\*[\\s\\S]*?([\\w\\s]+? \\*\\*\\*\\d{3})/i);\nif (cuentaDestinoFullMatch && cuentaDestinoFullMatch[1]) {\n    const fullAccountString = cuentaDestinoFullMatch[1];\n    const parts = fullAccountString.split(' ');\n    if (parts.length > 0) {\n        cuentaDestinoUltimaParte = parts[parts.length - 1];\n    }\n}\n\n// CONCEPTO: VERSIÓN EXTREMADAMENTE SIMPLE Y AMPLIA (ASUME QUE ES EL ÚLTIMO CAMPO RELEVANTE)\n// Busca **Concepto:** y luego captura CUALQUIER COSA hasta el final de la cadena.\n// Esto debería atraparlo a menos que el texto esté truncado o haya algo muy raro.\nconst conceptoMatch = extractedText.match(/\\*\\*Concepto:\\*\\*[\\s\\S]*?([\\s\\S]+)$/i);\nif (conceptoMatch && conceptoMatch[1]) {\n    concepto = conceptoMatch[1].trim(); // Trim para limpiar espacios/saltos de línea extra\n}\n\n\n// --- Asigna los datos extraídos directamente al item.json ---\nitem.json.cantidad = cantidad;\nitem.json.fecha = fecha;\nitem.json.cuenta_destino_ultima_parte = cuentaDestinoUltimaParte;\nitem.json.concepto = concepto;\n\n// --- Opcional: Eliminar la estructura 'content' ---\ndelete item.json.content;\n\n// Devuelve el item modificado\nreturn [item];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -400,
            -64
          ],
          "id": "d8202623-7e96-4516-be6b-36a946a94c61",
          "name": "Code"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            688,
            -272
          ],
          "id": "3a517051-ac71-42d2-a75f-b0e5cd3958b0",
          "name": "Send a message",
          "webhookId": "8300d660-3e18-4436-8867-0105076d20fb",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              },
              {
                "node": "Analyze image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Send a message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error1": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "canino1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Analyze image": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Send a message": {
          "main": [
            [
              {
                "node": "Sandra",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "35723e86-272f-4083-8c82-076430950aed",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-04T20:38:56.066Z",
          "createdAt": "2025-08-04T20:38:56.066Z",
          "role": "workflow:owner",
          "workflowId": "6qDeTkqGyaEvvHE7",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-09T02:14:13.000Z",
      "createdAt": "2025-09-10T01:40:59.201Z",
      "id": "7p2sueTvNcxsBvO8",
      "name": "ChanequePropuesta",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": " --- Propuestas ---",
            "formDescription": "Para hacer una Propuesta o Apoyar una propuesta selecciona una opciòn",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Selecciona",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Hacer una Propuesta"
                      },
                      {
                        "option": "Apoyar una Propuesta"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldName": "Id",
                  "fieldType": "hiddenField"
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "prop",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.3,
          "position": [
            -288,
            -192
          ],
          "id": "01c7f420-4463-44f9-881d-e7f53fb87949",
          "name": "Propuestas",
          "webhookId": "2c3b4b4d-ee2e-44f2-b068-19b39c077263"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.Selecciona }}",
                        "rightValue": "Hacer una Propuesta",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "49977eaa-f16b-47fd-b5b7-33ebc20004f4"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "7fb59f38-8e83-4ae9-9d2c-758be794b22b",
                        "leftValue": "={{ $json.Selecciona }}",
                        "rightValue": "Apoyar una Propuesta",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -96,
            -208
          ],
          "id": "c81e83c1-d895-462d-9719-9dc43da1d2ad",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre de la Propuesta",
                  "placeholder": "Asigna un nombre a tu propuesta",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Describe tu propuesta",
                  "placeholder": "Propongo que ....",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Describe que puedes aportar para que se realice",
                  "placeholder": "Puedo apoyar con....",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Describe que materiales o que se necesita para que se realice",
                  "placeholder": "Se necesita .....",
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 10,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Realizar propuesta",
              "formDescription": "={{ $json.Nombre }} propone que...",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            352,
            -320
          ],
          "id": "00fb35f0-d14d-4423-88fc-7cfd8e5fa892",
          "name": "Propuesta",
          "webhookId": "38cb53a6-d7eb-43ab-8fed-90a278380927"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Propuesta registrada con èxito",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            768,
            -320
          ],
          "id": "7d7bb0f4-e241-4dda-a5a8-6576f1a5b8e2",
          "name": "Exito",
          "webhookId": "ff63fcdc-8810-4885-b02e-942ca1b51a1f"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Id",
                  "lookupValue": "={{ $json.formQueryParameters.Id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            128,
            -320
          ],
          "id": "e0abf934-046d-4b1c-b457-5db716ce6f72",
          "name": "IDUsuario",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list",
              "cachedResultName": "Propuesta",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1596068065"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Id": "={{ $('IDUsuario').item.json.Id }}",
                "Nombre": "={{ $('IDUsuario').item.json.Nombre }}",
                "Propuesta": "={{ $json[\"Describe tu propuesta\"] }}",
                "Que puedo aportar": "={{ $json[\"Describe que puedes aportar para que se realice\"] }}",
                "Se necesita": "={{ $json[\"Describe que materiales o que se necesita para que se realice\"] }}",
                "Fecha": "={{ $json.submittedAt.toDateTime().format('dd-MM-yyyy') }}",
                "Nombre_de_la_Propuesta": "={{ $json[\"Nombre de la Propuesta\"] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre_de_la_Propuesta",
                  "displayName": "Nombre_de_la_Propuesta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Propuesta",
                  "displayName": "Propuesta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Se necesita",
                  "displayName": "Se necesita",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Que puedo aportar",
                  "displayName": "Que puedo aportar",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            560,
            -320
          ],
          "id": "1cd3c9f8-1553-473f-b90b-21a795f04f78",
          "name": "Guardar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list",
              "cachedResultName": "Propuesta",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1596068065"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            128,
            -160
          ],
          "id": "e15c1231-a041-4cd8-b208-21a0edb67af1",
          "name": "GetPropuestas",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"Nombre del Proyecto\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.dropdown_values.map(item => ({ option: item })) }}\n    },\n    \"requiredField\": true\n  }\n]",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Selecciona el Proyecto a Apoyar",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            560,
            -160
          ],
          "id": "bc39cf9a-0abc-4091-b43c-98cfd18156fe",
          "name": "Datos",
          "webhookId": "f5f9a577-29d8-4b27-a74e-de550b7619cf"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "cd46da9c-54a4-4ccd-9d09-f98959af96ce",
                  "name": "dropdown_values",
                  "value": "={{ $input.all().map(item => item.json.Nombre_de_la_Propuesta).filter(name => name && name.trim() !== '').filter((value, index, self) => self.indexOf(value) === index) }}",
                  "type": "array"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            352,
            -160
          ],
          "id": "a88f8a58-6213-4296-b720-c13e56e80c2a",
          "name": "Titulos",
          "executeOnce": true
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list",
              "cachedResultName": "Propuesta",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1596068065"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Nombre_de_la_Propuesta",
                  "lookupValue": "={{ $json[\"Nombre del Proyecto\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            768,
            -160
          ],
          "id": "a310d69d-168d-47e5-b052-e1a5970c73bd",
          "name": "PropuestaDatos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Describe como puedes apoyar",
                  "placeholder": "Apoyo con ....."
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "=Propuesta: {{ $json.Nombre_de_la_Propuesta }}",
              "formDescription": "=Se Necesita: {{ $json[\"Se necesita\"] }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            128,
            16
          ],
          "id": "3a0e4a52-991c-41c0-9913-d7aa93d1b2db",
          "name": "ApoyarPropForm",
          "webhookId": "71293a33-15e6-418e-bf03-3024292b0dbb"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1596068065,
              "mode": "list",
              "cachedResultName": "Propuesta",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1596068065"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Id": "={{ $json.Id }}",
                "Nombre": "={{ $json.Nombre }}",
                "Nombre_de_la_Propuesta": "={{ $('PropuestaDatos').item.json.Nombre_de_la_Propuesta }}",
                "Que puedo aportar": "={{ $('ApoyarPropForm').item.json[\"Describe como puedes apoyar\"] }}",
                "Fecha": "={{ $('ApoyarPropForm').item.json.submittedAt.toDateTime().format('dd-MM-yyyy') }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre_de_la_Propuesta",
                  "displayName": "Nombre_de_la_Propuesta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Propuesta",
                  "displayName": "Propuesta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Se necesita",
                  "displayName": "Se necesita",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Que puedo aportar",
                  "displayName": "Que puedo aportar",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            560,
            32
          ],
          "id": "d263cf1d-d649-40a8-a846-6d56e7c80714",
          "name": "RegistrarApoyo",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Id",
                  "lookupValue": "={{ $('Propuestas').item.json.Id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            352,
            16
          ],
          "id": "caea66be-0aa1-4211-bb06-824cd73eb8e0",
          "name": "IDUsuario1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Errorrrrrrrrrr",
            "completionMessage": "={{ $('Propuestas').item.json.Id }} {{ $('Propuestas').item.json.Selecciona }} ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -240,
            16
          ],
          "id": "e76185f4-2ba0-4cc1-9743-025ebdd730e8",
          "name": "Error",
          "webhookId": "2805e8a5-dc84-4c26-b34c-8d4710579396"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "={{ $json.Nombre }} Apoya con: {{ $json['Que puedo aportar'] }}",
            "completionMessage": "Apoyo Registrado. Muchas Gracias por tu Contribuciòn ",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            768,
            64
          ],
          "id": "69433792-4d23-4b6a-9b9b-368e2d4b152e",
          "name": "ApoyoRegistrado",
          "webhookId": "fe4e31f2-efbe-47fc-923f-09735a06c615"
        }
      ],
      "connections": {
        "Propuestas": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "IDUsuario",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "GetPropuestas",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Propuesta": {
          "main": [
            [
              {
                "node": "Guardar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IDUsuario": {
          "main": [
            [
              {
                "node": "Propuesta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Guardar": {
          "main": [
            [
              {
                "node": "Exito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GetPropuestas": {
          "main": [
            [
              {
                "node": "Titulos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Titulos": {
          "main": [
            [
              {
                "node": "Datos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datos": {
          "main": [
            [
              {
                "node": "PropuestaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PropuestaDatos": {
          "main": [
            [
              {
                "node": "ApoyarPropForm",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ApoyarPropForm": {
          "main": [
            [
              {
                "node": "IDUsuario1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IDUsuario1": {
          "main": [
            [
              {
                "node": "RegistrarApoyo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistrarApoyo": {
          "main": [
            [
              {
                "node": "ApoyoRegistrado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Propuestas": [
          {
            "json": {
              "Selecciona": "Hacer una Propuesta",
              "Id": "7972655827",
              "submittedAt": "2025-10-08T22:05:23.616-04:00",
              "formMode": "production",
              "formQueryParameters": {
                "Id": "7972655827"
              }
            }
          }
        ]
      },
      "versionId": "aa12315a-8029-4734-991c-6c248f0695ac",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-10T01:40:59.208Z",
          "createdAt": "2025-09-10T01:40:59.208Z",
          "role": "workflow:owner",
          "workflowId": "7p2sueTvNcxsBvO8",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-27T18:51:10.000Z",
      "createdAt": "2025-06-06T01:44:22.064Z",
      "id": "8EoTMqNoy8ATG1hs",
      "name": "StatusIDC",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -896,
            -496
          ],
          "id": "df60266c-2233-4df6-999e-9a0b215e969c",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "ID Cliente"
                },
                {
                  "name": "idChat"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -1136,
            -544
          ],
          "id": "c2ca909e-e0c2-476a-8181-8d345559e1f7",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n'/ip hotspot ip-binding print terse where mac-address=\"{{$json[\"MAC ID\"]}}\";\n:put \"---SEPARATOR---\";\n/ip dhcp-server lease print terse where mac-address=\"{{$json[\"MAC ID\"]}}\";\n:put \"---SEPARATOR---\";\n/system scheduler print terse where name=\"{{$json[\"ID Cliente\"]}}\";'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -1168,
            -80
          ],
          "id": "42f60e8c-aff0-4813-94f4-5ad974d430ba",
          "name": "ConsultaStatus1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8a89165b-be24-4d41-99aa-1a6accd67e92",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1136,
            -288
          ],
          "id": "63437ec1-96e7-4107-9b5d-f0208de80ded",
          "name": "If"
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID No encontrado",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -800,
            -256
          ],
          "id": "ab1e0dad-f09e-48d5-9bf7-3a867e0e934b",
          "name": "NoFoud",
          "webhookId": "0152bf53-824e-46c7-a077-8379d48b30f5",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID {{ $('Buscar').item.json[\"ID Cliente\"] }} {{ $('Buscar').item.json[\"Nombre completo\"] }} {{ $('Buscar').item.json[\"MAC ID\"] }} Activo: {{ $json.status_binding }} Conectado: {{ $json.status_conexion }} Fecha de corte: {{ $json.fecha_corte }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -704,
            0
          ],
          "id": "108d0366-7f94-4839-8021-e4ac91096543",
          "name": "Status",
          "webhookId": "0152bf53-824e-46c7-a077-8379d48b30f5",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Obtener la salida única del comando\nconst stdout = $json.stdout;\n\n// Dividir la salida en partes usando nuestro separador.\nconst parts = stdout.split('---SEPARATOR---');\n\n// Asignar cada parte a una variable para mayor claridad.\nconst out_binding = (parts[0] || \"\").trim();\nconst out_conexion = (parts[1] || \"\").trim();\nconst out_fecha = (parts[2] || \"\").trim();\n\n// Crear un objeto para guardar los resultados finales\nconst resultados = {};\n\n// --- 1. LÓGICA CORREGIDA PARA EL ESTADO DEL BINDING ---\n// Buscamos si la línea de texto contiene \"flags=X\"\nif (out_binding === '') {\n  resultados.status_binding = 'NO ENCONTRADO EN BINDING';\n} else if (out_binding.includes(' XP ')) { // <-- LA CORRECCIÓN CLAVE AQUÍ\n  resultados.status_binding = 'DESACTIVADO';\n} else {\n  resultados.status_binding = 'ACTIVADO';\n}\n\n// --- 2. LÓGICA CORREGIDA PARA EL ESTADO DE CONEXIÓN DHCP ---\n// Solo consideramos \"CONECTADO\" si el status es exactamente \"bound\"\nif (out_conexion.includes('status=bound')) { // <-- LA CORRECCIÓN CLAVE AQUÍ\n  resultados.status_conexion = 'CONECTADO';\n} else if (out_conexion.includes('status=offered')) {\n  resultados.status_conexion = 'INESTABLE';\n} else {\n  // Si no está \"bound\", no está conectado, sin importar si está \"waiting\" o no existe.\n  resultados.status_conexion = 'DESCONECTADO';\n}\n\n// --- 3. LÓGICA PARA LA FECHA DE CORTE (esta ya era correcta) ---\nif (out_fecha === '') {\n  resultados.fecha_corte = 'NO ENCONTRADA';\n} else {\n  const match = out_fecha.match(/start-date=([^\\s]+)/);\n  resultados.fecha_corte = match ? match[1] : 'FECHA MALFORMADA';\n}\n\n// Devolver un único item con todos los datos procesados\nreturn [{\n  json: {\n    ...$item.json,\n    ...resultados\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -944,
            -96
          ],
          "id": "7c34cfce-b7b1-4d86-96d1-6791d10e2b5b",
          "name": "Code"
        }
      ],
      "connections": {
        "Buscar": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ConsultaStatus1": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "NoFoud",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ConsultaStatus1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "When Executed by Another Workflow": [
          {
            "json": {
              "ID Cliente": "b215",
              "idChat": "8193170686 "
            }
          }
        ]
      },
      "versionId": "a4ace075-dee2-478f-8ac2-dec32fa89827",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-06T01:44:22.073Z",
          "createdAt": "2025-06-06T01:44:22.073Z",
          "role": "workflow:owner",
          "workflowId": "8EoTMqNoy8ATG1hs",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-07T05:07:38.686Z",
      "createdAt": "2025-06-07T05:07:38.686Z",
      "id": "8nzHoH9E0N4ylNEC",
      "name": "frankisteing",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.message.chat.id }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -2860,
            -840
          ],
          "id": "e6cc327c-bb22-4bde-abcf-8717d67f883e",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {},
            "path": "147a38ff-c523-445b-9beb-37d6227dcc0a"
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -3320,
            -500
          ],
          "id": "5668208d-2d0a-403b-ab1e-bcaf1029a313",
          "name": "Mensaje",
          "webhookId": "147a38ff-c523-445b-9beb-37d6227dcc0a",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.chatIdOriginal }}",
            "text": "={{ $json.message }}",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {},
            "path": "ea75018e-300f-44d7-afa8-ff38ce2a3ab2"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2280,
            -880
          ],
          "id": "441e9b62-5270-411f-952b-88983f166cea",
          "name": "Respuesta",
          "webhookId": "ea75018e-300f-44d7-afa8-ff38ce2a3ab2",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.message.text }}",
            "options": {
              "systemMessage": "=Clasifica el mensaje del usuario en una de las siguientes INTENCIONES. Responde ÚNICAMENTE con la etiqueta de la intención en MAYÚSCULAS.\n\nINTENCIONES:\n- SALUDO\n- BUSCAR_NOMBRE\n- ESTADO_CLIENTE\n- REPORTAR_GASTO\n- REPORTAR_PAGO\n- DESCONOCIDO\n\nEjemplos:\nUsuario: \"hola\" -> SALUDO\nUsuario: \"buenos días\" -> SALUDO\nUsuario: \"dime el id de Juan Perez\" -> BUSCAR_NOMBRE\nUsuario: \"busca el nombre Maria Lopez\" -> BUSCAR_NOMBRE\nUsuario: \"Como aparece el cliente con ID 123?\" -> ESTADO_CLIENTE\nUsuario: \"esta conectado el ID 456\" -> ESTADO_CLIENTE\nUsuario: \"quiero registrar un gasto\" -> REPORTAR_GASTO\nUsuario: \"Aldo gasto 300 en comida\" -> REPORTAR_GASTO\nUsuario: \"recibi 2000 de instalacion\" -> REPORTAR_GASTO\nUsuario: \"quiero reportar mi pago\" -> REPORTAR_PAGO\nUsuario: \"reportar pago de ID 789\" -> REPORTAR_PAGO\nUsuario: \"qué hora es?\" -> DESCONOCIDO\n\n---\nMensaje del Usuario:\n{{ $json.message.text }}\n---\nINTENCION:\n\nContesta siempre en español"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -2880,
            -1060
          ],
          "id": "8709be74-f1a4-4e45-a8d7-2aa508a3eed5",
          "name": "AgtIntent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-001",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2980,
            -840
          ],
          "id": "f233c247-5c35-4e7a-a79b-160626b656a6",
          "name": "GemIntent",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4da42528-a5f9-4321-a0c8-55363bd93037",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "SALUDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bb95cbec-d074-49cf-86f4-2e10f729c7f9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "BUSCAR_NOMBRE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "675f82ad-14e4-456c-929d-fa64a6552f48",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "ESTADO_CLIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_GASTO",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "cd7f0500-527d-4be7-bf61-b5a5cdeac877"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f738687-f3c2-4715-a82a-05640916957b",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_PAGO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "48297539-bf1e-49f9-89a0-5665b0ed81e9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "INTENCION_DESCONOCIDA",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2500,
            -1060
          ],
          "id": "6c8c9946-90cb-4ce5-a685-48521d67bca4",
          "name": "SwIntent"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el nombre de la persona que se busca. Responde SÓLO con el nombre. Si no puedes identificar un nombre claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el id de Juan Perez\" -> Juan\nMensaje: \"busca el nombre Maria Fernanda Lopez Garcia\" -> Fernanda\nMensaje: \"ID de ana\" -> ana\nMensaje: \"buscar nombre\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3100,
            -680
          ],
          "id": "7fdbd87f-157b-4b72-8ecc-620de0d59da0",
          "name": "AgtExtract"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=¡Hola! 👋 ¿En qué puedo ayudarte hoy? Puedes: - Buscar el ID de un cliente (ej: \"busca el ID de Ana\") - Consultar el estado de un cliente (ej: \"estado del ID 123\") - Reportar un gasto o ingreso (ej: \"Bertin gastó 300 en comida\") - Reportar un pago (ej: \"reportar pago del ID 456\")",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "893285eb-80e5-4896-9e2d-070d4b22a4a6"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2280,
            -1060
          ],
          "id": "64450dff-4957-4cde-a915-e7644d25f376",
          "name": "Telegram",
          "webhookId": "893285eb-80e5-4896-9e2d-070d4b22a4a6",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2720,
            -660
          ],
          "id": "4df59f7e-4a7e-4e07-9377-69725b4560b1",
          "name": "If"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -2900,
            -440
          ],
          "id": "626db375-7416-4b4d-95d7-3beb0ba7bd4a",
          "name": "Limit"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3100,
            -820
          ],
          "id": "2d4a1d2c-87b4-4d4c-b073-232d1a2d024f",
          "name": "BuscarID",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "xB5k8lNiGd17TIji",
              "mode": "list",
              "cachedResultName": "BuscarChiq2"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.output }}",
                "IdChat": "={{ $('Mensaje').item.json.message.chat.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "IdChat",
                  "displayName": "IdChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -3080,
            -440
          ],
          "id": "464ff00c-a5e0-46d5-8aaf-e7a30e938109",
          "name": "Buscar",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "3ef9ea1f-9c02-48bf-a5c8-adc4ae40dafa"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2700,
            -440
          ],
          "id": "221936ac-e551-442e-9f15-786dedb90f07",
          "name": "Resultado ID",
          "webhookId": "3ef9ea1f-9c02-48bf-a5c8-adc4ae40dafa",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el nombre que quieres buscar (ej: 'busca el ID de Ana').",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "2caa491f-6f14-4677-a5c6-26150d90cf28"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2720,
            -820
          ],
          "id": "9f45ab1f-87ec-4dfb-aeef-2adbbc52eca6",
          "name": "NoEntender",
          "webhookId": "2caa491f-6f14-4677-a5c6-26150d90cf28",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2120,
            -680
          ],
          "id": "268505b0-b777-43dd-b06a-b3327e7361bb",
          "name": "If2"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -2240,
            -480
          ],
          "id": "b3176248-2dc6-4603-afd5-c12fe29f8c65",
          "name": "Limit2"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.resultadoStatus }}",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "538da571-4836-4aa6-bb5f-6cab201b9da2"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2060,
            -420
          ],
          "id": "693b904f-4c98-4c7b-8cdd-53d7da025aa7",
          "name": "Resultado ID3",
          "webhookId": "538da571-4836-4aa6-bb5f-6cab201b9da2",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el ID del cliente que quieres saber su estado (ej: como aparece d456').",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "8d3473a5-037f-496d-b992-68663fdbe7a9"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1920,
            -560
          ],
          "id": "b2dc3a9c-2268-461b-81a0-b7abedb7a19c",
          "name": "NoEntender1",
          "webhookId": "8d3473a5-037f-496d-b992-68663fdbe7a9",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el ID del cliente que se busca. Responde SÓLO con el ID. Si no puedes identificar un ID claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el estado de c345\" -> c345\nMensaje: \"como aparece el a423\" -> a423\nMensaje: \"status de b043\" -> b043\nMensaje: \"buscar status\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -2480,
            -680
          ],
          "id": "4d296f56-29ed-4f32-a19a-200338a9e9e8",
          "name": "AgtStatus"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-001",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2480,
            -800
          ],
          "id": "3fd4cda0-3eb7-403e-8d8e-8749dc194a0e",
          "name": "status",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "8EoTMqNoy8ATG1hs",
              "mode": "list",
              "cachedResultName": "StatusIDC"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.output.trim() }}",
                "idChat": "={{ $('Mensaje').item.json.message.chat.id }} "
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "idChat",
                  "displayName": "idChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -2440,
            -480
          ],
          "id": "152563b0-0693-475c-ae72-58324b6567b1",
          "name": "statusID",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b8b3c9ed-6c0c-4366-924b-c0e60fb9e5b8",
                  "leftValue": "={{ $json.datosTextoCompletos }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "or"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1540,
            -1040
          ],
          "id": "c8e70dc9-19dd-477f-97ed-07043a398c8c",
          "name": "If3"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -1540,
            -420
          ],
          "id": "c3079d61-b350-4c36-aa9d-6b0bdec3d8a9",
          "name": "Limit3"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.resultadoStatus }}",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "7e97bc7d-bba7-4054-8925-48a417a095b9"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1380,
            -360
          ],
          "id": "4092d8dc-d233-4c42-8fb6-e6c9f214eaf2",
          "name": "Resultado ID4",
          "webhookId": "7e97bc7d-bba7-4054-8925-48a417a095b9",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "No pude entender todos los detalles del gasto. Por favor, intenta de nuevo con el formato: [Nombre] [gasto/ingreso] [cantidad] en [concepto]. Ejemplo: Lupita gastó 50 en pasajes",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "1a970fe6-fafe-4851-b385-091ebe01333d"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1280,
            -1000
          ],
          "id": "d675437b-0794-4cc6-a9a0-bd2889fc73a4",
          "name": "NoEntender2",
          "webhookId": "1a970fe6-fafe-4851-b385-091ebe01333d",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-001",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2100,
            -820
          ],
          "id": "312d2db5-2f36-4c95-9327-2e4534288585",
          "name": "Gastos",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae las variables para un gasto. Responde ÚNICAMENTE con un objeto JSON.\nVariables: \"nombre\" (Aldo, Bertin, Lupita, o NoEspecificado), \"movimiento\" (Ingreso o Gasto, predeterminado gasto), \"concepto\", \"cantidad\" (número, predeterminado 0), \"quiere_comprobante\" (responde \"si\", \"no\", o \"preguntar\").\n\nEjemplos:\nMensaje: \"Bertin gastó 300 en gasolina sin comprobante\"\nJSON: {\"nombre\": \"Bertin\", \"movimiento\": \"Gasto\", \"concepto\": \"Gasolina\", \"cantidad\": 300, \"quiere_comprobante\": \"no\"}\nMensaje: \"Lupita pago 600 a cotzet y tengo la factura\"\nJSON: {\"nombre\": \"Lupita\", \"movimiento\": \"Gasto\", \"concepto\": \"cotzet\", \"cantidad\": 600, \"quiere_comprobante\": \"si\"}\nMensaje: \"Bertin recibiò 2000 de instalaciòn\"\nJSON: {\"nombre\": \"Bertin\", \"movimiento\": \"Ingreso\", \"concepto\": \"Instalaciòn\", \"cantidad\": 2000, \"quiere_comprobante\": \"preguntar\"}\nMensaje: \"reportar gasto\"\nJSON: {\"nombre\": \"NoEspecificado\", \"movimiento\": \"gasto\", \"concepto\": \"NoEspecificado\", \"cantidad\": 0, \"quiere_comprobante\": \"preguntar\"}\n---\nMensaje Original: {{ $('Mensaje').item.json.message.text }}\n---\nRespuesta JSON:\nContesta siempre en español ",
              "passthroughBinaryImages": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -2080,
            -1040
          ],
          "id": "85dc5f34-362c-4af8-8452-c5c300ff5335",
          "name": "GastosIA"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "Z2xbG4OS8W1nHEdK",
              "mode": "list",
              "cachedResultName": "GastosIA"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.datos.nombre }}",
                "Movimiento": "{{ $json.datos.mov }}",
                "Concepto": "{{ $json.datos.con }}",
                "Comprobante": "={{ null }}",
                "ChatId": "{{ $json.chatId }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "Movimiento",
                  "displayName": "Movimiento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "Concepto",
                  "displayName": "Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number",
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "ChatId",
                  "displayName": "ChatId",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "mode": "each",
            "options": {
              "waitForSubWorkflow": false
            }
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -1740,
            -420
          ],
          "id": "98dd0918-ab6c-4c77-994a-db08e2336485",
          "name": "CallGastosIA",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "jsCode": "let datosGasto = { nombre: \"NoEspecificado\", mov: \"gasto\", con: \"NoEspecificado\", cant: 0 };\nlet textoEsOK = false; // Cambiado de textoOK para evitar conflicto con salida del IF\nlet infoParaMemoria = null; \ntry {\n    let raw = $('GastosIA').item.json.output.trim();\n    if (raw.startsWith(\"```json\")) { raw = raw.substring(7); if (raw.endsWith(\"```\")) { raw = raw.substring(0, raw.length - 3); }}\n    raw = raw.trim();\n    const p = JSON.parse(raw);\n\n    if (p.nombre && [\"Aldo\", \"Bertin\", \"Lupita\", \"NoEspecificado\"].includes(p.nombre)) datosGasto.nombre = p.nombre;\n    if (p.movimiento && [\"ingreso\", \"gasto\"].includes(p.movimiento.toLowerCase())) datosGasto.movimiento = p.movimiento.toLowerCase(); else datosGasto.movimiento = \"gasto\";\n    if (p.concepto) datosGasto.concepto = p.concepto; else datosGasto.concepto = \"NoEspecificado\";\n    if (p.cantidad !== undefined) datosGasto.cantidad = parseFloat(p.cantidad) || 0; else datosGasto.cantidad = 0;\n    \n    if (datosGasto.nombre !== \"NoEspecificado\" && datosGasto.concepto !== \"NoEspecificado\" && datosGasto.cantidad > 0) { // Ajusta si cant 0 es OK\n        textoEsOK = true;\n        const chatId = $('Mensaje').first().json.message.chat.id.toString();\n        // String formateado para la memoria\n        infoParaMemoria = `CTX_GASTO_PENDIENTE##CHATID=${chatId}##NOMBRE=${datosGasto.nombre}##MOVIMIENTO=${datosGasto.movimiento}##CONCEPTO=${datosGasto.concepto}##CANTIDAD=${datosGasto.cantidad}`;\n    }\n} catch (e) { console.error(\"Error en nodo extract:\", e); textoEsOK = false; } // Asegura que textoEsOK sea false en error\n\nreturn [{ json: { \n    datosExtraidos: datosGasto, \n    datosTextoCompletos: textoEsOK, \n    stringParaMemoria: infoParaMemoria \n}}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1720,
            -1040
          ],
          "id": "a0915432-19ca-4e00-b5e2-cbccdb595962",
          "name": "extract"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('extract').item.json.quiereComprobanteInicial }}",
                        "rightValue": "si",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "bf8ac23a-fc3c-4512-bf5a-7bd360e02535"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "ae7ecfa9-0aec-4f11-b6ca-5b184e866e06",
                        "leftValue": "={{ $('extract').item.json.quiereComprobanteInicial }}",
                        "rightValue": "preguntar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1760,
            -820
          ],
          "id": "2800a993-b694-4539-856a-7ff4de22d419",
          "name": "Comprobante?"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=Datos recibidos. ¿Quieres adjuntar un comprobante? Envía el archivo/imagen en el siguiente mensaje, o escribe 'no",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false
            },
            "path": "a41ff0f0-09c2-41fc-b84c-d196d54e4805"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1260,
            -580
          ],
          "id": "c4e5444f-904b-47e9-93f6-b4b2c37651ad",
          "name": "siono",
          "webhookId": "a41ff0f0-09c2-41fc-b84c-d196d54e4805",
          "alwaysOutputData": true,
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "07930674-92a6-4e53-adcc-34a3819ad9b6",
                  "name": "datosFinales",
                  "value": "={{ $('extract').item.json.datosGasto }}",
                  "type": "string"
                },
                {
                  "id": "89ed11fe-e02d-48c3-a93b-ab5f486542c2",
                  "name": "chatId",
                  "value": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1580,
            -660
          ],
          "id": "8db4c949-c399-43b3-8432-03f96c7f84c3",
          "name": "no"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "=gasto_chat_{{ $('Mensaje').first().json.message.chat.id }}\n{{ $('GastosIA').item.json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1940,
            -880
          ],
          "id": "51df36cd-82d8-4d2d-b8a1-4c45700ffdcc",
          "name": "temp"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "Perfecto, por favor envía el archivo del comprobante ahora.",
            "additionalFields": {},
            "path": "be9b698c-97ca-4891-a64a-8dd57f8c558e"
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1560,
            -840
          ],
          "id": "8da1830b-3e23-47af-bf33-de95008f4517",
          "name": "Telegram1",
          "webhookId": "be9b698c-97ca-4891-a64a-8dd57f8c558e",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('extract').item.json.stringParaMemoria }}",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -1340,
            -820
          ],
          "id": "8103d091-6d16-4ec2-83a8-16a9caf274cf",
          "name": "Memoria"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Revisa el historial de conversación reciente. Busca el ÚLTIMO mensaje que comience con \"CTX_GASTO_PENDIENTE##CHATID_{{ $('Mensaje').first().json.message.chat.id }}\". Si lo encuentras, extrae los valores de CHATID, NOMBRE, MOVIMIENTO, CONCEPTO, y CANTIDAD. Responde SÓLO con JSON: {\"ctx_ok\": true, \"chatId\": \"v\", \"nombre\": \"v\", \"movimiento\": \"v\", \"concepto\": \"v\", \"cantidad\": \"v\"}. Si NO lo encuentras, responde: {\"ctx_ok\": false}.",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3540,
            -740
          ],
          "id": "02c5c176-c3ea-4293-adda-63525788cc7d",
          "name": "LeerCtxDeMemoria"
        },
        {
          "parameters": {
            "jsCode": "let ctxOK = false;\nlet datosGasto = null;\nlet chatIdOriginal = null;\ntry {\n    let raw = $('LeerCtxDeMemoria').item.json.output.trim();\n    if (raw.startsWith(\"```json\")) { /* ... limpieza ... */ }\n    const p = JSON.parse(raw);\n    if (p.ctx_ok === true) {\n        ctxOK = true;\n        datosGasto = { nombre: p.nombre, mov: p.movimiento, con: p.concepto, cant: parseFloat(p.cantidad) || 0 };\n        chatIdOriginal = p.chatId;\n    }\n} catch (e) { console.error(\"ERR ParsearCtxRecuperado:\", e); }\nreturn [{ json: { ctxRecuperadoOK: ctxOK, datosGastoOriginales: datosGasto, chatIdOriginalRec: chatIdOriginal } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -3480,
            -520
          ],
          "id": "cdb446f6-a17c-4786-bf31-73019b138b65",
          "name": "parsear"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "f7febf67-2d3c-45f5-a719-f3aec5762138",
                  "leftValue": "={{ $json.ctxRecuperadoOK }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                },
                {
                  "id": "55da51e6-65fc-4547-92f1-06f7f93a5cc2",
                  "leftValue": "={{ $('Mensaje').item.json.message.document || $('Mensaje').item.json.message.photo }} - Exists  {{ $('Mensaje').item.json.message.text && $('Mensaje').item.json.message.text.toLowerCase() === 'no' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3520,
            -1060
          ],
          "id": "aa3f557e-780d-4f2a-b481-521159e6cdda",
          "name": "si"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "21c2ded8-385f-4d9f-b915-671e33d6c056",
                  "leftValue": "={{ $('Mensaje').item.json.message.document || $('Mensaje').item.json.message.photo }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3460,
            -900
          ],
          "id": "ca57053b-3f3d-40aa-83b2-9cd4f6797f45",
          "name": "archivo"
        }
      ],
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_memory",
                "index": 0
              },
              {
                "node": "Memoria",
                "type": "ai_memory",
                "index": 0
              },
              {
                "node": "LeerCtxDeMemoria",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Mensaje": {
          "main": [
            [
              {
                "node": "LeerCtxDeMemoria",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtIntent": {
          "main": [
            [
              {
                "node": "SwIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GemIntent": {
          "ai_languageModel": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Memoria",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "LeerCtxDeMemoria",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "SwIntent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtExtract",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtStatus",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "GastosIA",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtExtract": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Resultado ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscarID": {
          "ai_languageModel": [
            [
              {
                "node": "AgtExtract",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "statusID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit2": {
          "main": [
            [
              {
                "node": "Resultado ID3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtStatus": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "status": {
          "ai_languageModel": [
            [
              {
                "node": "AgtStatus",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "statusID": {
          "main": [
            [
              {
                "node": "Limit2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "Memoria",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit3": {
          "main": [
            [
              {
                "node": "Resultado ID4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gastos": {
          "ai_languageModel": [
            [
              {
                "node": "GastosIA",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "GastosIA": {
          "main": [
            [
              {
                "node": "extract",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CallGastosIA": {
          "main": [
            [
              {
                "node": "Limit3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "extract": {
          "main": [
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Comprobante?": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [
              {
                "node": "no",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "no": {
          "main": [
            [
              {
                "node": "CallGastosIA",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "temp": {
          "main": [
            [
              {
                "node": "Comprobante?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "NoEntender2": {
          "main": [
            []
          ]
        },
        "Memoria": {
          "main": [
            [
              {
                "node": "siono",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeerCtxDeMemoria": {
          "main": [
            [
              {
                "node": "parsear",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "parsear": {
          "main": [
            [
              {
                "node": "si",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "si": {
          "main": [
            [
              {
                "node": "archivo",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "7dc73492-952f-4fa2-97b8-a58d20856612",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-07T05:07:38.698Z",
          "createdAt": "2025-06-07T05:07:38.698Z",
          "role": "workflow:owner",
          "workflowId": "8nzHoH9E0N4ylNEC",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-28T22:34:16.000Z",
      "createdAt": "2025-11-22T05:32:54.900Z",
      "id": "Bt9NOHKdCpve8bhP",
      "name": "NuevoClienteDeps",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=Cliente interesado: {{ $json.body.nombre }} telefono: {{ $json.body.numero }}, Zona:{{ $json.body.zona }}. ID Cliente: {{ $json.body.id_cliente }}. Contactar para agendar cita.",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "id": "a6f4f537-863a-4ff4-8a98-8fec64791b7f",
          "name": "Notificar Telegram (Alrededores)",
          "webhookId": "a99edb8b-5bd1-402f-8cfe-e2e1d4831bff",
          "position": [
            -4064,
            272
          ],
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=Cliente interesado: {{ $json.body.nombre }} telefono: {{ $json.body.numero }}, Zona:{{ $json.body.zona }}. ID Cliente: {{ $json.uniqueCode }}. Contactar para agendar cita.",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "id": "d82c1b4f-3d4e-4231-9ab3-3ceef1838b2f",
          "name": "Notificar Telegram (Morelia)",
          "webhookId": "a99edb8b-5bd1-402f-8cfe-e2e1d4831bff",
          "position": [
            -4272,
            464
          ],
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "{\"success\": true}",
            "options": {}
          },
          "id": "2b828ffa-5990-4e2c-81c2-3870c661e798",
          "name": "Responder Éxito",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            -4064,
            480
          ]
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "nvocte",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "9e98ef93-5751-4e4a-be6d-f513cced4852",
          "name": "RecibirFormulario",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -4480,
            -160
          ],
          "webhookId": "7cb5e56c-3224-4123-934a-a17574085ce2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "options": {
              "dataLocationOnSheet": {
                "values": {
                  "rangeDefinition": "specifyRangeA1",
                  "range": "L:L"
                }
              }
            }
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -4272,
            -160
          ],
          "id": "07bf0c41-19ac-44e8-9106-1abef295c1a1",
          "name": "LeeID",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const existingCodes = items.map(item => item.json.K).filter(code => code); \n// Suponiendo que la columna de códigos se llama 'A' en la salida del nodo de Google Sheets\n// .filter(code => code) elimina cualquier celda vacía o nula\n\nreturn [{\n    json: {\n        existingCodes: existingCodes\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -4064,
            -160
          ],
          "id": "58abc7d4-ae37-456d-aa67-93a38c08032a",
          "name": "ID's"
        },
        {
          "parameters": {
            "jsCode": "const existingCodes = items[0].json.existingCodes; // Obtenemos el array de códigos existentes\nconst allowedLetters = ['e', 'f', 'g', 'h']; // Definimos las letras permitidas\n\nlet uniqueCode = '';\nlet isUnique = false;\n\nwhile (!isUnique) {\n    // Seleccionar una letra aleatoria de la lista de letras permitidas\n    const randomLetterIndex = Math.floor(Math.random() * allowedLetters.length);\n    const letter = allowedLetters[randomLetterIndex];\n\n    // Generar 3 dígitos aleatorios (000-999) y rellenar con ceros a la izquierda si es necesario\n    const digits = String(Math.floor(Math.random() * 1000)).padStart(3, '0');\n\n    const candidateCode = letter + digits;\n\n    // Verificar si el código candidato ya existe en el array de códigos existentes\n    if (!existingCodes.includes(candidateCode)) {\n        uniqueCode = candidateCode;\n        isUnique = true; // El código es único, salimos del bucle\n    }\n}\n\n// Devolvemos el código único encontrado\nreturn [{\n    json: {\n        uniqueCode: uniqueCode\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -4272,
            64
          ],
          "id": "9475ca30-f688-45bb-9630-ff9097358843",
          "name": "GeneraID"
        },
        {
          "parameters": {
            "mode": "mergeByIndex"
          },
          "id": "f1ff9686-9524-465f-b2fc-6a678bfb7c6a",
          "name": "CombinarDatos",
          "type": "n8n-nodes-base.merge",
          "typeVersion": 1,
          "position": [
            -4064,
            64
          ]
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7206baaa-9850-4bfa-9081-999c06d6b194",
                  "name": "body.nombre",
                  "value": "={{ $json.body.nombre }}",
                  "type": "string"
                },
                {
                  "id": "d7814865-6155-4e75-9e12-7e8161153628",
                  "name": "body.direccion",
                  "value": "={{ $json.body.direccion }}",
                  "type": "string"
                },
                {
                  "id": "55e5e81d-5c21-4e5d-893f-6297f8f24245",
                  "name": "body.numero",
                  "value": "={{ $json.body.numero }}",
                  "type": "string"
                },
                {
                  "id": "4fd85925-75f1-4fd0-ab4e-81eec060e833",
                  "name": "body.zona",
                  "value": "={{ $json.body.zona }}",
                  "type": "string"
                },
                {
                  "id": "9b889557-2ce0-467c-89d8-a02c28a5ed30",
                  "name": "body.recomendado",
                  "value": "={{ $json.body.recomendado }}",
                  "type": "string"
                },
                {
                  "id": "1f3ce17b-7aa6-4d48-8eed-8ab18582b042",
                  "name": "body.fecha",
                  "value": "={{ $json.body.fecha }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -4464,
            80
          ],
          "id": "b0fc2e61-b3ec-49ad-a672-547153e4f11b",
          "name": "DatosForm"
        },
        {
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $('RecibirFormulario').item.json.body.zona }}",
                  "value2": "Alrededores"
                }
              ]
            }
          },
          "id": "5a15cc73-4597-436f-91d2-e89324a7944c",
          "name": "Alrededores?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            -4464,
            272
          ]
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
              "mode": "list",
              "cachedResultName": "Contrataciones",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit#gid=1656915010"
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "ID Cliente",
                  "fieldValue": "={{ $json.body.id_cliente }}"
                },
                {
                  "fieldId": "Nombre completo",
                  "fieldValue": "={{ $json.body.nombre }}"
                },
                {
                  "fieldId": "Dirección ",
                  "fieldValue": "={{ $json.body.direccion }}"
                },
                {
                  "fieldId": "Numero de teléfono",
                  "fieldValue": "={{ $json.body.numero }}"
                },
                {
                  "fieldId": "Recomendado por..(ID Cliente)",
                  "fieldValue": "={{ $json.body.recomendado }}"
                },
                {
                  "fieldId": "Marca temporal",
                  "fieldValue": "={{ $json.body.fecha }}"
                },
                {
                  "fieldId": "Zona de Cobertura",
                  "fieldValue": "={{ $json.body.zona }}"
                }
              ]
            },
            "options": {}
          },
          "id": "7b3584a6-58d0-4c25-9381-53836bf247b7",
          "name": "Alrededores",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 3,
          "position": [
            -4272,
            272
          ],
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "IDCliente",
                  "fieldValue": "={{ $json.uniqueCode }}"
                },
                {
                  "fieldId": "Marca temporal",
                  "fieldValue": "={{ $json.body.fecha }}"
                },
                {
                  "fieldId": "Nombre completo",
                  "fieldValue": "={{ $json.body.nombre }}"
                },
                {
                  "fieldId": "Dirección ",
                  "fieldValue": "={{ $json.body.direccion }}"
                },
                {
                  "fieldId": "Numero de teléfono",
                  "fieldValue": "={{ $json.body.numero }}"
                },
                {
                  "fieldId": "Zona",
                  "fieldValue": "={{ $json.body.zona }}"
                },
                {
                  "fieldId": "Recomendado por..(ID Cliente)",
                  "fieldValue": "={{ $json.body.recomendado }}"
                }
              ]
            },
            "options": {}
          },
          "id": "1d1e3612-1d30-42fb-89c2-5b41daa8e956",
          "name": "Morelia",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 3,
          "position": [
            -4448,
            464
          ],
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formTitle": "ID Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cliente ID",
                  "requiredField": true
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "findepas",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -3824,
            -176
          ],
          "id": "0466de7a-e355-4c44-87c5-080ffec50a29",
          "name": "IDCliente",
          "webhookId": "6d0c432c-5007-4ca1-83df-598d331d3737"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $json[\"Cliente ID\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -3648,
            -176
          ],
          "id": "482c7ca9-edb1-4ebe-ae9e-2a299e465014",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "ERROR",
            "completionMessage": "=Cliente {{ $('IDCliente').item.json['Cliente ID'] }} No encontrado",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3232,
            -176
          ],
          "id": "59e5ccdb-abe6-4b03-8f5e-1d08aefce2d8",
          "name": "Error",
          "webhookId": "81fd8b6e-d1e0-45d8-a7b0-e7ed46a3d5b4"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "=Usuario pppoe",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Basico"
                      },
                      {
                        "option": "Premium"
                      },
                      {
                        "option": "Plus"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de Instalacion",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de Pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "=Conectado de caja",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Caja1 Base"
                      },
                      {
                        "option": "Caja1-2"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Puerto",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Recomendado por -ID Cliente-",
                  "placeholder": "="
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 15,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Llenar Campos",
              "formDescription": "=ID: {{ $('Datos').item.json.IDCliente }}\nNombre: {{ $('Datos').item.json[\"Nombre completo\"] }}\n\nAntes de Continuar Verifica Que los Datos Todo este Correctos",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3232,
            32
          ],
          "id": "cc4fb73c-3fda-4910-ae44-c85840e2743e",
          "name": "Faltantes",
          "webhookId": "5c04d6e2-5477-4e54-ac99-698564fb4323"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro Exitoso",
            "completionMessage": "=Nombre: {{ $('Limpiar').item.json[\"Nombre completo\"] }} -- ID Cliente: {{ $('Limpiar').item.json.IDCliente }} -- Usuario pppoe: {{ $json['Usuario pppoe'] }} -- Contraseña: {{ $json['contraseña'] }} -- Instalado: {{ $('Limpiar').item.json['Fecha de Instalacion'] }} -- Fecha de Corte: {{ $('Limpiar').item.json.DatePay }} Agregado Correctamente :)",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2544,
            544
          ],
          "id": "aac85c6c-cc5f-4f60-af3f-26b3858baf67",
          "name": "Fin",
          "webhookId": "6d1f1eaa-0d28-4d89-b87b-2c5c7357c2ef"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json[\"Fecha de Pago\"] }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "outputFieldName": "DatePay",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -2768,
            32
          ],
          "id": "35f78ab6-f988-4c1a-87ff-a118c5a975be",
          "name": "FechaCort"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b0a8f3f7-fc85-4c0f-a240-0bd545e63732",
                  "name": "IDCliente",
                  "value": "={{ $('Datos').item.json.IDCliente }}",
                  "type": "string"
                },
                {
                  "id": "ff94a3db-6256-4081-89d7-53e91084a5ff",
                  "name": "Nombre completo",
                  "value": "={{ $('Vacio?').item.json['Nombre completo'] }}",
                  "type": "string"
                },
                {
                  "id": "d64f947d-6603-409b-9581-ff5f1b05d4e3",
                  "name": "Fecha de Instalacion",
                  "value": "={{ $('Faltantes').item.json[\"Fecha de Instalacion\"] }}",
                  "type": "string"
                },
                {
                  "id": "e699f2be-8bcc-4012-8cc7-85203f6da0b7",
                  "name": "DatePay",
                  "value": "={{ $json.DatePay }}",
                  "type": "string"
                },
                {
                  "id": "5a1a8ec9-8211-41d8-a191-8fe7e7a0903d",
                  "name": "Usuario pppoe",
                  "value": "={{ $('Faltantes').item.json[\"Usuario pppoe\"] }}",
                  "type": "string"
                },
                {
                  "id": "eb5db01b-8706-4ad4-95e4-7e2a3dc84229",
                  "name": "Plan",
                  "value": "={{ $('Faltantes').item.json.Plan }}",
                  "type": "string"
                },
                {
                  "id": "7f4522bf-8503-46fc-a2b4-6f0a34e6afa6",
                  "name": "Conectado de caja",
                  "value": "={{ $('Faltantes').item.json[\"Conectado de caja\"] }}",
                  "type": "string"
                },
                {
                  "id": "1b1eda05-1ae3-4da3-9e45-f27ce0307c50",
                  "name": "Puerto",
                  "value": "={{ $('Faltantes').item.json.Puerto }}",
                  "type": "number"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2544,
            32
          ],
          "id": "8426a82e-3e83-4882-adc4-2b14eaed16bd",
          "name": "Limpiar"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "IDCliente": "={{ $('Limpiar').item.json.IDCliente }}",
                "FechaInstalacion": "={{ $('Limpiar').item.json['Fecha de Instalacion'] }}",
                "FechaPago": "={{ $('Limpiar').item.json.DatePay }}",
                "Usuario pppoe": "={{ $('Limpiar').item.json[\"Usuario pppoe\"] }}",
                "contraseña": "8816",
                "ConectadoCaja": "={{ $('Limpiar').item.json[\"Conectado de caja\"] }}",
                "Puerto": "={{ $('Limpiar').item.json.Puerto }}",
                "Plan": "={{ $('Limpiar').item.json.Plan }}"
              },
              "matchingColumns": [
                "IDCliente"
              ],
              "schema": [
                {
                  "id": "Marca temporal",
                  "displayName": "Marca temporal",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Dirección ",
                  "displayName": "Dirección ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Numero de teléfono",
                  "displayName": "Numero de teléfono",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Zona",
                  "displayName": "Zona",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Plan",
                  "displayName": "Plan",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Recomendado por..(ID Cliente)",
                  "displayName": "Recomendado por..(ID Cliente)",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Usuario pppoe",
                  "displayName": "Usuario pppoe",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "contraseña",
                  "displayName": "contraseña",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaInstalacion",
                  "displayName": "FechaInstalacion",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "FechaPago",
                  "displayName": "FechaPago",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "IDCliente",
                  "displayName": "IDCliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ConectadoCaja",
                  "displayName": "ConectadoCaja",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Puerto",
                  "displayName": "Puerto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2752,
            432
          ],
          "id": "2127ef48-0094-47d8-a6b6-099fbcf0aadf",
          "name": "CompletaDatos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Todo Ok?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Si todo OK"
                      },
                      {
                        "option": "Modificar Registro"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 10,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Registro completo. Deseas modificar?",
              "formDescription": "=ID {{ $json.IDCliente }} Nombre {{ $json[\"Nombre completo\"] }} Direccion {{ $json[\"Dirección \"] }} Usuario pppoe {{ $json[\"Usuario pppoe\"] }} password {{ $json[\"contraseña\"] }} Fecha de Pago {{ $json.FechaPago }} Instalado el {{ $json.FechaInstalacion }} Ya existe, deseas MODIFICAR???"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3840,
            272
          ],
          "id": "0436c841-d9f9-4c0f-b9c2-af13a6d3f4e3",
          "name": "Modificar?",
          "webhookId": "c764cd8e-0fe4-452e-84b1-eb0b3a0f3590"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ca18ae1a-ecea-4fc3-98cc-f9da6c3187c0",
                  "leftValue": "={{ $json[\"Todo Ok?\"] }}",
                  "rightValue": "Modificar Registro",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3648,
            272
          ],
          "id": "63fd621b-1b94-4090-9d13-d44bcaf1e460",
          "name": "Acepta"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro Sin Cambios",
            "completionMessage": "Todo Ok",
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3824,
            464
          ],
          "id": "50ad6fc2-c5fc-4010-9b65-d02cb3dc2ba1",
          "name": "Cancel",
          "webhookId": "b49e5e55-be27-4bc8-8a83-0aaf2053f780"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 406007195,
              "mode": "list",
              "cachedResultName": "Bono",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=406007195"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json.IDCliente }}"
                },
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -3200,
            400
          ],
          "id": "5518edcd-4e71-4b9e-9110-66c87501d067",
          "name": "Bono",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6e9b61c3-be0d-4cc1-ae57-06c62bd116bf",
                  "leftValue": "={{ $json[\"Recomendado por -ID Cliente-\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2992,
            -176
          ],
          "id": "cb85168c-2ac5-4d74-a9ab-aabcc540a54a",
          "name": "Recomendado?"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $json[\"Recomendado por -ID Cliente-\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -3424,
            224
          ],
          "id": "6ef28d4e-4b67-4445-9a06-d52448f126b2",
          "name": "BuscaRecom",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Cliente no encontrado"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3408,
            48
          ],
          "id": "edee4645-bba7-4244-a653-34bdb686428e",
          "name": "NoEncontrado",
          "webhookId": "4e72855b-ef38-46f0-88f2-3744c4929a40"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "=Enviar el siguiente mensaje a :{{ $json.ID }}- {{ $json.Nombre }}. Felicidades has ganado $100 pesos por recomendar a  {{ $json[\"Por recomendar a:\"] }}\n\nPara reclamar tu regalo, en tu pròximo pago selecciona la opciòn pagar varios meses, selecciona otro e ingresa el còdigo: {{ $json.Codigo }} para usar tus $100 pesos de regalo. ",
                "Estado": "Pendiente",
                "Chat id": "7972655827"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2992,
            32
          ],
          "id": "9af43555-7c2b-4e38-b2af-4c9201e83c33",
          "name": "Pend-msn",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "cb1ac556-1007-4732-9da3-dc3af509ba72",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3200,
            240
          ],
          "id": "7fd4db12-4d26-4195-a471-bf21484d65a3",
          "name": "If2"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID": "={{ $json.ID }}",
                "Cantidad": "=={{ $json[\"Cantidad\"] + 100 }}",
                "Por recomendar a:": "=={{ $json[\"Por recomendar a:\"] ? $json[\"Por recomendar a:\"] + \", \" + $('Datos').item.json[\"Nombre completo\"] : $('Datos').item.json[\"Nombre completo\"] }}"
              },
              "matchingColumns": [
                "ID"
              ],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Codigo",
                  "displayName": "Codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Por recomendar a:",
                  "displayName": "Por recomendar a:",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2976,
            400
          ],
          "id": "aa75d6e3-9009-4471-aedf-392bb5b61ca8",
          "name": "add100",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 406007195,
              "mode": "list",
              "cachedResultName": "Bono",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=406007195"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $now.toFormat('dd/MM/yyyy') }}",
                "ID": "={{ $('BuscaRecom').item.json.IDCliente }}",
                "Nombre": "={{ $('BuscaRecom').item.json[\"Nombre completo\"] }}",
                "Codigo": "={{   Math.random().toString(36).substring(2, 6).toUpperCase() }}",
                "Cantidad": "100",
                "Estado": "Pendiente",
                "Por recomendar a:": "={{ $('Datos').item.json[\"Nombre completo\"] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Codigo",
                  "displayName": "Codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Por recomendar a:",
                  "displayName": "Por recomendar a:",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2992,
            224
          ],
          "id": "7ee9280d-94a3-4d7d-9ad2-c37accb5e9ed",
          "name": "Bono100",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -2528,
            -176
          ],
          "id": "6663af9a-84ec-4ff8-b669-1838e738134a",
          "name": "Merge"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $json.IDCliente }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -3824,
            32
          ],
          "id": "01b3e263-e214-4244-a94c-d821ea8e95e9",
          "name": "Datos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "542afc8a-433e-4384-a0cf-e783f4478a73",
                  "leftValue": "={{ $json[\"Usuario pppoe\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "74ee96be-116e-4a51-89f1-1ad615225955",
                  "leftValue": "={{ $json.Plan }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "5ca52d5f-d696-40bb-865e-5ee7c15af6fa",
                  "leftValue": "={{ $json.FechaInstalacion }}",
                  "rightValue": "",
                  "operator": {
                    "type": "dateTime",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "21859303-ae1d-4530-a8d8-5adad38e91bb",
                  "leftValue": "={{ $json.FechaPago }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "or"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3648,
            32
          ],
          "id": "6e513a1b-05f0-43ac-adce-d57a8d4dcfdc",
          "name": "Vacio?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c069b524-b2b4-4126-b3ff-526fb40428ee",
                  "leftValue": "={{ $json.IDCliente }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3440,
            -176
          ],
          "id": "d73795ca-b5c9-42d4-9693-0c3bbb62c98f",
          "name": "Existe?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "27f9568a-8ab5-4095-965a-1a30eb6d565b",
                  "leftValue": "={{ $json[\"IDCliente\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3424,
            416
          ],
          "id": "a9f79fe7-5720-433f-8e38-fd476cbf7331",
          "name": "RecomendadOk"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -T -p 9090 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/system scheduler add name=\\\"{{ $('Limpiar').item.json.IDCliente }}\\\" start-date=\\\"{{ $('Limpiar').item.json.DatePay }}\\\" interval=31d on-event=\\\"/ppp secret disable [find name={{ $('Limpiar').item.json[\"Usuario pppoe\"] }}]\\\"\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -2544,
            240
          ],
          "id": "38fe3847-1b94-4fda-91dc-647e11fd6ff2",
          "name": "Execute Command1"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -T -p 9090 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/ppp secret add name=\\\"{{ $json[\"Usuario pppoe\"] }}\\\" password=\\\"8816\\\" service=pppoe profile=\\\"{{ $json.Plan }}\\\"\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -2768,
            240
          ],
          "id": "a7eef5f3-fb13-481a-aa30-c64a3e27de71",
          "name": "PPPSecret"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b3a8a0bc-3dd2-43ef-ba9c-69a2e769595e",
                  "name": "Fecha de Pago",
                  "value": "={{ $('Recomendado?').item.json[\"Fecha de Pago\"] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2768,
            -176
          ],
          "id": "d190703e-4892-4c2a-8b75-e884dbb5c9ec",
          "name": "Edit Fields"
        }
      ],
      "connections": {
        "Notificar Telegram (Alrededores)": {
          "main": [
            [
              {
                "node": "Responder Éxito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notificar Telegram (Morelia)": {
          "main": [
            [
              {
                "node": "Responder Éxito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RecibirFormulario": {
          "main": [
            [
              {
                "node": "LeeID",
                "type": "main",
                "index": 0
              },
              {
                "node": "DatosForm",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LeeID": {
          "main": [
            [
              {
                "node": "ID's",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ID's": {
          "main": [
            [
              {
                "node": "GeneraID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GeneraID": {
          "main": [
            [
              {
                "node": "CombinarDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CombinarDatos": {
          "main": [
            [
              {
                "node": "Alrededores?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosForm": {
          "main": [
            [
              {
                "node": "CombinarDatos",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Alrededores?": {
          "main": [
            [
              {
                "node": "Alrededores",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Morelia",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Alrededores": {
          "main": [
            [
              {
                "node": "Notificar Telegram (Alrededores)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Morelia": {
          "main": [
            [
              {
                "node": "Notificar Telegram (Morelia)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IDCliente": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Faltantes": {
          "main": [
            [
              {
                "node": "Recomendado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCort": {
          "main": [
            [
              {
                "node": "Limpiar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limpiar": {
          "main": [
            [
              {
                "node": "PPPSecret",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CompletaDatos": {
          "main": [
            [
              {
                "node": "Fin",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modificar?": {
          "main": [
            [
              {
                "node": "Acepta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acepta": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Cancel",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Bono": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recomendado?": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "BuscaRecom",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaRecom": {
          "main": [
            [
              {
                "node": "RecomendadOk",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "NoEncontrado": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pend-msn": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Bono100",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "add100",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "add100": {
          "main": [
            [
              {
                "node": "Pend-msn",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Bono100": {
          "main": [
            [
              {
                "node": "Pend-msn",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "FechaCort",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datos": {
          "main": [
            [
              {
                "node": "Vacio?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vacio?": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modificar?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "Datos",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RecomendadOk": {
          "main": [
            [
              {
                "node": "NoEncontrado",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Bono",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PPPSecret": {
          "main": [
            [
              {
                "node": "Execute Command1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute Command1": {
          "main": [
            [
              {
                "node": "CompletaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "VsZgQdgcs6lVZ4p1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "RecibirFormulario": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0",
                "content-length": "757",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-MX,es;q=0.8,en-US;q=0.5,en;q=0.3",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "9a3621581ed214e1-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "a967b86d-d2c2-48b5-a764-c5343bcdde25",
                "connection": "keep-alive",
                "content-type": "multipart/form-data; boundary=----geckoformboundary7a03f97f76c941cffe4b9883f771c905",
                "origin": "https://1850213937-atari-embeds.googleusercontent.com",
                "priority": "u=0",
                "referer": "https://1850213937-atari-embeds.googleusercontent.com/",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "nombre": "juan pita",
                "direccion": "chiraspelas",
                "numero": "5555",
                "zona": "Morelia",
                "recomendado": "e334",
                "fecha": "23/11/2025"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/nvocte",
              "executionMode": "production"
            }
          }
        ],
        "IDCliente": [
          {
            "json": {
              "Cliente ID": "f194",
              "submittedAt": "2025-11-23T23:48:06.777-05:00",
              "formMode": "production"
            }
          }
        ]
      },
      "versionId": "3fdda8d4-df33-4552-aa49-02a7908441f3",
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-11-22T05:32:54.921Z",
          "createdAt": "2025-11-22T05:32:54.921Z",
          "role": "workflow:owner",
          "workflowId": "Bt9NOHKdCpve8bhP",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-11-22T05:32:41.927Z",
          "createdAt": "2025-11-22T05:32:41.927Z",
          "id": "REkbHNk0nSWbCGDS",
          "name": "Depas"
        }
      ]
    },
    {
      "updatedAt": "2025-10-11T05:10:19.000Z",
      "createdAt": "2025-10-11T05:09:45.490Z",
      "id": "CrQZH6IcS4O0J61T",
      "name": "CyberBoxCaja",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "4020deb1-34f7-4855-9178-9e72d704fc5e",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            3808,
            3232
          ],
          "id": "b294b5fa-acbd-4d54-b71a-b01b5b4c7223",
          "name": "Caja",
          "webhookId": "4020deb1-34f7-4855-9178-9e72d704fc5e"
        },
        {
          "parameters": {
            "jsCode": "const action = $('Switch1').item.json.intencion;\nconst cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nlet message, type;\n\nswitch(action) {\n  case 'modificar':\n    message = 'Cantidad modificada en el carrito.';\n    type = 'success';\n    break;\n  case 'vaciar':\n    message = 'El carrito ha sido vaciado.';\n    type = 'success';\n    break;\n  case 'finalizar':\n    if (cartItems.length === 0) {\n      message = 'No se puede finalizar: el carrito está vacío.';\n      type = 'error';\n    } else {\n      message = 'Compra finalizada exitosamente.';\n      type = 'success';\n    }\n    break;\n  case 'ver':\n    message = 'Contenido actual del carrito:';\n    type = 'info';\n    break;\n  default:\n    message = 'Operación completada.';\n    type = 'info';\n}\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: message,\n            currentCart: [],\n            cartTotal: 0,\n            type: type\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.id} -- ${item.json.product_id}, ${cantidad} * $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        text: message,\n        currentCart: formattedItems,\n        cartTotal: Math.round(totalGeneral),\n        type: type\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4928,
            3472
          ],
          "id": "7d04c432-cd10-4af5-b19c-dc06a5450805",
          "name": "FormatOtherResponses"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "52fd61d2-793b-4707-9bf0-a626728cca37",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            4240,
            3184
          ],
          "id": "29a10270-6ec2-4c9a-b657-aa0baf330bf7",
          "name": "Switch1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('Find1').item.json }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4688,
            2960
          ],
          "id": "b65ea551-aad6-46e3-a5cc-85ccac4a4fbf",
          "name": "If2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('Buscar1').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('Buscar1').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('Buscar1').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Switch1').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": false
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4464,
            2960
          ],
          "id": "75c8fbdb-7366-4fb4-9570-6ac39fda77a4",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            5200,
            3584
          ],
          "id": "be450c10-3a79-4929-abd4-24662801739a",
          "name": "Respond to Webhook1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "da24ee7f-0719-4be1-ae5c-d6d601393539",
                  "name": "text",
                  "value": "Producto añadido/actualizado al carrito.",
                  "type": "string"
                },
                {
                  "id": "329742e7-97b9-4ad9-9858-12b361dd1471",
                  "name": "currentCart",
                  "value": "={{ $('total1').item.json.currentCart }}",
                  "type": "array"
                },
                {
                  "id": "cart-total-fixed",
                  "name": "cartTotal",
                  "value": "={{ $('total1').item.json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "add-update-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            5120,
            3344
          ],
          "id": "d3821b47-a895-43e3-ad1b-7cc8a3e8a495",
          "name": "Add/Update Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "vaciar-text",
                  "name": "text",
                  "value": "El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "vaciar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "vaciar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "vaciar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4464,
            3472
          ],
          "id": "37376eeb-679a-4818-a772-50502f74ea1d",
          "name": "Vaciar Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "error-text",
                  "name": "text",
                  "value": "Ha ocurrido un error inesperado.",
                  "type": "string"
                },
                {
                  "id": "error-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "error-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "error-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4688,
            3472
          ],
          "id": "14d57afa-c7b5-404f-8658-2dd07e4326e0",
          "name": "Error Response1"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' ');\n\nconst intencion = parts[0];\nconst id = parts[1];\nconst cantidad = parseInt(parts[2]) || 1;\n\n// Capturar datos del usuario del body\nconst user_id = $input.first().json.body.user_id;\nconst session_id = $input.first().json.body.session_id;\nconst username = $input.first().json.body.username;\n\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad,\n    user_id: user_id,\n    session_id: session_id,\n    username: username\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4032,
            3232
          ],
          "id": "e7ec0de2-d96d-4a98-9f7d-886e45fed09a",
          "name": "Intencion1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "not-found-text",
                  "name": "text",
                  "value": "={{ $json.mergedText }}",
                  "type": "string"
                },
                {
                  "id": "not-found-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "not-found-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "not-found-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4912,
            3280
          ],
          "id": "c730d1bc-5701-49f5-b3db-e75a11d3e350",
          "name": "Product Not Found Response1"
        },
        {
          "parameters": {
            "jsCode": "if (!items || items.length === 0) {\n    return [{ json: { mergedText: `No se encontraron productos con: ${$('Switch1').item.json.id}` } }];\n}\n\nconst result = [];\nfor (const item of items) {\n    if (item.json && item.json.id) {\n        result.push(`ID: ${item.json.id}, ${item.json.nombre}, Precio: ${item.json.precio}`);\n    }\n}\n\nreturn [{ json: { mergedText: result.length > 0 ? result.join('\\n') : 'No se encontraron productos válidos' } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4688,
            3136
          ],
          "id": "c16d532e-ef2d-4fd2-bae8-e1ccc58110bd",
          "name": "Code1",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "jsCode": "const cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: \"El carrito está vacío.\",\n            currentCart: [],\n            cartTotal: 0,\n            type: \"info\"\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.id} -- ${item.json.product_id}, ${cantidad} * $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        currentCart: formattedItems,\n        cartTotal: Math.round(totalGeneral)\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            5120,
            3152
          ],
          "id": "55953356-c2ac-4bbd-aeda-bff4afa91e9c",
          "name": "total1"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "product",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Switch1').item.json.id.toUpperCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3824,
            3040
          ],
          "id": "352aad4b-b862-4eb2-9303-d335c994a6a8",
          "name": "Buscar1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4240,
            2960
          ],
          "id": "97f38699-8256-4c7a-ba98-546dc9181936",
          "name": "Find1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "={{ $json.id }}"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $json.nombre }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.precio * $json.cantidad }}"
                },
                {
                  "fieldId": "user_sesion_id",
                  "fieldValue": "={{ $('Switch1').item.json.user_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4912,
            2944
          ],
          "id": "4753d0d9-de15-4700-a557-14889fac3e19",
          "name": "Create a row2",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "product",
            "limit": 10,
            "filters": {
              "conditions": [
                {
                  "keyName": "nombre",
                  "condition": "fullText",
                  "searchFunction": "plfts",
                  "keyValue": "={{ $('Switch1').item.json.id.toLowerCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4464,
            3120
          ],
          "id": "ca072b20-3e0f-4c54-a656-85b10b311b67",
          "name": "BuscaNombre1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart",
            "limit": 30
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            5120,
            2944
          ],
          "id": "20ca79a8-e28e-4ddd-856f-63e9bd467fc7",
          "name": "GetCart1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $json.id.toUpperCase() }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4688,
            3312
          ],
          "id": "0e9a34b2-19aa-4f42-b446-9df17a9ffd39",
          "name": "Modifica1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $('Find1').item.json.cantidad + $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4912,
            3120
          ],
          "id": "91643e60-d201-4040-96ec-9d5702e5ae0f",
          "name": "Update1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3824,
            3472
          ],
          "id": "3d3b8830-d4c8-4fb6-acc0-36bc3054bdc5",
          "name": "TraerCarrito1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $('Buscar1').item.json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4016,
            3056
          ],
          "id": "a624fd6f-5cf6-476f-9ac3-6cd24cf621d5",
          "name": "existe?1",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "cart",
            "filterType": "string",
            "filterString": "id=not.is.null"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4464,
            3312
          ],
          "id": "846124a6-86c6-4959-93c7-702a489fa50f",
          "name": "Delete a row1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5f4d63ef-8888-4fc9-9d59-d0ea3b0062f0",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4016,
            3488
          ],
          "id": "7bc93428-da21-4d67-af1e-1519ab3450e8",
          "name": "If3"
        },
        {
          "parameters": {
            "tableId": "sales",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "Producto",
                  "fieldValue": "={{ $json.product_id }}"
                },
                {
                  "fieldId": "Cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.total }}"
                },
                {
                  "fieldId": "Precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "user_id",
                  "fieldValue": "={{ $('Intencion1').item.json.user_id }}"
                },
                {
                  "fieldId": "username",
                  "fieldValue": "={{ $('Intencion1').item.json.username }}"
                },
                {
                  "fieldId": "session_id",
                  "fieldValue": "={{ $('Intencion1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4240,
            3504
          ],
          "id": "69f080a7-69ac-4c10-9178-4b54f6f637fe",
          "name": "Create a row3",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        }
      ],
      "connections": {
        "Caja": {
          "main": [
            [
              {
                "node": "Intencion1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormatOtherResponses": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Buscar1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modifica1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "TraerCarrito1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Create a row2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add/Update Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion1": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Product Not Found Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Product Not Found Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "total1": {
          "main": [
            [
              {
                "node": "Add/Update Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar1": {
          "main": [
            [
              {
                "node": "existe?1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find1": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row2": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaNombre1": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GetCart1": {
          "main": [
            [
              {
                "node": "total1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modifica1": {
          "main": [
            [
              {
                "node": "FormatOtherResponses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update1": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TraerCarrito1": {
          "main": [
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?1": {
          "main": [
            [
              {
                "node": "BuscaNombre1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Find1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row1": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row3": {
          "main": [
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Caja": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36",
                "content-length": "85",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "9857db018a87b795-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "68a38f6a-ca8c-4824-b947-e341c3b1abcb",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "message": "finalizar",
                "user_id": 1,
                "username": "admin",
                "session_id": "1_1758942601219"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/carrit2",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "f2dddb91-6d14-42e5-8b23-139c8d150a3d",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-10-11T05:09:45.504Z",
          "createdAt": "2025-10-11T05:09:45.504Z",
          "role": "workflow:owner",
          "workflowId": "CrQZH6IcS4O0J61T",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-10-11T05:02:22.755Z",
          "createdAt": "2025-10-11T05:02:22.755Z",
          "id": "XsE6BF4zmq7QL7N0",
          "name": "caja"
        }
      ]
    },
    {
      "updatedAt": "2025-06-23T17:16:39.000Z",
      "createdAt": "2025-06-11T05:26:09.821Z",
      "id": "Dj9hJgSAkkWqNNZT",
      "name": "Pendientes",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $('When Executed by Another Workflow').item.json.Pendiente }}",
                "Estado": "Pendiente",
                "Chat id": "={{ $('When Executed by Another Workflow').item.json['chat-id'] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "name": "Agregar a hoja",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -160,
            -80
          ],
          "id": "fd41b02e-0a1a-49f8-ba1d-c85d4213ff94",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json['chat-id'] }}",
            "text": "=✅ Pendiente registrado.",
            "additionalFields": {}
          },
          "name": "Confirm Add Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            100,
            -80
          ],
          "id": "6cd27af5-a3d4-4d5e-a24a-607434343c15",
          "webhookId": "4fcd2258-772a-4aa0-b3fe-82105317c473",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{$json.chatId}}",
            "text": "✅ Pendiente '{{ $json.pendiente }}' marcado como completado.",
            "additionalFields": {}
          },
          "name": "Confirmar Hecho Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -60,
            280
          ],
          "id": "93d50f35-2c66-4fcb-81aa-210648821a89",
          "webhookId": "ac9bca57-c807-44be-813c-ede25bb7d884",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9,
                  "triggerAtMinute": 20
                },
                {
                  "triggerAtHour": 13
                },
                {
                  "triggerAtHour": 17
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -860,
            -80
          ],
          "id": "fc537388-0f61-40e6-aaf5-fd5a7ebde240",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -840,
            120
          ],
          "id": "62e22950-8443-4fcc-a04b-b205cd324f99",
          "name": "Pendientes",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Pendiente",
                  "lookupValue": "={{ $json.Pendiente }}"
                },
                {
                  "lookupColumn": "Chat id",
                  "lookupValue": "= {{$json.chatId}}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -580,
            140
          ],
          "id": "fc6c1389-5df5-403b-97d3-61af7ba4e29b",
          "name": "Pendient",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Estado": "completado",
                "Pendiente": "{{ $json.Pendiente }}"
              },
              "matchingColumns": [
                "Pendiente"
              ],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -340,
            240
          ],
          "id": "84a5de39-f7f5-43b9-be80-1340130f60cc",
          "name": "Completado",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const ahora = new Date();\nreturn items.filter(item => {\n  const estado = item.json.estado?.toLowerCase();\n  const fecha = new Date(item.json.fecha);\n  return estado === 'pendiente' && fecha <= ahora;\n});\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -840,
            300
          ],
          "id": "f2fbc66e-2ebc-44e2-b757-02ccdc1216d8",
          "name": "Filtrar Vencidos"
        },
        {
          "parameters": {
            "chatId": "={{$json.chat_id}}",
            "text": "=⏰ Recordatorio: pendiente \"{{ $json.pendiente }}\" programado para {{ $json.fecha }}.   Cuando lo completes, responde: pendiente cumplido {{ $json.pendiente }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -600,
            320
          ],
          "id": "8698bb98-ca43-4903-a0b2-783c0f110017",
          "name": "Recordatorio",
          "webhookId": "78d98072-5186-45bc-b21e-0b4309dbd1dd",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{$json.chatId}}",
            "text": "=pendiente \"{{ $json.pendiente }}\" programado para {{ $json.fecha }}.   Cuando lo completes, responde: pendiente cumplido {{ $json.pendiente }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            220,
            240
          ],
          "id": "264815e1-14fb-4185-8b20-3655e12bd902",
          "name": "Telegram",
          "webhookId": "ba000aa8-1dcd-42f1-bff9-c2dd9a383375",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "Accion"
                },
                {
                  "name": "Pendiente"
                },
                {
                  "name": "chat-id",
                  "type": "number"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -640,
            -40
          ],
          "id": "8bea44de-5d19-4c51-8478-3b3cdaa641c6",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.Accion }}",
                        "rightValue": "add",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "08a62ae7-f12c-4fdc-8835-ec887e60eb9f"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "919e7e00-c608-4fc6-9223-434fd81034d5",
                        "leftValue": "={{ $json.Accion }}",
                        "rightValue": "show",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6fafe8d6-f710-4707-b255-8720d9e595e9",
                        "leftValue": "={{ $json.Accion }}",
                        "rightValue": "del",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -440,
            -40
          ],
          "id": "f97babfc-5282-42a3-b75c-4522de948e4a",
          "name": "Switch"
        },
        {
          "parameters": {
            "jsCode": "const ahora = new Date();\nreturn items.filter(item => {\n  const estado = item.json.estado?.toLowerCase();\n  const fecha = new Date(item.json.fecha);\n  return estado === 'pendiente' && fecha <= ahora;\n});\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            40,
            120
          ],
          "id": "f86f54a8-e32c-4ad1-8121-6a94bc1cab11",
          "name": "Filtrar Vencidos1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -160,
            100
          ],
          "id": "aefbce1a-78c1-413d-af7a-bd8b03eddc41",
          "name": "show",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        }
      ],
      "connections": {
        "Agregar a hoja": {
          "main": [
            [
              {
                "node": "Confirm Add Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendient": {
          "main": [
            [
              {
                "node": "Completado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completado": {
          "main": [
            [
              {
                "node": "Confirmar Hecho Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendientes": {
          "main": [
            [
              {
                "node": "Filtrar Vencidos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filtrar Vencidos": {
          "main": [
            [
              {
                "node": "Recordatorio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Agregar a hoja",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "show",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "show": {
          "main": [
            [
              {
                "node": "Filtrar Vencidos1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filtrar Vencidos1": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "472b1bf0-ecc7-47d8-b2b9-50e40ffd7e1c",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-06-11T05:26:09.826Z",
          "createdAt": "2025-06-11T05:26:09.826Z",
          "role": "workflow:owner",
          "workflowId": "Dj9hJgSAkkWqNNZT",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-06T20:25:20.000Z",
      "createdAt": "2025-12-06T20:23:56.356Z",
      "id": "Eihs3q4doK9BeR8m",
      "name": "PagoInterStaCruz copy",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Pago de Internet",
            "formDescription": "Ingresa Id o Busca por Nombre",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID"
                },
                {
                  "fieldLabel": "NOMBRE"
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "buttonLabel": "Aceptar",
              "path": "StaCruz",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -3296,
            896
          ],
          "id": "503cb53d-deae-43c9-acec-a783e9592a5b",
          "name": "On form submission",
          "webhookId": "1782becd-5a35-4e87-993d-25a2de28bfc6"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "2d77fd42-1873-439d-af09-460c82ce353a",
                  "leftValue": "={{ $json.Nombre.toLowerCase ()}}",
                  "rightValue": "={{ $('On form submission').item.json.NOMBRE }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -3072,
            704
          ],
          "id": "55ce7033-923e-4088-9c47-b5d8f32bf2fb",
          "name": "Filter",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "2c6fbedf-d480-46fd-a4c9-93508dd632d3",
                  "leftValue": "={{ $json.Nombre }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3072,
            1104
          ],
          "id": "f8446ae8-cf69-48d6-b7fb-3a0d6b0efccd",
          "name": "If"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "=codigo",
                  "lookupValue": "={{ $('On form submission').item.json.ID.toUpperCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -3264,
            1104
          ],
          "id": "3cb136b0-ebb2-44fb-9122-b078b7565869",
          "name": "ID",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -3296,
            704
          ],
          "id": "e8d417ac-22c1-467f-a03f-5e5759d5cafa",
          "name": "NOMBRE",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const nameToFind = $('On form submission').first().json.NOMBRE.toLowerCase();\nconst clients = $input.all();\n\n// Verificar si el nombre a buscar está vacío\nif (!nameToFind) {\n  return [{ json: { message: 'Por favor, ingrese un nombre para buscar.' } }];\n}\n\n// Filtrar los clientes que coinciden\nconst filteredClients = clients.filter(client => {\n  const clientName = client.json.Nombre;\n  return clientName && typeof clientName === 'string' && clientName.toLowerCase().includes(nameToFind);\n});\n\n// Si no se encontraron clientes, devolver un mensaje de error\nif (filteredClients.length === 0) {\n  return [{ json: { message: 'No se encontraron clientes con ese nombre.' } }];\n}\n\n// Mapear los clientes filtrados para crear un array de cadenas de texto con la información deseada\nconst clientMessages = filteredClients.map(client => {\n  const name = client.json.Nombre || 'Nombre no disponible';\n  const code = client.json.codigo || 'Código no disponible';\n  return `Nombre: ${name}, Código: ${code}`;\n});\n\n// Unir todos los mensajes en una sola cadena, separándolos con saltos de línea\nconst finalMessage = clientMessages.join('\\n');\n\n// Devolver un solo ítem con el mensaje final\nreturn [{ json: { message: finalMessage } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2848,
            704
          ],
          "id": "f4849380-3744-4729-83b0-deec0cd4c417",
          "name": "Code"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "ERROR",
            "completionMessage": "CLIENTE NO ENCONTRADO ",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2848,
            848
          ],
          "id": "2148e806-0436-4016-9ec7-82488d822413",
          "name": "no existe",
          "webhookId": "1ec253b6-acca-4715-9889-de92adb30a12"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.ID }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "c385fd11-d0ea-4311-9ae2-dd1f6e1e2bdd"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0828d583-eb11-4ef6-b6a5-2650bcb4e982",
                        "leftValue": "={{ $json.NOMBRE }}",
                        "rightValue": "=",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -3072,
            880
          ],
          "id": "d0fd8164-9291-4d4e-8623-776f0b29e256",
          "name": "Switch"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -2416,
            1248
          ],
          "id": "2682196c-91f3-404d-bbc9-2b8060ba8537",
          "name": "Merge"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=Encontrados",
            "completionMessage": "={{ $json.message }}",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2656,
            704
          ],
          "id": "28099e73-6a79-47c7-b313-93cc05ed0c1c",
          "name": "Encontrados",
          "webhookId": "c31cc024-cd7d-47e0-bba6-6b2336fe3a9b"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a5f79a3c-2fe2-4d2a-8ab1-1b9ed4e919e0",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "20",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "36fdb60d-d81f-4751-8699-15fce9d8e1ca",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "120",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "d936e11c-68bb-4c61-8490-7f590626d3a4",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "250",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "03db099a-9f2d-4185-852c-b5229d8e6bb3",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "350",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "ceb38cfd-a3e2-4468-a884-4058a5292237",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "450",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2848,
            1008
          ],
          "id": "8f8809b7-2a5b-4e84-9f8b-d8b98c4599f3",
          "name": "Plan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "=Plan2M",
                  "type": "string"
                },
                {
                  "id": "200ca108-4601-4ee3-bdca-a560f390669b",
                  "name": "hrs",
                  "value": 24,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            864
          ],
          "id": "b86cc997-7c22-49e3-b068-7a6b75cf78e7",
          "name": "1dia"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan2M",
                  "type": "string"
                },
                {
                  "id": "e0f83a70-09ea-47a6-8667-f3ea698e17ca",
                  "name": "hrs",
                  "value": 168,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1008
          ],
          "id": "8a3274c5-2f73-452a-bf3c-b4d0c46c3e58",
          "name": "1sem"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2416,
            1104
          ],
          "id": "929c4df8-ad5a-4fa2-911e-a41270249684",
          "name": "10Mb"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan5M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1296
          ],
          "id": "d4ab2608-c359-4465-bf3e-2f04328eec29",
          "name": "18Mb"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1152
          ],
          "id": "f05023d4-7f57-4e04-adb3-ee7fcac4539f",
          "name": "14Mb"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Switch').item.json.submittedAt }}",
            "timeUnit": "hours",
            "duration": "={{ $json.hrs }}",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -1984,
            688
          ],
          "id": "bee34edc-abd8-47f6-bb01-bc0237baac8b",
          "name": "Date & Time"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $json.fechaDeCorteFormateada }}",
            "timeUnit": "hours",
            "duration": "={{ $json.hrs  }}",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -2192,
            832
          ],
          "id": "d0dd5b43-dd74-4ca1-add0-b2c2d53d34c1",
          "name": "Date & Time1"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -2416,
            896
          ],
          "id": "232248f9-7730-48cb-b440-1224a9c085b3",
          "name": "Merge1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "15fba6b9-f932-428a-aa43-ce39d9f1660b",
                  "leftValue": "={{ $now }}",
                  "rightValue": "={{ $json.fechaDeCorteFormateada }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "afterOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2208,
            1120
          ],
          "id": "64ce1b68-62e1-4872-8595-05af945dcb66",
          "name": "If2"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $now }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -2192,
            976
          ],
          "id": "c2cda8e0-b363-432a-8638-6d669f7dadc5",
          "name": "Date & Time2"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $json.fechaDeCorteFormateada }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -1984,
            848
          ],
          "id": "0f898029-34d9-4fe0-ab8b-30a697fbdd24",
          "name": "Date & Time3"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -1776,
            688
          ],
          "id": "55543da8-3daa-44cf-be62-c05485e1e12e",
          "name": "Merge2"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "49cc61e1-e18b-41e2-b11c-93ac9d032869",
                  "leftValue": "={{ $json.submittedAt }}",
                  "rightValue": "={{ $json.fechaDeCorteFormateada }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "afterOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2208,
            704
          ],
          "id": "2293b8ce-757a-48de-a6b6-ffa96c03f061",
          "name": "If1"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Agregado al Carrito - Presiona Ver Carrito",
            "completionMessage": "=ID {{ $('ActualizaBase').item.json.codigo }} -- {{ $('Edit Fields').item.json.nombre }} -- ${{ $('ActualizaBase').item.json[\"cantidad pagada \"] }} -- Fecha de Corte {{ $('ActualizaBase').item.json[\"fecha de corte\"] }} a las {{ $json[\"start-time\"] }}",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -1600,
            1408
          ],
          "id": "316f0aab-79e2-486e-8e70-e7bb73fe18aa",
          "name": "Form1",
          "webhookId": "4650f358-5fee-49cd-bf85-76e13520e588"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error ***",
            "completionMessage": "No encontrado",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3280,
            1280
          ],
          "id": "d0bfa066-d86c-42a7-aec7-4a6a3b222771",
          "name": "Error404",
          "webhookId": "c846ec31-c029-499f-a838-35bedd232cfe"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "=Cantidad",
                  "fieldType": "number",
                  "placeholder": "={{ $json['cantidad pagada '] }}"
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formDescription": "=ID  {{ $json.codigo }} - {{ $json.Nombre }} - Corte: {{ $json['fecha de corte'] }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3040,
            1296
          ],
          "id": "766c0d0e-da9d-40a8-976a-592afb6e14bb",
          "name": "Cantidad",
          "webhookId": "ca0802e4-e718-4dbe-a8b8-30457539fa25"
        },
        {
          "parameters": {
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "ERROR **",
              "formDescription": "=La cantidad no es correcta",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2848,
            1312
          ],
          "id": "2da09b53-1c3b-4c24-86f3-a3128ae7c979",
          "name": "ErrorCant",
          "webhookId": "81bd19dc-8148-4bd0-8142-f254fb1bdbe1"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene el objeto JSON del nodo 'Merge1' y extrae la fecha de corte.\n// Asegúrate de que el nombre 'Merge1' coincida con tu nodo real.\nconst fechaDeCorte = $node['ID'].json['fecha de corte'];\n\n// El resto del código permanece igual\nconst outputItems = [];\n\nfor (const item of $input.all()) {\n  const originalJson = item.json;\n\n  if (fechaDeCorte) {\n    const parts = fechaDeCorte.split('/');\n    const day = parts[0];\n    const month = parts[1];\n    const year = parts[2];\n\n    const formattedDate = `${year}-${month}-${day}`;\n    \n    originalJson.fechaDeCorteFormateada = formattedDate;\n  }\n\n  outputItems.push({\n    json: originalJson\n  });\n}\n\nreturn outputItems;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2416,
            704
          ],
          "id": "8b040e4c-64dd-4c8e-92eb-68f1f5ac46e8",
          "name": "formatdate"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene el objeto JSON del nodo 'Merge1' y extrae la fecha de corte.\n// Asegúrate de que el nombre 'Merge1' coincida con tu nodo real.\nconst fechaDeCorte = $node['ID'].json['fecha de corte'];\n\n// El resto del código permanece igual\nconst outputItems = [];\n\nfor (const item of $input.all()) {\n  const originalJson = item.json;\n\n  if (fechaDeCorte) {\n    const parts = fechaDeCorte.split('/');\n    const day = parts[0];\n    const month = parts[1];\n    const year = parts[2];\n\n    const formattedDate = `${year}-${month}-${day}`;\n    \n    originalJson.fechaDeCorteFormateada = formattedDate;\n  }\n\n  outputItems.push({\n    json: originalJson\n  });\n}\n\nreturn outputItems;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2208,
            1264
          ],
          "id": "d53bb7b8-1194-4fc8-8d54-447b8196d521",
          "name": "Formatedate"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "codigo": "={{ $('If').item.json.codigo }}",
                "cantidad pagada ": "={{ $('Cantidad').item.json.Cantidad }}",
                "fecha de corte": "={{ $json.corte.toDateTime().format('dd/MM/yyyy') }}",
                "fecha de pago ": "={{ $json.submittedAt.toDateTime().format('yyyy-MM-dd') }}",
                "hora de pago": "={{ $json.submittedAt.toDateTime().format('hh:mm:ss') }}"
              },
              "matchingColumns": [
                "codigo"
              ],
              "schema": [
                {
                  "id": "codigo",
                  "displayName": "codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad pagada ",
                  "displayName": "cantidad pagada ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "fecha de pago ",
                  "displayName": "fecha de pago ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "fecha de corte",
                  "displayName": "fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "hora de pago",
                  "displayName": "hora de pago",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Mac",
                  "displayName": "Mac",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ip",
                  "displayName": "Ip",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1600,
            688
          ],
          "id": "de95bd2b-7560-4e05-8557-661b77a2aa4a",
          "name": "ActualizaBase",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "={{ $json.codigo }}"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $('ID').item.json.Nombre }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "1"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json[\"cantidad pagada \"] }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json[\"cantidad pagada \"] }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1808,
            912
          ],
          "id": "70920f06-44c6-4f95-99c0-ce5ad42954a9",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bf85ddee-ad8c-4bd3-8b7e-060f42558a69",
                  "name": "id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "22963fb9-38c8-4c47-be1a-629753d09cf0",
                  "name": "nombre",
                  "value": "={{ $json.product_id }}",
                  "type": "string"
                },
                {
                  "id": "4c71f54f-d766-4cc1-b7ec-86b523a3100e",
                  "name": "cantidad pagada ",
                  "value": "={{ $('ActualizaBase').item.json[\"cantidad pagada \"] }}",
                  "type": "number"
                },
                {
                  "id": "c62b9bde-3cb2-4f68-b10f-21c4b9224c7b",
                  "name": "fecha de corte",
                  "value": "={{ $('ActualizaBase').item.json[\"fecha de corte\"] }}",
                  "type": "string"
                },
                {
                  "id": "5034c9ed-ee7b-4597-8829-2cb77d72981b",
                  "name": "PlanPagado",
                  "value": "={{ $('Merge2').item.json.PlanPagado }}",
                  "type": "string"
                },
                {
                  "id": "665e7581-7881-4001-b2c9-3e25317fc011",
                  "name": "Mac",
                  "value": "={{ $('ID').item.json.Mac }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1616,
            880
          ],
          "id": "13a72024-f9cb-490e-9a99-4adc9d45e4ba",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/ip/hotspot/ip-binding?mac-address={{ $json.Mac }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1984,
            976
          ],
          "id": "d52b85b1-0d64-4d90-91df-0924dfb089b2",
          "name": "ipbinding",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/ip/hotspot/ip-binding/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"disabled\": \"no\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -2000,
            1120
          ],
          "id": "49b76b6c-07ed-4ab9-bfee-fa7fc3e13f28",
          "name": "active",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/ip/dhcp-server/lease?mac-address={{ $json[\"mac-address\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1984,
            1312
          ],
          "id": "818731c0-2e7e-4505-8adf-50151da21902",
          "name": "dhcp-server",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/ip/dhcp-server/lease/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"address-lists\": \"{{$('Edit Fields').item.json.PlanPagado}}\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1792,
            1088
          ],
          "id": "477f9f62-2721-45c9-8730-da0b81cda8b5",
          "name": "addreslist",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/system/scheduler?name={{ $('Edit Fields').item.json.id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1616,
            1040
          ],
          "id": "d6eeba03-f0a4-4bab-ae48-ae8713c821f8",
          "name": "schedule",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/system/scheduler/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"start-date\": \"{{ $json.fechamikro }}\",\n  \"start-time\": \"{{ $json.horamikro }}\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1616,
            1216
          ],
          "id": "a15b5ae7-845d-45d8-8b6f-5fe00bcd9803",
          "name": "fechacorte",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Obtenemos los datos actuales que vienen del nodo \"schedule\".\nconst currentData = items[0].json;\n\n// ¡IMPORTANTE! Obtenemos los datos del nodo específico \"Edit Fields\".\nconst sourceData = $node[\"Edit Fields\"].json;\n\n// Ahora extraemos la fecha de corte desde la fuente de datos correcta.\nconst dateStr = sourceData['fecha de corte'].trim();\n\n// --- Código para formatear la fecha (sin cambios) ---\nconst parts = dateStr.split('/');\nconst day = parts[0];\nconst month = parts[1];\nconst year = parts[2];\nconst dateObj = new Date(year, month - 1, day);\nconst monthNames = [\"jan\", \"feb\", \"mar\", \"apr\", \"may\", \"jun\", \"jul\", \"aug\", \"sep\", \"oct\", \"nov\", \"dec\"];\nconst mikrotikMonth = monthNames[dateObj.getMonth()];\nconst mikrotikDay = String(dateObj.getDate()).padStart(2, '0');\nconst mikrotikYear = dateObj.getFullYear();\nconst formattedDate = `${mikrotikMonth}/${mikrotikDay}/${mikrotikYear}`;\n\n// --- NUEVA PARTE: Definimos la hora ---\n// Aquí puedes poner la hora que necesites en formato HH:MM:SS\n// --- NUEVA PARTE: Obtenemos la HORA ACTUAL ---\nconst now = new Date();\nconst hours = String(now.getHours()).padStart(2, '0');\nconst minutes = String(now.getMinutes()).padStart(2, '0');\nconst seconds = String(now.getSeconds()).padStart(2, '0');\n\n// Construimos la hora en el formato HH:MM:SS que MikroTik necesita\nconst formattedTime = `${hours}:${minutes}:${seconds}`;\n\n// Añadimos la fecha formateada a los datos.\ncurrentData.fechamikro = formattedDate;\n\n// --- NUEVA PARTE: Añadimos también la hora a los datos ---\ncurrentData.horamikro = formattedTime;\n\n// Retornamos los datos combinados para el siguiente nodo.\nreturn [{\n  json: currentData\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1776,
            1264
          ],
          "id": "33ce2e51-c55f-4f7b-aa63-3ad3ec3dc49d",
          "name": "Code1"
        }
      ],
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Cantidad",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error404",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ID": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "NOMBRE": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Encontrados",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "ID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NOMBRE",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "no existe",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Formatedate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan": {
          "main": [
            [
              {
                "node": "1dia",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "1sem",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "10Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "14Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "18Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ErrorCant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "1dia": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "1sem": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "10Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "18Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "14Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time1": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "formatdate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Date & Time2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Date & Time3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time2": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Date & Time3": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Merge2": {
          "main": [
            [
              {
                "node": "ActualizaBase",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Date & Time1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cantidad": {
          "main": [
            [
              {
                "node": "Plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ErrorCant": {
          "main": [
            [
              {
                "node": "Cantidad",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "formatdate": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Formatedate": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaBase": {
          "main": [
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "ipbinding",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ipbinding": {
          "main": [
            [
              {
                "node": "active",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "active": {
          "main": [
            [
              {
                "node": "dhcp-server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "dhcp-server": {
          "main": [
            [
              {
                "node": "addreslist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "addreslist": {
          "main": [
            [
              {
                "node": "schedule",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "schedule": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "fechacorte",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "fechacorte": {
          "main": [
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "6qDeTkqGyaEvvHE7"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "On form submission": [
          {
            "json": {
              "ID": "mahe",
              "NOMBRE": "",
              "submittedAt": "2025-12-05T21:05:04.286-05:00",
              "formMode": "production"
            }
          }
        ]
      },
      "versionId": "2b9123a3-aa61-4594-9f04-cac8b915cb08",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-12-06T20:23:56.362Z",
          "createdAt": "2025-12-06T20:23:56.362Z",
          "role": "workflow:owner",
          "workflowId": "Eihs3q4doK9BeR8m",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-02T23:43:33.000Z",
      "createdAt": "2025-05-29T17:55:38.478Z",
      "id": "GJ6iHmav6Vh8nkXQ",
      "name": "ModuloPagosChiqback2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Reportar Pago Por..",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "1 Mes"
                      },
                      {
                        "option": "Varios Meses"
                      },
                      {
                        "option": "Otro"
                      }
                    ]
                  }
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            680,
            -900
          ],
          "id": "651a64d2-f8d3-46db-aba4-e0c41962f8c1",
          "name": "ID Cliente",
          "webhookId": "931893fe-c10c-4a93-a602-be3a9c45fd21"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            860,
            -900
          ],
          "id": "77cbb0b7-c698-4301-805e-81e56773233f",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            680,
            -660
          ],
          "id": "04196ff1-5221-42b8-8019-075039b84a46",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      },
                      {
                        "option": "otro..."
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1300,
            -920
          ],
          "id": "167881c7-783e-4259-8cf7-0a65ba8dbb15",
          "name": "CargarPago",
          "webhookId": "6e9d47d0-67ad-436e-ac93-c91c34562844"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1980,
            -920
          ],
          "id": "799ead9b-4c15-49a4-87f8-48a7a64de843",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2180,
            -920
          ],
          "id": "2f9e25e0-030f-4d18-87bf-6224eed790c8",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            700,
            -420
          ],
          "id": "d0f1ba25-c7c1-499c-8eb3-880253569d58",
          "name": "Error",
          "webhookId": "2866650c-e689-4134-8d8a-e6ac03441071"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2160,
            -760
          ],
          "id": "e34775dc-bd23-4553-97b6-778c31d035c6",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1980,
            -480
          ],
          "id": "d7bb77d9-04a3-4ef1-b8b0-a79175831608",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2380,
            -920
          ],
          "id": "66e93222-c93f-4b30-96cf-1c2fc62597d3",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2380,
            -720
          ],
          "id": "b539f846-891a-4fc8-a371-247b303eae60",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";'\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2400,
            -520
          ],
          "id": "80e0f9ac-f155-41dc-90a5-7fa9aae65fd0",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2600,
            -920
          ],
          "id": "88d68c72-fd7d-48b2-b869-484883f06487",
          "name": "Form",
          "webhookId": "ea528254-b5c6-4c20-a87c-76ce6a2ac9b7"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2620,
            -680
          ],
          "id": "14c1d047-6fe6-44c1-9ca4-44dc724e0791",
          "name": "Gmail",
          "webhookId": "611e1149-4860-4b41-9b97-9638df348d4a",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2200,
            -380
          ],
          "id": "441444ab-d750-444b-9d46-40ad30fbfe78",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            1740,
            -920
          ],
          "id": "d2902b7f-f7ee-4e8f-a667-8f88b046e973",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1740,
            -660
          ],
          "id": "3363f18f-74c2-457b-8f95-9a7007c1bce4",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1740,
            -380
          ],
          "id": "e63a63ce-0745-415b-a458-b61a846d2131",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1360,
            -380
          ],
          "id": "310251be-f0f1-4678-8854-f74e891c482e",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1540,
            -380
          ],
          "id": "459de9cb-3692-45b2-bb6d-e54a7a3c5e0c",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            860,
            -680
          ],
          "id": "ff01e0b4-ff99-46a1-b91b-11018e11c3c6",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            920,
            -420
          ],
          "id": "10b72ac3-8f07-4a3c-8f8c-67764d1bf83e",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Merge').item.json['Cantidad Pagada'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2180,
            -580
          ],
          "id": "643fd93b-87c5-4740-89a8-0f4440112f9b",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1100,
            -380
          ],
          "id": "58f9aa36-1649-4625-931e-3f0a1b1e4f74",
          "name": "Error1",
          "webhookId": "edeafaee-2f06-4ec8-9921-aa877f7cefe7"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2580,
            -520
          ],
          "id": "70e41aeb-5461-415b-92e1-72b5bd224109",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2620,
            -360
          ],
          "id": "cd98d87b-e0ac-4e3e-91ac-1724d0839b0d",
          "name": "Form1",
          "webhookId": "7301281d-e165-48c9-aa33-30e6e0818ac1"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2400,
            -380
          ],
          "id": "20f47640-4273-44d8-b60f-bf7058cd74d4",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Meses Pagados",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "2"
                      },
                      {
                        "option": "3"
                      },
                      {
                        "option": "4"
                      },
                      {
                        "option": "5"
                      },
                      {
                        "option": "6"
                      },
                      {
                        "option": "7"
                      },
                      {
                        "option": "8"
                      },
                      {
                        "option": "9"
                      },
                      {
                        "option": "10"
                      },
                      {
                        "option": "11 +1 Gratis"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Por favor selecciones cuantos meses pago"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1140,
            -600
          ],
          "id": "56db7c78-f7a4-4385-ade3-2b83db17c68c",
          "name": "Meses",
          "webhookId": "d351a3bf-bc46-4b8a-9ef1-fb9dfcb7395b"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "1 Mes",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "31265679-e2bc-4527-b882-e4d580ebe2fa"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "65fab1f3-aec3-469c-ad26-f3471d84f5b8",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Varios Meses",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9b0e9c3-74eb-4700-9d17-4336678d0948",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1080,
            -900
          ],
          "id": "1ddd1fe9-337d-4614-9bbf-f231783a15f7",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Todo Correcto?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aceptar"
                      },
                      {
                        "option": "Corregir Meses y/o Plan"
                      }
                    ]
                  }
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Cantidad Pagada",
                  "fieldValue": "={{ $json['Meses Pagados'] * $json['Plan Mensual Pagado'] }}"
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Plan Mensual Pagado",
                  "fieldValue": "={{ $json[\"Plan Mensual Pagado\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Antes de continuar verifica que los datos esten correctos",
              "formDescription": "=Cliente: {{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nCantidad Pagada = {{ $json['Meses Pagados'] * $json['Plan Mensual Pagado'] }}\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1320,
            -600
          ],
          "id": "56849668-f151-44e0-95ce-91bba557d4f7",
          "name": "PagoVarios",
          "webhookId": "6e9d47d0-67ad-436e-ac93-c91c34562844"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json[\"Todo Correcto?\"] }}",
                  "rightValue": "=Aceptar",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1520,
            -600
          ],
          "id": "6f671b47-6542-4229-9bac-0ece460f048f",
          "name": "TodoOk?"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1300,
            -760
          ],
          "id": "b93d54fd-ad11-485f-bb5a-f273035aaeea",
          "name": "OtrosPago",
          "webhookId": "6e9d47d0-67ad-436e-ac93-c91c34562844"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1520,
            -760
          ],
          "id": "1af0f4cb-7637-4f6d-9ddc-990acf68de10",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1500,
            -920
          ],
          "id": "d26f558b-6dc4-42da-8848-c7c81bd58093",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1960,
            -700
          ],
          "id": "6e7ec16e-cde4-40ad-acc6-55c2a0f28612",
          "name": "MismoPlan"
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Meses": {
          "main": [
            [
              {
                "node": "PagoVarios",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "OtrosPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoVarios": {
          "main": [
            [
              {
                "node": "TodoOk?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TodoOk?": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OtrosPago": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "2ef17b27-8c54-4b34-b28b-0e5dd60ee516",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-29T17:55:38.496Z",
          "createdAt": "2025-05-29T17:55:38.496Z",
          "role": "workflow:owner",
          "workflowId": "GJ6iHmav6Vh8nkXQ",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-04T03:58:13.000Z",
      "createdAt": "2025-06-04T03:29:23.253Z",
      "id": "L61mb1SZ0OsiQU5z",
      "name": "enviar archivo",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            0,
            0
          ],
          "id": "ca7e9d21-cd46-48b2-924a-119626ad4b07",
          "name": "Telegram Trigger",
          "webhookId": "f4cc7b3c-704b-4d8a-ae18-5814a9fff009",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Eres un asistente inteligente para registrar movimientos financieros personales a través de Telegram.\nTu objetivo es extraer la siguiente información de los mensajes del usuario:\n- Nombre de la persona (si no se especifica y el usuario dice \"yo\" o \"mi\", usa el nombre del remitente: {{ $json.message.from.firstName }})\n- Tipo de movimiento (Ingreso o Gasto)\n- Monto (número)\n- Concepto del movimiento (descripción)\n\nFormato de salida esperado (JSON):\n{\n  \"nombre\": \"string\",\n  \"tipo\": \"Ingreso\" | \"Gasto\",\n  \"monto\": number,\n  \"concepto\": \"string\",\n  \"mensaje_respuesta\": \"string para el usuario\",\n  \"espera_comprobante\": boolean\n}\n\nInstrucciones:\n- Si el usuario indica que el siguiente mensaje será un comprobante, establece \"espera_comprobante\": true y pregunta por él en \"mensaje_respuesta\".\n- Si el usuario corrige información previa (ej. \"perdón, no era ingreso, era gasto\"), actualiza los datos.\n- Si el usuario dice que no hay comprobante o no lo menciona, establece \"espera_comprobante\": false.\n- Si la información es ambigua o incompleta, pide aclaraciones en \"mensaje_respuesta\" y no intentes rellenar los campos. En este caso, los campos pueden ser null o faltar, y \"espera_comprobante\" debe ser false.\n\nContesta siempre en español\nMensaje del usuario: \"{{ $json.message.text }}\""
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            220,
            0
          ],
          "id": "3ebb5b85-39ab-478d-92cf-1c44007d1905",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.0-pro-vision-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            140,
            160
          ],
          "id": "42dc9b0e-d2e8-4452-ae6d-90db14c5d9ea",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            300,
            180
          ],
          "id": "e4d1b8c0-c978-4ddf-9d92-4bff7a472e06",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5e57bad8-6fec-4bee-8d63-63d6cb5cd68e",
                  "leftValue": "={{ $last.json.nombre }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "0600ad53-f7a3-4a7d-ab6a-941f3c84e646",
                  "leftValue": "={{ $last.json.tipo }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "efabc673-08a0-4657-8d3a-c2ef75e2263c",
                  "leftValue": "={{ $last.json.cantidad }}",
                  "rightValue": "",
                  "operator": {
                    "type": "number",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "70220154-a8f4-43f5-97b9-93a79ea5a3d3",
                  "leftValue": "={{ $last.json.concepto }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            580,
            0
          ],
          "id": "5c3341cf-b818-44e9-afe2-705b83d2d640",
          "name": "If"
        },
        {
          "parameters": {
            "chatId": "={{ $json.message.chat.id }}",
            "text": "={{ $nodes[\"[AI Agente] Node Name\"].json.mensaje_respuesta }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            800,
            -100
          ],
          "id": "1fc50fa2-f187-4db0-ba8f-bc43b3c4c614",
          "name": "Telegram",
          "webhookId": "c2bc6046-0bf6-42b1-8c03-23300524cf3f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "Telegram Trigger": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a9111884-b002-4ace-8717-e39f7fd04e8d",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-06-04T03:29:23.264Z",
          "createdAt": "2025-06-04T03:29:23.264Z",
          "role": "workflow:owner",
          "workflowId": "L61mb1SZ0OsiQU5z",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-23T19:33:55.000Z",
      "createdAt": "2025-05-13T05:16:53.921Z",
      "id": "Lr1l0oe5paQRrTQN",
      "name": "IngresosyGastosChiq",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            -1340,
            -1000
          ],
          "id": "044e66b3-c979-4407-8aae-8779faa3dbcd",
          "name": "Merge"
        },
        {
          "parameters": {
            "formTitle": "Registrar Movimientos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Lupita"
                      },
                      {
                        "option": "Bertin"
                      },
                      {
                        "option": "Aldo"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "tipo_movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Concepto",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Comprobante",
                  "fieldType": "file",
                  "multipleFiles": false
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "path": "gastos"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1540,
            -1240
          ],
          "id": "9249ee41-6c03-4401-8077-c7bdf0304c00",
          "name": "IngresoGasto",
          "webhookId": "346594bc-0634-4bd9-9d75-9a2f0b3dec28"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c6e167ae-b485-4606-ad68-ece6352dfbf2",
                  "name": "Fecha actual",
                  "value": "={{ new Date().toLocaleDateString('es-MX') }}",
                  "type": "string"
                },
                {
                  "id": "e84595c9-917a-4f21-abb5-cc71c4be3271",
                  "name": "monto_calculo",
                  "value": "={{ $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad * -1 : $json.Cantidad }}",
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1360,
            -1240
          ],
          "id": "e81d72f1-0bca-4daf-a2b3-6b1e9fbb891a",
          "name": "CapturaDatos"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5727c573-ad23-4d04-8c02-ba2d35b64a8c",
                  "leftValue": "={{ $json.Comprobante != null }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1180,
            -1240
          ],
          "id": "d9a85a75-4e74-468a-bb27-2240c4013fea",
          "name": "Comprobante?"
        },
        {
          "parameters": {
            "inputDataFieldName": "Comprobante",
            "name": "={{ $json.Concepto }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh",
              "mode": "list",
              "cachedResultName": "Gastos",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh"
            },
            "options": {
              "simplifyOutput": true
            }
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -980,
            -1260
          ],
          "id": "05c05984-31d6-46b3-999b-59f419c79aa9",
          "name": "GuardComp",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "67019d5c-39a2-442a-bee2-b24cea72d202",
                  "name": "Comprobante",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1520,
            -1000
          ],
          "id": "00894e42-fd1b-4ff4-a92c-09ee641a0a99",
          "name": "SinComp"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "eed4cf15-ff7b-4786-bb29-f2bdd545c747",
                  "name": "link_comprobante_gsheet",
                  "value": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1540,
            -800
          ],
          "id": "df252204-89b6-44a7-bfaa-51decece98b8",
          "name": "Linkcomp"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $json.formattedDate }}",
                "Cliente/Concepto": "={{ $('LimpiarDatos').item.json.Concepto }}",
                "Comprobante": "={{ $('LimpiarDatos').item.json.LinkCompro }}",
                "Lup-Ing": "={{ $('LimpiarDatos').item.json.LupitaIngr }}",
                "Lup-Gas": "={{ $('LimpiarDatos').item.json.LupitaGast }}",
                "Ber-Ing": "={{ $('LimpiarDatos').item.json.BertIng }}",
                "Ber-Gas": "={{ $('LimpiarDatos').item.json.BertGast }}",
                "Ald-Ing": "={{ $('LimpiarDatos').item.json.AldoIng }}",
                "Ald-Gas": "={{ $('LimpiarDatos').item.json.AldoGas }}",
                "--": "-"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -1320,
            -800
          ],
          "id": "f6cc64ea-5645-4574-81c0-91ba4eef692f",
          "name": "RegMov.",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Movimiento registrado... todo OK",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -960,
            -700
          ],
          "id": "d30278f7-e724-4782-b2e8-31b8f1a5bcf0",
          "name": "Form",
          "webhookId": "76e2988f-4aad-4307-acf7-176d0f9de6a4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f8892c3a-51e9-4c0b-821b-2ae4a48e6638",
                  "name": "LupitaIngr",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "0586845b-1ea8-47b4-9ad5-bbe997006e1f",
                  "name": "LupitaGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "e7956a2e-3f3b-44ff-a43f-9c6a3f78c2d0",
                  "name": "BertIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "eac02c77-4700-498b-9f04-ad661d5dc576",
                  "name": "BertGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "108813e8-47f8-4bc0-affc-f55cc86c75fc",
                  "name": "AldoIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "83a6dc15-9a49-4f65-9ab3-564cf164fcf3",
                  "name": "AldoGas",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "f269177f-0744-46bf-a724-3efb5ee06dc2",
                  "name": "LinkCompro",
                  "value": "={{ $json.link_comprobante_gsheet }}",
                  "type": "string"
                },
                {
                  "id": "a5ad16ad-dd7e-4cdb-bc71-a54977ad4b8c",
                  "name": "Concepto",
                  "value": "={{ $('Comprobante?').item.json.Concepto }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1140,
            -1000
          ],
          "id": "1839a1da-594c-43c0-81f5-fe308d07dec7",
          "name": "LimpiarDatos"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $('Comprobante?').item.json.submittedAt }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -960,
            -1000
          ],
          "id": "c53c9e31-c58c-442a-8b7d-2afa9227170d",
          "name": "Date & Time"
        }
      ],
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "LimpiarDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IngresoGasto": {
          "main": [
            [
              {
                "node": "CapturaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CapturaDatos": {
          "main": [
            [
              {
                "node": "Comprobante?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Comprobante?": {
          "main": [
            [
              {
                "node": "GuardComp",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SinComp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardComp": {
          "main": [
            [
              {
                "node": "Linkcomp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SinComp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Linkcomp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "RegMov.": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarDatos": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "RegMov.",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "e45a77cd-8e2f-409f-9f4f-4227cc9a86be",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-13T05:16:53.934Z",
          "createdAt": "2025-05-13T05:16:53.934Z",
          "role": "workflow:owner",
          "workflowId": "Lr1l0oe5paQRrTQN",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-10T17:05:49.000Z",
      "createdAt": "2025-09-30T17:53:52.608Z",
      "id": "M2bpUJQEVRLzUinq",
      "name": "perfilesredes",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "webconai-webhook",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "350f1132-71ba-4efb-84c9-79a9558cf2d6",
          "name": "📥 Recibir Datos",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -400,
            -96
          ],
          "webhookId": "47f70295-0c97-48de-b8a4-c1081e968a20"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "consulta-simple",
                  "leftValue": "={{ $json.plan_light }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "isEmpty"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "3a0c5c07-7ee2-4ef9-bafe-d3e16240b55c",
          "name": "🔀 Tipo de Solicitud",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            -176,
            -96
          ]
        },
        {
          "parameters": {
            "subject": "Consulta WebConAi - {{ $json.nombre }}",
            "options": {
              "appendAttribution": false
            }
          },
          "id": "1643bd8e-7eff-42bf-bf71-38d212340648",
          "name": "📧 Respuesta Consulta",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            48,
            -80
          ],
          "webhookId": "d1fa90ce-bdae-4511-aa17-3cafaf262005"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "es-profesional",
                  "leftValue": "={{ $json.plan_profesional }}",
                  "rightValue": "profesional",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "70ad4ed9-d044-4141-866f-ccf281d4b166",
          "name": "🔀 Plan Seleccionado",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            -384,
            160
          ]
        },
        {
          "parameters": {
            "jsCode": "// Generar contenido para sitio web\nconst datos = $input.first().json;\n\nconst contenidoSitio = {\n  titulo: datos.nombre,\n  descripcion: datos.descripcion,\n  colores: datos.colores || '#f1a532, #f9d427, #2a335a',\n  logo: datos.logo || '',\n  secciones: [\n    {\n      nombre: 'Inicio',\n      contenido: `Bienvenido a ${datos.nombre}. ${datos.descripcion}`\n    },\n    {\n      nombre: 'Servicios', \n      contenido: 'Nuestros servicios están diseñados para satisfacer tus necesidades.'\n    },\n    {\n      nombre: 'Acerca de',\n      contenido: `${datos.nombre} es tu mejor opción. ${datos.descripcion}`\n    },\n    {\n      nombre: 'Contacto',\n      contenido: `Contáctanos: ${datos.email}`\n    }\n  ],\n  dominioSugerido: datos.nombre.toLowerCase().replace(/\\s+/g, '') + '.com'\n};\n\nreturn { json: { ...datos, sitioWeb: contenidoSitio } };"
          },
          "id": "434aab95-37b2-4169-8112-ce0d47fcd084",
          "name": "🌐 Generar Borrador Sitio",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -144,
            144
          ]
        },
        {
          "parameters": {
            "subject": "Tu sitio web está listo - {{ $json.nombre }}",
            "options": {
              "appendAttribution": false
            }
          },
          "id": "724d1292-a53b-437f-8b3e-a56fad5aef3f",
          "name": "📧 Email Plan Light",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            48,
            128
          ],
          "webhookId": "4cf47f63-6410-4e10-8128-31705aaef9e3"
        },
        {
          "parameters": {
            "jsCode": "// Generar perfiles de redes sociales\nconst datos = $input.first().json;\nconst redes = datos.redes ? datos.redes.split(',').map(r => r.trim()) : [];\n\nconst perfilesRedes = redes.map(red => ({\n  plataforma: red,\n  usuario: datos.usuario || datos.nombre.toLowerCase().replace(/\\s+/g, ''),\n  biografia: datos.biografia || `${datos.nombre} - ${datos.descripcion}`,\n  hashtags: datos.hashtags || `#${datos.nombre.replace(/\\s+/g, '')} #negocio #servicios`,\n  configuracion: {\n    publicacionDiaria: true,\n    alertaComentarios: true,\n    respuestasIA: true\n  }\n}));\n\nreturn { \n  json: { \n    ...datos, \n    perfilesRedes,\n    sitioWebPro: {\n      ...datos.sitioWeb,\n      seccionesAdicionales: 2,\n      imagenesMaximas: 10,\n      emailsCuenta: 8\n    }\n  } \n};"
          },
          "id": "b60747da-d500-470a-aebf-c69c33c288d3",
          "name": "📱 Generar Perfiles Redes",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -400,
            352
          ]
        },
        {
          "parameters": {
            "subject": "Tu sitio web + redes sociales están listos - {{ $json.nombre }}",
            "options": {
              "appendAttribution": false
            }
          },
          "id": "77795b44-8246-41be-8595-5b89fc324156",
          "name": "📧 Email Plan Profesional",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -144,
            352
          ],
          "webhookId": "fae004e8-7072-445e-9430-c2aae7848ed9"
        },
        {
          "parameters": {
            "respondWith": "text",
            "responseBody": "Solicitud procesada correctamente",
            "options": {}
          },
          "id": "4298258c-d807-471c-8fc4-9c9668baeec3",
          "name": "✅ Respuesta OK",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            320,
            272
          ]
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "crear-cuentas",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "af174058-4ed8-43d1-89f3-447db253d204",
          "name": "Webhook - Datos Cliente",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -1248,
            -112
          ],
          "webhookId": "f1d1817d-dcda-4d6b-bd91-43a1c5fca79b",
          "disabled": true
        },
        {
          "parameters": {
            "functionCode": "// Validar datos requeridos\nconst required = ['nombre', 'email', 'telefono', 'empresa'];\nfor (let field of required) {\n  if (!items[0].json[field]) {\n    throw new Error(`Campo requerido: ${field}`);\n  }\n}\n\n// Generar datos adicionales\nitems[0].json.timestamp = new Date().toISOString();\nitems[0].json.cliente_id = Date.now().toString();\n\nreturn items;"
          },
          "id": "18c6933d-5393-4cac-be33-2c0562f5dd6c",
          "name": "Validar Datos",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            -1072,
            -112
          ]
        },
        {
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{$json.plataformas}}",
                  "operation": "contains",
                  "value2": "facebook"
                }
              ]
            }
          },
          "id": "20edf3e2-49b5-4863-91ac-210945ff20b1",
          "name": "¿Crear Facebook?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            -1248,
            144
          ]
        },
        {
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{$json.plataformas}}",
                  "operation": "contains",
                  "value2": "instagram"
                }
              ]
            }
          },
          "id": "51ac95b4-73ae-4fc9-baa9-e973d7e2db2e",
          "name": "¿Crear Instagram?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            -1248,
            240
          ]
        },
        {
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{$json.plataformas}}",
                  "operation": "contains",
                  "value2": "twitter"
                }
              ]
            }
          },
          "id": "eac420b1-dc36-4d8c-a741-bd966a6e541e",
          "name": "¿Crear Twitter?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            -1248,
            336
          ]
        },
        {
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "plataforma",
                  "value": "facebook"
                },
                {
                  "name": "username",
                  "value": "={{$json.empresa.toLowerCase().replace(/\\s+/g, '')}}"
                },
                {
                  "name": "email_fb",
                  "value": "={{$json.email}}"
                },
                {
                  "name": "password",
                  "value": "={{$json.empresa}}2024!"
                },
                {
                  "name": "nombre_completo",
                  "value": "={{$json.nombre}} {{$json.apellido || ''}}"
                }
              ]
            },
            "options": {}
          },
          "id": "14740934-39d5-4937-bce6-6a7bf446ba18",
          "name": "Preparar Facebook",
          "type": "n8n-nodes-base.set",
          "typeVersion": 1,
          "position": [
            -1040,
            64
          ]
        },
        {
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "plataforma",
                  "value": "instagram"
                },
                {
                  "name": "username",
                  "value": "={{$json.empresa.toLowerCase().replace(/\\s+/g, '')}}oficial"
                },
                {
                  "name": "email_ig",
                  "value": "={{$json.email}}"
                },
                {
                  "name": "telefono",
                  "value": "={{$json.telefono}}"
                },
                {
                  "name": "nombre_completo",
                  "value": "={{$json.empresa}}"
                }
              ]
            },
            "options": {}
          },
          "id": "1759568f-cc7f-4900-bc0b-1d01aab4b3a8",
          "name": "Preparar Instagram",
          "type": "n8n-nodes-base.set",
          "typeVersion": 1,
          "position": [
            -1040,
            208
          ]
        },
        {
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "plataforma",
                  "value": "twitter"
                },
                {
                  "name": "username",
                  "value": "={{$json.empresa.toLowerCase().replace(/\\s+/g, '')}}tw"
                },
                {
                  "name": "email_tw",
                  "value": "={{$json.email}}"
                },
                {
                  "name": "telefono",
                  "value": "={{$json.telefono}}"
                },
                {
                  "name": "nombre_display",
                  "value": "={{$json.empresa}}"
                }
              ]
            },
            "options": {}
          },
          "id": "cc51ab89-c662-4af6-85b1-9bd2204de00d",
          "name": "Preparar Twitter",
          "type": "n8n-nodes-base.set",
          "typeVersion": 1,
          "position": [
            -1040,
            352
          ]
        },
        {
          "parameters": {
            "functionCode": "// Simular creación de Facebook\n// En producción aquí iría Puppeteer o Playwright\n\nconst resultado = {\n  plataforma: 'facebook',\n  username: items[0].json.username,\n  email: items[0].json.email_fb,\n  estado: 'creado',\n  url_perfil: `https://facebook.com/${items[0].json.username}`,\n  fecha_creacion: new Date().toISOString(),\n  requiere_verificacion: true,\n  notas: 'Cuenta creada - Pendiente verificación por SMS'\n};\n\nreturn [{ json: resultado }];"
          },
          "id": "d634533e-6e75-4874-b33d-e5c9fab68e9e",
          "name": "Crear Facebook",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            -848,
            -96
          ]
        },
        {
          "parameters": {
            "functionCode": "// Simular creación de Instagram\n// En producción aquí iría Puppeteer o Playwright\n\nconst resultado = {\n  plataforma: 'instagram',\n  username: items[0].json.username,\n  email: items[0].json.email_ig,\n  telefono: items[0].json.telefono,\n  estado: 'creado',\n  url_perfil: `https://instagram.com/${items[0].json.username}`,\n  fecha_creacion: new Date().toISOString(),\n  requiere_verificacion: true,\n  notas: 'Cuenta creada - Pendiente verificación por SMS'\n};\n\nreturn [{ json: resultado }];"
          },
          "id": "5ed54b9e-db7b-4794-8f5d-03f2fe8e8c7a",
          "name": "Crear Instagram",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            -848,
            80
          ]
        },
        {
          "parameters": {
            "functionCode": "// Simular creación de Twitter\n// En producción aquí iría Puppeteer o Playwright\n\nconst resultado = {\n  plataforma: 'twitter',\n  username: items[0].json.username,\n  email: items[0].json.email_tw,\n  telefono: items[0].json.telefono,\n  estado: 'creado',\n  url_perfil: `https://twitter.com/${items[0].json.username}`,\n  fecha_creacion: new Date().toISOString(),\n  requiere_verificacion: true,\n  notas: 'Cuenta creada - Pendiente verificación por SMS'\n};\n\nreturn [{ json: resultado }];"
          },
          "id": "301b66f2-df0f-4199-beb1-40e26663340d",
          "name": "Crear Twitter",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            -848,
            224
          ]
        },
        {
          "parameters": {},
          "id": "421fde1f-aef1-4a6e-97bf-e4ed3f5f833c",
          "name": "Merge Resultados",
          "type": "n8n-nodes-base.merge",
          "typeVersion": 2,
          "position": [
            -848,
            368
          ]
        },
        {
          "parameters": {
            "functionCode": "// Consolidar todos los resultados\nconst resultados = {\n  cliente_id: items[0].json.cliente_id || Date.now().toString(),\n  cliente_nombre: items[0].json.nombre || 'Cliente',\n  empresa: items[0].json.empresa || 'Empresa',\n  email_principal: items[0].json.email || items[0].json.email_fb || items[0].json.email_ig,\n  fecha_proceso: new Date().toISOString(),\n  cuentas_creadas: [],\n  total_cuentas: 0,\n  estado_general: 'completado'\n};\n\n// Procesar todos los items\nfor (let item of items) {\n  if (item.json.plataforma) {\n    resultados.cuentas_creadas.push({\n      plataforma: item.json.plataforma,\n      username: item.json.username,\n      url_perfil: item.json.url_perfil,\n      estado: item.json.estado,\n      requiere_verificacion: item.json.requiere_verificacion\n    });\n    resultados.total_cuentas++;\n  }\n}\n\nreturn [{ json: resultados }];"
          },
          "id": "c93344da-8ca8-42da-8fc2-93f017926739",
          "name": "Consolidar Resultados",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            -656,
            -80
          ]
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={\n  \"success\": true,\n  \"message\": \"Cuentas creadas exitosamente\",\n  \"cliente_id\": \"{{$json.cliente_id}}\",\n  \"total_cuentas\": {{$json.total_cuentas}},\n  \"cuentas\": {{$json.cuentas_creadas}},\n  \"fecha\": \"{{$json.fecha_proceso}}\"\n}",
            "options": {}
          },
          "id": "540bb50c-4c4f-453b-b05b-5e1a4cfc166b",
          "name": "Respuesta Webhook",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            -656,
            112
          ]
        }
      ],
      "connections": {
        "📥 Recibir Datos": {
          "main": [
            [
              {
                "node": "🔀 Tipo de Solicitud",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "🔀 Tipo de Solicitud": {
          "main": [
            [
              {
                "node": "📧 Respuesta Consulta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "🔀 Plan Seleccionado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "🔀 Plan Seleccionado": {
          "main": [
            [
              {
                "node": "🌐 Generar Borrador Sitio",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "📱 Generar Perfiles Redes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "🌐 Generar Borrador Sitio": {
          "main": [
            [
              {
                "node": "📧 Email Plan Light",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "📱 Generar Perfiles Redes": {
          "main": [
            [
              {
                "node": "📧 Email Plan Profesional",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "📧 Respuesta Consulta": {
          "main": [
            [
              {
                "node": "✅ Respuesta OK",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "📧 Email Plan Light": {
          "main": [
            [
              {
                "node": "✅ Respuesta OK",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "📧 Email Plan Profesional": {
          "main": [
            [
              {
                "node": "✅ Respuesta OK",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook - Datos Cliente": {
          "main": [
            [
              {
                "node": "Validar Datos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Validar Datos": {
          "main": [
            [
              {
                "node": "¿Crear Facebook?",
                "type": "main",
                "index": 0
              },
              {
                "node": "¿Crear Instagram?",
                "type": "main",
                "index": 0
              },
              {
                "node": "¿Crear Twitter?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "¿Crear Facebook?": {
          "main": [
            [
              {
                "node": "Preparar Facebook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "¿Crear Instagram?": {
          "main": [
            [
              {
                "node": "Preparar Instagram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "¿Crear Twitter?": {
          "main": [
            [
              {
                "node": "Preparar Twitter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Preparar Facebook": {
          "main": [
            [
              {
                "node": "Crear Facebook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Preparar Instagram": {
          "main": [
            [
              {
                "node": "Crear Instagram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Preparar Twitter": {
          "main": [
            [
              {
                "node": "Crear Twitter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Crear Facebook": {
          "main": [
            [
              {
                "node": "Merge Resultados",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Crear Instagram": {
          "main": [
            [
              {
                "node": "Merge Resultados",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge Resultados": {
          "main": [
            [
              {
                "node": "Consolidar Resultados",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Consolidar Resultados": {
          "main": [
            [
              {
                "node": "Respuesta Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "3be0d3a5-2c71-40d7-a8e8-f2d56ed4603b",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-09-30T17:53:52.617Z",
          "createdAt": "2025-09-30T17:53:52.617Z",
          "role": "workflow:owner",
          "workflowId": "M2bpUJQEVRLzUinq",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-19T18:15:07.000Z",
      "createdAt": "2025-12-12T18:43:06.715Z",
      "id": "MDqauig4ABnNvesT",
      "name": "backupN8N",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "hours",
                  "hoursInterval": 24
                }
              ]
            }
          },
          "id": "ecbdd768-62e9-4233-9db4-2008607502fb",
          "name": "Schedule Trigger",
          "type": "n8n-nodes-base.scheduleTrigger",
          "position": [
            -448,
            -64
          ],
          "typeVersion": 1.2
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "config-1",
                  "name": "repo_owner",
                  "type": "string",
                  "value": "albowtch"
                },
                {
                  "id": "config-2",
                  "name": "repo_name",
                  "type": "string",
                  "value": "n8nbackup"
                },
                {
                  "id": "config-3",
                  "name": "repo_path",
                  "type": "string",
                  "value": "workflows/"
                }
              ]
            },
            "options": {}
          },
          "id": "5e3a94e0-1d71-465f-b6bf-cab9188bd7eb",
          "name": "Config",
          "type": "n8n-nodes-base.set",
          "position": [
            -240,
            -64
          ],
          "typeVersion": 3.4
        },
        {
          "parameters": {
            "url": "http://localhost:5678/api/v1/workflows",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "id": "63148a47-c1ac-4033-871e-938f7ae9a97e",
          "name": "Get All Workflows",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            -48,
            -64
          ],
          "typeVersion": 4.2,
          "credentials": {
            "httpHeaderAuth": {
              "id": "vUonS3ABZy6j8x7i",
              "name": "n8nbackup"
            }
          }
        },
        {
          "parameters": {
            "resource": "file",
            "owner": {
              "__rl": true,
              "mode": "name",
              "value": "={{ $json.repo_owner }}"
            },
            "repository": {
              "__rl": true,
              "mode": "name",
              "value": "={{ $json.repo_name }}"
            },
            "filePath": "={{ $json.repo_path }}{{ new Date().getFullYear() }}/{{ String(new Date().getMonth() + 1).padStart(2, '0') }}/{{ $json.id }}.json",
            "fileContent": "={{ JSON.stringify($json, null, 2) }}",
            "commitMessage": "Backup: {{ $json.name }} - {{ new Date().toISOString() }}"
          },
          "id": "d6662e04-c37e-490a-bc08-63bb1d1431fd",
          "name": "Create Backup",
          "type": "n8n-nodes-base.github",
          "position": [
            400,
            -64
          ],
          "typeVersion": 1,
          "webhookId": "dd1fd658-c828-4846-83e0-f23861097f3c",
          "credentials": {
            "githubApi": {
              "id": "MX3rq9I7PXRytH47",
              "name": "GitHub account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "merge-1",
                  "name": "repo_path",
                  "type": "string",
                  "value": "={{ $('Config').first().json.repo_path }}"
                },
                {
                  "id": "merge-2",
                  "name": "repo_owner",
                  "type": "string",
                  "value": "={{ $('Config').first().json.repo_owner }}"
                },
                {
                  "id": "merge-3",
                  "name": "repo_name",
                  "type": "string",
                  "value": "={{ $('Config').first().json.repo_name }}"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "id": "7bfdf904-f4e2-425f-96c2-b69e47cef409",
          "name": "Merge Config1",
          "type": "n8n-nodes-base.set",
          "position": [
            192,
            -64
          ],
          "typeVersion": 3.4
        }
      ],
      "connections": {
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Config",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Config": {
          "main": [
            [
              {
                "node": "Get All Workflows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get All Workflows": {
          "main": [
            [
              {
                "node": "Merge Config1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Config1": {
          "main": [
            [
              {
                "node": "Create Backup",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "e6e0d1bb-386a-48a8-96b4-a4093222d395",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-12T18:43:06.723Z",
          "createdAt": "2025-12-12T18:43:06.723Z",
          "role": "workflow:owner",
          "workflowId": "MDqauig4ABnNvesT",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-27T22:19:09.000Z",
      "createdAt": "2025-05-26T19:27:36.926Z",
      "id": "NCp49VC9H6ZP2TPV",
      "name": "Agente2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.message.chat.id }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -3856,
            -992
          ],
          "id": "8225b5e2-8445-44ea-9490-cc7e10992fc6",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -4096,
            -1200
          ],
          "id": "6dc1ddb1-b583-4c67-94fc-44b3063c3f4a",
          "name": "Mensaje",
          "webhookId": "89e0be04-0067-4658-8812-86242db2a534",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=No toy",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3280,
            -1008
          ],
          "id": "5006191f-bb7d-4319-a33c-5782cac3a289",
          "name": "Respuesta",
          "webhookId": "76b58d3c-2b9e-4181-b27e-9323a8d8489f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.message.text }}",
            "options": {
              "systemMessage": "=Clasifica el mensaje del usuario en una de las siguientes INTENCIONES. Responde ÚNICAMENTE con la etiqueta de la intención en MAYÚSCULAS.\n\nINTENCIONES:\n- SALUDO\n- BUSCAR_NOMBRE\n- ESTADO_CLIENTE\n- REPORTAR_GASTO\n- REPORTAR_PAGO\n- DESCONOCIDO\n- PENDIENTE\n- COMPLETAR\n\nEjemplos:\nUsuario: \"hola\" -> SALUDO\nUsuario: \"buenos días\" -> SALUDO\nUsuario: \"dime el id de Juan Perez\" -> BUSCAR_NOMBRE\nUsuario: \"busca el nombre Maria Lopez\" -> BUSCAR_NOMBRE\nUsuario: \"Como aparece el cliente con ID 123?\" -> ESTADO_CLIENTE\nUsuario: \"esta conectado el ID 456\" -> ESTADO_CLIENTE\nUsuario: \"quiero registrar un gasto\" -> REPORTAR_GASTO\nUsuario: \"Aldo gasto 300 en comida\" -> REPORTAR_GASTO\nUsuario: \"recibi 2000 de instalacion\" -> REPORTAR_GASTO\nUsuario: \"quiero reportar mi pago\" -> REPORTAR_PAGO\nUsuario: \"reportar pago de ID 789\" -> REPORTAR_PAGO\nUsuario: \"anota en pendientes comprar cable\" -> PENDIENTE\nUsuario: \"Cuales son los pendientes\" -> PENDIENTE\nUusario: \"Pendiente 7 completado\" -> PENDIENTE\nUsuario: \"Pendiente comprar cable completado\" -> PENDIENTE\nUsuario: \"qué hora es?\" -> DESCONOCIDO\nUsuario: \"que horas son?\" -> DESCONOCIDO\nUsuario: \"cual es la capital de..\" -> DESCONOCIDO\nUsuario: \"Completar registro\" -> COMPLETAR\nUsuario: \"Terminar registro\" -> COMPLETAR\nUsuario: \"Finalizar registro\" -> COMPLETAR\nEs importante que hagas una distinciòn entre las palabras completar y completado. Si es completar se refiere a COMPLETAR, Si es completado se refiere a PENDIENTES\n---\nMensaje del Usuario:\n{{ $json.message.text }}\n---\nINTENCION:\n\nContesta siempre en español"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3888,
            -1200
          ],
          "id": "01cc48f4-9cc3-4739-8b51-82593153c799",
          "name": "AgtIntent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-2.0-flash-001",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3984,
            -992
          ],
          "id": "eff4ae11-58fb-4aee-9fda-8426ee95cd10",
          "name": "GemIntent",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4da42528-a5f9-4321-a0c8-55363bd93037",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "SALUDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bb95cbec-d074-49cf-86f4-2e10f729c7f9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "BUSCAR_NOMBRE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "675f82ad-14e4-456c-929d-fa64a6552f48",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "ESTADO_CLIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_GASTO",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "cd7f0500-527d-4be7-bf61-b5a5cdeac877"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f738687-f3c2-4715-a82a-05640916957b",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_PAGO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "48297539-bf1e-49f9-89a0-5665b0ed81e9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "DESCONOCIDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b3137ff5-3906-4cbb-9917-a6efb244bab6",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "PENDIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3f66a1c0-6dc9-47f6-960b-f5b623ea1b91",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "COMPLETAR",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -3520,
            -1200
          ],
          "id": "0923e641-a53a-42de-923d-034e7e0c00ee",
          "name": "SwIntent"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el nombre de la persona que se busca. Responde SÓLO con el nombre. Si no puedes identificar un nombre claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el id de Juan Perez\" -> Juan\nMensaje: \"busca el id Maria Fernanda Lopez Garcia\" -> Fernanda\nMensaje: \"ID de ana\" -> ana\nMensaje: \"id de lluvia\" -> lluvia\nMensaje: \"buscar nombre\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -4096,
            -832
          ],
          "id": "d27d71fb-54b0-4cfe-8627-bfd53ca505f2",
          "name": "AgtExtract"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=¡Hola! 👋 ¿En qué puedo ayudarte hoy? Puedes: - Buscar el ID de un cliente (ej: \"busca el ID de Ana\") - Consultar el estado de un cliente (ej: \"estado del ID 123\") - Reportar un gasto o ingreso - Reportar un pago mensual - Registrar listar y completar pendientes - Completar registros de nuevos clientes",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3360,
            -1232
          ],
          "id": "004e6801-294b-4abc-9a82-6d21d15d8236",
          "name": "Telegram",
          "webhookId": "ca510a8d-28e6-4401-85c5-c48833be7ef8",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3728,
            -800
          ],
          "id": "0ef5502e-c1ed-4a37-a0eb-c8350593ed4a",
          "name": "If"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -3904,
            -592
          ],
          "id": "dc591dac-75d8-4bf3-aae2-fcdef219316c",
          "name": "Limit"
        },
        {
          "parameters": {
            "modelName": "models/gemini-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -4096,
            -960
          ],
          "id": "d0910fe2-b75a-4ce3-ab50-1c3fb61a12b3",
          "name": "BuscarID",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "xB5k8lNiGd17TIji",
              "mode": "list",
              "cachedResultName": "BuscarChiq2"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.output }}",
                "IdChat": "={{ $('Mensaje').item.json.message.chat.id.toString() }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "IdChat",
                  "displayName": "IdChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -4080,
            -592
          ],
          "id": "67495f1c-4329-4317-ac6a-bc9edc90412a",
          "name": "Buscar",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "operation": "sendAudio",
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "binaryData": true,
            "additionalFields": {
              "fileName": "respuesta.mp3"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2976,
            -512
          ],
          "id": "f0922340-13e0-4e2d-8b4c-f7e50de3177b",
          "name": "Resultado ID",
          "webhookId": "82227789-06f1-46ac-9235-eef9b8c2db28",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el nombre que quieres buscar (ej: 'busca el ID de Ana').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3728,
            -960
          ],
          "id": "500631b8-519f-4f2e-92ff-ebf9c990dcf9",
          "name": "NoEntender",
          "webhookId": "37931557-b2da-4108-a384-85b0bc1bb4fd",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3168,
            -848
          ],
          "id": "6d5c26c9-78cd-4b36-adb7-07555017a90f",
          "name": "If2"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -3296,
            -624
          ],
          "id": "380d5a9e-ffab-4784-83e5-51ea84090982",
          "name": "Limit2"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.result.text }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3136,
            -608
          ],
          "id": "cc5ab733-8234-4daa-8fec-93f2ede73b3f",
          "name": "Resultado ID3",
          "webhookId": "82227789-06f1-46ac-9235-eef9b8c2db28",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el ID del cliente que quieres saber su estado (ej: como aparece d456').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3008,
            -688
          ],
          "id": "4d6b6bf6-13b1-4fc0-ba08-b9b0b498ebf8",
          "name": "NoEntender1",
          "webhookId": "37931557-b2da-4108-a384-85b0bc1bb4fd",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el ID del cliente que se busca. Responde SÓLO con el ID. Si no puedes identificar un ID claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el estado de c345\" -> c345\nMensaje: \"como aparece el a423\" -> a423\nMensaje: \"status de b043\" -> b043\nMensaje: \"buscar status\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3504,
            -832
          ],
          "id": "549a8d71-5b88-4d37-bfd7-0f51d77d722e",
          "name": "AgtStatus"
        },
        {
          "parameters": {
            "modelName": "models/gemini-flash-lite-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3408,
            -928
          ],
          "id": "fd02949d-a250-4649-947d-a5ea44225b6e",
          "name": "status",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "8EoTMqNoy8ATG1hs",
              "mode": "list",
              "cachedResultName": "StatusIDC"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.output.trim() }}",
                "idChat": "={{ $('Mensaje').item.json.message.chat.id }} "
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "idChat",
                  "displayName": "idChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -3504,
            -624
          ],
          "id": "ba0acf98-9077-4086-8823-ffc77e22877d",
          "name": "statusID",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=Reportar ingresos y gastos <a href=\"https://n8n.albored.com/form/gastos\">AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3120,
            -1104
          ],
          "id": "6f372d3b-f021-4526-bbf2-6466f4a6f183",
          "name": "Gasto",
          "webhookId": "76b58d3c-2b9e-4181-b27e-9323a8d8489f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/Pago1Mes\">Reportar Pago 1MES AQUI</a>\n\n<a href=\"https://n8n.albored.com/form/Varios\">Reportar Pago Varios meses AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3088,
            -992
          ],
          "id": "ab0cfd6e-38d7-40ba-af62-31f9db4d7aee",
          "name": "pago",
          "webhookId": "76b58d3c-2b9e-4181-b27e-9323a8d8489f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2944,
            -1072
          ],
          "id": "3a694e70-2d54-444a-9338-4c4256cabab5",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae la ACCION y el PENDIENTE. Cuando tengas todos los datos, Responde SÓLO con accion,y pendiente\n\nEjemplos:\nMensaje: \"anota en pendientes comprar cinta negra, alambre y tubos\" -> accion=add, pendiente=\"comprar cinta negra, alambre y tubos\"\nMensaje: \"pon en pendientes revisar antena xyz3\" -> accion=add, pendiente=revisar antena xyz3\nMensaje: \"cuales son los pendientes\" -> accion=show, pendiente=\"\"\nMensaje: \"Que pendientes hay\" -> accion=show, pendiente=\"\"\nMensaje: \"Pendiente 3 completado\"-> accion=del, pendiente=\"3\"\nMensaje: \"Quitar pendiente 5\"-> accion=del, pendiente=\"5\"\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nACCION, PENDIENTE a buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -2960,
            -1200
          ],
          "id": "d322127c-ee32-45b4-8173-c47133ffa97e",
          "name": "AgtPendient"
        },
        {
          "parameters": {
            "jsCode": "// Obtenemos el primer (y único) item que llega al nodo\nconst item = items[0];\n\n// Extraemos la cadena de texto del campo \"output\"\nconst rawString = item.json.output;\n\n// Creamos un objeto vacío para guardar los nuevos datos\nconst newData = {};\n\n// 1. Limpiamos la cadena (quitamos espacios y saltos de línea al inicio/final)\n// 2. La dividimos por la coma (,) para obtener cada par \"clave=valor\"\nconst pairs = rawString.trim().split(',');\n\n// Recorremos cada par\nfor (const pair of pairs) {\n  // Dividimos el par por el signo igual (=) para separar la clave del valor\n  // Usamos una pequeña optimización para que el valor pueda contener \"=\"\n  const [key, ...valueParts] = pair.split('=');\n  const value = valueParts.join('=');\n  \n  // Añadimos la clave y el valor al nuevo objeto, limpiando espacios\n  if (key) {\n    newData[key.trim()] = value.trim();\n  }\n}\n\n// Reemplazamos el json original del item con nuestro nuevo objeto\nitem.json = newData;\n\n// Devolvemos el item modificado\nreturn [item];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2624,
            -1184
          ],
          "id": "50eed381-6910-4c1f-b94b-cea0dd3832c6",
          "name": "Code"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bd191530-ac43-4a91-bbdc-dc3e79c1bf87",
                  "name": "accion",
                  "value": "={{ $('Code').item.json.accion }}",
                  "type": "string"
                },
                {
                  "id": "ec194e3c-caf6-4160-8895-f0df5443e5c5",
                  "name": "pendiente",
                  "value": "={{ $('Code').item.json.pendiente }}",
                  "type": "string"
                },
                {
                  "id": "f9430989-4996-4f48-b230-cc485f0683a4",
                  "name": "id",
                  "value": "={{ $('Mensaje').item.json.message.chat.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2464,
            -1184
          ],
          "id": "b1d15d82-b5fe-4acf-9b8f-055919ced7f2",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.pendiente }}",
                "Estado": "Pendiente",
                "Chat id": "={{ $json.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "name": "Agregar a hoja",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -2608,
            -992
          ],
          "id": "f4e17403-2c5c-482a-932e-116917b93602",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json['Chat id'] }}",
            "text": "=✅ Pendiente {{ $json.Pendiente }} registrado.",
            "additionalFields": {}
          },
          "name": "Confirm Add Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2416,
            -960
          ],
          "id": "7fab1eb4-024d-4fc4-bf6f-f15a19f89c02",
          "webhookId": "4fcd2258-772a-4aa0-b3fe-82105317c473",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Edit Fields').item.json.id }}",
            "text": "=✅ Pendiente '{{ $('Edit Fields').item.json.pendiente }}' cambiò a completado. ",
            "additionalFields": {}
          },
          "name": "Confirmar Hecho Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2800,
            -608
          ],
          "id": "fe97a263-ea26-4e56-aeec-21d3f9158192",
          "webhookId": "ac9bca57-c807-44be-813c-ede25bb7d884",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "No",
                  "lookupValue": "={{ $json.pendiente.replace(/\"/g, '') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2944,
            -848
          ],
          "id": "59a1f843-ee4f-4433-925d-729f713163cc",
          "name": "Pendient",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.Pendiente }}",
                "Estado": "Completado"
              },
              "matchingColumns": [
                "Pendiente"
              ],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2784,
            -768
          ],
          "id": "371997ab-5b7f-47e8-9ba3-e0b28687d2f9",
          "name": "Completado",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "add",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "08a62ae7-f12c-4fdc-8835-ec887e60eb9f"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "919e7e00-c608-4fc6-9223-434fd81034d5",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "show",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6fafe8d6-f710-4707-b255-8720d9e595e9",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "del",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2784,
            -992
          ],
          "id": "425c68aa-6cc6-4241-ba4f-c341c18fae50",
          "name": "Switch"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2608,
            -784
          ],
          "id": "a73692b1-dbdc-439c-81a3-8a891fa324d3",
          "name": "show",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Edit Fields').first().json.id }}",
            "text": "={{ $json.message }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2624,
            -448
          ],
          "id": "4326c3cd-2759-46dc-82fc-4094b0061e03",
          "name": "Telegram1",
          "webhookId": "ba000aa8-1dcd-42f1-bff9-c2dd9a383375",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "1b478ab7-c155-42aa-8a74-5acea89152c3",
                  "leftValue": "={{ $json.Estado }}",
                  "rightValue": "Pendiente",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -2448,
            -784
          ],
          "id": "f31614f1-612c-42e8-a984-2ea9f1d2cfb0",
          "name": "Filter"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9,
                  "triggerAtMinute": 20
                },
                {
                  "triggerAtHour": 13
                },
                {
                  "triggerAtHour": 17,
                  "triggerAtMinute": 3
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -4320,
            -1184
          ],
          "id": "1339c1e4-5e59-489c-93a2-b5e5632e6790",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -4320,
            -992
          ],
          "id": "629af36e-b691-4506-a852-b2633353074b",
          "name": "Pendientes",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=⏰{{ $json.message }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -4240,
            -512
          ],
          "id": "0b137165-7cd8-47b5-b871-eadf75595365",
          "name": "Recordatorio",
          "webhookId": "78d98072-5186-45bc-b21e-0b4309dbd1dd",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/completar\">Completar Registro AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3216,
            -1184
          ],
          "id": "72d009af-57fc-4a59-85db-81250ae891cc",
          "name": "RegistroNuevo",
          "webhookId": "76b58d3c-2b9e-4181-b27e-9323a8d8489f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.elevenlabs.io/v1/text-to-speech/iBGVhgcEZS6A5gTOjqSJ",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {
              "response": {
                "response": {
                  "responseFormat": "file"
                }
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -3456,
            -480
          ],
          "id": "23786f1d-8b93-4690-97a6-93f5659410e3",
          "name": "HTTP Request",
          "credentials": {
            "httpHeaderAuth": {
              "id": "uQPu5vi6tNyxC09l",
              "name": "Header Auth account 2"
            }
          }
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "={\n  \"text\": {{ JSON.stringify($json.mensajeParaTelegram.replace(/\\n/g, \", \")) }},\n  \"model_id\": \"eleven_multilingual_v2\"\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -3680,
            -592
          ],
          "id": "6b337a18-b672-49f8-9c0c-c38ec1db5ffe",
          "name": "textVoz"
        },
        {
          "parameters": {
            "operation": "write",
            "fileName": "audiotem.mp3",
            "options": {}
          },
          "type": "n8n-nodes-base.readWriteFile",
          "typeVersion": 1,
          "position": [
            -3296,
            -464
          ],
          "id": "a9055abe-9618-4257-aada-b6913ac9f45f",
          "name": "tempofile"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3856,
            -448
          ],
          "id": "ca3c102e-e69d-443a-a6b8-60ff7c7314fa",
          "name": "Resultado ID1",
          "webhookId": "82227789-06f1-46ac-9235-eef9b8c2db28",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0c3f89b2-a523-4a31-84bc-bf3453631992",
                  "leftValue": "={{ $json.Estado }}",
                  "rightValue": "Pendiente",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -4320,
            -832
          ],
          "id": "b134a301-f7b9-4494-bc13-e5d4dd13c0ff",
          "name": "Filter1"
        },
        {
          "parameters": {
            "jsCode": "const mensajesPendientes = [];\nlet chatID = null; // Variable para almacenar el Chat ID\n\n// Itera sobre cada item de entrada\nfor (const item of $input.all()) {\n  // Asegúrate de que los campos 'Pendiente' y 'No' existan\n  if (item.json.Pendiente && item.json.No !== undefined && item.json.No !== null) {\n    const pendienteTexto = item.json.Pendiente;\n    let numeroPendiente = String(item.json.No);\n    numeroPendiente = numeroPendiente.trim();\n\n    // Construye la línea para cada pendiente\n    mensajesPendientes.push(`- Pendiente: ${pendienteTexto}. Cuando lo completes, escribe: pendiente ${numeroPendiente} completado`);\n\n    // Captura el Chat ID del primer item. Asumiendo que es el mismo para todos o solo necesitas uno.\n    if (!chatID && item.json['Chat id']) { // Asegúrate de usar el nombre de campo exacto 'Chat id'\n      chatID = item.json['Chat id'];\n    }\n  }\n}\n\nlet mensajeFinal = \"No se encontraron pendientes.\";\nif (mensajesPendientes.length > 0) {\n  mensajeFinal = \"Aquí están tus pendientes:\\n\\n\" + mensajesPendientes.join('\\n\\n');\n}\n\n// Retorna un único item con el mensaje consolidado Y el Chat ID\nreturn [{\n  json: {\n    message: mensajeFinal,\n    telegramChatID: chatID // Agregamos el Chat ID a la salida JSON\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2544,
            -624
          ],
          "id": "3a641d01-9e87-469b-8023-08cee20cad35",
          "name": "Code1"
        },
        {
          "parameters": {
            "jsCode": "const mensajesPendientes = [];\nlet chatID = null; // Variable para almacenar el Chat ID\n\n// Itera sobre cada item de entrada\nfor (const item of $input.all()) {\n  // Asegúrate de que los campos 'Pendiente' y 'No' existan\n  if (item.json.Pendiente && item.json.No !== undefined && item.json.No !== null) {\n    const pendienteTexto = item.json.Pendiente;\n    let numeroPendiente = String(item.json.No);\n    numeroPendiente = numeroPendiente.trim();\n\n    // Construye la línea para cada pendiente\n    mensajesPendientes.push(`- Pendiente: ${pendienteTexto}. Cuando lo completes, escribe: pendiente ${numeroPendiente} completado`);\n\n    // Captura el Chat ID del primer item. Asumiendo que es el mismo para todos o solo necesitas uno.\n    if (!chatID && item.json['Chat id']) { // Asegúrate de usar el nombre de campo exacto 'Chat id'\n      chatID = item.json['Chat id'];\n    }\n  }\n}\n\nlet mensajeFinal = \"No se encontraron pendientes.\";\nif (mensajesPendientes.length > 0) {\n  mensajeFinal = \"Recuerda que hay estos pendientes:\\n\\n\" + mensajesPendientes.join('\\n\\n');\n}\n\n// Retorna un único item con el mensaje consolidado Y el Chat ID\nreturn [{\n  json: {\n    message: mensajeFinal,\n    telegramChatID: chatID // Agregamos el Chat ID a la salida JSON\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -4320,
            -672
          ],
          "id": "08411dbb-91fb-4ede-b7d8-63d529f600bc",
          "name": "Code2"
        }
      ],
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Mensaje": {
          "main": [
            [
              {
                "node": "AgtIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtIntent": {
          "main": [
            [
              {
                "node": "SwIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GemIntent": {
          "ai_languageModel": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "SwIntent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtExtract",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtStatus",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Gasto",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "pago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtPendient",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "RegistroNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtExtract": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Resultado ID1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscarID": {
          "ai_languageModel": [
            [
              {
                "node": "AgtExtract",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "statusID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit2": {
          "main": [
            [
              {
                "node": "Resultado ID3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtStatus": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "status": {
          "ai_languageModel": [
            [
              {
                "node": "AgtStatus",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "statusID": {
          "main": [
            []
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AgtPendient",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "AgtPendient": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agregar a hoja": {
          "main": [
            [
              {
                "node": "Confirm Add Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendient": {
          "main": [
            [
              {
                "node": "Completado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completado": {
          "main": [
            [
              {
                "node": "Confirmar Hecho Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Agregar a hoja",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "show",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "show": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendientes": {
          "main": [
            [
              {
                "node": "Filter1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "tempofile",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "textVoz": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "tempofile": {
          "main": [
            [
              {
                "node": "Resultado ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter1": {
          "main": [
            [
              {
                "node": "Code2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recordatorio": {
          "main": [
            []
          ]
        },
        "Code2": {
          "main": [
            [
              {
                "node": "Recordatorio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Mensaje": [
          {
            "json": {
              "update_id": 275664485,
              "message": {
                "message_id": 2120,
                "from": {
                  "id": 8193170686,
                  "is_bot": false,
                  "first_name": "Canino",
                  "language_code": "es"
                },
                "chat": {
                  "id": 8193170686,
                  "first_name": "Canino",
                  "type": "private"
                },
                "date": 1758996228,
                "text": "Estado de c037"
              }
            }
          }
        ]
      },
      "versionId": "429e2c12-1701-48b1-aa8c-24d39c2424af",
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-05-26T19:27:36.937Z",
          "createdAt": "2025-05-26T19:27:36.937Z",
          "role": "workflow:owner",
          "workflowId": "NCp49VC9H6ZP2TPV",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-24T03:06:40.000Z",
      "createdAt": "2025-06-24T03:06:26.152Z",
      "id": "NMs5CaTaLlWhFcGv",
      "name": "Agente2Backup",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.message.chat.id }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -3900,
            -1040
          ],
          "id": "d5f4530b-4ecd-4827-a951-064cd43ba236",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -4140,
            -1260
          ],
          "id": "256efa54-a090-4420-bb99-782a8b33f0af",
          "name": "Mensaje",
          "webhookId": "bb317901-8d83-4515-a3c4-21dc00e844de",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "chatId": "={{ $json.chatIdOriginal }}",
            "text": "={{ $json.message }}",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3320,
            -1060
          ],
          "id": "0ac9fa8f-0cb3-47e7-bcb3-ba1a49388ebc",
          "name": "Respuesta",
          "webhookId": "1f865958-70ea-4d5f-b372-b4e0100f3759",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.message.text }}",
            "options": {
              "systemMessage": "=Clasifica el mensaje del usuario en una de las siguientes INTENCIONES. Responde ÚNICAMENTE con la etiqueta de la intención en MAYÚSCULAS.\n\nINTENCIONES:\n- SALUDO\n- BUSCAR_NOMBRE\n- ESTADO_CLIENTE\n- REPORTAR_GASTO\n- REPORTAR_PAGO\n- DESCONOCIDO\n- PENDIENTE\n- COMPLETAR\n\nEjemplos:\nUsuario: \"hola\" -> SALUDO\nUsuario: \"buenos días\" -> SALUDO\nUsuario: \"dime el id de Juan Perez\" -> BUSCAR_NOMBRE\nUsuario: \"busca el nombre Maria Lopez\" -> BUSCAR_NOMBRE\nUsuario: \"Como aparece el cliente con ID 123?\" -> ESTADO_CLIENTE\nUsuario: \"esta conectado el ID 456\" -> ESTADO_CLIENTE\nUsuario: \"quiero registrar un gasto\" -> REPORTAR_GASTO\nUsuario: \"Aldo gasto 300 en comida\" -> REPORTAR_GASTO\nUsuario: \"recibi 2000 de instalacion\" -> REPORTAR_GASTO\nUsuario: \"quiero reportar mi pago\" -> REPORTAR_PAGO\nUsuario: \"reportar pago de ID 789\" -> REPORTAR_PAGO\nUsuario: \"anota en pendientes comprar cable\" -> PENDIENTE\nUsuario: \"Cuales son los pendientes\" -> PENDIENTE\nUusario: \"Pendiente completado\" -> PENDIENTE\nUsuario: \"Pendiente comprar cable completado\" -> PENDIENTE\nUsuario: \"qué hora es?\" -> DESCONOCIDO\nUsuario: \"Completar registro\" -> COMPLETAR\nUsuario: \"Terminar registro\" -> COMPLETAR\nUsuario: \"Finalizar registro\" -> COMPLETAR\n\n---\nMensaje del Usuario:\n{{ $json.message.text }}\n---\nINTENCION:\n\nContesta siempre en español"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3920,
            -1260
          ],
          "id": "9ee774a2-a333-4da2-a305-54a09ab61033",
          "name": "AgtIntent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -4020,
            -1040
          ],
          "id": "5a37b6ff-2a8c-4cca-bd96-fa16ad6f65a8",
          "name": "GemIntent",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4da42528-a5f9-4321-a0c8-55363bd93037",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "SALUDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bb95cbec-d074-49cf-86f4-2e10f729c7f9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "BUSCAR_NOMBRE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "675f82ad-14e4-456c-929d-fa64a6552f48",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "ESTADO_CLIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_GASTO",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "cd7f0500-527d-4be7-bf61-b5a5cdeac877"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f738687-f3c2-4715-a82a-05640916957b",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_PAGO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "48297539-bf1e-49f9-89a0-5665b0ed81e9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "INTENCION_DESCONOCIDA",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b3137ff5-3906-4cbb-9917-a6efb244bab6",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "PENDIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3f66a1c0-6dc9-47f6-960b-f5b623ea1b91",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "COMPLETAR",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -3560,
            -1260
          ],
          "id": "18e5c775-26ca-47aa-9a90-fecaa78d547a",
          "name": "SwIntent"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el nombre de la persona que se busca. Responde SÓLO con el nombre. Si no puedes identificar un nombre claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el id de Juan Perez\" -> Juan\nMensaje: \"busca el nombre Maria Fernanda Lopez Garcia\" -> Fernanda\nMensaje: \"ID de ana\" -> ana\nMensaje: \"buscar nombre\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -4140,
            -880
          ],
          "id": "83884c69-4a71-4918-8c2d-ad0faaa32300",
          "name": "AgtExtract"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=¡Hola! 👋 ¿En qué puedo ayudarte hoy? Puedes: - Buscar el ID de un cliente (ej: \"busca el ID de Ana\") - Consultar el estado de un cliente (ej: \"estado del ID 123\") - Reportar un gasto o ingreso - Reportar un pago mensual - Registrar listar y completar pendientes - Completar registros de nuevos clientes",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3400,
            -1280
          ],
          "id": "9e943475-5069-4a48-9398-99e935bf6920",
          "name": "Telegram",
          "webhookId": "46d467c0-0196-4d16-a79f-47b1e86869a3",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3760,
            -860
          ],
          "id": "d92ecc82-8bd2-44cc-8bcc-1610ce6fca8d",
          "name": "If"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -3940,
            -640
          ],
          "id": "78de4936-761c-4c62-bbbc-f0022008158c",
          "name": "Limit"
        },
        {
          "parameters": {
            "modelName": "=models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -4140,
            -1020
          ],
          "id": "a12bcca7-479a-44bb-8169-84e06f4a9f64",
          "name": "BuscarID",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "xB5k8lNiGd17TIji",
              "mode": "list",
              "cachedResultName": "BuscarChiq2"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.output }}",
                "IdChat": "={{ $('Mensaje').item.json.message.chat.id.toString() }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "IdChat",
                  "displayName": "IdChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -4120,
            -640
          ],
          "id": "633ad712-514b-4f76-9fe9-0f686f2f80cc",
          "name": "Buscar",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3740,
            -640
          ],
          "id": "3377c50e-0611-4e96-b6a7-241a7d0e0f75",
          "name": "Resultado ID",
          "webhookId": "528ca76a-5b80-44a5-9cd6-5fdb5928cda8",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el nombre que quieres buscar (ej: 'busca el ID de Ana').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3760,
            -1020
          ],
          "id": "2165132b-a6a1-48c3-b1de-746aaf4b9573",
          "name": "NoEntender",
          "webhookId": "4f58a825-2887-442c-8470-d29d22097e4a",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3200,
            -900
          ],
          "id": "8f08b35b-ebcd-4eef-a3c4-7adab0d91007",
          "name": "If2"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -3340,
            -680
          ],
          "id": "b816674a-e92f-4443-845d-26471024fa4e",
          "name": "Limit2"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3180,
            -660
          ],
          "id": "faa26500-f4b8-4c46-8e39-8dc004198497",
          "name": "Resultado ID3",
          "webhookId": "4d3ddef4-99fe-479c-a40c-99bd36528864",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el ID del cliente que quieres saber su estado (ej: como aparece d456').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3040,
            -740
          ],
          "id": "ae168812-365a-4056-8865-1ac694062c63",
          "name": "NoEntender1",
          "webhookId": "897e491e-0985-40bd-a141-f5c6b8acca3e",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el ID del cliente que se busca. Responde SÓLO con el ID. Si no puedes identificar un ID claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el estado de c345\" -> c345\nMensaje: \"como aparece el a423\" -> a423\nMensaje: \"status de b043\" -> b043\nMensaje: \"buscar status\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3520,
            -880
          ],
          "id": "0452f423-7527-4a38-9818-63441a31a3c9",
          "name": "AgtStatus"
        },
        {
          "parameters": {
            "modelName": "=models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3440,
            -980
          ],
          "id": "b31c305e-4619-42a8-bd46-bc5a9619d327",
          "name": "status",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "8EoTMqNoy8ATG1hs",
              "mode": "list",
              "cachedResultName": "StatusIDC"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.output.trim() }}",
                "idChat": "={{ $('Mensaje').item.json.message.chat.id }} "
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "idChat",
                  "displayName": "idChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -3540,
            -680
          ],
          "id": "1f75756a-d532-4f07-877e-296686996627",
          "name": "statusID",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=Reportar ingresos y gastos <a href=\"https://n8n.albored.com/form/gastos\">AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3160,
            -1160
          ],
          "id": "ce6f5fec-0d21-4866-b775-293bb528db25",
          "name": "Gasto",
          "webhookId": "418c9674-6a16-4dd6-9b26-a247ac4d4a52",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/ddc26433-a54c-4b1e-a3bb-3c1447eebd71\">Reportar Pago 1MES AQUI</a>\n\n<a href=\"https://n8n.albored.com/form/a0972ad6-4c43-4f86-9100-fd32b4aff9ed\">Reportar Pago Varios meses AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3120,
            -1040
          ],
          "id": "9e392503-b7ea-4d58-a290-144eebd2c32b",
          "name": "pago",
          "webhookId": "508b7e86-c244-43a2-93fe-9a2b0c49f8ff",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2980,
            -1120
          ],
          "id": "b68b8f2b-5c61-4d45-ba9e-fbe735f47073",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae la ACCION y el PENDIENTE. Cuando tengas todos los datos, Responde SÓLO con accion,y pendiente\n\nEjemplos:\nMensaje: \"anota en pendientes comprar cinta negra, alambre y tubos\" -> accion=add, pendiente=\"comprar cinta negra, alambre y tubos\"\nMensaje: \"pon en pendientes revisar antena xyz3\" -> accion=add, pendiente=revisar antena xyz3\nMensaje: \"cuales son los pendientes\" -> accion=show, pendiente=\"\"\nMensaje: \"Que pendientes hay\" -> accion=show, pendiente=\"\"\nMensaje: \"Pendiente 3 completado\"-> accion=del, pendiente=\"3\"\nMensaje: \"Quitar pendiente 5\"-> accion=del, pendiente=\"5\"\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nACCION, PENDIENTE a buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3000,
            -1260
          ],
          "id": "60d4f021-5492-4b12-bf09-c7da3139208c",
          "name": "AgtPendient"
        },
        {
          "parameters": {
            "jsCode": "// Obtenemos el primer (y único) item que llega al nodo\nconst item = items[0];\n\n// Extraemos la cadena de texto del campo \"output\"\nconst rawString = item.json.output;\n\n// Creamos un objeto vacío para guardar los nuevos datos\nconst newData = {};\n\n// 1. Limpiamos la cadena (quitamos espacios y saltos de línea al inicio/final)\n// 2. La dividimos por la coma (,) para obtener cada par \"clave=valor\"\nconst pairs = rawString.trim().split(',');\n\n// Recorremos cada par\nfor (const pair of pairs) {\n  // Dividimos el par por el signo igual (=) para separar la clave del valor\n  // Usamos una pequeña optimización para que el valor pueda contener \"=\"\n  const [key, ...valueParts] = pair.split('=');\n  const value = valueParts.join('=');\n  \n  // Añadimos la clave y el valor al nuevo objeto, limpiando espacios\n  if (key) {\n    newData[key.trim()] = value.trim();\n  }\n}\n\n// Reemplazamos el json original del item con nuestro nuevo objeto\nitem.json = newData;\n\n// Devolvemos el item modificado\nreturn [item];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2660,
            -1240
          ],
          "id": "854acb61-2b95-49db-9838-b8d939e22936",
          "name": "Code"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bd191530-ac43-4a91-bbdc-dc3e79c1bf87",
                  "name": "accion",
                  "value": "={{ $('Code').item.json.accion }}",
                  "type": "string"
                },
                {
                  "id": "ec194e3c-caf6-4160-8895-f0df5443e5c5",
                  "name": "pendiente",
                  "value": "={{ $('Code').item.json.pendiente }}",
                  "type": "string"
                },
                {
                  "id": "f9430989-4996-4f48-b230-cc485f0683a4",
                  "name": "id",
                  "value": "={{ $('Mensaje').item.json.message.chat.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2500,
            -1240
          ],
          "id": "23856d46-2b39-475b-a358-8c7e252f512a",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.pendiente }}",
                "Estado": "Pendiente",
                "Chat id": "={{ $json.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "name": "Agregar a hoja",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -2640,
            -1040
          ],
          "id": "49979da7-6a42-491f-9fdf-c7e2a79c34ce",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json['Chat id'] }}",
            "text": "=✅ Pendiente {{ $json.Pendiente }} registrado.",
            "additionalFields": {}
          },
          "name": "Confirm Add Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2460,
            -1020
          ],
          "id": "7b4f5ee0-20d0-44fa-9f3d-3383a855a1f9",
          "webhookId": "2fcd6278-976a-4715-b691-ab413fbf1f7f",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Edit Fields').item.json.id }}",
            "text": "=✅ Pendiente '{{ $('Edit Fields').item.json.pendiente }}' marcado como completado. ",
            "additionalFields": {}
          },
          "name": "Confirmar Hecho Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2840,
            -660
          ],
          "id": "da439069-cef7-4e5f-aed9-c60e58ceb0e0",
          "webhookId": "67d37b57-ca8f-4abf-a11b-2c52319a22f7",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Pendiente",
                  "lookupValue": "={{ $json.pendiente.replace(/\"/g, '') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2980,
            -900
          ],
          "id": "018968c7-1938-4723-9bf6-695c442d5176",
          "name": "Pendient",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.Pendiente }}",
                "Estado": "Completado"
              },
              "matchingColumns": [
                "Pendiente"
              ],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2820,
            -820
          ],
          "id": "ccdb7631-f2e6-44b2-a9ca-eeaf5ce6d526",
          "name": "Completado",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "add",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "08a62ae7-f12c-4fdc-8835-ec887e60eb9f"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "919e7e00-c608-4fc6-9223-434fd81034d5",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "show",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6fafe8d6-f710-4707-b255-8720d9e595e9",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "del",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2860,
            -1040
          ],
          "id": "ba3a77a7-84f3-4e5e-afde-2be64772f3c7",
          "name": "Switch"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2640,
            -840
          ],
          "id": "4397abcf-6852-4219-8a5e-0c4dee2930e6",
          "name": "show",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json['Chat id'] }}",
            "text": "=pendiente \"{{ $json.Pendiente }}\". Cuando lo completes, responde: pendiente cumplido {{ $json.Pendiente }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2540,
            -600
          ],
          "id": "ee7f3212-2ce8-4629-b631-06319c2851bf",
          "name": "Telegram1",
          "webhookId": "e5703c79-91bc-45cc-b829-3a181c37274b",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "1b478ab7-c155-42aa-8a74-5acea89152c3",
                  "leftValue": "={{ $json.Estado }}",
                  "rightValue": "Pendiente",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -2480,
            -840
          ],
          "id": "fe16337a-8d1c-48b2-8e05-aadec3e04aa9",
          "name": "Filter"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9,
                  "triggerAtMinute": 20
                },
                {
                  "triggerAtHour": 13
                },
                {
                  "triggerAtHour": 17,
                  "triggerAtMinute": 3
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -4380,
            -1240
          ],
          "id": "32280a43-feb9-46cd-8d6d-4f7d04fe894b",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -4360,
            -1040
          ],
          "id": "7568e8ac-f0b5-4f2b-b112-bea57320347b",
          "name": "Pendientes",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "return items.filter(item => {\n  // 1. Accede a la propiedad correcta: \"Estado\" (con E mayúscula)\n  // 2. Compara con la versión en minúsculas: \"pendiente\"\n  return item.json.Estado?.toLowerCase() === 'pendiente';\n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -4360,
            -860
          ],
          "id": "575e0c30-ae0c-4aac-9d6a-55f51aab0933",
          "name": "Filtrar Vencidos"
        },
        {
          "parameters": {
            "chatId": "={{$json.chat_id}}",
            "text": "=⏰ Recordatorio: pendiente \"{{ $json.pendiente }}\" programado para {{ $json.fecha }}.   Cuando lo completes, responde: pendiente cumplido {{ $json.pendiente }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -4360,
            -680
          ],
          "id": "8cf4e6cc-42f2-4b7e-a570-fd0aca14c874",
          "name": "Recordatorio",
          "webhookId": "b976010a-03dc-410f-bd41-120b3a3379c1",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/6d0c432c-5007-4ca1-83df-598d331d3737\">Completar Registro AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3260,
            -1240
          ],
          "id": "a8e9bc62-ae8c-4e9f-999f-e4f69b7d41e0",
          "name": "RegistroNuevo",
          "webhookId": "6bfbc2ad-8424-474d-bd4c-ed328cbf5fb0",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Mensaje": {
          "main": [
            [
              {
                "node": "AgtIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtIntent": {
          "main": [
            [
              {
                "node": "SwIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GemIntent": {
          "ai_languageModel": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "SwIntent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtExtract",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtStatus",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Gasto",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "pago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtPendient",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "RegistroNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtExtract": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Resultado ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscarID": {
          "ai_languageModel": [
            [
              {
                "node": "AgtExtract",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "statusID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit2": {
          "main": [
            [
              {
                "node": "Resultado ID3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtStatus": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "status": {
          "ai_languageModel": [
            [
              {
                "node": "AgtStatus",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "statusID": {
          "main": [
            [
              {
                "node": "Limit2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AgtPendient",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "AgtPendient": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agregar a hoja": {
          "main": [
            [
              {
                "node": "Confirm Add Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendient": {
          "main": [
            [
              {
                "node": "Completado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completado": {
          "main": [
            [
              {
                "node": "Confirmar Hecho Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Agregar a hoja",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "show",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "show": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendientes": {
          "main": [
            [
              {
                "node": "Filtrar Vencidos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filtrar Vencidos": {
          "main": [
            [
              {
                "node": "Recordatorio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "98babcee-d073-48ff-acb2-05f721826717",
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-06-24T03:06:26.165Z",
          "createdAt": "2025-06-24T03:06:26.165Z",
          "role": "workflow:owner",
          "workflowId": "NMs5CaTaLlWhFcGv",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-24T20:58:30.000Z",
      "createdAt": "2025-06-03T04:16:49.001Z",
      "id": "NiWdBg73r03ZZG35",
      "name": "PagosChiq",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Reportar Pago Por..",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Varios Meses"
                      },
                      {
                        "option": "Otro"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "path": "Varios"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            940,
            -860
          ],
          "id": "4a67a17a-9df1-45e9-8a6e-3050dca38987",
          "name": "ID Cliente",
          "webhookId": "a0972ad6-4c43-4f86-9100-fd32b4aff9ed"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1160,
            -860
          ],
          "id": "cffe761e-63bf-4e31-abac-f99fbef0958d",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            940,
            -660
          ],
          "id": "0c7f89ea-6ac7-44d3-84fe-705c9fe39fa8",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1380,
            -860
          ],
          "id": "c74e9a32-e5e7-48f0-81ee-0bd3e1f80f06",
          "name": "CargarPago",
          "webhookId": "ae1d31a6-e22d-4005-8643-d0b51d29335c"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2000,
            -860
          ],
          "id": "f92f3740-c1ee-4a68-b823-c3b62490af64",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2200,
            -860
          ],
          "id": "9a2a9499-d4ea-420a-9f86-52324efac9f3",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            940,
            -220
          ],
          "id": "aacdae3c-020d-423f-8a30-1e0d14437382",
          "name": "Error",
          "webhookId": "c9e4a62e-6584-43fd-afa7-73eddae95ca6"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Merge').item.json[\"Fecha de pago\"] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2020,
            -640
          ],
          "id": "87c54c65-391e-433a-8fbd-42b0d56d1323",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2220,
            -280
          ],
          "id": "cdeb0eac-d3d8-4506-b147-19d74fcb352b",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2220,
            -660
          ],
          "id": "fb17f033-209c-4268-b424-4566ca69c3bf",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2420,
            -860
          ],
          "id": "db513841-e105-49bd-bcd6-7f906b5904eb",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2640,
            -660
          ],
          "id": "38a1b898-d776-4c68-ad35-066927aee296",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2440,
            -240
          ],
          "id": "4a1b11b8-c44b-4929-b1e4-ffbd54295250",
          "name": "Form",
          "webhookId": "a071e6e8-7699-4f5c-9075-48272ffaf233"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2580,
            -160
          ],
          "id": "902b7fbd-c384-470d-820d-da157494644a",
          "name": "Gmail",
          "webhookId": "258a689f-c50d-408a-bf03-eba42b45c782",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2420,
            -640
          ],
          "id": "8d04234f-8525-481b-88b1-b35b018ceb41",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            1800,
            -620
          ],
          "id": "3c3fee80-1a71-41fd-95b6-5618e015855a",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1980,
            -480
          ],
          "id": "ab77aa8e-4f7d-4ac2-8732-19c97fbba4fc",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1960,
            -220
          ],
          "id": "6adc42d1-d5e4-4b4d-989b-2df86631a6aa",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1600,
            -280
          ],
          "id": "ab514fdd-2aa7-4f4a-bfa4-6f543cae8f28",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1780,
            -220
          ],
          "id": "21f6e3be-7638-48cb-9b66-5dd4de8339c0",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1140,
            -660
          ],
          "id": "c154f1bc-ec6e-46bf-aa08-203eccc5a3f8",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            980,
            -420
          ],
          "id": "640f0b86-7d53-437b-ae90-f658b9b9cc19",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Merge').item.json['Cantidad Pagada'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "bbd59a4f-b55e-4e71-9d85-98e04e902024",
                  "name": "NuevoPlan",
                  "value": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                  "type": "string"
                },
                {
                  "id": "e629e409-d239-4505-b5ac-9c1acf5d0037",
                  "name": "SumarMeses",
                  "value": "={{ $('Merge').item.json.SumarMeses }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2600,
            -860
          ],
          "id": "de7b25e7-16d1-4061-9c76-cdfabc0f103c",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1100,
            -280
          ],
          "id": "93de046a-7de2-4967-83da-1192d7a187d6",
          "name": "Error1",
          "webhookId": "c53188e9-7db5-4242-887e-9fcc6bb35da8"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2640,
            -460
          ],
          "id": "eb1f9be5-c90c-4bee-8944-fc24d6b38c42",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2660,
            -300
          ],
          "id": "e41feab1-13d0-43ca-bf8e-8703f0cf6c9c",
          "name": "Form1",
          "webhookId": "2395db6b-075a-45c5-a3a5-6353411feb88"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2420,
            -440
          ],
          "id": "c4bac8a0-badf-4a11-8c85-4b70d020afc7",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Meses Pagados",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "2"
                      },
                      {
                        "option": "3"
                      },
                      {
                        "option": "4"
                      },
                      {
                        "option": "5"
                      },
                      {
                        "option": "6"
                      },
                      {
                        "option": "7"
                      },
                      {
                        "option": "8"
                      },
                      {
                        "option": "9"
                      },
                      {
                        "option": "10"
                      },
                      {
                        "option": "11 +1 Gratis"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Por favor selecciones cuantos meses pago"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1400,
            -300
          ],
          "id": "b7f05acc-aff3-4f0a-827d-c14856b17876",
          "name": "Meses",
          "webhookId": "9b5279e8-001e-49bc-962b-f0b84b263789"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "1 Mes",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "31265679-e2bc-4527-b882-e4d580ebe2fa"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "65fab1f3-aec3-469c-ad26-f3471d84f5b8",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Varios Meses",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9b0e9c3-74eb-4700-9d17-4336678d0948",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1160,
            -420
          ],
          "id": "19cf9711-60ad-4504-a1cc-d02fd4bad7ea",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Todo Correcto?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aceptar"
                      },
                      {
                        "option": "Corregir Meses y/o Plan"
                      }
                    ]
                  }
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Cantidad Pagada",
                  "fieldValue": "={{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}"
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Plan Mensual Pagado",
                  "fieldValue": "={{ $json[\"Plan Mensual Pagado\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Antes de continuar verifica que los datos esten correctos",
              "formDescription": "=Cliente: {{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nCantidad Pagada = {{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}\n "
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1380,
            -520
          ],
          "id": "2d29d3c6-8999-4d97-be4a-a4f5cf74dab9",
          "name": "PagoVarios",
          "webhookId": "8eaa5800-abf4-42ad-bfdf-fc186d0d8b39"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json[\"Todo Correcto?\"] }}",
                  "rightValue": "=Aceptar",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1560,
            -520
          ],
          "id": "de31d1d5-38be-4f3d-b500-2f7283226e4d",
          "name": "TodoOk?"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1380,
            -680
          ],
          "id": "8937d8e9-7a4a-40cd-9290-6ecd4e81bd14",
          "name": "OtrosPago",
          "webhookId": "58176f9d-d60b-4711-8642-af18a75a6c59"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1780,
            -840
          ],
          "id": "c847f284-f345-4045-a074-271231ab2df0",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                },
                {
                  "id": "1b963156-9b3c-4764-a647-95502c0eb968",
                  "name": "SumarMeses",
                  "value": 1,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1560,
            -860
          ],
          "id": "b8fe6efa-31db-4ee1-ba9d-15670981af69",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2200,
            -500
          ],
          "id": "bc66bac7-8515-400e-8068-f6ce190887b9",
          "name": "MismoPlan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "97338f77-1ed1-4a62-b3d6-2341c48a8c75",
                  "name": "SumarMeses",
                  "value": "={{ $('Meses').item.json[\"Meses Pagados\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -460
          ],
          "id": "8e918459-99cc-4ae3-b8dc-35ed348106e9",
          "name": "mesesvarios"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3675b7e2-16ec-4541-805e-f0dadf9481c8",
                  "name": "SumarMeses",
                  "value": "={{ Math.round($json['Cantidad Pagada'] / $json['Plan Mensual Pagado']) }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1560,
            -680
          ],
          "id": "3df69f88-dd64-4e9e-aefb-fc34e13f04e1",
          "name": "mesotros"
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago {{ $('DatosListos').item.json[\"ID Cliente\"] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Meses pagados:{{ $('DatosListos').item.json.SumarMeses }} x Plan pagado:{{ $('DatosListos').item.json.NuevoPlan }} sea igual a ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            2760,
            -140
          ],
          "id": "3d6cfb22-8c17-4339-9fb1-937be2248a98",
          "name": "Telegram",
          "webhookId": "fb5c3934-3dfb-4de5-b7a4-30c6d059ad0a",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago duplicado, error al intentar reportar pago {{ $json.ID }} {{ $json[\"Cliente/Concepto\"] }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            1260,
            -200
          ],
          "id": "3d924bea-f905-46e8-b83e-d224343c902e",
          "name": "Telegram1",
          "webhookId": "5408b5da-216f-4527-b2e5-472198961784",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Meses": {
          "main": [
            [
              {
                "node": "PagoVarios",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "OtrosPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoVarios": {
          "main": [
            [
              {
                "node": "TodoOk?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TodoOk?": {
          "main": [
            [
              {
                "node": "mesesvarios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OtrosPago": {
          "main": [
            [
              {
                "node": "mesotros",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "mesesvarios": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "mesotros": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Error1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "334b659b-d1a9-463b-b43b-6f98ebe5fb42",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-03T04:16:49.015Z",
          "createdAt": "2025-06-03T04:16:49.015Z",
          "role": "workflow:owner",
          "workflowId": "NiWdBg73r03ZZG35",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-17T02:22:52.000Z",
      "createdAt": "2025-06-08T01:22:09.184Z",
      "id": "PLn9wXX4zdRCYuaF",
      "name": "PagosChiq1Mes",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "buttonLabel": "Enviar",
              "path": "Pago1Mes",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            960,
            -896
          ],
          "id": "34446b33-3c22-40d2-92f6-888a52ffad8f",
          "name": "ID Cliente",
          "webhookId": "ddc26433-a54c-4b1e-a3bb-3c1447eebd71"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1152,
            -896
          ],
          "id": "16bcd36d-e184-476a-9b53-e226bd3e9090",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            768,
            -864
          ],
          "id": "f4e2393a-cc50-49a4-acea-1a49dfa83542",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 10,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1168,
            -480
          ],
          "id": "3323b9f0-a8db-4560-acf2-829c71531785",
          "name": "CargarPago",
          "webhookId": "2be449ef-5a47-46df-baaf-e893c4a86f0a"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1808,
            -896
          ],
          "id": "3f76c205-a6d1-4172-b53e-4a0ca8dc4d2e",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "timeUnit": "months",
            "duration": "={{ $('AddCant').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            1984,
            -896
          ],
          "id": "ccc7f879-a10a-4756-9efa-506247fab25a",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            752,
            -688
          ],
          "id": "aa96c543-5435-4531-81b0-ee352fa91cfa",
          "name": "Error",
          "webhookId": "c8553210-c36a-497c-b403-e7b6cc02a210"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('AddCant').item.json[\"Fecha de pago\"] }}",
            "timeUnit": "months",
            "duration": "={{ $('AddCant').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            1808,
            -736
          ],
          "id": "781ac6e4-b60f-4bd1-b4d1-44b607f6e910",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1600,
            -896
          ],
          "id": "6cd6ff86-bc60-4067-8afb-6542b422695e",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2016,
            -736
          ],
          "id": "1fc20e99-21a9-4aaa-b4fa-bbba513abd39",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2192,
            -896
          ],
          "id": "d514abb8-c3ef-4c33-8105-a4b868ba16f2",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            1824,
            -336
          ],
          "id": "8e44ed20-528f-4841-bbaa-e3de1a76cf37",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "limitWaitTime": true,
            "resumeAmount": 20,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2208,
            -496
          ],
          "id": "55b07ce3-dfa6-4688-b002-304e598b1e76",
          "name": "Form",
          "webhookId": "defa5022-2ebe-4b2d-95df-92e0b2b5fed9"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2208,
            -704
          ],
          "id": "61b024cf-c599-4efa-a08f-9fcee0f2c82e",
          "name": "Gmail",
          "webhookId": "8300d660-3e18-4436-8867-0105076d20fb",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nom",
                  "displayName": "Nom",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ingre",
                  "displayName": "Ingre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "gasto",
                  "displayName": "gasto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Total",
                  "displayName": "Total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Eqvale",
                  "displayName": "Eqvale",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Corresp",
                  "displayName": "Corresp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1824,
            -560
          ],
          "id": "6b904564-14c4-4a99-9663-f2f22eb2bba0",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            1168,
            -320
          ],
          "id": "8a602754-9c53-4b13-8c20-53479a7f8811",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('AddCant').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('AddCant').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('AddCant').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('AddCant').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1392,
            -624
          ],
          "id": "0a516947-968a-421f-ba3d-3709c6771890",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1600,
            -704
          ],
          "id": "3d814407-7b45-443a-b5c8-5ab32d0e8a14",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1600,
            -368
          ],
          "id": "4cd99de2-c32c-46ba-9bea-a23ab5f9bdc7",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1600,
            -544
          ],
          "id": "2bc5773f-32c6-4a47-8f39-2b9e00d5e47e",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            960,
            -704
          ],
          "id": "4fee13f9-fccc-4c86-9d25-6e4ce0287a76",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1152,
            -704
          ],
          "id": "a166cb2f-e742-4468-bc0c-ae7f0122d794",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('AddCant').item.json[\"Fecha de pago\"] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('AddCant').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('AddCant').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('AddCant').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('AddCant').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('AddCant').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('AddCant').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('AddCant').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('AddCant').item.json['Plan Mensual Pagado'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "1a71be0f-eb3c-4f01-b639-8731d3bc87b0",
                  "name": "NuevoPlan",
                  "value": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2368,
            -768
          ],
          "id": "e6e03049-d49d-42a7-b96b-5ed2ff432736",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Deseas agregar un nuevo pago?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Si, Nuevo Pago"
                      },
                      {
                        "option": "No, Cancelar"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formTitle": "EL PAGO YA HA SIDO REGISTRADO!! ... El pago de este periodo para el usuario:",
              "formDescription": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}",
              "buttonLabel": "Aceptar",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            768,
            -464
          ],
          "id": "911f4998-794a-4ba6-8ca2-a9a739931b46",
          "name": "Error1",
          "webhookId": "6599920f-a446-4a89-a2f1-1d0465650d73"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2032,
            -336
          ],
          "id": "e4f30e87-44e4-4e44-bfd8-cd3d836875d2",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2240,
            -240
          ],
          "id": "00f89955-7e84-482e-918f-384dcf42e4df",
          "name": "Form1",
          "webhookId": "6fa51534-80c2-4f06-bd9f-8b5bb5aaf5fc"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1984,
            -560
          ],
          "id": "4a34ee8c-6396-45e8-bc31-21409f87af04",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                },
                {
                  "id": "1b963156-9b3c-4764-a647-95502c0eb968",
                  "name": "SumarMeses",
                  "value": 1,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1392,
            -368
          ],
          "id": "c7639d8c-80ef-4d89-942d-532e65147be9",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1392,
            -816
          ],
          "id": "82d6cf8e-3a7e-4cbd-b783-9deb90cd3245",
          "name": "MismoPlan"
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago {{ $('DatosListos').item.json['ID Cliente'] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Plan Pagado: {{ $('DatosListos').item.json.NuevoPlan }} y Cantidad pagada ${{ $('DatosListos').item.json['Cantidad Pagada'] }}, esten correctos, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            2368,
            -560
          ],
          "id": "6fa039e1-52a8-4766-a297-69868d4068db",
          "name": "Sandra",
          "webhookId": "348fa3a7-d62d-4cc0-8925-68be6759c61c",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Cancelado",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            912,
            -304
          ],
          "id": "3bf8fb62-0a64-4120-b07a-02ebd35d22a6",
          "name": "canino1",
          "webhookId": "348fa3a7-d62d-4cc0-8925-68be6759c61c",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3d202440-2f61-46b2-9680-183bdcbf8038",
                  "leftValue": "={{ $json[\"Deseas agregar un nuevo pago?\"] }}",
                  "rightValue": "Si, Nuevo Pago",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            944,
            -464
          ],
          "id": "15f97e0e-9c17-4c0c-8dd7-9d12343476f2",
          "name": "If"
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Sandra",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Sandra": {
          "main": [
            []
          ]
        },
        "Error1": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "canino1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "ID Cliente": [
          {
            "json": {
              "ID Cliente": "B403",
              "submittedAt": "2025-11-16T20:40:08.324-05:00",
              "formMode": "production"
            }
          }
        ]
      },
      "versionId": "3c487dc6-c60a-4604-bd8e-ad48b2c76f55",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-08T01:22:09.197Z",
          "createdAt": "2025-06-08T01:22:09.197Z",
          "role": "workflow:owner",
          "workflowId": "PLn9wXX4zdRCYuaF",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-17T03:11:44.000Z",
      "createdAt": "2025-09-29T03:09:07.098Z",
      "id": "PUjmFQBqKDXwf0XK",
      "name": "FormularioRedes",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1824,
            1456
          ],
          "id": "30a98973-69d8-4263-9683-b3aea1c8ff29",
          "name": "Google Gemini Chat Model3",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-2.0-flash-lite",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1952,
            1456
          ],
          "id": "cf871beb-b1d3-491b-9639-b8b794dbba9b",
          "name": "Google Gemini Chat Model1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-flash-lite-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2096,
            1456
          ],
          "id": "9deb641c-2428-40ae-ac1e-b1bd47e1aa52",
          "name": "Google Gemini Chat Model2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "numberInputs": 3,
            "rules": {
              "rule": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3236ebab-c0ef-4704-b2a2-b9349ec89225",
                        "leftValue": "true",
                        "rightValue": "true",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "modelIndex": 2,
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "55707611-f8f7-4b05-b2b2-8343dae448fa",
                        "leftValue": "true",
                        "rightValue": "true",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            }
          },
          "type": "@n8n/n8n-nodes-langchain.modelSelector",
          "typeVersion": 1,
          "position": [
            -2080,
            1280
          ],
          "id": "63ddd8b1-ea38-4a49-99ed-c2eeab263fb3",
          "name": "Model Selector"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.body.message }}",
            "options": {
              "systemMessage": "ERES EL ASISTENTE OFICIAL DE WEBCONAI. SOLO PUEDES RESPONDER CON LA INFORMACIÓN PROPORCIONADA AQUÍ.\n\n=== QUIÉNES SOMOS ===\nSomos WebConAi. Tu sitio web y tus tareas automatizadas para siempre. Usamos inteligencia artificial y herramientas como N8N para crear sitios web personalizados y sistemas que trabajan para ti. ¡Más productividad, menos esfuerzo!\n\n=== SERVICIOS WEBCONAI ===\n\n💡 PLAN LIGHT ($14.99):\n- Sitio web profesional con Google Sites o GitHub\n- Nombre de dominio personalizado www.tumarca.com *sujeto a disponibilidad\n- 5 pestañas incluidas\n- Opciones de diseño para tu marca\n- Entrega: 1-5 días aproximados\n\n🚀 PLAN PROFESIONAL ($24.99):\n- Todo lo del Plan Light +\n- Creación de cuentas Facebook, X, YouTube\n- 1 post diario, alerta de respuestas\n- Sugerencias de respuestas\n- Entrega: 2-7 días\n\n⭐ PLAN PREMIUM ($79.99):\n- Todo lo anterior +\n- Chatbot inteligente integrado\n- Bot de Telegram\n- Automatizaciones: control inventario, formularios ventas, bases datos, creación contenido, envío masivo, sistema citas/reservas\n- Entrega: 5-14 días\n\n💰 ADICIONALES:\n- Automatizaciones extra: desde $5/mes\n- Si facturamos\n\n=== PROCESO DE CONTRATACIÓN ===\n1. Completa el formulario: ([www.webconai.com/solicita](https://www.webconai.com/solicita))\n2. Te contactamos para confirmar detalles\n3. **Pago**: 3 meses de anticipo\n4. **Formas de pago**: PayPal, depósitos bancarios, criptomonedas, MercadoPago\n5. Generamos tu factura\n6. Desarrollo de tu proyecto y link de dashboard visualizacion del progreso.\n7. Entrega final\n=== DESPUÉS DE LA ENTREGA ===\n- Tienes 2 consultas gratis incluidas para modificaciones y/o dudas\n- Contacto: contacto@webconai.com\n\n📞 CONTACTO: \n- Formulario: https://www.webconai.com/solicita\n- Email: contacto@webconai.com\n\n=== REGLAS ESTRICTAS ===\n1. SOLO información de arriba\n2. Si no está listado: \"Para esa consulta, completa nuestro formulario: https://www.webconai.com/solicita\"\n3. NO inventes información\n4. Respuestas cortas, concisas y si tienes que agregar mas detalles pregunta si quiere saber mas\n5. No exageres ni seas ostentoso\n6. Español, profesional y amigable",
              "maxIterations": 4
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -1904,
            1104
          ],
          "id": "bf60485e-ac6e-4503-9616-e741ec76f048",
          "name": "Chat Pagina"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ { \"response\": $json.output, \"status\": \"success\" } }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            -1568,
            1104
          ],
          "id": "4d622d37-4d20-4cac-8d98-5b8ad9ac1f5c",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "agente",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -2096,
            1104
          ],
          "id": "47714359-6dfb-4a14-b0b6-83f222ff29e8",
          "name": "Webhook",
          "webhookId": "fd3506aa-9887-4c4c-a163-5317ccb53277"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "95c39b7c-9b12-4874-9491-92931e801260",
                  "leftValue": "={{ $json.plan_light }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "adc29ccd-814c-496a-af93-20b6a6a531d1",
                  "leftValue": "={{ $json.plan_profesional }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2656,
            912
          ],
          "id": "099606ff-370d-406c-9142-1803f2383bc8",
          "name": "🔀 Solo Consulta?"
        },
        {
          "parameters": {
            "fromEmail": "noreply@webconai.com",
            "toEmail": "={{ $json.email }}",
            "subject": "=Tu sitio web + redes sociales están listos - {{ $json.nombre }}",
            "text": "=¡Hola {{ $json.nombre }}!\n\nHemos preparado tu paquete PROFESIONAL completo:\n\n🌐 **SITIO WEB:**\n- Dominio: {{ $json.sitioWeb.dominioSugerido }}\n- 7 secciones (5 básicas + 2 adicionales)\n- Hasta 10 imágenes\n- 8 cuentas de email\n\n📱 **REDES SOCIALES:**\n{% for perfil in $json.perfilesRedes %}\n- {{ perfil.plataforma }}: @{{ perfil.usuario }}\n  Bio: {{ perfil.biografia }}\n  Hashtags: {{ perfil.hashtags }}\n{% endfor %}\n\n🤖 **AUTOMATIZACIÓN INCLUIDA:**\n✅ Publicación diaria automática\n✅ Alertas de comentarios\n✅ Respuestas sugeridas con IA\n\n**Para completar necesitamos:**\n📧 Confirmación de cuentas de email deseadas\n🖼️ Hasta 10 imágenes para el sitio\n📝 Contenido para las 2 secciones adicionales\n🔑 Acceso para crear las redes sociales\n\nResponde con los datos faltantes para proceder.\n\n¡Gracias por elegir WebConAi!\n\nEquipo WebConAi\n",
            "options": {}
          },
          "id": "650d3029-abd1-4b61-a2c1-f765aa716e0c",
          "name": "📧 Email Plan Profesional1",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -2896,
            1312
          ],
          "webhookId": "504f9f02-9454-4722-9d1f-eadd61e26f79",
          "credentials": {
            "smtp": {
              "id": "f3561gQKuV6bgmmX",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "fromEmail": "noreply@webconai.com",
            "toEmail": "={{ $json.email }}",
            "subject": "Tu sitio web está listo - {{ $json.nombre }}",
            "text": "=Hola {{ $json.nombre }},\n\n¡Excelente! Hemos recibido tu solicitud para el Plan Light ($14.99).\n\n📋 DATOS CONFIRMADOS:\n• Negocio: {{ $json.nombre }}\n• Email: {{ $json.email }}\n• Descripción: {{ $json.descripcion }}\n• Pedido #: {{ $json.pedido_id }}\n\n🎨 PRÓXIMO PASO: Selecciona tu diseño y nombre de dominio\n👉 {{ $json.selector_url }}\n\n**Para completar tu sitio necesitamos:**\n✅ Hasta 6 imágenes para mostrar en tu página *opcional\n✅ Textos en borrador para las páginas del sitio\n✅ Información de contacto\n✅ Datos para facturaciòn.\n\n📅 CRONOGRAMA:\n• Selección diseño y nombre de dominio: Ahora (5 - 10 min)\n• Creación de sitio personalizado: 2 - 48 horas\n• Preview, revisiones y cambios: 1 - 24 horas\n• Entrega final: Después del pago\n\n✨ INCLUYE:\n• Nombre de dominio personalizado\n• Sitio web profesional en línea\n• Formulario de contacto\n• 2 revisiones sin costo\n\n🎯 QUÉ HACER AHORA:\nSelecciona tu diseño y nombre de dominio aquí:\n{{ $json.selector_url }}\n\n¿Dudas? Responde este email.\n\nSaludos,\nEquipo WebConAI\n\n",
            "options": {}
          },
          "id": "9152b9d3-2ec3-44ba-9980-f978509a23b7",
          "name": "📧 Email Plan Light1",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -2448,
            1328
          ],
          "webhookId": "47dea416-c37c-403c-b788-98d662ab364c",
          "credentials": {
            "smtp": {
              "id": "f3561gQKuV6bgmmX",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 1
              },
              "conditions": [
                {
                  "leftValue": "={{ $json['G'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "isNotEmpty"
                  },
                  "id": "313f0e17-cf24-4440-ba63-5761e1406d96"
                },
                {
                  "id": "c72d7e16-63e8-4424-81d2-3a02759bbb82",
                  "leftValue": "={{ $json.plan_profesional }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "b1fa7f5c-6f12-4d4a-a07b-f2893461eb6d",
          "name": "🔀 Tiene Plan Profesional?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            -2896,
            1120
          ]
        },
        {
          "parameters": {
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2320,
            1136
          ],
          "id": "0c01d0bb-d275-44be-9360-6241e29d2f95",
          "name": "Google Gemini Chat Model4",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-flash-lite-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2448,
            1136
          ],
          "id": "d8f772b8-2484-4aa3-9848-66e4be4a5616",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=={{ $json.body ? $json.body.message : 'Consulta del cliente ' + $json.Nombre + ': ' + $json.Descripcion }}",
            "needsFallback": true,
            "options": {
              "systemMessage": "=ERES EL ASISTENTE OFICIAL DE WEBCONAI. SOLO PUEDES RESPONDER CON LA INFORMACIÓN PROPORCIONADA AQUÍ.\n\n=== QUIÉNES SOMOS ===\nSomos WebConAi. Tu sitio web y tus tareas automatizadas para siempre. Usamos inteligencia artificial y herramientas como N8N para crear sitios web personalizados y sistemas que trabajan para ti. ¡Más productividad, menos esfuerzo!\n\n=== SERVICIOS WEBCONAI ===\n\n💡 PLAN LIGHT ($14.99):\n- Sitio web profesional con Google Sites o GitHub\n- Nombre de dominio personalizado www.tumarca.com *sujeto a disponibilidad\n- 5 pestañas incluidas\n- Opciones de diseño para tu marca\n- Entrega: 1-5 días aproximados\n\n🚀 PLAN PROFESIONAL ($24.99):\n- Todo lo del Plan Light +\n- Creación de cuentas Facebook, X, YouTube\n- 1 post diario, alerta de respuestas\n- Sugerencias de respuestas\n- Entrega: 2-7 días\n\n⭐ PLAN PREMIUM ($79.99):\n- Todo lo anterior +\n- Chatbot inteligente integrado\n- Bot de Telegram\n- Automatizaciones: control inventario, formularios ventas, bases datos, creación contenido, envío masivo, sistema citas/reservas\n- Entrega: 5-14 días\n\n💰 ADICIONALES:\n- Automatizaciones extra: desde $5/mes\n- Para hablar con una persona, favor de llenar formulario:  \n\n=== PROCESO DE CONTRATACIÓN ===\n1. Completa el formulario: https://www.webconai.com/solicita\n2. Te contactamos para confirmar detalles\n3. **Pago**: 3 meses por adelantado\n4. **Formas de pago**: PayPal, depósitos bancarios, criptomonedas, MercadoPago\n5. Desarrollo de tu proyecto\n6. Entrega final\n\n=== DESPUÉS DE LA ENTREGA ===\n- Tienes 3 consultas gratis incluidas\n- Contacto: contacto@webconai.com\n\n📞 CONTACTO: \n- Formulario: https://www.webconai.com/solicita\n- Email: contacto@webconai.com\n\n=== REGLAS ESTRICTAS ===\n1. SOLO información de arriba\n2. Si no está listado: \"Para esa consulta, completa nuestro formulario: https://www.webconai.com/solicita\"\n3. NO inventes información\n4. Máximo 150 palabras\n5. Español, profesional y amigable",
              "maxIterations": 4
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -2416,
            912
          ],
          "id": "27e3ec23-0963-440b-82ca-52c429746255",
          "name": "Contesta Correo"
        },
        {
          "parameters": {
            "fromEmail": "noreply@webconai.com",
            "toEmail": "={{ $('Google Sheets Trigger').item.json.email }}",
            "subject": "=Consulta WebConAi Para - {{ $('Google Sheets Trigger').item.json.nombre }}",
            "text": "=Hola {{ $('Google Sheets Trigger').item.json.nombre }},\n\nGracias por contactarnos. Hemos recibido tu consulta:\n\n{{ $json.output }}\n\nSi tienes mas preguntas puedes hacerlas directamente en: \nhttps://www.webconai.com/agenteia\nO si prefieres una consulta con una persona de nuestro equipo, llena el formulario seleccionando el paquete, detalles de tu proyecto y nos ponemos en contacto contigo.\n\nSaludos,\nEquipo WebConAi",
            "options": {}
          },
          "id": "b31cb305-ed42-45cd-b5ee-b82a0d0da06e",
          "name": "📧 Respuesta Consulta1",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -2080,
            912
          ],
          "webhookId": "6e7c1b04-d2f8-43d5-802a-fd609c1eb277",
          "credentials": {
            "smtp": {
              "id": "f3561gQKuV6bgmmX",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyHour"
                }
              ]
            },
            "documentId": {
              "__rl": true,
              "value": "1iaFxLaGwadQHtZxiEKcpwuAiFzn3MuItm-EHdy8WJeA",
              "mode": "list",
              "cachedResultName": "FormWebCo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iaFxLaGwadQHtZxiEKcpwuAiFzn3MuItm-EHdy8WJeA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Leads",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iaFxLaGwadQHtZxiEKcpwuAiFzn3MuItm-EHdy8WJeA/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTrigger",
          "typeVersion": 1,
          "position": [
            -2896,
            912
          ],
          "id": "e1af9510-5e8e-4299-8aef-e0a62981eaf0",
          "name": "Google Sheets Trigger",
          "credentials": {
            "googleSheetsTriggerOAuth2Api": {
              "id": "cZo45ZjqHQdroFJd",
              "name": "Google Sheets Trigger account"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "dominio-seleccionado",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "fc42839c-5922-44c4-b1e4-0f2faa0cb151",
          "name": "Webhook Dominio",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -1616,
            1328
          ],
          "webhookId": "bf43b11d-9530-4cd5-aed5-c06df8940dcd"
        },
        {
          "parameters": {
            "fromEmail": "noreply@webconai.com",
            "toEmail": "admin@webconai.com",
            "subject": "🚨 CREAR SITIO - {{ $json.cliente }}",
            "options": {}
          },
          "id": "e522a60c-7251-44d2-80d7-b23d06a2fbd3",
          "name": "Email Admin",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -1392,
            1232
          ],
          "webhookId": "8b20885a-25ff-4f48-8e90-d6f8474dbb12"
        },
        {
          "parameters": {
            "fromEmail": "noreply@webconai.com",
            "toEmail": "{{ $json.email }}",
            "subject": "✅ Confirmado - Tu sitio está en creación",
            "options": {}
          },
          "id": "fa69a820-2684-4328-8f0e-64e2e4b88508",
          "name": "Email Cliente",
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2,
          "position": [
            -1392,
            1424
          ],
          "webhookId": "ab60e0e4-de56-4f4b-b19a-d11691e69cad"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "{\"status\": \"success\", \"message\": \"Pedido confirmado\"}",
            "options": {}
          },
          "id": "db50ece5-d59f-4d40-8de8-602eb6f48d20",
          "name": "Respuesta",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            -1168,
            1328
          ]
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "plantilla-seleccionada",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "c719ea7d-b36e-4e09-b558-8d40131ae6bf",
          "name": "Webhook Plantilla",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -1792,
            928
          ],
          "webhookId": "7e5470ac-071e-49aa-9c1d-6954deb20e96"
        },
        {
          "parameters": {
            "respondWith": "redirect",
            "redirectURL": "https://webconai.com/verificador-dominio?cliente={{ $json.cliente }}&email={{ $json.email }}&diseno={{ $json.diseno }}&pedido={{ $json.pedido_id }}",
            "options": {}
          },
          "id": "8c1e4e34-c390-4702-a60b-37d9c0634caf",
          "name": "Redirigir Dominio",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            -1568,
            928
          ]
        },
        {
          "parameters": {
            "jsCode": "const datos = $json;\n\nif (datos.plan_light === \"light\") {\n    const timestamp = Date.now();\n    const pedidoId = 'WCA-' + timestamp.toString().slice(-6);\n    const fechaLimite = new Date();\n    fechaLimite.setHours(fechaLimite.getHours() + 48);\n    \n    return {\n        json: {\n            nombre: datos.nombre || '',\n            email: datos.email || '',\n            telefono: datos.telefono || '',\n            descripcion: datos.descripcion || '',\n            logo: datos.logo || '',\n            colores: datos.colores || '',\n            pedido_id: pedidoId,\n            tipo_proceso: 'plan_light',\n            estado_proceso: 'plantilla_pendiente',\n            fecha_inicio: new Date().toISOString(),\n            fecha_limite: fechaLimite.toISOString(),\n            precio: 14.99,\n            selector_url: `https://webconai.com/selector?cliente=${encodeURIComponent(datos.nombre)}&email=${encodeURIComponent(datos.email)}&pedido=${pedidoId}`,\n            diseno_seleccionado: '',\n            dominio_elegido: '',\n            preview_url: '',\n            pagado: false,\n            revisiones_restantes: 3\n        }\n    };\n} else {\n    return { json: datos };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2656,
            1120
          ],
          "id": "872fc70b-cfcc-45c8-802c-63c37d823bbf",
          "name": "Code"
        }
      ],
      "connections": {
        "Google Gemini Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "Model Selector",
                "type": "ai_languageModel",
                "index": 2
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Model Selector",
                "type": "ai_languageModel",
                "index": 1
              }
            ]
          ]
        },
        "Google Gemini Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Model Selector",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Model Selector": {
          "ai_languageModel": [
            [
              {
                "node": "Chat Pagina",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Chat Pagina": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Chat Pagina",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "🔀 Solo Consulta?": {
          "main": [
            [
              {
                "node": "Contesta Correo",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "🔀 Tiene Plan Profesional?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model4": {
          "ai_languageModel": [
            [
              {
                "node": "Contesta Correo",
                "type": "ai_languageModel",
                "index": 1
              }
            ]
          ]
        },
        "🔀 Tiene Plan Profesional?": {
          "main": [
            [
              {
                "node": "📧 Email Plan Profesional1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Contesta Correo",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Contesta Correo": {
          "main": [
            [
              {
                "node": "📧 Respuesta Consulta1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets Trigger": {
          "main": [
            [
              {
                "node": "🔀 Solo Consulta?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook Dominio": {
          "main": [
            [
              {
                "node": "Email Admin",
                "type": "main",
                "index": 0
              },
              {
                "node": "Email Cliente",
                "type": "main",
                "index": 0
              },
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook Plantilla": {
          "main": [
            [
              {
                "node": "Redirigir Dominio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "📧 Email Plan Light1": {
          "main": [
            []
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "📧 Email Plan Light1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "PUjmFQBqKDXwf0XK"
      },
      "staticData": {
        "node:Google Sheets Trigger": {
          "documentId": "1iaFxLaGwadQHtZxiEKcpwuAiFzn3MuItm-EHdy8WJeA",
          "sheetId": 0,
          "lastRevision": 15,
          "lastRevisionLink": "https://docs.google.com/spreadsheets/export?id=1iaFxLaGwadQHtZxiEKcpwuAiFzn3MuItm-EHdy8WJeA&revision=15&exportFormat=xlsx"
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "3fc7f697-52e2-479e-9835-395730f50493",
      "triggerCount": 4,
      "shared": [
        {
          "updatedAt": "2025-09-29T03:09:07.105Z",
          "createdAt": "2025-09-29T03:09:07.105Z",
          "role": "workflow:owner",
          "workflowId": "PUjmFQBqKDXwf0XK",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-26T20:18:43.000Z",
      "createdAt": "2025-07-04T17:25:06.710Z",
      "id": "PgRV4DknLUpARI5W",
      "name": "AsistenteClientes",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "jsonMode": "expressionData",
            "jsonData": "={{ $json.data }}",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "=file_id",
                    "value": "={{ $('Set File ID').item.json.file_id }}"
                  }
                ]
              }
            }
          },
          "id": "f04c7e4c-0d97-4981-88a1-14408d18b5b2",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            -1620,
            540
          ]
        },
        {
          "parameters": {
            "name": "user_documents",
            "description": "Utiliza esta tool para contestar las preguntas que te hagan. Aqui tienes todos los documentos que puedes revisar para tener un contexto y contestar las preguntas del usuario"
          },
          "id": "31c692e2-6c51-4fb0-bfd2-947401b7733d",
          "name": "Retrieve Documents",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "typeVersion": 1,
          "position": [
            -1880,
            80
          ]
        },
        {
          "parameters": {
            "operation": "download",
            "fileId": {
              "__rl": true,
              "value": "={{ $('Set File ID').item.json.file_id }}",
              "mode": "id"
            },
            "options": {
              "googleFileConversion": {
                "conversion": {
                  "docsToFormat": "text/plain"
                }
              }
            }
          },
          "id": "e89b5899-4664-4801-b393-518066961492",
          "name": "Download File",
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -1960,
            480
          ],
          "executeOnce": true,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyMinute"
                }
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1OQwo2pIXVUDchblctmAd3URLzLgNwtgV",
              "mode": "list",
              "cachedResultName": "AsistenteClientes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1OQwo2pIXVUDchblctmAd3URLzLgNwtgV"
            },
            "event": "fileCreated",
            "options": {}
          },
          "id": "c602f911-58ed-4942-93e4-4c02657e3984",
          "name": "File Created",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "typeVersion": 1,
          "position": [
            -2520,
            460
          ],
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyMinute"
                }
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1OQwo2pIXVUDchblctmAd3URLzLgNwtgV",
              "mode": "list",
              "cachedResultName": "AsistenteClientes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1OQwo2pIXVUDchblctmAd3URLzLgNwtgV"
            },
            "event": "fileUpdated",
            "options": {
              "fileType": "all"
            }
          },
          "id": "33406321-11ad-45d9-a046-ce6b9962fca1",
          "name": "File Updated",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "typeVersion": 1,
          "position": [
            -2540,
            280
          ],
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "operation": "text",
            "options": {}
          },
          "id": "deddf3b7-c381-4e9a-84ee-09640f2f29a7",
          "name": "Extract Document Text",
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            -1780,
            400
          ],
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "tableName": "user_documents"
          },
          "id": "4c88a50f-21f6-4613-8e65-b8de10bac29f",
          "name": "Postgres Chat Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
          "typeVersion": 1,
          "position": [
            -2220,
            220
          ],
          "notesInFlow": false,
          "credentials": {
            "postgres": {
              "id": "j24zbTzefEUTw1dT",
              "name": "Postgres account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "id": "175b7778-f69c-4c49-baf7-fdc860fef5ea",
          "name": "Recursive Character Text Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "typeVersion": 1,
          "position": [
            -1340,
            680
          ]
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "documents",
            "filterType": "string",
            "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
          },
          "id": "5d2dd547-a7ca-40f7-b228-701cfc06a531",
          "name": "Delete Old Doc Rows",
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -2160,
            420
          ],
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
                  "name": "file_id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "id": "9707b0eb-b810-4ff7-9866-de080038165f",
          "name": "Set File ID",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2340,
            400
          ]
        },
        {
          "parameters": {
            "public": true,
            "options": {}
          },
          "id": "6b9848c9-20f6-4f82-8d15-7797827fcc97",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            -2500,
            20
          ],
          "webhookId": "e985d15f-b2f6-456d-be15-97e0b1544a40"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('When chat message received').item.json.chatInput }}",
            "options": {
              "systemMessage": "Eres un asistente personal que utiliza la tool retrieve documents para contestar las preguntas que se hagan. Limitate unicamente a contestar lo que se te pregunta con la informacion contenida en user_documents, en un tono amable y servicial. Si la pregunta no tiene informacion relacioanda con la informacion de user_documents, di que no entiendiste pero puedes hablar -y di algo relacionado con tu informaciòn. Contesta siempre en español."
            }
          },
          "id": "4dfc1beb-c183-4169-80ba-0c4c82c404b0",
          "name": "RAG AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.6,
          "position": [
            -2300,
            20
          ]
        },
        {
          "parameters": {
            "tableName": {
              "__rl": true,
              "value": "user_documents",
              "mode": "list",
              "cachedResultName": "user_documents"
            },
            "options": {}
          },
          "id": "05da1b7c-4699-4b45-a4e4-c98f2cfcf6ef",
          "name": "Supabase Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            -2120,
            240
          ],
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "documents",
              "mode": "list",
              "cachedResultName": "documents"
            },
            "options": {
              "queryName": "match_documents"
            }
          },
          "id": "a15c5f70-33f9-41c5-9b4a-32b992b36c49",
          "name": "Insert into Supabase Vectorstore",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            -1600,
            380
          ],
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-embedding-exp-03-07"
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1560,
            200
          ],
          "id": "0bbe42dc-5d2c-4244-bc60-c95537e447ca",
          "name": "Embeddings Google Gemini",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 300,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -2380,
            220
          ],
          "id": "2c1ab39d-6193-4c23-937b-9ded56249bec",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1760,
            220
          ],
          "id": "26166f40-e801-471c-bd47-ebc42ed7cec3",
          "name": "Google Gemini Chat Model1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-embedding-exp"
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1980,
            340
          ],
          "id": "881f43bb-9688-4b11-a332-b27435a09b6e",
          "name": "Embeddings Google Gemini1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        }
      ],
      "connections": {
        "Retrieve Documents": {
          "ai_tool": [
            [
              {
                "node": "RAG AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Download File": {
          "main": [
            [
              {
                "node": "Extract Document Text",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "File Created": {
          "main": [
            [
              {
                "node": "Set File ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract Document Text": {
          "main": [
            [
              {
                "node": "Insert into Supabase Vectorstore",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Insert into Supabase Vectorstore",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Postgres Chat Memory": {
          "ai_memory": [
            [
              {
                "node": "RAG AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Delete Old Doc Rows": {
          "main": [
            [
              {
                "node": "Download File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set File ID": {
          "main": [
            [
              {
                "node": "Delete Old Doc Rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "File Updated": {
          "main": [
            [
              {
                "node": "Set File ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "RAG AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store": {
          "ai_vectorStore": [
            [
              {
                "node": "Retrieve Documents",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ],
          "ai_tool": [
            []
          ]
        },
        "Insert into Supabase Vectorstore": {
          "main": [
            []
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Insert into Supabase Vectorstore",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "RAG AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Retrieve Documents",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:File Created": {
          "lastTimeChecked": "2025-10-24T19:35:08Z"
        },
        "node:File Updated": {
          "lastTimeChecked": "2025-10-24T19:35:08Z"
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "b9cddeb7-80e8-4c40-b798-2f328556f989",
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-07-04T17:25:06.723Z",
          "createdAt": "2025-07-04T17:25:06.723Z",
          "role": "workflow:owner",
          "workflowId": "PgRV4DknLUpARI5W",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-27T04:46:44.000Z",
      "createdAt": "2025-08-22T20:24:24.058Z",
      "id": "RfTxRzEODNOWDvhi",
      "name": "cart",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "iacaja",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            832,
            -464
          ],
          "id": "9aeebe34-241f-4e7e-b350-4ff896d3af6f",
          "name": "API",
          "webhookId": "replace_on_deploy_main_api"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' ');\n\nconst intencion = parts[0];\nconst id = parts[1] ? parts[1].toUpperCase() : undefined;\nconst cant = parts[2] ? Number(parts[2]) : undefined;\n\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cant: cant\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1008,
            -464
          ],
          "id": "d10e048d-2b3e-48c0-8077-5c4b3a898a84",
          "name": "Input_Parse"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            688,
            -256
          ],
          "id": "c4da60af-8ea2-48dd-b99d-c30d43100f46",
          "name": "Gemini_LLM",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Intencion={{ $json.intencion }} Id={{ $json.id }} Cantidad:={{ $json.cant }}",
            "options": {
              "systemMessage": "Eres el centro de control de una caja registradora. Tu única función es delegar tareas a tus herramientas especializadas según la intención del usuario.\n\nInstrucciones:\n\nSi la intención es \"finalizar\", usa la herramienta Compra.\n\nSi la intención es \"añadir\" o \"modificar\", usa la herramienta Item_Agent.\n\nSi la intención es \"ver\", usa la herramienta Ver.\n\nSi la intención es \"vaciar\", usa la herramienta Vaciar.\n\nFormato de entrada: Un objeto JSON con las claves intencion, id y cant.\nFormato de salida: La salida generada por la herramienta que hayas utilizado.\n\nRestricciones: No realices ninguna operación directamente; tu única tarea es decidir qué herramienta usar y pasarle la información."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            880,
            -256
          ],
          "id": "9da2eecc-7b42-4ae4-87f6-492e32fe0482",
          "name": "Caja_Agente"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            1184,
            -80
          ],
          "id": "a69e13b3-69ce-4300-b7f9-692e52fccbc4",
          "name": "Salida"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            224,
            -448
          ],
          "id": "55d60c49-ce77-4074-ad3e-a01661812243",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            208,
            -304
          ],
          "id": "42a1d41f-de79-4693-a403-0a7c9e3c2200",
          "name": "Buscar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            336,
            -288
          ],
          "id": "cc35d096-66ce-4fb6-882e-c5f64ade61a6",
          "name": "carrito",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}",
                "producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('producto', ``, 'string') }}",
                "cantidad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cantidad', ``, 'string') }}",
                "precio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('precio', ``, 'string') }}",
                "total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('total', ``, 'string') }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            448,
            -272
          ],
          "id": "eb91b8e9-b008-45d4-a5fc-fdcfff4655c1",
          "name": "Actualizar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', ``, 'string') }}",
                "producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('producto', ``, 'string') }}",
                "cantidad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cantidad', ``, 'string') }}",
                "precio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('precio', ``, 'string') }}",
                "total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('total', ``, 'string') }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            560,
            -256
          ],
          "id": "1f4e081e-3cb7-400e-b9fa-3b1c282464fb",
          "name": "Añadir",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            304,
            80
          ],
          "id": "556cf552-211c-4179-908a-26661eb3c264",
          "name": "Google Gemini Chat Model1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Te especializas en limpiar el carrito",
            "text": "{}",
            "options": {
              "systemMessage": "Eres un agente de limpieza. Tu función es vaciar completamente el carrito de compras.\n\nInstrucciones:\n\n    Borra todo el contenido de la hoja de cálculo del carrito, excepto la fila de encabezados.\n\n    Confirma que la acción se ha completado con éxito.\n\nFormato de entrada: Un objeto vacío {}.\nFormato de salida: Un mensaje de confirmación, como \"El carrito ha sido vaciado\".\nRestricciones: No puedes ver el contenido del carrito ni realizar ninguna otra operación. Solo te encargas de vaciarlo."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            816,
            -32
          ],
          "id": "8804c2dc-fc21-40db-be3b-73cd0542eb63",
          "name": "Vaciar"
        },
        {
          "parameters": {
            "toolDescription": "Se especializa en finalizar la compra, registrar ventas y actualizar stock.",
            "text": "{}",
            "options": {
              "systemMessage": "Eres un agente de ventas. Tu función es finalizar la compra, registrar la transacción y actualizar el inventario.\n\nInstrucciones:\n\n    Lee todo el contenido de la hoja de cálculo del carrito.\n\n    Por cada ítem en el carrito:\n\n        Registra la venta en la hoja de ventas (addSaleItem).\n\n        Busca el ítem en la hoja de stock (stock) y resta la cantidad vendida.\n\n        Actualiza el stock (addstock1).\n\n    Finalmente, vacía el carrito de compras (LimpiarCarrito1).\n\nFormato de entrada: Un objeto vacío {}.\nFormato de salida: Un mensaje de confirmación de la venta, como \"Compra finalizada. El carrito ha sido vaciado y el stock actualizado\".\nRestricciones: Esta es la última acción en el proceso de compra. No puedes añadir o modificar ítems en el carrito."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            1264,
            -464
          ],
          "id": "a13d8c6f-9b91-4976-838e-04115dacd87d",
          "name": "Compra"
        },
        {
          "parameters": {
            "toolDescription": "Un Agente Herramienta genérico para funcionalidades adicionales (Internet, Pagos, Reportes). El Agente Maestro le diría qué acción específica debe realizar.",
            "text": "{\"accion_extra\": \"string\"}",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            1472,
            -80
          ],
          "id": "67b7fb08-9f5b-498c-b955-60a635b216a9",
          "name": "Extra"
        },
        {
          "parameters": {
            "toolDescription": "Te especializas en mostrar el contenido completo del carrito y su total.",
            "text": "{}",
            "options": {
              "systemMessage": "Eres un agente especializado en mostrar el contenido del carrito.\n\nInstrucciones:\n\n    Lee la hoja de cálculo del carrito.\n\n    Suma el total de todos los ítems para obtener el total de la compra.\n\n    Genera una respuesta clara que muestre cada ítem con su cantidad y precio, junto con el total final.\n\nFormato de entrada: Un objeto vacío {}.\nFormato de salida: Un mensaje de texto detallado con la lista de productos y el total.\nRestricciones: No puedes añadir, modificar ni vaciar el carrito. Solo puedes ver su contenido."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            384,
            -80
          ],
          "id": "ff00bf16-96f7-4807-954b-23d6acc5df52",
          "name": "Ver"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            688,
            176
          ],
          "id": "867c236e-8c2c-4c12-8265-5dc82c015dac",
          "name": "Google Gemini Chat Model2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            560,
            80
          ],
          "id": "e80a0fde-7cff-44ec-886d-4dd8a4681836",
          "name": "carrito1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "clear",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "keepFirstRow": true
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1088,
            112
          ],
          "id": "1c1da36d-b2ce-4f79-98e6-8d78c67f1337",
          "name": "LimpiarCarrito",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            1216,
            -320
          ],
          "id": "4e6a3520-3695-45d4-ba24-b797601224f4",
          "name": "Google Gemini Chat Model3",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1648,
            -432
          ],
          "id": "83d82d1e-63a3-485b-bb4d-762bf5eb56de",
          "name": "carrito2",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1203437505,
              "mode": "list",
              "cachedResultName": "ventas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=1203437505"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha', ``, 'string') }}",
                "producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('producto', ``, 'string') }}",
                "cantidad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cantidad', ``, 'string') }}",
                "precio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('precio', ``, 'string') }}",
                "total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('total', ``, 'string') }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "fecha",
                  "displayName": "fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1648,
            -304
          ],
          "id": "7c836d8d-6d97-4bad-b8a2-dcdfab2e2684",
          "name": "addSaleItem",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                },
                {
                  "lookupColumn": "stock",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values1_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1440,
            -256
          ],
          "id": "0d576870-ff3c-49ab-9d75-fda0630f849d",
          "name": "stock",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}",
                "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}",
                "precio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('precio', ``, 'string') }}",
                "stock": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('stock', ``, 'string') }}",
                "max": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('max', ``, 'string') }}",
                "min": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('min', ``, 'string') }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "nombre",
                  "displayName": "nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "stock",
                  "displayName": "stock",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "max",
                  "displayName": "max",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "min",
                  "displayName": "min",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1328,
            -272
          ],
          "id": "200344df-9796-4690-b58c-485a8f1b951a",
          "name": "addstock1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "clear",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "keepFirstRow": true
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            1536,
            -288
          ],
          "id": "8f6f09f1-995e-40d5-a688-9fb624c4a75c",
          "name": "LimpiarCarrito1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            1344,
            128
          ],
          "id": "35eef29f-ae6f-45f3-9796-7e5682caef25",
          "name": "Google Gemini Chat Model4",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Agente Herramienta se especializa en todo lo relacionado con añadir o modificar ítems individuales en el carrito. El Agente Maestro lo llamaría cuando la intencion sea añadir o modificar",
            "text": "={{ $fromAI('Prompt__User_Message_', ``, 'string') }}",
            "options": {
              "systemMessage": "Eres un agente especializado en gestionar ítems en el carrito de compras. Tu función es añadir o modificar productos en el carrito.\n\nInstrucciones:\n\n    Si la accion es \"añadir\": Busca el producto por id en el catálogo, verifica su precio y luego añade el id y la cant al carrito.\n\n    Si la accion es \"modificar\": Busca el producto por id en el carrito y actualiza su cant.\n\n    Calcula el total multiplicando el precio por la cant.\n\nFormato de entrada: Un objeto JSON con las claves id, cant y accion.\nFormato de salida: La información del ítem añadido/modificado, incluyendo id, producto, cantidad, precio y total.\nRestricciones: No puedes ver el carrito completo ni finalizar la compra. Solo te encargas de la gestión de ítems individuales."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agentTool",
          "typeVersion": 2.2,
          "position": [
            432,
            -432
          ],
          "id": "8de63c7f-c44b-4a5d-9ab0-2522f5d423a6",
          "name": "Item_Agent"
        }
      ],
      "connections": {
        "API": {
          "main": [
            [
              {
                "node": "Input_Parse",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Input_Parse": {
          "main": [
            [
              {
                "node": "Caja_Agente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gemini_LLM": {
          "ai_languageModel": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Caja_Agente": {
          "main": [
            [
              {
                "node": "Salida",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Item_Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "ai_tool": [
            [
              {
                "node": "Item_Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "carrito": {
          "ai_tool": [
            [
              {
                "node": "Item_Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Actualizar": {
          "ai_tool": [
            [
              {
                "node": "Item_Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Añadir": {
          "ai_tool": [
            [
              {
                "node": "Item_Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Ver",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar": {
          "ai_tool": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Compra": {
          "ai_tool": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Extra": {
          "ai_tool": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Ver": {
          "ai_tool": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Vaciar",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "carrito1": {
          "ai_tool": [
            [
              {
                "node": "Ver",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarCarrito": {
          "ai_tool": [
            [
              {
                "node": "Vaciar",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "Compra",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "carrito2": {
          "ai_tool": [
            [
              {
                "node": "Compra",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "addSaleItem": {
          "ai_tool": [
            [
              {
                "node": "Compra",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "stock": {
          "ai_tool": [
            [
              {
                "node": "Compra",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "addstock1": {
          "ai_tool": [
            [
              {
                "node": "Compra",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarCarrito1": {
          "ai_tool": [
            [
              {
                "node": "Compra",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model4": {
          "ai_languageModel": [
            [
              {
                "node": "Extra",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Item_Agent": {
          "ai_tool": [
            [
              {
                "node": "Caja_Agente",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "API": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
                "content-length": "27",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "97551db8ce5cd949-AMS",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "8bfa490a-de42-4a98-a90b-b7d24e51ba6b",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Not;A=Brand\";v=\"99\", \"Google Chrome\";v=\"139\", \"Chromium\";v=\"139\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "message": "añadir cop 1"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/iacaja",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "7994fb11-962b-40a6-a545-420dd950c4bd",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-22T20:24:24.066Z",
          "createdAt": "2025-08-22T20:24:24.066Z",
          "role": "workflow:owner",
          "workflowId": "RfTxRzEODNOWDvhi",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-06T21:12:16.000Z",
      "createdAt": "2025-08-06T05:51:21.571Z",
      "id": "RzwFwMTqQ4eWMQtt",
      "name": "My workflow 2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "mode": "insert",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {}
          },
          "id": "64e20ffd-1d8c-4677-a5de-80f8d13ad0f4",
          "name": "Pinecone Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            -288,
            704
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {},
          "id": "7a2cc4ef-28df-41df-a212-416641a57141",
          "name": "Embeddings Google Gemini",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            -496,
            992
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "dataType": "binary",
            "binaryMode": "specificField",
            "options": {}
          },
          "id": "5bcc2b40-bb9f-47c4-8b03-6b3b733327d3",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "position": [
            -176,
            880
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "chunkOverlap": 100,
            "options": {}
          },
          "id": "abeb1589-258f-4fd2-ae2b-1c6a7891c24c",
          "name": "Recursive Character Text Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "position": [
            -336,
            1008
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Eres un asistente muy utili diseñado para responder a las preguntas de las personas basándose en la informacion de la empresa.\n\nContesta de forma corta y concisa\n\nRecupera la información relevante de los documentos internos proporcionados y ofrece una respuesta concisa, precisa e informativa a la pregunta del empleado.\n\nUtiliza la herramienta llamada \"company_documents_tool\" para recuperar cualquier información de los documentos de la empresa.\n\nSi la respuesta no se encuentra en los documentos proporcionados, responde con \"No puedo encontrar la respuesta en los recursos disponibles\"."
            }
          },
          "id": "8b7e7d49-4836-4f75-ba85-7154c0795378",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            240,
            480
          ],
          "typeVersion": 1.7
        },
        {
          "parameters": {
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {}
          },
          "id": "eaa0b6c0-96b3-4e64-9478-ccfe6a190fa3",
          "name": "Pinecone Vector Store (Retrieval)",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            176,
            864
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {},
          "id": "2ef5dfe6-7bdb-4f4d-817d-49bbaeb71889",
          "name": "Embeddings Google Gemini (retrieval)",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            80,
            1008
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "operation": "download",
            "fileId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {
              "fileName": "={{ $json.name }}"
            }
          },
          "id": "ba6a859d-d32e-4732-aca3-e322d46ee985",
          "name": "Download File From Google Drive",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            -256,
            480
          ],
          "typeVersion": 3,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyMinute"
                }
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1OQwo2pIXVUDchblctmAd3URLzLgNwtgV",
              "mode": "list",
              "cachedResultName": "AsistenteClientes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1OQwo2pIXVUDchblctmAd3URLzLgNwtgV"
            },
            "event": "fileUpdated",
            "options": {}
          },
          "id": "bdb5eb09-0c7a-44e9-a416-ba890598902b",
          "name": "Google Drive File Updated",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "position": [
            -496,
            704
          ],
          "typeVersion": 1,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {}
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2",
              "mode": "list",
              "cachedResultName": "agente",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2"
            },
            "event": "fileCreated",
            "options": {
              "fileType": "all"
            }
          },
          "id": "269fc662-0981-4e05-9ff1-880213bf88a1",
          "name": "Google Drive File Created",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "position": [
            -496,
            480
          ],
          "typeVersion": 1,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {},
          "id": "4054d626-46be-43c8-ab13-9f1e5d5f1e3d",
          "name": "Window Buffer Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            272,
            672
          ],
          "typeVersion": 1.3
        },
        {
          "parameters": {
            "options": {}
          },
          "id": "68c475df-9a55-4ba3-bcfe-e50c4cb19b79",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            0,
            480
          ],
          "webhookId": "5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd",
          "typeVersion": 1.1
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "id": "10d0e892-24ab-45b6-9ad1-8334bf1f9c91",
          "name": "Google Gemini Chat Model (retrieval)",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            544,
            880
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            112,
            688
          ],
          "id": "a9bb7b3c-274b-4f40-9457-76397026ee19",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "name": "company_documents_tool",
            "description": "Recupera infromacion importante de la empresa para contestar todas las preguntas que se te hagan y proporcionar la informacion que se te pida"
          },
          "id": "c3f463c3-3cb1-4c2b-a7fd-2e0ef5cb6c53",
          "name": "company_documents_tool",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "position": [
            432,
            672
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chat",
          "typeVersion": 1,
          "position": [
            592,
            480
          ],
          "id": "cd65f089-2785-4b52-b29b-cf8747e48217",
          "name": "Respond to Chat"
        }
      ],
      "connections": {
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Window Buffer Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive File Created": {
          "main": [
            [
              {
                "node": "Download File From Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive File Updated": {
          "main": [
            [
              {
                "node": "Download File From Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download File From Google Drive": {
          "main": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pinecone Vector Store (Retrieval)": {
          "ai_vectorStore": [
            [
              {
                "node": "company_documents_tool",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini (retrieval)": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store (Retrieval)",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model (retrieval)": {
          "ai_languageModel": [
            [
              {
                "node": "company_documents_tool",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "company_documents_tool": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Respond to Chat",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a1e9b396-4d2f-42de-9cfb-d41787efd049",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-06T05:51:21.579Z",
          "createdAt": "2025-08-06T05:51:21.579Z",
          "role": "workflow:owner",
          "workflowId": "RzwFwMTqQ4eWMQtt",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-27T17:27:24.000Z",
      "createdAt": "2025-08-28T02:42:01.061Z",
      "id": "Tefw1eO0ruiUPFkh",
      "name": "PagosStaCruz",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Ingresa la Cantidad",
            "formDescription": "Comision $12 - hasta $500 pesos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number",
                  "requiredField": true
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "$$",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -80,
            -272
          ],
          "id": "2ad88466-f85f-4d08-a049-a600807f063d",
          "name": "Pagos",
          "webhookId": "0a5ac401-9e1c-4f85-843a-69fb3d2ee3b9"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fcbda645-422f-486b-8a2c-498699da4557",
                  "name": "comision",
                  "value": "={{ $json.Cantidad < 500 ? 12 : Math.floor(($json.Cantidad - 1) / 500) * 12 + 12 }}",
                  "type": "number"
                },
                {
                  "id": "ae729a97-b6c6-4fc7-97d8-2ccb130a156d",
                  "name": "Cantidad",
                  "value": "={{ $json.Cantidad }}",
                  "type": "number"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            176,
            -224
          ],
          "id": "9a8101a5-46ba-4a77-8cc7-cf173c1ecbcc",
          "name": "CalculaTotal"
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "PAGO"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "Pagos y envios"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "=1"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $('Pagos').item.json.Cantidad + $json.comision }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.comision + $json.Cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -16,
            0
          ],
          "id": "94efc920-288b-480b-a57f-23541db691af",
          "name": "AgregaCart",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Agregado al Carrito - Presiona Ver Carrito",
            "completionMessage": "=Para finaliza la venta. Total = {{ $json.precio }}",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            272,
            112
          ],
          "id": "277eba0b-ff45-4e7e-89c7-ba3bb6ae4f75",
          "name": "Total",
          "webhookId": "a386e678-2b7b-4ec2-a187-e267a2ef0dd5"
        }
      ],
      "connections": {
        "Pagos": {
          "main": [
            [
              {
                "node": "CalculaTotal",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CalculaTotal": {
          "main": [
            [
              {
                "node": "AgregaCart",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgregaCart": {
          "main": [
            [
              {
                "node": "Total",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Pagos": [
          {
            "json": {
              "Cantidad": 279,
              "submittedAt": "2025-09-09T23:32:24.816-04:00",
              "formMode": "production"
            }
          }
        ]
      },
      "versionId": "9da6eb71-8b61-4e36-8d5f-9f3131e1582d",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-28T02:42:01.065Z",
          "createdAt": "2025-08-28T02:42:01.065Z",
          "role": "workflow:owner",
          "workflowId": "Tefw1eO0ruiUPFkh",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-18T01:54:28.000Z",
      "createdAt": "2025-08-06T02:50:04.447Z",
      "id": "Uyj64rW1wKYJkCe4",
      "name": "RagPinecone",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "mode": "insert",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {}
          },
          "id": "3493b197-3945-464b-9a0c-3a79db353b10",
          "name": "Pinecone Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            160,
            448
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {},
          "id": "50e8c651-16fb-4a60-8325-3c4508623ca4",
          "name": "Embeddings Google Gemini",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            -48,
            672
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "dataType": "binary",
            "binaryMode": "specificField",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "contrata"
                  }
                ]
              }
            }
          },
          "id": "6c8dccab-b4f7-4414-a7e6-418fc42ad09c",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "position": [
            144,
            640
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "chunkOverlap": 100,
            "options": {}
          },
          "id": "a99df9d1-22a7-457b-b05d-fef4015290f9",
          "name": "Recursive Character Text Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "position": [
            368,
            736
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Eres un asistente diseñado para contestar preguntas y proporcionar información de la empresa albored y los servicios que ofrece\nRecupera la información relevante del documento interno y proporciona una respuesta con información precisa, concisa a la pregunta recibida\n\nUsa la herramienta llamada Vector Store Tool o document_tool, para recabar información y contestar las respuestas,\n\nApegate a la informacion encontrada, no inventes, exageres ni digas otras cosas que no esten en el documento.\n \nSi la respuesta no se encuentra en el documento proporcionado, responde con \"No tengo información al respecto\"\nContesta siempre en español"
            }
          },
          "id": "bc79ad26-d548-45fa-ac18-1864eab87341",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            800,
            208
          ],
          "typeVersion": 1.7,
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "name": "document_tool",
            "description": "Proporciona la informacion para dar respuestas precisas utilizando vector store"
          },
          "id": "a625adf7-60a8-40b0-85f3-ad43f64fd2a7",
          "name": "Vector Store Tool",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "position": [
            944,
            448
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {}
          },
          "id": "e4c13561-c4d4-4127-8e49-1aa86ff67eed",
          "name": "Pinecone Vector Store (Retrieval)",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            512,
            640
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {},
          "id": "9ff34df8-0762-4e42-a743-a8234c4ac218",
          "name": "Embeddings Google Gemini (retrieval)",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            912,
            672
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "operation": "download",
            "fileId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {
              "fileName": "={{ $json.name }}"
            }
          },
          "id": "a5a19be3-c41f-4f11-9854-f060d4365490",
          "name": "Download File From Google Drive",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            192,
            208
          ],
          "typeVersion": 3,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyHour"
                }
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1OQwo2pIXVUDchblctmAd3URLzLgNwtgV",
              "mode": "list",
              "cachedResultName": "AsistenteClientes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1OQwo2pIXVUDchblctmAd3URLzLgNwtgV"
            },
            "event": "fileUpdated",
            "options": {}
          },
          "id": "9f72b2ca-f3e9-4799-8df8-738df674a6ca",
          "name": "Google Drive File Updated",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "position": [
            -112,
            416
          ],
          "typeVersion": 1,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyHour"
                }
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2",
              "mode": "list",
              "cachedResultName": "agente",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2"
            },
            "event": "fileCreated",
            "options": {
              "fileType": "all"
            }
          },
          "id": "69effe1c-3772-4a67-925f-09e195e8fc5c",
          "name": "Google Drive File Created",
          "type": "n8n-nodes-base.googleDriveTrigger",
          "position": [
            -112,
            208
          ],
          "typeVersion": 1,
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {},
          "id": "427a621d-35be-4ef7-be39-78748fea1fd4",
          "name": "Window Buffer Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            768,
            448
          ],
          "typeVersion": 1.3
        },
        {
          "parameters": {
            "options": {
              "allowFileUploads": true
            }
          },
          "id": "6ef9e23f-ce9b-4134-bc4f-d004a81e84cc",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            576,
            208
          ],
          "webhookId": "5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd",
          "typeVersion": 1.1
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "id": "014fd4c2-e7e8-4744-b262-d3be0294ad64",
          "name": "Google Gemini Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            592,
            432
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "id": "19dedb03-5bc1-407c-9921-c653515d0853",
          "name": "Google Gemini Chat Model (retrieval)",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            1104,
            672
          ],
          "typeVersion": 1,
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        }
      ],
      "connections": {
        "Vector Store Tool": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Window Buffer Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive File Created": {
          "main": [
            [
              {
                "node": "Download File From Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive File Updated": {
          "main": [
            [
              {
                "node": "Download File From Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download File From Google Drive": {
          "main": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pinecone Vector Store (Retrieval)": {
          "ai_vectorStore": [
            [
              {
                "node": "Vector Store Tool",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini (retrieval)": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store (Retrieval)",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model (retrieval)": {
          "ai_languageModel": [
            [
              {
                "node": "Vector Store Tool",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "2192331c-fe1b-4b95-8553-20fa88ced1f4",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-06T02:50:04.453Z",
          "createdAt": "2025-08-06T02:50:04.453Z",
          "role": "workflow:owner",
          "workflowId": "Uyj64rW1wKYJkCe4",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-12T17:55:33.000Z",
      "createdAt": "2025-09-12T17:26:11.995Z",
      "id": "VMfdCbfQBcAAwrQn",
      "name": "box copy",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "carrit2",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            3040,
            3136
          ],
          "id": "0c0818f2-75db-4667-beed-fbbc0fed1fba",
          "name": "Caja",
          "webhookId": "c75e15eb-a8fa-484f-b5cb-140e543f0013"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "52fd61d2-793b-4707-9bf0-a626728cca37",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            3392,
            3120
          ],
          "id": "a05c03ea-28a4-470f-a2d2-402c43e05913",
          "name": "Switch"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('Find').item.json }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4000,
            2944
          ],
          "id": "b924daf9-b361-4163-bfca-03bf695aa11e",
          "name": "If"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('Buscar').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('Buscar').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('Buscar').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Switch').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                },
                {
                  "id": "35d3b039-5e40-4f1c-9cf5-d2f3ac1d9b1c",
                  "name": "",
                  "value": "={{ $json.length > 0 }}",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": false
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3776,
            2944
          ],
          "id": "f5a50108-00b3-44be-96cd-09c25a7bdebe",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            4480,
            3408
          ],
          "id": "577ee214-8bbd-40c5-84cd-fac90ad8aac5",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "da24ee7f-0719-4be1-ae5c-d6d601393539",
                  "name": "text",
                  "value": "Producto añadido/actualizado al carrito.",
                  "type": "string"
                },
                {
                  "id": "329742e7-97b9-4ad9-9858-12b361dd1471",
                  "name": "currentCart",
                  "value": "={{ $('total').item.json.currentCart }}",
                  "type": "array"
                },
                {
                  "id": "cart-total-fixed",
                  "name": "cartTotal",
                  "value": "={{ $json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "add-update-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4448,
            3136
          ],
          "id": "6c8cafd8-c9c3-4225-9b00-8cf35df94842",
          "name": "Add/Update Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "vaciar-text",
                  "name": "text",
                  "value": "El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "vaciar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "vaciar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "vaciar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4016,
            3360
          ],
          "id": "88a4d4cb-09d5-4ff9-805b-dc645b8673ab",
          "name": "Vaciar Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "error-text",
                  "name": "text",
                  "value": "Ha ocurrido un error inesperado.",
                  "type": "string"
                },
                {
                  "id": "error-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "error-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "error-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4208,
            3408
          ],
          "id": "f5d59584-0b25-4e61-ba5e-a34de7b49d98",
          "name": "Error Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "viewcar-text",
                  "name": "text",
                  "value": "Contenido actual del carrito:",
                  "type": "string"
                },
                {
                  "id": "viewcar-current-cart",
                  "name": "currentCart",
                  "value": "={{ $json.currentCart }}",
                  "type": "array"
                },
                {
                  "id": "viewcar-cart-total",
                  "name": "cartTotal",
                  "value": "={{ $json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "viewcar-type",
                  "name": "type",
                  "value": "info",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4320,
            3264
          ],
          "id": "b3839559-0359-401d-9949-f09e3f61a7dc",
          "name": "View Cart Response"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            4448,
            2944
          ],
          "id": "25cc52b0-979f-4beb-b41d-51da756772d3",
          "name": "Merge"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' '); // Esto dividirá la cadena por espacios\n\nconst intencion = parts[0];\nconst id = parts[1];\nconst cantidad = parts[2];\n\n// Devolver un nuevo objeto JSON con las variables separadas\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            3216,
            3136
          ],
          "id": "fd2beb04-55da-47cc-804e-87d112f7e32f",
          "name": "Intencion"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "not-found-text",
                  "name": "text",
                  "value": "={{ $json.mergedText }}",
                  "type": "string"
                },
                {
                  "id": "not-found-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "not-found-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "not-found-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4000,
            3120
          ],
          "id": "212f5088-1f11-4924-95cf-94382b712d6f",
          "name": "Product Not Found Response"
        },
        {
          "parameters": {
            "jsCode": "const result = [];\nfor (const item of items) {\n    result.push(`ID: ${item.json.id}, ${item.json.nombre}, Precio: ${item.json.precio}`);\n}\nreturn [{ json: { mergedText: result.join('\\n') } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            3776,
            3120
          ],
          "id": "9edb3ff0-9ddb-4a19-8751-6741ef6a2895",
          "name": "Code",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "jsCode": "// El nodo de código recibirá la información del nodo anterior,\n// que puede ser 'Update' o 'Create a row'.\n// El array `items` contendrá los datos del nodo que se ejecutó.\n\nlet productData = null;\n\n// Buscamos si existe la información del producto actualizado (nodo Update)\n// Si no, buscamos la del producto recién creado (nodo Create a row)\nif (items[0] && items[0].json && items[0].json.cantidad) {\n    productData = items[0].json;\n} else if (items[0] && items[0].json && items[0].json.body && items[0].json.body.cantidad) {\n    // Esto podría ser necesario si la respuesta de Create a row es diferente\n    // y la cantidad está dentro de un 'body' o similar\n    productData = items[0].json.body;\n}\n\n// Aquí es donde obtenemos la información del producto original del nodo 'Buscar'\n// para obtener el nombre y el precio, ya que 'Update' y 'Create' solo\n// manejan los datos del carrito (cantidad, id del producto).\nconst originalProductData = items.find(item => item.json.nombre);\nconst nombreProducto = originalProductData.json.nombre;\nconst precioUnitario = originalProductData.json.precio;\n\n// Si no se encuentra la información, detenemos el flujo con un error\nif (!productData || !nombreProducto || !precioUnitario) {\n    return [{ json: { error: 'No se pudo obtener la información completa del producto para el cálculo.' } }];\n}\n\nconst idProducto = productData.id;\nconst nuevaCantidad = productData.cantidad;\n\nconst totalItem = nuevaCantidad * precioUnitario;\n\n// Preparamos la respuesta final que será enviada\nreturn [{\n  json: {\n    text: `¡Listo! Se ha añadido o actualizado tu producto.`,\n    product_details: `Producto: ${nombreProducto} (ID: ${idProducto}), Cantidad: ${nuevaCantidad}, Total: $${totalItem.toFixed(2)}`,\n    cartTotal: totalItem.toFixed(2), // Este valor es solo el total del ítem, no del carrito completo\n    type: \"success\"\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4160,
            3248
          ],
          "id": "77458e03-145c-42e4-9c55-95859ff314d9",
          "name": "total"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "product",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Switch').item.json.id.toUpperCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3120,
            2944
          ],
          "id": "8fdd99c4-7e5d-49ff-be6c-14fbbff77b9b",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Buscar').item.json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3552,
            2944
          ],
          "id": "78fd9354-22e4-49d4-84bb-813cbf36eb9a",
          "name": "Find",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "={{ $json.id }}"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $json.nombre }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.precio * $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4224,
            2928
          ],
          "id": "fea433b9-1e35-43f2-b80d-e16a206319b1",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "product",
            "filters": {
              "conditions": [
                {
                  "keyName": "nombre",
                  "condition": "fullText",
                  "searchFunction": "plfts",
                  "keyValue": "={{ $('Switch').item.json.id.toLowerCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3568,
            3120
          ],
          "id": "7683899e-2e44-4ab5-b249-aad56fffcead",
          "name": "BuscaNombre",
          "alwaysOutputData": false,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $json.id.toUpperCase() }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3616,
            3280
          ],
          "id": "46c0b144-231d-440d-bc82-f4347e6b3815",
          "name": "Modifica",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $('Buscar').item.json.id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $('Find').item.json.cantidad + $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4224,
            3088
          ],
          "id": "8ddd93aa-3a3c-492e-b32a-7fc9066b7ed7",
          "name": "Update",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3104,
            3296
          ],
          "id": "1732ac7d-d139-4d20-9c9b-995c7b0ab2f3",
          "name": "TraerCarrito",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $('Buscar').item.json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            3344,
            2944
          ],
          "id": "a46167d7-263e-45b0-a9c0-f956bdb1175d",
          "name": "existe?",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "cart",
            "filterType": "string",
            "filterString": "id=not.is.null"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3824,
            3280
          ],
          "id": "f401e728-8f0d-4865-8e3a-dfe5703373db",
          "name": "Delete a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5f4d63ef-8888-4fc9-9d59-d0ea3b0062f0",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            3264,
            3376
          ],
          "id": "cbad14e0-ffa3-4f64-9aa8-d573e8f8af29",
          "name": "If1"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            3648,
            3424
          ],
          "id": "f8b3d2a8-7ebd-4bd6-a7d9-077d917e1419",
          "name": "No Operation, do nothing"
        },
        {
          "parameters": {
            "tableId": "sales",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "Producto",
                  "fieldValue": "={{ $json.product_id }}"
                },
                {
                  "fieldId": "Cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.total }}"
                },
                {
                  "fieldId": "Precio",
                  "fieldValue": "={{ $json.precio }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3472,
            3408
          ],
          "id": "656453d2-8d09-41ee-b1b9-41f57716b9a9",
          "name": "Create a row1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        }
      ],
      "connections": {
        "Caja": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modifica",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete a row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "TraerCarrito",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "total",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add/Update Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "View Cart Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "total",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Product Not Found Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Product Not Found Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "total": {
          "main": [
            [
              {
                "node": "View Cart Response",
                "type": "main",
                "index": 0
              },
              {
                "node": "Add/Update Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaNombre": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modifica": {
          "main": [
            [
              {
                "node": "total",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "TraerCarrito": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?": {
          "main": [
            [
              {
                "node": "BuscaNombre",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Find",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row": {
          "main": [
            [
              {
                "node": "Vaciar Response",
                "type": "main",
                "index": 0
              },
              {
                "node": "total",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Vaciar Response",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing": {
          "main": [
            [
              {
                "node": "Delete a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row1": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Caja": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36",
                "content-length": "27",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "97e122632bcee608-IAD",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "79b7f9c9-c086-45c3-9ced-2a125344eb85",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "message": "añadir cop 1"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/carrit2",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "0955b25d-0f20-452d-a688-e7ecc7d06811",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-12T17:26:12.003Z",
          "createdAt": "2025-09-12T17:26:12.003Z",
          "role": "workflow:owner",
          "workflowId": "VMfdCbfQBcAAwrQn",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-04T17:04:02.000Z",
      "createdAt": "2025-06-11T03:46:16.882Z",
      "id": "VsZgQdgcs6lVZ4p1",
      "name": "ClienteNuevo",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {
                  "mode": "everyX",
                  "value": 15,
                  "unit": "minutes"
                }
              ]
            },
            "documentId": {
              "__rl": true,
              "value": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
              "mode": "list",
              "cachedResultName": "Contrataciones",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit#gid=1656915010"
            },
            "event": "rowAdded",
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTrigger",
          "typeVersion": 1,
          "position": [
            -32,
            -208
          ],
          "id": "520f307b-3927-48cd-a20e-c5d537e5484c",
          "name": "nuevo?",
          "credentials": {
            "googleSheetsTriggerOAuth2Api": {
              "id": "cZo45ZjqHQdroFJd",
              "name": "Google Sheets Trigger account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre completo": "={{ $json['Nombre completo'] }}",
                "Paquete": "={{ $json.Plan }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -16,
            32
          ],
          "id": "1364f4ef-8549-416d-af42-c477ca3b0233",
          "name": "DatosNuevo",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=Cliente interesado: {{ $json['Nombre completo'] }} telefono: {{ $('nuevo?').item.json['Numero de teléfono'] }}, {{ $('nuevo?').item.json.Plan }}, {{ $('nuevo?').item.json.Localidad }}{{ $('nuevo?').item.json.Zona }}. Contactar para agendar cita.",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            336,
            16
          ],
          "id": "9aef48c3-6b1d-4a52-95a9-cedef089a7ae",
          "name": "no",
          "webhookId": "a99edb8b-5bd1-402f-8cfe-e2e1d4831bff",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c1c6df3d-5d07-40f5-a2ba-8509c5911790",
                  "leftValue": "={{ $json[\"Zona de Cobertura\"] }}",
                  "rightValue": "Morelia",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            176,
            -208
          ],
          "id": "fc93462d-bc2f-4321-b784-e72a50c08439",
          "name": "If"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1UP0BlDqPJaYFPe9wbC4KFWT0HtEnanH5D0ff3fd__2E",
              "mode": "list",
              "cachedResultName": "DatosDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UP0BlDqPJaYFPe9wbC4KFWT0HtEnanH5D0ff3fd__2E/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UP0BlDqPJaYFPe9wbC4KFWT0HtEnanH5D0ff3fd__2E/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre completo": "={{ $json[\"Nombre completo\"] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            384,
            -208
          ],
          "id": "132994f0-3411-4353-bb1e-ffd6baff5eb6",
          "name": "DatosNuevo1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        }
      ],
      "connections": {
        "nuevo?": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosNuevo": {
          "main": [
            [
              {
                "node": "no",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "DatosNuevo1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "DatosNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Google Sheets Trigger": {
          "documentId": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
          "sheetId": 1656915010,
          "lastIndexChecked": 2
        },
        "node:nuevo?": {
          "documentId": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
          "sheetId": 1656915010,
          "lastIndexChecked": 27
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "48a27857-aa35-495d-b1c4-68c276b9e34e",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-11T03:46:16.905Z",
          "createdAt": "2025-06-11T03:46:16.905Z",
          "role": "workflow:owner",
          "workflowId": "VsZgQdgcs6lVZ4p1",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-06T21:11:54.000Z",
      "createdAt": "2025-06-06T17:38:13.190Z",
      "id": "Z2xbG4OS8W1nHEdK",
      "name": "GastosIA",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            -1340,
            -1000
          ],
          "id": "88d99c85-2500-4e14-8575-a992f7f1c59c",
          "name": "Merge"
        },
        {
          "parameters": {
            "formTitle": "Registrar Movimientos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Lupita"
                      },
                      {
                        "option": "Bertin"
                      },
                      {
                        "option": "Aldo"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "tipo_movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Concepto",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Comprobante",
                  "fieldType": "file",
                  "multipleFiles": false
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -640,
            -920
          ],
          "id": "4bbe6da7-bc8a-4047-bc90-015a0ecfa5f5",
          "name": "IngresoGasto",
          "webhookId": "12654cd0-c3b3-4cf9-84b8-53393d7ffa38"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c6e167ae-b485-4606-ad68-ece6352dfbf2",
                  "name": "Fecha actual",
                  "value": "={{ new Date().toLocaleDateString('es-MX') }}",
                  "type": "string"
                },
                {
                  "id": "e84595c9-917a-4f21-abb5-cc71c4be3271",
                  "name": "monto_calculo",
                  "value": "={{ $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad * -1 : $json.Cantidad }}",
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1360,
            -1240
          ],
          "id": "ea6d58d6-0ac0-4875-807d-eac01037d573",
          "name": "CapturaDatos"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5727c573-ad23-4d04-8c02-ba2d35b64a8c",
                  "leftValue": "={{ $json.Comprobante != null }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1180,
            -1240
          ],
          "id": "3b4fc3b6-71f8-4614-9309-2d2fcb01cbbe",
          "name": "Comprobante?"
        },
        {
          "parameters": {
            "inputDataFieldName": "Comprobante",
            "name": "={{ $json.Concepto }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh",
              "mode": "list",
              "cachedResultName": "Gastos",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh"
            },
            "options": {
              "simplifyOutput": true
            }
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -980,
            -1260
          ],
          "id": "5af69ebd-62a6-4ba0-9397-d2229521f085",
          "name": "GuardComp",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "67019d5c-39a2-442a-bee2-b24cea72d202",
                  "name": "Comprobante",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1520,
            -1000
          ],
          "id": "f24aa1a6-b7c8-488f-8032-788303910853",
          "name": "SinComp"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "eed4cf15-ff7b-4786-bb29-f2bdd545c747",
                  "name": "link_comprobante_gsheet",
                  "value": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1540,
            -800
          ],
          "id": "465d7046-0956-44f6-abdc-aa58ae7f2464",
          "name": "Linkcomp"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $json.formattedDate }}",
                "Cliente/Concepto": "={{ $('LimpiarDatos').item.json.Concepto }}",
                "Comprobante": "={{ $('LimpiarDatos').item.json.LinkCompro }}",
                "Lup-Ing": "={{ $('LimpiarDatos').item.json.LupitaIngr }}",
                "Lup-Gas": "={{ $('LimpiarDatos').item.json.LupitaGast }}",
                "Ber-Ing": "={{ $('LimpiarDatos').item.json.BertIng }}",
                "Ber-Gas": "={{ $('LimpiarDatos').item.json.BertGast }}",
                "Ald-Ing": "={{ $('LimpiarDatos').item.json.AldoIng }}",
                "Ald-Gas": "={{ $('LimpiarDatos').item.json.AldoGas }}",
                "--": "-"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -1320,
            -800
          ],
          "id": "339bcb8c-82d2-4423-a36c-34461dda172f",
          "name": "RegMov.",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Movimiento registrado... todo OK",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -960,
            -700
          ],
          "id": "c6ffe4d2-3271-40cb-ba87-d0249cc972b5",
          "name": "Form",
          "webhookId": "32863612-6699-4e23-b01b-94385b6b82d0"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f8892c3a-51e9-4c0b-821b-2ae4a48e6638",
                  "name": "LupitaIngr",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "0586845b-1ea8-47b4-9ad5-bbe997006e1f",
                  "name": "LupitaGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Lupita\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "e7956a2e-3f3b-44ff-a43f-9c6a3f78c2d0",
                  "name": "BertIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "eac02c77-4700-498b-9f04-ad661d5dc576",
                  "name": "BertGast",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Bertin\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "108813e8-47f8-4bc0-affc-f55cc86c75fc",
                  "name": "AldoIng",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Ingreso\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "83a6dc15-9a49-4f65-9ab3-564cf164fcf3",
                  "name": "AldoGas",
                  "value": "={{ $('Comprobante?').item.json.Nombre === \"Aldo\" && $('Comprobante?').item.json.tipo_movimiento === \"Gasto\" ? $('Comprobante?').item.json.monto_calculo : null }}",
                  "type": "number"
                },
                {
                  "id": "f269177f-0744-46bf-a724-3efb5ee06dc2",
                  "name": "LinkCompro",
                  "value": "={{ $json.link_comprobante_gsheet }}",
                  "type": "string"
                },
                {
                  "id": "a5ad16ad-dd7e-4cdb-bc71-a54977ad4b8c",
                  "name": "Concepto",
                  "value": "={{ $('Comprobante?').item.json.Concepto }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1140,
            -1000
          ],
          "id": "905c8ec3-ab8a-42e1-9c17-183d5457060e",
          "name": "LimpiarDatos"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $('Comprobante?').item.json.submittedAt }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -960,
            -1000
          ],
          "id": "a8a92826-067d-4504-a1c2-4df8ca8310a4",
          "name": "Date & Time"
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "Nombre"
                },
                {
                  "name": "Movimiento"
                },
                {
                  "name": "Concepto"
                },
                {
                  "name": "Cantidad",
                  "type": "number"
                },
                {
                  "name": "Comprobante"
                },
                {
                  "name": "ChatId"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -1560,
            -1240
          ],
          "id": "98c72ef5-c43b-476f-865e-4cfda95bfb51",
          "name": "When Executed by Another Workflow"
        }
      ],
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "LimpiarDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IngresoGasto": {
          "main": [
            []
          ]
        },
        "CapturaDatos": {
          "main": [
            [
              {
                "node": "Comprobante?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Comprobante?": {
          "main": [
            [
              {
                "node": "GuardComp",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SinComp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardComp": {
          "main": [
            [
              {
                "node": "Linkcomp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SinComp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Linkcomp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "RegMov.": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarDatos": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "RegMov.",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "CapturaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "def10228-bad4-41ff-8713-d901beaf3c50",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-06T17:38:13.203Z",
          "createdAt": "2025-06-06T17:38:13.203Z",
          "role": "workflow:owner",
          "workflowId": "Z2xbG4OS8W1nHEdK",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-12T19:41:23.000Z",
      "createdAt": "2025-10-11T05:02:32.810Z",
      "id": "ZgGhR3hNpKlofg8f",
      "name": "CyberBox",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "c8967f26-4817-4e80-800d-7e82078b7241",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -832,
            272
          ],
          "id": "7323c9ee-000f-40a0-a45d-70ca62c002c1",
          "name": "Cortesincierre",
          "webhookId": "c8967f26-4817-4e80-800d-7e82078b7241"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "sales",
            "returnAll": true,
            "filters": {
              "conditions": [
                {
                  "keyName": "corte_realizado",
                  "condition": "eq",
                  "keyValue": "false"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -624,
            272
          ],
          "id": "0ca90758-d66b-4550-8775-fa606bd92efb",
          "name": "Get many rows",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst sesionesUnicas = {};\n\n// Obtener sesiones únicas\nitems.forEach(item => {\n  const sessionId = item.json.session_id;\n  if (!sesionesUnicas[sessionId]) {\n    sesionesUnicas[sessionId] = {\n      session_id: sessionId,\n      username: item.json.username,\n      fecha: item.json.fecha.split('T')[0]\n    };\n  }\n});\n\nreturn Object.values(sesionesUnicas).map(sesion => ({ json: sesion }));\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -416,
            272
          ],
          "id": "d996db75-0738-4567-b4cb-105562b196c4",
          "name": "Code2"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "login-nuevo",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -736,
            80
          ],
          "id": "ef6618ae-1738-45a4-8b21-4a632bd02e60",
          "name": "LoginWebhook",
          "webhookId": "login-nuevo"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "users",
            "filters": {
              "conditions": [
                {
                  "keyName": "username",
                  "keyValue": "={{ $json.body.username }}"
                },
                {
                  "keyName": "password",
                  "keyValue": "={{ $json.body.password }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -528,
            80
          ],
          "id": "8a2305de-31d4-4a26-a186-bed9a6af26ae",
          "name": "VerifyUser",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "id": "e9e9e5eb-4472-4ba4-93af-9734f70a0088"
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -336,
            80
          ],
          "id": "551b2312-15c5-4d73-8826-d5a3767396c5",
          "name": "CheckLogin"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "success",
                  "value": false,
                  "type": "boolean"
                },
                {
                  "name": "message",
                  "value": "Usuario o contraseña incorrectos",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -96,
            64
          ],
          "id": "aefce350-2ebe-4af5-a7dc-2df762e89868",
          "name": "LoginFailed"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "success",
                  "value": true,
                  "type": "boolean"
                },
                {
                  "name": "message",
                  "value": "Login exitoso",
                  "type": "string"
                },
                {
                  "name": "user_id",
                  "value": "={{ $json.id }}",
                  "type": "number"
                },
                {
                  "name": "username",
                  "value": "={{ $json.username }}",
                  "type": "string"
                },
                {
                  "name": "token",
                  "value": "={{ $json.username }}_{{ Date.now() }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -96,
            240
          ],
          "id": "ff7a905c-d126-42e9-b04a-07c4671700b4",
          "name": "LoginSuccess"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            160,
            304
          ],
          "id": "c5161801-43b5-4dc8-aa67-ca6272cda7e7",
          "name": "LoginResponse"
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst sessionId = $node[\"Corte\"].json.body.session_id;\nconst totalRecaudado = parseFloat($node[\"Corte\"].json.body.total_recaudado || 0);\nconst totalVentas = items.reduce((sum, item) => sum + parseFloat(item.json.total || 0), 0);\nconst diferencia = totalRecaudado - totalVentas;\n\nreturn items.map(item => ({\n  json: {\n    ...item.json,\n    total_recaudado: totalRecaudado,\n    diferencia: diferencia\n  }\n}));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -448,
            512
          ],
          "id": "defd981a-9fd6-4166-a830-f575b1f51b0a",
          "name": "Add Totals"
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "sales",
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $json.session_id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "corte_realizado",
                  "fieldValue": "true"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -240,
            512
          ],
          "id": "28fe7d26-6e0d-4360-8093-343c76dbf32b",
          "name": "Mark Processed",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst productUpdates = {};\n\n// Agrupar por producto\nitems.forEach(item => {\n  const productId = item.json.product_id;\n  const cantidad = parseInt(item.json.cantidad) || 0;\n  \n  if (!productUpdates[productId]) {\n    productUpdates[productId] = 0;\n  }\n  productUpdates[productId] += cantidad;\n});\n\n// Convertir a array\nreturn Object.entries(productUpdates).map(([productId, totalVendido]) => ({\n  json: {\n    product_id: productId,\n    cantidad_vendida: totalVendido\n  }\n}));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            160,
            512
          ],
          "id": "972ffa66-512c-4c3b-bcd4-079be86ca220",
          "name": "Group Products"
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "products",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $json.id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "stock",
                  "fieldValue": "={{ $json.stock - $('Group Products').item.json.cantidad_vendida }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            560,
            512
          ],
          "id": "6bf154cb-696e-4871-b058-825f258ecc8d",
          "name": "Update Stock",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ { \"success\": true, \"message\": \"Corte realizado exitosamente\" } }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            752,
            512
          ],
          "id": "33a1adfc-c869-416e-be20-09aff3387f3f",
          "name": "Response"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "sales",
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $json.body.session_id }}"
                },
                {
                  "keyName": "corte_realizado",
                  "condition": "eq",
                  "keyValue": "false"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -656,
            512
          ],
          "id": "f9637643-80e0-45b5-b428-e6535bdf6ddb",
          "name": "Get Sales1",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY",
              "mode": "list"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "fecha": "={{ $json.fecha }}",
                "Producto": "={{ $json.product_id }}",
                "Cantidad": "={{ $json.cantidad }}",
                "Precio": "={{ $json.precio_venta }}",
                "Total": "={{ $json.total }}",
                "Usuario": "={{ $json.username }}",
                "recaudado": "={{ $json.total_recaudado }}",
                "diferencia": "={{ $json.diferencia }}"
              }
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -48,
            512
          ],
          "id": "f98e7c6e-58b5-4029-a529-34eceff067ab",
          "name": "Save to Sheets1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "products",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $json.product_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            352,
            512
          ],
          "id": "0cab28b0-7346-4ed8-a7b3-b2eb99ca7bda",
          "name": "Get Product1",
          "credentials": {
            "supabaseApi": {
              "id": "b7vxXfEWUSkhFYh3",
              "name": "CyberBox"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "corte-nuevo",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -864,
            512
          ],
          "id": "1912d972-a8ae-4c76-bc3b-cfaa50f9c057",
          "name": "Corte1",
          "webhookId": "corte-nuevo"
        }
      ],
      "connections": {
        "Cortesincierre": {
          "main": [
            [
              {
                "node": "Get many rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many rows": {
          "main": [
            [
              {
                "node": "Code2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LoginWebhook": {
          "main": [
            [
              {
                "node": "VerifyUser",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "VerifyUser": {
          "main": [
            [
              {
                "node": "CheckLogin",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CheckLogin": {
          "main": [
            [
              {
                "node": "LoginFailed",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "LoginSuccess",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LoginFailed": {
          "main": [
            [
              {
                "node": "LoginResponse",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LoginSuccess": {
          "main": [
            [
              {
                "node": "LoginResponse",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add Totals": {
          "main": [
            [
              {
                "node": "Mark Processed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark Processed": {
          "main": [
            [
              {
                "node": "Save to Sheets1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Group Products": {
          "main": [
            [
              {
                "node": "Get Product1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Stock": {
          "main": [
            [
              {
                "node": "Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Sales1": {
          "main": [
            [
              {
                "node": "Add Totals",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save to Sheets1": {
          "main": [
            [
              {
                "node": "Group Products",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Product1": {
          "main": [
            [
              {
                "node": "Update Stock",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Corte1": {
          "main": [
            [
              {
                "node": "Get Sales1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "pUUfrS2rb6SHGlDo"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "1a5ebb5f-47ca-407f-a08c-a84125124d9d",
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-10-11T05:02:32.826Z",
          "createdAt": "2025-10-11T05:02:32.826Z",
          "role": "workflow:owner",
          "workflowId": "ZgGhR3hNpKlofg8f",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-10-11T05:02:22.755Z",
          "createdAt": "2025-10-11T05:02:22.755Z",
          "id": "XsE6BF4zmq7QL7N0",
          "name": "caja"
        }
      ]
    },
    {
      "updatedAt": "2025-05-28T05:49:07.000Z",
      "createdAt": "2025-05-15T05:27:20.351Z",
      "id": "aQ2tBOLb4ixSTJfC",
      "name": "ModuloPagosChiq",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -420,
            -820
          ],
          "id": "bab2b3c2-a0eb-422b-9f83-285f2c807fa3",
          "name": "ID Cliente",
          "webhookId": "18393db5-e848-48cf-9c48-3fec5312f107"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -220,
            -820
          ],
          "id": "3c2dafea-30ce-4cdd-b302-14ca5a2ecb91",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -40,
            -780
          ],
          "id": "6a85dfb9-2420-486d-8c0b-40d5e94b27ad",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      },
                      {
                        "option": "otro..."
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -160,
            -480
          ],
          "id": "a7a45233-1072-410e-ab33-c7a3610ad3ca",
          "name": "CargarPago",
          "webhookId": "f88b7482-d252-447b-a4b6-9205178b7baa"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            500,
            -620
          ],
          "id": "38e3eb2b-7c6a-409d-b14a-78086cb449d8",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha'] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            460,
            -780
          ],
          "id": "d4c9690f-1720-4fd5-a365-ce71ccb7ab48",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -380,
            -560
          ],
          "id": "88cd6a1e-7d96-4b62-a069-19cad77d6e62",
          "name": "Error",
          "webhookId": "9f248268-7007-4f03-bbdc-5474ff160840"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            720,
            -600
          ],
          "id": "14eea62f-9c3b-454e-b833-8de3d659ae90",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            520,
            -380
          ],
          "id": "78b551a9-3366-41c8-b409-3aee487075c8",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            720,
            -800
          ],
          "id": "cd511dc2-4ce3-4451-a4c2-40cdec4a5588",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            920,
            -800
          ],
          "id": "1defe401-d8d3-4f9c-989d-556ddfd9cfb3",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            1020,
            -380
          ],
          "id": "63b4a40e-76d6-4061-9071-aacab906ab9d",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global Mac \"{{ $('Existe?').item.json[\"MAC ID\"] }}\";\n:global Plan \"{{ $json.NuevoPlan }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            680,
            -340
          ],
          "id": "66b3e58b-b0cb-43b0-97cf-222bcba6e5ad",
          "name": "CambiarPlan1"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1220,
            -320
          ],
          "id": "23ce04d3-5730-49ae-bb6b-6195df3b6834",
          "name": "Form",
          "webhookId": "284e45a5-968e-404c-bb41-8b55b4cc5ab0"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            1400,
            -140
          ],
          "id": "d5455b4a-093e-4297-8c78-66153ba75784",
          "name": "Gmail",
          "webhookId": "351f5c04-bf08-4fe3-bc4e-a87db5740cfa",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1300,
            -800
          ],
          "id": "54481d28-30e1-4681-87b7-a1fd331b354a",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            40,
            -540
          ],
          "id": "79a2fa3a-211b-470e-abd0-13e4478612d1",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('CargarPago').item.json['Cantidad Pagada'] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            200,
            -600
          ],
          "id": "269a7e79-7eca-4f1d-ac47-461838342f7a",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            280,
            -260
          ],
          "id": "73e90c1f-5eb1-485d-8ecc-8f98c343548c",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            160,
            -360
          ],
          "id": "f3b38a0b-9bd5-4c84-9e53-87fbb8947671",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            320,
            -380
          ],
          "id": "04dc2c70-5a90-49b8-aabb-85c8549f720b",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            60,
            -280
          ],
          "id": "132cb884-fb0f-4fc0-acfd-3385278e1173",
          "name": "Exept1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            160,
            -820
          ],
          "id": "0d1fe8a8-f682-45ba-831a-769f08a88b82",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -400,
            -320
          ],
          "id": "b8d9d03f-074f-40d5-93fa-06ba8a0ddd1b",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                "Cuenta": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                "Cantidad": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}",
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            840,
            -340
          ],
          "id": "71da1cd7-182e-49c4-985b-49f3ee159dff",
          "name": "ActualizaPlan",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.ID }}",
                "Fecha de corte": "={{ $json.FechaCorte }}",
                "Cuenta": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                "Cantidad": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            940,
            -600
          ],
          "id": "c4b882df-68fc-4578-8fa0-6506ee0ba37d",
          "name": "FechaBD",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Ma. Gpe. term -0274 Azte' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Bertin term -9712 Azte' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] == 'Aldo term -5905 Sant.' ? $('CargarPago').item.json[\"Cantidad Pagada\"] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('CargarPago').item.json[\"Cuenta en la que hizo el pago\"] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('CargarPago').item.json[\"Cantidad Pagada\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1100,
            -800
          ],
          "id": "e0b2d237-80bc-4874-8e12-670e0e3557c6",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -180,
            -280
          ],
          "id": "9f0b8520-208f-4227-8422-48ae44281bf1",
          "name": "Error1",
          "webhookId": "4c188fc4-81fd-4834-a48c-89fb7df14b50"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1180,
            -560
          ],
          "id": "617ce314-a598-47bc-aafa-a48afc547ff8",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1360,
            -520
          ],
          "id": "b4ee3bf5-159e-474e-b438-815f70c943bc",
          "name": "Form1",
          "webhookId": "fa09d65f-288f-4f2b-ae5c-7c7524e669f1"
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "CambiarPlan1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CambiarPlan1": {
          "main": [
            [
              {
                "node": "ActualizaPlan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "FechaBD",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Exept1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Exept1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaPlan": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaBD": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "08fca5e6-9c4f-47bc-8fb2-b80a8d276bc6",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-15T05:27:20.362Z",
          "createdAt": "2025-05-15T05:27:20.362Z",
          "role": "workflow:owner",
          "workflowId": "aQ2tBOLb4ixSTJfC",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-05-20T01:09:18.000Z",
      "createdAt": "2025-05-16T05:37:40.481Z",
      "id": "aQy5cygBcMBvROO9",
      "name": "IngresosyGastosChiq (May 15 at 00:56:11)",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            -180,
            20
          ],
          "id": "e5e3e6e2-6715-4d90-bc5c-afdf5d8cef0a",
          "name": "Merge"
        },
        {
          "parameters": {
            "formTitle": "Registrar Movimientos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Lupita"
                      },
                      {
                        "option": "Bertin"
                      },
                      {
                        "option": "Aldo"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "tipo_movimiento",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Ingreso"
                      },
                      {
                        "option": "Gasto"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cantidad",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Concepto",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Comprobante",
                  "fieldType": "file",
                  "multipleFiles": false
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -380,
            -220
          ],
          "id": "a4c874dc-04cf-42e8-b28d-4cdfcc9009e7",
          "name": "IngresoGasto",
          "webhookId": "346594bc-0634-4bd9-9d75-9a2f0b3dec28"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c6e167ae-b485-4606-ad68-ece6352dfbf2",
                  "name": "Fecha actual",
                  "value": "={{ new Date().toLocaleDateString('es-MX') }}",
                  "type": "string"
                },
                {
                  "id": "e84595c9-917a-4f21-abb5-cc71c4be3271",
                  "name": "monto_calculo",
                  "value": "={{ $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad * -1 : $json.Cantidad }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -200,
            -220
          ],
          "id": "a3fdf06a-33c8-4d50-b110-0844f70fa3ed",
          "name": "CapturaDatos"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5727c573-ad23-4d04-8c02-ba2d35b64a8c",
                  "leftValue": "={{ $json.Comprobante != null }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -20,
            -220
          ],
          "id": "37ab85cc-28d7-4daf-8582-b4e06bb16a3c",
          "name": "Comprobante?"
        },
        {
          "parameters": {
            "inputDataFieldName": "Comprobante",
            "name": "={{ $json.Concepto }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh",
              "mode": "list",
              "cachedResultName": "Gastos",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1FbSQoA1Lilph0IO_yEk_oGg2qar8fFVh"
            },
            "options": {
              "simplifyOutput": true
            }
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            180,
            -220
          ],
          "id": "f06556b4-ea92-4a81-8793-7b3b6b0b61c3",
          "name": "GuardComp",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "67019d5c-39a2-442a-bee2-b24cea72d202",
                  "name": "Comprobante",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -360,
            20
          ],
          "id": "34933c8d-6070-4e78-87c8-aa56a930f67d",
          "name": "SinComp"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "eed4cf15-ff7b-4786-bb29-f2bdd545c747",
                  "name": "link_comprobante_gsheet",
                  "value": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -380,
            220
          ],
          "id": "9458082f-9578-4af6-9850-6efdf87c8a35",
          "name": "Linkcomp"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.formattedDate }}",
                "Cliente/Concepto": "={{ $('LimpiarDatos').item.json.Concepto }}",
                "Comprobante": "={{ $('LimpiarDatos').item.json.Comprobante }}",
                "Lup-Ing": "={{ $('LimpiarDatos').item.json.LupitaIngr }}",
                "Lup-Gas": "={{ $('LimpiarDatos').item.json.LupitaGast }}",
                "Ber-Ing": "={{ $('LimpiarDatos').item.json.BertIng }}",
                "Ber-Gas": "={{ $('LimpiarDatos').item.json.BertGast }}",
                "Ald-Ing": "={{ $('LimpiarDatos').item.json.AldoIng }}",
                "Ald-Gas": "={{ $('LimpiarDatos').item.json.AldoGas }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -160,
            220
          ],
          "id": "ec35e687-c1bd-4b94-9a4b-686c561f936f",
          "name": "RegMov.",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Movimiento registrado... todo OK",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            0,
            220
          ],
          "id": "dab3e223-b862-461e-b4d6-02246197ffe9",
          "name": "Form",
          "webhookId": "76e2988f-4aad-4307-acf7-176d0f9de6a4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f8892c3a-51e9-4c0b-821b-2ae4a48e6638",
                  "name": "LupitaIngr",
                  "value": "={{ $json.Nombre === \"Lupita\" && $json.tipo_movimiento === \"Ingreso\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "0586845b-1ea8-47b4-9ad5-bbe997006e1f",
                  "name": "LupitaGast",
                  "value": "={{ $json.Nombre === \"Lupita\" && $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "e7956a2e-3f3b-44ff-a43f-9c6a3f78c2d0",
                  "name": "BertIng",
                  "value": "={{ $json.Nombre === \"Bertin\" && $json.tipo_movimiento === \"Ingreso\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "eac02c77-4700-498b-9f04-ad661d5dc576",
                  "name": "BertGast",
                  "value": "={{ $json.Nombre === \"Bertin\" && $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "108813e8-47f8-4bc0-affc-f55cc86c75fc",
                  "name": "AldoIng",
                  "value": "={{ $json.Nombre === \"Aldo\" && $json.tipo_movimiento === \"Ingreso\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "83a6dc15-9a49-4f65-9ab3-564cf164fcf3",
                  "name": "AldoGas",
                  "value": "={{ $json.Nombre === \"Aldo\" && $json.tipo_movimiento === \"Gasto\" ? $json.Cantidad : null }}",
                  "type": "string"
                },
                {
                  "id": "f269177f-0744-46bf-a724-3efb5ee06dc2",
                  "name": "LinkCompro",
                  "value": "={{ $('Merge').item.json.Comprobante }}",
                  "type": "string"
                },
                {
                  "id": "a5ad16ad-dd7e-4cdb-bc71-a54977ad4b8c",
                  "name": "Concepto",
                  "value": "={{ $('Comprobante?').item.json.Concepto }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            20,
            20
          ],
          "id": "f9fad266-faa5-49cf-8cdb-44a8e5c5fba4",
          "name": "LimpiarDatos"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $('Comprobante?').item.json.submittedAt }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            200,
            20
          ],
          "id": "0f9cd2a4-64db-4c5f-b688-0e0771437d59",
          "name": "Date & Time"
        }
      ],
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "LimpiarDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IngresoGasto": {
          "main": [
            [
              {
                "node": "CapturaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CapturaDatos": {
          "main": [
            [
              {
                "node": "Comprobante?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Comprobante?": {
          "main": [
            [
              {
                "node": "GuardComp",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "SinComp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardComp": {
          "main": [
            [
              {
                "node": "Linkcomp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SinComp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Linkcomp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "RegMov.": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LimpiarDatos": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "RegMov.",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {},
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "7bf9b629-b81a-4bcd-8573-056e77f1268e",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-05-16T05:37:40.490Z",
          "createdAt": "2025-05-16T05:37:40.490Z",
          "role": "workflow:owner",
          "workflowId": "aQy5cygBcMBvROO9",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-18T19:38:59.000Z",
      "createdAt": "2025-06-11T22:00:56.959Z",
      "id": "axp4rTx3ArDnUOxd",
      "name": "Agentecop",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.message.chat.id }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -4180,
            -820
          ],
          "id": "511e16a2-6ab6-4d14-bf92-e4f58e6eff00",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "chatId": "={{ $json.chatIdOriginal }}",
            "text": "={{ $json.message }}",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3600,
            -860
          ],
          "id": "265b69ce-c974-4a3b-a0ea-b50f614c7ed7",
          "name": "Respuesta",
          "webhookId": "b5435e16-b729-4b2e-a012-1d8055770f7e",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.message.text }}",
            "options": {
              "systemMessage": "=Clasifica el mensaje del usuario en una de las siguientes INTENCIONES. Responde ÚNICAMENTE con la etiqueta de la intención en MAYÚSCULAS.\n\nINTENCIONES:\n- SALUDO\n- BUSCAR_NOMBRE\n- ESTADO_CLIENTE\n- REPORTAR_GASTO\n- REPORTAR_PAGO\n- PENDIENTE\n- DESCONOCIDO\n\nEjemplos:\nUsuario: \"hola\" -> SALUDO\nUsuario: \"buenos días\" -> SALUDO\nUsuario: \"dime el id de Juan Perez\" -> BUSCAR_NOMBRE\nUsuario: \"busca el nombre Maria Lopez\" -> BUSCAR_NOMBRE\nUsuario: \"Como aparece el cliente con ID 123?\" -> ESTADO_CLIENTE\nUsuario: \"esta conectado el ID 456\" -> ESTADO_CLIENTE\nUsuario: \"quiero registrar un gasto\" -> REPORTAR_GASTO\nUsuario: \"Aldo gasto 300 en comida\" -> REPORTAR_GASTO\nUsuario: \"recibi 2000 de instalacion\" -> REPORTAR_GASTO\nUsuario: \"quiero reportar mi pago\" -> REPORTAR_PAGO\nUsuario: \"reportar pago de ID 789\" -> REPORTAR_PAGO\nUsuario: \"anota en pendientes comprar cable\" -> PENDIENTE\nUsuario: \"Cuales son los pendientes\" -> PENDIENTE\nUusario: \"Pendiente completado\" -> PENDIENTE\nUsuario: \"qué hora es?\" -> DESCONOCIDO\n\n---\nMensaje del Usuario:\n{{ $json.message.text }}\n---\nINTENCION:\n\nContesta siempre en español"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -4200,
            -1040
          ],
          "id": "91d3aba4-e88c-4c3e-aedc-0b461965fe3e",
          "name": "AgtIntent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -4300,
            -820
          ],
          "id": "c2cb5167-335e-48e8-9f9c-5db7e076993d",
          "name": "GemIntent",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4da42528-a5f9-4321-a0c8-55363bd93037",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "SALUDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bb95cbec-d074-49cf-86f4-2e10f729c7f9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "BUSCAR_NOMBRE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "675f82ad-14e4-456c-929d-fa64a6552f48",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "ESTADO_CLIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_GASTO",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "cd7f0500-527d-4be7-bf61-b5a5cdeac877"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f738687-f3c2-4715-a82a-05640916957b",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "REPORTAR_PAGO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "48297539-bf1e-49f9-89a0-5665b0ed81e9",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "INTENCION_DESCONOCIDA",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "015cda22-e1f5-4496-afb5-3fddc2c1b629",
                        "leftValue": "={{ $json.output.trim() }}",
                        "rightValue": "PENDIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -3820,
            -1040
          ],
          "id": "7cc55e0e-f3c9-47d6-a075-f412882d4128",
          "name": "SwIntent"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el nombre de la persona que se busca. Responde SÓLO con el nombre. Si no puedes identificar un nombre claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el id de Juan Perez\" -> Juan\nMensaje: \"busca el nombre Maria Fernanda Lopez Garcia\" -> Fernanda\nMensaje: \"ID de ana\" -> ana\nMensaje: \"buscar nombre\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -4420,
            -660
          ],
          "id": "df61b787-64c5-4933-921a-e044528c2fb7",
          "name": "AgtExtract"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').item.json.message.chat.id }}",
            "text": "=¡Hola! 👋 ¿En qué puedo ayudarte? Puedes: - Buscar el ID de un cliente (ej: \"busca el ID de Ana\") - Consultar el estado de un cliente (ej: \"estado del ID 123\") - Reportar un gasto o ingreso - Reportar un pago mensual",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3560,
            -1040
          ],
          "id": "eded286b-3554-4ce0-8699-96e875ed2fce",
          "name": "Telegram",
          "webhookId": "5f302bed-256d-4dc3-81fb-17e3034ac308",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -4040,
            -640
          ],
          "id": "85309747-c812-48d0-bf5a-3fd0ca74f837",
          "name": "If"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -4220,
            -420
          ],
          "id": "5498d92f-c1dd-42e8-9edc-f8e236f7c97d",
          "name": "Limit"
        },
        {
          "parameters": {
            "modelName": "=models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.2
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -4420,
            -800
          ],
          "id": "41c8fca7-511a-409a-a202-52ae02387de7",
          "name": "BuscarID",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "xB5k8lNiGd17TIji",
              "mode": "list",
              "cachedResultName": "BuscarChiq2"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.output }}",
                "IdChat": "={{ $('Mensaje1').item.json.message.chat.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "IdChat",
                  "displayName": "IdChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -4400,
            -420
          ],
          "id": "a432cd8e-0a04-4e80-85e0-3dc1318c8ed8",
          "name": "Buscar",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -4020,
            -420
          ],
          "id": "8fc39d59-4575-41cc-a4d0-ff9140a1ba47",
          "name": "Resultado ID",
          "webhookId": "81919248-3aec-4729-80f3-a955bf2fb48d",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').item.json.message.chat.id }}",
            "text": "Por favor, dime el nombre que quieres buscar (ej: 'busca el ID de Ana').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -4040,
            -800
          ],
          "id": "a760d1dd-c97d-44ab-b0b6-e0711917607b",
          "name": "NoEntender",
          "webhookId": "0fe7d867-6485-4df8-a343-fdafc1ed1945",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3460,
            -660
          ],
          "id": "636accd3-fa2b-40c6-8b48-af5abcd3d402",
          "name": "If2"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -3560,
            -460
          ],
          "id": "d11760a0-642f-4888-ba90-93a53271f3b8",
          "name": "Limit2"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').first().json.message.chat.id.toString() }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3380,
            -420
          ],
          "id": "8d011782-e091-49f5-ba23-874f449ceef0",
          "name": "Resultado ID3",
          "webhookId": "af82b283-fe6b-4aa3-9472-663983bcfb55",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').item.json.message.chat.id }}",
            "text": "Por favor, dime el ID del cliente que quieres saber su estado (ej: como aparece d456').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3020,
            -560
          ],
          "id": "b8701d83-b65a-451e-9f36-c280f3ad13e6",
          "name": "NoEntender1",
          "webhookId": "3d04504a-c133-455e-8448-54e7a02456d9",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje1').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae el ID del cliente que se busca. Responde SÓLO con el ID. Si no puedes identificar un ID claro, responde \"Noespecificado\".\n\nEjemplos:\nMensaje: \"dime el estado de c345\" -> c345\nMensaje: \"como aparece el a423\" -> a423\nMensaje: \"status de b043\" -> b043\nMensaje: \"buscar status\" -> NoEspecificado\n\n---\nMensaje Original:\n{{ $('Mensaje1').item.json.message.text }}\n---\nNombre a Buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -3800,
            -660
          ],
          "id": "3ff611f4-584f-4760-87ae-9c1471e83378",
          "name": "AgtStatus"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3800,
            -780
          ],
          "id": "a92ee857-a085-4d07-b48e-74a510bbf5b1",
          "name": "status",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "8EoTMqNoy8ATG1hs",
              "mode": "list",
              "cachedResultName": "StatusIDC"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.output.trim() }}",
                "idChat": "={{ $('Mensaje1').item.json.message.chat.id }} "
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "idChat",
                  "displayName": "idChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            -3760,
            -460
          ],
          "id": "59e0ba8d-c04c-43fe-ac47-e6fc4331f0f7",
          "name": "statusID",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').item.json.message.chat.id }}",
            "text": "=Reportar ingresos y gastos <a href=\"https://n8n.albored.com/form/346594bc-0634-4bd9-9d75-9a2f0b3dec28\">AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3400,
            -920
          ],
          "id": "cde8787e-1b75-45cf-a8ef-4da2bd549e8a",
          "name": "Gasto",
          "webhookId": "2cff8d18-6f9f-4dc3-b7b9-7e553e5c921c",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje1').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/ddc26433-a54c-4b1e-a3bb-3c1447eebd71\">Reportar Pago 1MES AQUI</a>\n\n<a href=\"https://n8n.albored.com/form/a0972ad6-4c43-4f86-9100-fd32b4aff9ed\">Reportar Pago Varios meses AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3360,
            -780
          ],
          "id": "d1b01547-b29b-4291-a73e-2d9e03d87b19",
          "name": "pago",
          "webhookId": "92b514e4-48c5-47a0-a391-b26a5cf94d64",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3000,
            -880
          ],
          "id": "39b5d059-8638-48b1-a20a-373af0e33246",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Mensaje').item.json.message.text }}",
            "options": {
              "systemMessage": "=Del siguiente mensaje, extrae la ACCION y el PENDIENTE. Cuando tengas todos los datos, Responde SÓLO con accion,y pendiente\n\nEjemplos:\nMensaje: \"anota en pendientes comprar cinta negra, alambre y tubos\" -> accion=add, pendiente=\"comprar cinta negra, alambre y tubos\"\nMensaje: \"pon en pendientes revisar antena xyz3\" -> accion=add, pendiente=revisar antena xyz3\nMensaje: \"cuales son los pendientes\" -> accion=show, pendiente=\"\"\nMensaje: \"Que pendientes hay\" -> accion=show, pendiente=\"\"\nMensaje: \"Pendiente 3 completado\"-> accion=del, pendiente=\"3\"\nMensaje: \"Quitar pendiente 5\"-> accion=del, pendiente=\"5\"\n\n---\nMensaje Original:\n{{ $('Mensaje').item.json.message.text }}\n---\nACCION, PENDIENTE a buscar:\nContesta siempre en español ",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -2980,
            -1060
          ],
          "id": "5f96bac4-dcc4-452f-9610-89255fac6d9f",
          "name": "AgtPendient"
        },
        {
          "parameters": {
            "jsCode": "// Obtenemos el primer (y único) item que llega al nodo\nconst item = items[0];\n\n// Extraemos la cadena de texto del campo \"output\"\nconst rawString = item.json.output;\n\n// Creamos un objeto vacío para guardar los nuevos datos\nconst newData = {};\n\n// 1. Limpiamos la cadena (quitamos espacios y saltos de línea al inicio/final)\n// 2. La dividimos por la coma (,) para obtener cada par \"clave=valor\"\nconst pairs = rawString.trim().split(',');\n\n// Recorremos cada par\nfor (const pair of pairs) {\n  // Dividimos el par por el signo igual (=) para separar la clave del valor\n  // Usamos una pequeña optimización para que el valor pueda contener \"=\"\n  const [key, ...valueParts] = pair.split('=');\n  const value = valueParts.join('=');\n  \n  // Añadimos la clave y el valor al nuevo objeto, limpiando espacios\n  if (key) {\n    newData[key.trim()] = value.trim();\n  }\n}\n\n// Reemplazamos el json original del item con nuestro nuevo objeto\nitem.json = newData;\n\n// Devolvemos el item modificado\nreturn [item];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2620,
            -1080
          ],
          "id": "a12b1310-6549-475d-a3e0-de6ab1be64b9",
          "name": "Code"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bd191530-ac43-4a91-bbdc-dc3e79c1bf87",
                  "name": "accion",
                  "value": "={{ $('Code').item.json.accion }}",
                  "type": "string"
                },
                {
                  "id": "ec194e3c-caf6-4160-8895-f0df5443e5c5",
                  "name": "pendiente",
                  "value": "={{ $('Code').item.json.pendiente }}",
                  "type": "string"
                },
                {
                  "id": "f9430989-4996-4f48-b230-cc485f0683a4",
                  "name": "id",
                  "value": "={{ $('On form submission').item.json.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2440,
            -1080
          ],
          "id": "4fdae0bd-a2cd-4853-91a0-dce7ffe7b4e6",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "formTitle": "test",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "mensaje"
                },
                {
                  "fieldLabel": "id"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -4560,
            -1040
          ],
          "id": "51b229f5-b836-4466-8b42-8def25591d51",
          "name": "On form submission",
          "webhookId": "347dd517-126c-4dc2-96d7-8087a1088e13"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -4700,
            -600
          ],
          "id": "decb4820-08a3-4789-9cbd-76b756cf4374",
          "name": "Mensaje1",
          "webhookId": "583c6d09-272b-4f0c-b469-a6925d5ec0f5",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "jsCode": "// Obtiene los datos del formulario (lo que escribiste en \"mensaje\" y \"id\")\nconst formData = $input.first().json;\n\n// Crea la estructura de datos que tu flujo espera de Telegram\nconst telegramSimulatedData = {\n  \"update_id\": Date.now(), // Un número único para cada prueba\n  \"message\": {\n    \"message_id\": Date.now() % 100000, // Otro número único\n    \"from\": {\n      \"id\": parseInt(formData.id), // **El ID del formulario va aquí**\n      \"is_bot\": false,\n      \"first_name\": \"Usuario_Prueba_Form\",\n      \"username\": \"usuario_form_test\"\n    },\n    \"chat\": {\n      \"id\": parseInt(formData.id), // **El ID del formulario va aquí (mismo que from.id para chats privados)**\n      \"first_name\": \"Usuario_Prueba_Form\",\n      \"username\": \"usuario_form_test\",\n      \"type\": \"private\"\n    },\n//    \"date\": Math.floor(Date.now() / 1000), // Fecha actual\n    \"text\": formData.mensaje // **El TEXTO del formulario va aquí**\n  }\n};\n\n// Esto envía la estructura creada al siguiente nodo\nreturn [{ json: telegramSimulatedData }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -4400,
            -1060
          ],
          "id": "2a4c289c-e2aa-4ecc-aa7d-f8ad106f1709",
          "name": "Mensaje"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.pendiente }}",
                "Estado": "Pendiente",
                "Chat id": "={{ $json.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "name": "Agregar a hoja",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -2620,
            -880
          ],
          "id": "1110a378-1ad9-4504-b93c-cebbda59eea5",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json['Chat id'] }}",
            "text": "=✅ Pendiente {{ $json.Pendiente }} registrado.",
            "additionalFields": {}
          },
          "name": "Confirm Add Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2440,
            -860
          ],
          "id": "f8523526-d917-463a-9113-c32216c7017c",
          "webhookId": "4fcd2258-772a-4aa0-b3fe-82105317c473",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{$json.chatId}}",
            "text": "✅ Pendiente '{{ $json.pendiente }}' marcado como completado.",
            "additionalFields": {}
          },
          "name": "Confirmar Hecho Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            -2860,
            -440
          ],
          "id": "540b9e9b-e6d3-4fa8-8146-afc62e960a80",
          "webhookId": "ac9bca57-c807-44be-813c-ede25bb7d884",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Pendiente",
                  "lookupValue": "={{ $json.Pendiente }}"
                },
                {
                  "lookupColumn": "Chat id",
                  "lookupValue": "= {{$json.chatId}}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2960,
            -700
          ],
          "id": "e2ade0c0-40da-4578-9e4d-25d0b86a43ab",
          "name": "Pendient",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Estado": "completado",
                "Pendiente": "{{ $json.Pendiente }}"
              },
              "matchingColumns": [
                "Pendiente"
              ],
              "schema": [
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2800,
            -620
          ],
          "id": "2e3c5b1c-f198-4ba2-8d9c-f3a816794a1a",
          "name": "Completado",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "add",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "08a62ae7-f12c-4fdc-8835-ec887e60eb9f"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "919e7e00-c608-4fc6-9223-434fd81034d5",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "show",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6fafe8d6-f710-4707-b255-8720d9e595e9",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "del",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2840,
            -880
          ],
          "id": "3d8aeadf-645d-4b9f-8c0e-40bc6a9aac1f",
          "name": "Switch"
        },
        {
          "parameters": {
            "jsCode": "const ahora = new Date();\nreturn items.filter(item => {\n  const estado = item.json.estado?.toLowerCase();\n  const fecha = new Date(item.json.fecha);\n  return estado === 'pendiente' && fecha <= ahora;\n});\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2440,
            -680
          ],
          "id": "fc8dff26-4d96-44ce-b861-a65e0ab32c2b",
          "name": "Filtrar Vencidos1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -2620,
            -700
          ],
          "id": "7359eda4-6a99-43cc-9e4a-cc6682ad1c7b",
          "name": "show",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{$json.chatId}}",
            "text": "=pendiente \"{{ $json.pendiente }}\" programado para {{ $json.fecha }}.   Cuando lo completes, responde: pendiente cumplido {{ $json.pendiente }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2520,
            -500
          ],
          "id": "77af4261-3c64-46b4-9fbc-43930a61cc01",
          "name": "Telegram1",
          "webhookId": "ba000aa8-1dcd-42f1-bff9-c2dd9a383375",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "AgtIntent": {
          "main": [
            [
              {
                "node": "SwIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GemIntent": {
          "ai_languageModel": [
            [
              {
                "node": "AgtIntent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "SwIntent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtExtract",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtStatus",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Gasto",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "pago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgtPendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtExtract": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Resultado ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscarID": {
          "ai_languageModel": [
            [
              {
                "node": "AgtExtract",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "statusID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit2": {
          "main": [
            [
              {
                "node": "Resultado ID3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgtStatus": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "status": {
          "ai_languageModel": [
            [
              {
                "node": "AgtStatus",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "statusID": {
          "main": [
            [
              {
                "node": "Limit2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AgtPendient",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "AgtPendient": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Mensaje",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mensaje1": {
          "main": [
            []
          ]
        },
        "Mensaje": {
          "main": [
            [
              {
                "node": "AgtIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agregar a hoja": {
          "main": [
            [
              {
                "node": "Confirm Add Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendient": {
          "main": [
            [
              {
                "node": "Completado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completado": {
          "main": [
            [
              {
                "node": "Confirmar Hecho Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Agregar a hoja",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "show",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filtrar Vencidos1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "show": {
          "main": [
            [
              {
                "node": "Filtrar Vencidos1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "8bff5fa4-1a09-4ea0-a65c-c4af89620758",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-11T22:00:56.980Z",
          "createdAt": "2025-06-11T22:00:56.980Z",
          "role": "workflow:owner",
          "workflowId": "axp4rTx3ArDnUOxd",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-23T03:19:39.000Z",
      "createdAt": "2025-05-14T20:23:19.285Z",
      "id": "boSAbW8Gk5F1Oxwh",
      "name": "Mikrotik",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 553 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@192.168.88.1 \\\n':global clientKey \"ricardo perez\";\n:local bindingState [/ip hotspot ip-binding get [find comment=$clientKey] disabled];\n:if ($bindingState) do={ :put \"Activado:disabled\"; } else={ :put \"Activado:active\"; }\n\n:put (\"Conectado:\" . [/ip dhcp-server lease get [find comment=$clientKey] status]);\n\n:put (\"FechaCorte:\" . [/system scheduler get [find name=$clientKey] next-run]);'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            280,
            -40
          ],
          "id": "e5a63383-4177-485f-8515-8740c85569d6",
          "name": "ConsultaStatus"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/ip hotspot ip-binding print terse\" | grep \"{{ $json.Mac }}\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -420,
            -280
          ],
          "id": "b7fa6d11-2c85-4c8a-880d-6f1427bf9018",
          "name": "ConsultaStatus1"
        },
        {
          "parameters": {
            "formTitle": "Mac",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Mac"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -640,
            -280
          ],
          "id": "20fb3c31-83e4-48dc-a838-0267303ce4cd",
          "name": "On form submission",
          "webhookId": "0334ea9d-826a-46c8-ab08-5bb724e28833",
          "disabled": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "bc90fc41-2abe-4c4c-9b1c-a3b8d2569da6",
                  "leftValue": "={{ $json.stdout }}",
                  "rightValue": " XP ",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            140,
            -260
          ],
          "id": "3887d156-9d18-412d-a548-f756c4849c05",
          "name": "If"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "DESACTIVADO",
            "completionMessage": "=",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            360,
            -360
          ],
          "id": "360c91ef-5c6c-4257-9560-fe48e80952b2",
          "name": "Form",
          "webhookId": "8dd64491-acf4-4627-ade1-6be25253e247"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "ACTIVADO",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            360,
            -160
          ],
          "id": "e796b1fc-4c01-4def-a093-dff4a91ff1eb",
          "name": "Form1",
          "webhookId": "465ed045-97cd-451d-ad99-59199b8621df"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene la salida del comando anterior (ConsultaStatus1)\nconst stdout = $json.stdout;\nlet status_message = '';\n\n// 1. Comprueba si la salida está vacía (MAC no encontrada)\nif (!stdout || stdout.trim() === '') {\n  status_message = 'MAC NO ENCONTRADA';\n}\n// 2. Comprueba si la MAC está deshabilitada (contiene 'XP')\nelse if (stdout.includes(' XP ')) {\n  status_message = 'DESACTIVADO';\n}\n// 3. Si no es ninguna de las anteriores, está activada\nelse {\n  status_message = 'ACTIVADO';\n}\n\n// Devuelve el resultado en un nuevo campo llamado 'status'\nreturn [{\n  json: {\n    status: status_message\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -200,
            -280
          ],
          "id": "551bcc78-874b-4d55-b26f-0abf85f0e2e2",
          "name": "Code"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "={{ $('Code1').item.json.status }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -20,
            -100
          ],
          "id": "6fe8b638-daed-48fc-83af-bb284e298e2b",
          "name": "Resultado del Formulario",
          "webhookId": "231e8b2b-42b3-4f11-9257-897d91e81395"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/ip hotspot ip-binding print terse\" | grep \"{{ $json.Mac }}\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -460,
            -100
          ],
          "id": "071dafdd-8c2e-44b5-a412-b8dd35a9d4e3",
          "name": "ConsultaStatus2"
        },
        {
          "parameters": {
            "formTitle": "Verificar Status de MAC",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Mac"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -680,
            -100
          ],
          "id": "d67ede64-8974-4fac-a04e-f3ff6f062d26",
          "name": "On form submission1",
          "webhookId": "9ec61d77-31cf-4b6e-b25a-9ded56ae3c43"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene la salida del comando anterior (ConsultaStatus1)\nconst stdout = $json.stdout;\nlet status_message = '';\n\n// 1. Comprueba si la salida está vacía (MAC no encontrada)\nif (!stdout || stdout.trim() === '') {\n  status_message = 'MAC NO ENCONTRADA';\n}\n// 2. Comprueba si la MAC está deshabilitada (contiene 'XP')\nelse if (stdout.includes(' XP ')) {\n  status_message = 'DESACTIVADO';\n}\n// 3. Si no es ninguna de las anteriores, está activada\nelse {\n  status_message = 'ACTIVADO';\n}\n\n// Devuelve el resultado en un nuevo campo llamado 'status'\nreturn [{\n  json: {\n    status: status_message\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -240,
            -100
          ],
          "id": "2ef64d80-eb54-42c4-a144-26d4cb11b55a",
          "name": "Code1"
        }
      ],
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "ConsultaStatus1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ConsultaStatus1": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ConsultaStatus2": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission1": {
          "main": [
            [
              {
                "node": "ConsultaStatus2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Resultado del Formulario",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "271965b9-bdaf-436d-9da1-5c5d442e22d5",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-05-14T20:23:19.299Z",
          "createdAt": "2025-05-14T20:23:19.299Z",
          "role": "workflow:owner",
          "workflowId": "boSAbW8Gk5F1Oxwh",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-24T03:40:04.000Z",
      "createdAt": "2025-06-19T16:43:39.573Z",
      "id": "cMgCePQYNGWwCJ5g",
      "name": "CompletarNuevoCliente",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c069b524-b2b4-4126-b3ff-526fb40428ee",
                  "leftValue": "={{ $json.IDCliente }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -736,
            -416
          ],
          "id": "2c94a52a-d1f2-462e-9934-627dbc3dcb06",
          "name": "If"
        },
        {
          "parameters": {
            "formTitle": "ID Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cliente ID",
                  "requiredField": true
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "completar",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1120,
            -416
          ],
          "id": "799532f4-e64c-45be-865d-9ea9e4819a48",
          "name": "IDCliente",
          "webhookId": "6d0c432c-5007-4ca1-83df-598d331d3737"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
              "mode": "list",
              "cachedResultName": "Contrataciones",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $json['Cliente ID'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -944,
            -416
          ],
          "id": "375b25d2-9aac-4240-98eb-907cd1b25a05",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "ERROR",
            "completionMessage": "=Cliente {{ $('IDCliente').item.json['Cliente ID'] }} No encontrado",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -496,
            -384
          ],
          "id": "6268ea14-e760-424e-b6ed-de047473f6b0",
          "name": "Error",
          "webhookId": "81fd8b6e-d1e0-45d8-a7b0-e7ed46a3d5b4"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Modem Mac",
                  "placeholder": "={{ $('Datos').item.json.ModemMac }}",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Antena IP",
                  "placeholder": "={{ $('Datos').item.json.AntenaIP }}",
                  "requiredField": true
                },
                {
                  "fieldLabel": "ConectadoBase",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de Instalacion",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de Pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Recomendado por -ID Cliente-",
                  "placeholder": "={{ $json[\"Recomendado por..(ID Cliente)\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Llenar Campos",
              "formDescription": "=ID: {{ $('Datos').item.json.IDCliente }}\nNombre: {{ $('Datos').item.json[\"Nombre completo\"] }}\n\nAntes de Continuar Verifica Que los Datos Todo este Correctos",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -720,
            -192
          ],
          "id": "47a1be9e-5170-42b7-8d21-c409fc17bda7",
          "name": "Faltantes",
          "webhookId": "5c04d6e2-5477-4e54-ac99-698564fb4323"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro Exitoso",
            "completionMessage": "=Nombre: {{ $('Limpiar').item.json[\"Nombre completo\"] }} -- ID Cliente: {{ $('Limpiar').item.json.IDCliente }} -- Mac: {{ $('Limpiar').item.json['Modem Mac'] }} -- AntenaIP: {{ $('Limpiar').item.json['Antena IP'] }} -- Instalado: {{ $('Limpiar').item.json['Fecha de Instalacion'] }} -- Fecha de Corte: {{ $('Limpiar').item.json.DatePay }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            592,
            192
          ],
          "id": "6bc3842c-84ca-424d-aea7-690e38e0d735",
          "name": "Fin",
          "webhookId": "6d1f1eaa-0d28-4d89-b87b-2c5c7357c2ef"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
              "mode": "list",
              "cachedResultName": "Contrataciones",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $('IDCliente').item.json[\"Cliente ID\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -1120,
            -192
          ],
          "id": "7ad6cca5-8f74-4f00-81ee-a592d8c7c9ab",
          "name": "Datos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json[\"Fecha de Pago\"] }}",
            "format": "custom",
            "customFormat": "MMM/dd/yyyy",
            "outputFieldName": "DatePay",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            160,
            -416
          ],
          "id": "ba06d026-2b70-497b-9354-dc0602da0bcb",
          "name": "FechaCort"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b0a8f3f7-fc85-4c0f-a240-0bd545e63732",
                  "name": "IDCliente",
                  "value": "={{ $('Datos').item.json.IDCliente }}",
                  "type": "string"
                },
                {
                  "id": "ff94a3db-6256-4081-89d7-53e91084a5ff",
                  "name": "Nombre completo",
                  "value": "={{ $('Existe?').item.json['Nombre completo'] }}",
                  "type": "string"
                },
                {
                  "id": "ee588dc8-5266-4b47-bba1-633ed636847f",
                  "name": "Modem Mac",
                  "value": "={{ $('Faltantes').item.json[\"Modem Mac\"] }}",
                  "type": "string"
                },
                {
                  "id": "ad62e5df-3fd7-4aee-a3ef-c079d85a7454",
                  "name": "Antena IP",
                  "value": "={{ $('Faltantes').item.json[\"Antena IP\"] }}",
                  "type": "string"
                },
                {
                  "id": "e7547eff-be6d-4c6e-bf28-f27e0997277f",
                  "name": "ConectadoBase",
                  "value": "={{ $('Faltantes').item.json[\"ConectadoBase\"] }}",
                  "type": "string"
                },
                {
                  "id": "d64f947d-6603-409b-9581-ff5f1b05d4e3",
                  "name": "Fecha de Instalacion",
                  "value": "={{ $('Faltantes').item.json[\"Fecha de Instalacion\"] }}",
                  "type": "string"
                },
                {
                  "id": "e699f2be-8bcc-4012-8cc7-85203f6da0b7",
                  "name": "DatePay",
                  "value": "={{ $json.DatePay }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            352,
            -416
          ],
          "id": "130eb1e8-27ba-49bf-8851-63b295c186c2",
          "name": "Limpiar"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -T -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/system scheduler add name=\\\"{{ $json.IDCliente }}\\\" start-date=\\\"{{ $json.DatePay }}\\\" interval=31d on-event=\\\"/ip hotspot ip-binding disable [find mac-address={{$json['Modem Mac']}}]\\\"\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            560,
            -416
          ],
          "id": "f48cff02-3ee5-4477-a8e4-11ff6d9eda5e",
          "name": "addSchedule"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY",
              "mode": "list",
              "cachedResultName": "Contrataciones",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NxiorDY6-j2ifPemrNfimBBerPuO7JG7sqMUdN7D2sY/edit#gid=1656915010"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "IDCliente": "={{ $('Datos').item.json.IDCliente }}",
                "ModemMac": "={{ $('Limpiar').item.json['Modem Mac'] }}",
                "AntenaIP": "={{ $('Limpiar').item.json['Antena IP'] }}",
                "FechaInstalacion": "={{ $('Limpiar').item.json['Fecha de Instalacion'] }}",
                "FechaPago": "={{ $('Limpiar').item.json.DatePay }}",
                "ConectadoBase": "={{ $('Limpiar').item.json.ConectadoBase }}"
              },
              "matchingColumns": [
                "IDCliente"
              ],
              "schema": [
                {
                  "id": "Marca temporal",
                  "displayName": "Marca temporal",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Dirección ",
                  "displayName": "Dirección ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Numero de teléfono",
                  "displayName": "Numero de teléfono",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Zona de Cobertura",
                  "displayName": "Zona de Cobertura",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Localidad",
                  "displayName": "Localidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Plan a Contratar",
                  "displayName": "Plan a Contratar",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Recomendado por..(ID Cliente)",
                  "displayName": "Recomendado por..(ID Cliente)",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Colonia/Zona",
                  "displayName": "Colonia/Zona",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Plan a Contratar",
                  "displayName": "Plan a Contratar",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Zona",
                  "displayName": "Zona",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Plan",
                  "displayName": "Plan",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "ModemMac",
                  "displayName": "ModemMac",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "AntenaIP",
                  "displayName": "AntenaIP",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "FechaPago",
                  "displayName": "FechaPago",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "FechaInstalacion",
                  "displayName": "FechaInstalacion",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "IDCliente",
                  "displayName": "IDCliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ConectadoBase",
                  "displayName": "ConectadoBase",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Merged Doc ID - contrato",
                  "displayName": "Merged Doc ID - contrato",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Merged Doc URL - contrato",
                  "displayName": "Merged Doc URL - contrato",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Link to merged Doc - contrato",
                  "displayName": "Link to merged Doc - contrato",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Document Merge Status - contrato",
                  "displayName": "Document Merge Status - contrato",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            176,
            -176
          ],
          "id": "5eac5963-cdd9-41ad-a282-4e88b1657ef6",
          "name": "CompletaDatos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Todo Ok?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Si todo OK"
                      },
                      {
                        "option": "Modificar Registro"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Registro completo. Deseas modificar?",
              "formDescription": "=ID {{ $json.IDCliente }} Nombre {{ $json[\"Nombre completo\"] }} Modem {{ $json.ModemMac }} Antena {{ $json.AntenaIP }} Fecha de Pago {{ $json.FechaPago }} Instalado el {{ $json.FechaInstalacion }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -1120,
            80
          ],
          "id": "e4ac5255-b5f6-48d4-bb19-b926cac4dc65",
          "name": "Modificar?",
          "webhookId": "c764cd8e-0fe4-452e-84b1-eb0b3a0f3590"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "542afc8a-433e-4384-a0cf-e783f4478a73",
                  "leftValue": "={{ $json.ModemMac }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "74ee96be-116e-4a51-89f1-1ad615225955",
                  "leftValue": "={{ $json.AntenaIP }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "5ca52d5f-d696-40bb-865e-5ee7c15af6fa",
                  "leftValue": "={{ $json.FechaInstalacion }}",
                  "rightValue": "",
                  "operator": {
                    "type": "dateTime",
                    "operation": "empty",
                    "singleValue": true
                  }
                },
                {
                  "id": "21859303-ae1d-4530-a8d8-5adad38e91bb",
                  "leftValue": "={{ $json.FechaPago }}",
                  "rightValue": "",
                  "operator": {
                    "type": "dateTime",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -944,
            -192
          ],
          "id": "67bf11a4-3586-4262-98da-f35ee1d6664a",
          "name": "Existe?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ca18ae1a-ecea-4fc3-98cc-f9da6c3187c0",
                  "leftValue": "={{ $json[\"Todo Ok?\"] }}",
                  "rightValue": "Modificar Registro",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -944,
            80
          ],
          "id": "ef1fd0ad-bb55-4e7b-a5f6-c956de06b383",
          "name": "Acepta"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Registro Sin Cambios",
            "completionMessage": "Todo Ok",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -720,
            48
          ],
          "id": "b8b33ba6-d7a6-4018-8d3a-04f0c18b63a2",
          "name": "Cancel",
          "webhookId": "b49e5e55-be27-4bc8-8a83-0aaf2053f780"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.IDCliente }}",
                "Fecha de corte": "={{ $json.FechaPago }}",
                "MAC ID": "={{ $json.ModemMac }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            368,
            -176
          ],
          "id": "297c6be2-e9b7-4067-9543-bae02b18622a",
          "name": "DatosChiq",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"] }}"
                },
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -224,
            64
          ],
          "id": "c05f5c78-cbb0-4323-9256-2647f475ec53",
          "name": "Bono",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6e9b61c3-be0d-4cc1-ae57-06c62bd116bf",
                  "leftValue": "={{ $json[\"Recomendado por -ID Cliente-\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -496,
            -192
          ],
          "id": "89ab7c55-b6dc-4165-9fca-b16cf546b8b1",
          "name": "Recomendado?"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json[\"Recomendado por -ID Cliente-\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -224,
            -192
          ],
          "id": "cca4798c-a6f3-4338-9751-d0f73bc2ff81",
          "name": "BuscaRecom",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "27f9568a-8ab5-4095-965a-1a30eb6d565b",
                  "leftValue": "={{ $json[\"ID Cliente\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -48,
            -192
          ],
          "id": "8b538b9b-9d33-4f6a-b607-e58b8ddaa2e5",
          "name": "If1"
        },
        {
          "parameters": {
            "options": {
              "formTitle": "Cliente no encontrado"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -496,
            32
          ],
          "id": "51fa47d2-e612-41f2-ac3c-d3755466079c",
          "name": "NoEncontrado",
          "webhookId": "4e72855b-ef38-46f0-88f2-3744c4929a40"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "=Enviar el siguiente mensaje a :{{ $json.ID }}- {{ $('If2').item.json.Nombre }}. Felicidades has ganado $100 pesos por recomendar a  {{ $json[\"Por recomendar a:\"] }}\n\nPara reclamar tu regalo, en tu pròximo pago selecciona la opciòn pagar varios meses, selecciona otro e ingresa el còdigo: {{ $json.Codigo }} para usar tus $100 pesos de regalo. ",
                "Estado": "Pendiente",
                "Chat id": "7972655827"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -256,
            -400
          ],
          "id": "6b981e75-cd7a-41c4-8592-cb5c46d9b557",
          "name": "Pend-msn",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "cb1ac556-1007-4732-9da3-dc3af509ba72",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -48,
            64
          ],
          "id": "11ad0112-0e4f-4d47-9848-e98225f769ff",
          "name": "If2"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID": "={{ $json.ID }}",
                "Cantidad": "=={{ $json[\"Cantidad\"] + 100 }}",
                "Por recomendar a:": "=={{ $json[\"Por recomendar a:\"] ? $json[\"Por recomendar a:\"] + \", \" + $('Datos').item.json[\"Nombre completo\"] : $('Datos').item.json[\"Nombre completo\"] }}"
              },
              "matchingColumns": [
                "ID"
              ],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Codigo",
                  "displayName": "Codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Por recomendar a:",
                  "displayName": "Por recomendar a:",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            368,
            80
          ],
          "id": "240206d0-76ed-4d81-af83-cb437ea6c6d6",
          "name": "add100",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $now.toFormat('dd/MM/yyyy') }}",
                "ID": "={{ $('BuscaRecom').item.json[\"ID Cliente\"] }}",
                "Nombre": "={{ $('BuscaRecom').item.json[\"Nombre completo\"] }}",
                "Cantidad": "100",
                "Estado": "Pendiente",
                "Por recomendar a:": "={{ $('Buscar').item.json[\"Nombre completo\"] }}",
                "Codigo": "={{   Math.random().toString(36).substring(2, 6).toUpperCase() }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Codigo",
                  "displayName": "Codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Por recomendar a:",
                  "displayName": "Por recomendar a:",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            144,
            48
          ],
          "id": "47d2c3fe-59ce-45c1-8701-a9457db215bf",
          "name": "Bono100",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -32,
            -416
          ],
          "id": "b6f70d98-5afe-4916-bc18-8be500d4f562",
          "name": "Merge"
        }
      ],
      "connections": {
        "If": {
          "main": [
            [
              {
                "node": "Datos",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IDCliente": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Faltantes": {
          "main": [
            [
              {
                "node": "Recomendado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datos": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCort": {
          "main": [
            [
              {
                "node": "Limpiar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limpiar": {
          "main": [
            [
              {
                "node": "addSchedule",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "addSchedule": {
          "main": [
            [
              {
                "node": "CompletaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CompletaDatos": {
          "main": [
            [
              {
                "node": "DatosChiq",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modificar?": {
          "main": [
            [
              {
                "node": "Acepta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modificar?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acepta": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Cancel",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosChiq": {
          "main": [
            [
              {
                "node": "Fin",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Bono": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recomendado?": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "BuscaRecom",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaRecom": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "NoEncontrado",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Bono",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "NoEncontrado": {
          "main": [
            [
              {
                "node": "Faltantes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pend-msn": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Bono100",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "add100",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "add100": {
          "main": [
            [
              {
                "node": "Pend-msn",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Bono100": {
          "main": [
            [
              {
                "node": "Pend-msn",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "FechaCort",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "4fb98190-5f4a-4ab1-a094-2ccfb66eb6af",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-19T16:43:39.582Z",
          "createdAt": "2025-06-19T16:43:39.582Z",
          "role": "workflow:owner",
          "workflowId": "cMgCePQYNGWwCJ5g",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-08T13:12:53.000Z",
      "createdAt": "2025-09-27T19:36:17.612Z",
      "id": "dfpHMfGuMh8WhiiF",
      "name": "AgenteNew",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -240,
            -160
          ],
          "id": "6e1be80c-b9fb-4588-ae2e-1ab1061fbc51",
          "name": "Mensaje",
          "webhookId": "9ae43a27-ae09-4139-8531-f5d19d5fee74",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=No toy",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            608,
            160
          ],
          "id": "f52ea411-f317-411c-ae02-b0125549635e",
          "name": "Respuesta",
          "webhookId": "b416f3be-df2f-4d6d-9602-5cb63698a042",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4da42528-a5f9-4321-a0c8-55363bd93037",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "SALUDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bb95cbec-d074-49cf-86f4-2e10f729c7f9",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "BUSCAR_NOMBRE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "675f82ad-14e4-456c-929d-fa64a6552f48",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ESTADO_CLIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "REPORTAR_GASTO",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "cd7f0500-527d-4be7-bf61-b5a5cdeac877"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f738687-f3c2-4715-a82a-05640916957b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "REPORTAR_PAGO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "48297539-bf1e-49f9-89a0-5665b0ed81e9",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "DESCONOCIDO",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b3137ff5-3906-4cbb-9917-a6efb244bab6",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "PENDIENTE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3f66a1c0-6dc9-47f6-960b-f5b623ea1b91",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "COMPLETAR",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -224,
            64
          ],
          "id": "ce8cdb2d-a6da-4f53-9eb9-41b2c0020845",
          "name": "SwIntent"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=¡Hola! 👋 ¿En qué puedo ayudarte hoy? Puedes: - Buscar el ID de un cliente (ej: \"busca el ID de Ana\") - Consultar el estado de un cliente (ej: \"estado del ID 123\") - Reportar un gasto o ingreso - Reportar un pago mensual - Registrar listar y completar pendientes - Completar registros de nuevos clientes",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            176,
            -160
          ],
          "id": "bd161699-6ef8-4474-ab87-235c441d13e2",
          "name": "Telegram",
          "webhookId": "efa4fc61-612a-4209-b51d-571838248a65",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            176,
            16
          ],
          "id": "06dc58ef-f6aa-4158-b91c-7aa4b53fd92f",
          "name": "If"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            608,
            -160
          ],
          "id": "fc658783-9145-4653-876c-bc04426c6367",
          "name": "Limit"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "xB5k8lNiGd17TIji",
              "mode": "list",
              "cachedResultName": "BuscarChiq2"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "Nombre": "={{ $json.nombre }}",
                "IdChat": "={{ $('Mensaje').item.json.message.chat.id.toString() }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "IdChat",
                  "displayName": "IdChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            400,
            -160
          ],
          "id": "801e8d40-0e39-4a10-906f-fa809998cef0",
          "name": "Buscar",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el nombre que quieres buscar (ej: 'busca el ID de Ana').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            400,
            -16
          ],
          "id": "b12c976e-ab13-42ed-ba5d-9badc462c7db",
          "name": "NoEntender",
          "webhookId": "011f7d8d-f323-4292-8684-27c6aa9e80e5",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "aed1bec2-4343-40c4-b5c6-fa8a0cf7fce5",
                  "leftValue": "={{ $json.output !== \"NoEspecificado\"  }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            176,
            160
          ],
          "id": "4bee4379-eade-4f06-936a-c59f1be47f21",
          "name": "If2"
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "Por favor, dime el ID del cliente que quieres saber su estado (ej: como aparece d456').",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            400,
            288
          ],
          "id": "a5f97042-42a2-46e7-b5c5-5910b56e7bef",
          "name": "NoEntender1",
          "webhookId": "32447985-3229-4b47-b400-042703300e1e",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "8EoTMqNoy8ATG1hs",
              "mode": "list",
              "cachedResultName": "StatusIDC"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "ID Cliente": "={{ $json.idCliente.trim() }}",
                "idChat": "={{ $('Mensaje').item.json.message.chat.id }} "
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "idChat",
                  "displayName": "idChat",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            400,
            144
          ],
          "id": "44efbbc0-1043-4d26-b5cd-c36e466d4487",
          "name": "statusID",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=Reportar ingresos y gastos <a href=\"https://n8n.albored.com/form/gastos\">AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            608,
            -16
          ],
          "id": "fd544cda-10a1-4786-86de-f6523d69c548",
          "name": "Gasto",
          "webhookId": "92dad1b9-9cbf-48a8-a94d-23de5eb01248",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/Pago1Mes\">Reportar Pago 1MES AQUI</a>\n\n<a href=\"https://n8n.albored.com/form/Varios\">Reportar Pago Varios meses AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -32,
            320
          ],
          "id": "fefdb498-ba89-41d0-bfe4-7526eee00738",
          "name": "pago",
          "webhookId": "1afef729-f7b0-40e4-84dd-09e5608078dd",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Analiza el mensaje y extrae accion y pendiente, luego estructura el objeto final\n\nconst texto = $json.message.text.toLowerCase();\n\nlet accion = \"\";\nlet pendiente = \"\";\n\n// Agregar pendiente\nif (/anota en pendientes|pon en pendientes|registrar en pendientes|registra en pendientes|agrega pendiente|añade pendiente/.test(texto)) {\n  accion = \"add\";\n  const match = texto.match(/(?:anota en pendientes|pon en pendientes|registrar en pendientes|registra en pendientes|agrega pendiente|añade pendiente)\\s*(.*)/);\n  pendiente = match && match[1] ? match[1].trim() : \"\";\n}\n// Mostrar pendientes\nelse if (/cuales son los pendientes|qué pendientes hay|mostrar pendientes|lista de pendientes/.test(texto)) {\n  accion = \"show\";\n  pendiente = \"\";\n}\n// Completar/eliminar pendiente\nelse if (/pendiente\\s*\\d+\\s*completado|quitar pendiente\\s*\\d+|eliminar pendiente\\s*\\d+/.test(texto)) {\n  accion = \"del\";\n  const match = texto.match(/pendiente\\s*(\\d+)\\s*completado|quitar pendiente\\s*(\\d+)|eliminar pendiente\\s*(\\d+)/);\n  pendiente = match ? (match[1] || match[2] || match[3]) : \"\";\n}\nelse {\n  accion = \"desconocido\";\n  pendiente = \"\";\n}\n\n// Estructura el objeto final como antes\nconst item = items[0];\nitem.json = {\n  accion,\n  pendiente,\n  id: $json.message.chat.id\n};\n\nreturn [item];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            176,
            304
          ],
          "id": "7f81b17b-45b1-4ce9-bdaa-b1d467351557",
          "name": "Code"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bd191530-ac43-4a91-bbdc-dc3e79c1bf87",
                  "name": "accion",
                  "value": "={{ $('Code').item.json.accion }}",
                  "type": "string"
                },
                {
                  "id": "ec194e3c-caf6-4160-8895-f0df5443e5c5",
                  "name": "pendiente",
                  "value": "={{ $('Code').item.json.pendiente }}",
                  "type": "string"
                },
                {
                  "id": "f9430989-4996-4f48-b230-cc485f0683a4",
                  "name": "id",
                  "value": "={{ $('Mensaje').item.json.message.chat.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -32,
            480
          ],
          "id": "74400e24-7cd9-42a2-ad8d-5b14fa1e3d94",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.pendiente }}",
                "Estado": "Pendiente",
                "Chat id": "={{ $json.id }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "name": "Agregar a hoja",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            816,
            32
          ],
          "id": "7198a593-fbbe-41a0-81f2-48a36a9be07a",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json['Chat id'] }}",
            "text": "=✅ Pendiente {{ $json.Pendiente }} registrado.",
            "additionalFields": {}
          },
          "name": "Confirm Add Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            1008,
            48
          ],
          "id": "ed41de9c-62ba-4041-8c65-80bacd367f46",
          "webhookId": "3a091244-2165-4a1e-84a6-d2d6ce594951",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Edit Fields').item.json.id }}",
            "text": "=✅ Pendiente '{{ $('Edit Fields').item.json.pendiente }}' cambiò a completado. ",
            "additionalFields": {}
          },
          "name": "Confirmar Hecho Telegram",
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1,
          "position": [
            816,
            544
          ],
          "id": "96c9ccfa-c5b1-4694-b8a8-6d6d6d114701",
          "webhookId": "d5f59a3d-1dab-4e40-9424-1f894c173f5b",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "No",
                  "lookupValue": "={{ $json.pendiente.replace(/\"/g, '') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            400,
            464
          ],
          "id": "1ca16118-61f5-4af2-8198-c2bcd701aff2",
          "name": "Pendient",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Pendiente": "={{ $json.Pendiente }}",
                "Estado": "Completado"
              },
              "matchingColumns": [
                "Pendiente"
              ],
              "schema": [
                {
                  "id": "No",
                  "displayName": "No",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Pendiente",
                  "displayName": "Pendiente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Chat id",
                  "displayName": "Chat id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            608,
            496
          ],
          "id": "af47cbe9-2a46-43e1-8c31-6c9b7f28065c",
          "name": "Completado",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "add",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "08a62ae7-f12c-4fdc-8835-ec887e60eb9f"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "919e7e00-c608-4fc6-9223-434fd81034d5",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "show",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6fafe8d6-f710-4707-b255-8720d9e595e9",
                        "leftValue": "={{ $json.accion }}",
                        "rightValue": "del",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            176,
            448
          ],
          "id": "22334e7d-220d-4a97-98cd-098b470a4a77",
          "name": "Switch"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            608,
            336
          ],
          "id": "781a4a99-8814-4f0d-9f39-4166a3acddce",
          "name": "show",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Edit Fields').first().json.id }}",
            "text": "={{ $json.message }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            1008,
            368
          ],
          "id": "9c16e823-14e8-45f1-aea5-0df7484d2345",
          "name": "Telegram1",
          "webhookId": "489f4074-cc98-4c43-ae7d-5fdd35e4dba5",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "1b478ab7-c155-42aa-8a74-5acea89152c3",
                  "leftValue": "={{ $json.Estado }}",
                  "rightValue": "Pendiente",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            816,
            192
          ],
          "id": "edb2dea4-f40c-43e5-b8e0-3847667dfa5f",
          "name": "Filter"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9,
                  "triggerAtMinute": 20
                },
                {
                  "triggerAtHour": 13
                },
                {
                  "triggerAtHour": 17,
                  "triggerAtMinute": 3
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -480,
            -176
          ],
          "id": "4a8b3b19-fd48-42ca-818a-f98982154839",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q",
              "mode": "list",
              "cachedResultName": "Pendientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19iYNAvmXZ2zYV8bC6mTmMCTuWhNP6C3yN6iUBDfsM4Q/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -480,
            -32
          ],
          "id": "29f6edeb-d0fa-46a5-a310-ee12cb3c3cfb",
          "name": "Pendientes",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=⏰{{ $json.message }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -480,
            480
          ],
          "id": "8c971db3-9b20-44ea-95b7-e008d295f027",
          "name": "Recordatorio",
          "webhookId": "1e7baaba-55f4-4ba1-bb26-48435d3beb0d",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "=<a href=\"https://n8n.albored.com/form/completar\">Completar Registro AQUI</a>",
            "replyMarkup": "inlineKeyboard",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "HTML"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -240,
            480
          ],
          "id": "1c7ae9c8-db7e-4126-95e2-184009d98508",
          "name": "RegistroNuevo",
          "webhookId": "7a3f6b59-96b8-466e-9f31-ca553ed801ea",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Mensaje').item.json.message.chat.id }}",
            "text": "={{ $json.mensajeParaTelegram }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            816,
            -160
          ],
          "id": "6375f9de-a3ae-4b55-b8cb-c9c4eb3f215b",
          "name": "Resultado ID1",
          "webhookId": "924bc063-47f6-4ad4-8f30-bf61c0a90303",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0c3f89b2-a523-4a31-84bc-bf3453631992",
                  "leftValue": "={{ $json.Estado }}",
                  "rightValue": "Pendiente",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -480,
            144
          ],
          "id": "bc0551fb-bc20-4e7c-b452-95a533a8ccf9",
          "name": "Filter1"
        },
        {
          "parameters": {
            "jsCode": "const mensajesPendientes = [];\nlet chatID = null; // Variable para almacenar el Chat ID\n\n// Itera sobre cada item de entrada\nfor (const item of $input.all()) {\n  // Asegúrate de que los campos 'Pendiente' y 'No' existan\n  if (item.json.Pendiente && item.json.No !== undefined && item.json.No !== null) {\n    const pendienteTexto = item.json.Pendiente;\n    let numeroPendiente = String(item.json.No);\n    numeroPendiente = numeroPendiente.trim();\n\n    // Construye la línea para cada pendiente\n    mensajesPendientes.push(`- Pendiente: ${pendienteTexto}. Cuando lo completes, escribe: pendiente ${numeroPendiente} completado`);\n\n    // Captura el Chat ID del primer item. Asumiendo que es el mismo para todos o solo necesitas uno.\n    if (!chatID && item.json['Chat id']) { // Asegúrate de usar el nombre de campo exacto 'Chat id'\n      chatID = item.json['Chat id'];\n    }\n  }\n}\n\nlet mensajeFinal = \"No se encontraron pendientes.\";\nif (mensajesPendientes.length > 0) {\n  mensajeFinal = \"Aquí están tus pendientes:\\n\\n\" + mensajesPendientes.join('\\n\\n');\n}\n\n// Retorna un único item con el mensaje consolidado Y el Chat ID\nreturn [{\n  json: {\n    message: mensajeFinal,\n    telegramChatID: chatID // Agregamos el Chat ID a la salida JSON\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            816,
            352
          ],
          "id": "8a4345ea-32d7-4867-96e8-3ce735ff9c8c",
          "name": "Code1"
        },
        {
          "parameters": {
            "jsCode": "const mensajesPendientes = [];\nlet chatID = null; // Variable para almacenar el Chat ID\n\n// Itera sobre cada item de entrada\nfor (const item of $input.all()) {\n  // Asegúrate de que los campos 'Pendiente' y 'No' existan\n  if (item.json.Pendiente && item.json.No !== undefined && item.json.No !== null) {\n    const pendienteTexto = item.json.Pendiente;\n    let numeroPendiente = String(item.json.No);\n    numeroPendiente = numeroPendiente.trim();\n\n    // Construye la línea para cada pendiente\n    mensajesPendientes.push(`- Pendiente: ${pendienteTexto}. Cuando lo completes, escribe: pendiente ${numeroPendiente} completado`);\n\n    // Captura el Chat ID del primer item. Asumiendo que es el mismo para todos o solo necesitas uno.\n    if (!chatID && item.json['Chat id']) { // Asegúrate de usar el nombre de campo exacto 'Chat id'\n      chatID = item.json['Chat id'];\n    }\n  }\n}\n\nlet mensajeFinal = \"No se encontraron pendientes.\";\nif (mensajesPendientes.length > 0) {\n  mensajeFinal = \"Recuerda que hay estos pendientes:\\n\\n\" + mensajesPendientes.join('\\n\\n');\n}\n\n// Retorna un único item con el mensaje consolidado Y el Chat ID\nreturn [{\n  json: {\n    message: mensajeFinal,\n    telegramChatID: chatID // Agregamos el Chat ID a la salida JSON\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -480,
            320
          ],
          "id": "5682e51e-9158-421a-819c-cd9301a1a63d",
          "name": "Code2"
        },
        {
          "parameters": {
            "jsCode": "// Clasificación de intenciones por patrones simples\nconst texto = $json[\"message\"][\"text\"].toLowerCase();\nlet intencion = \"DESCONOCIDO\";\n\nif (/\\b(hola|buenos días|buenas tardes|buenas noches)\\b/.test(texto)) {\n  intencion = \"SALUDO\";\n} else if (/busca(r)?( el)? nombre|id de|dime el id de|buscar nombre|busca el id/i.test(texto)) {\n  intencion = \"BUSCAR_NOMBRE\";\n} else if (/estado de|como aparece|status de|esta conectado el|aparece el cliente/i.test(texto)) {\n  intencion = \"ESTADO_CLIENTE\";\n} else if (/gasto|registrar un gasto|gast[óo]|ingreso|recibi|reportar gasto/i.test(texto)) {\n  intencion = \"REPORTAR_GASTO\";\n} else if (/reportar pago|pago mensual|pago de id|reportar pago de/i.test(texto)) {\n  intencion = \"REPORTAR_PAGO\";\n} else if (/pendiente|anota en pendientes|pon en pendientes|quitar pendiente|completado/i.test(texto)) {\n  if (/completar( registro)?/i.test(texto)) {\n    intencion = \"COMPLETAR\";\n  } else {\n    intencion = \"PENDIENTE\";\n  }\n} else if (/completar( registro)?|terminar registro|finalizar registro/i.test(texto)) {\n  intencion = \"COMPLETAR\";\n}\n\nreturn [{ json: { ...$json, intencion } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -32,
            -160
          ],
          "id": "1bbf2a7a-5404-45a0-908a-5ab12016a5e7",
          "name": "ClasificarIntencion"
        },
        {
          "parameters": {
            "jsCode": "// Extrae el nombre de la persona a buscar\nconst texto = $json[\"message\"][\"text\"];\nconst match = texto.match(/(?:id de|nombre de|busca el id de|busca el nombre de|dime el id de)\\s+([a-záéíóúñ ]+)/i);\nlet nombre = \"NoEspecificado\";\nif (match && match[1]) {\n  nombre = match[1].trim().split(\" \")[0];\n}\nreturn [{ json: { ...$json, nombre } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -32,
            16
          ],
          "id": "f8bc7f8c-d7b2-47b1-86cd-69291eaf5cbf",
          "name": "ExtraerNombre"
        },
        {
          "parameters": {
            "jsCode": "// Extrae el ID del cliente\nconst texto = $json[\"message\"][\"text\"];\nconst match = texto.match(/(?:estado de|como aparece|status de|id)\\s*([a-z0-9]+)/i);\nlet idCliente = \"NoEspecificado\";\nif (match && match[1]) {\n  idCliente = match[1].trim();\n}\nreturn [{ json: { ...$json, idCliente } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -32,
            160
          ],
          "id": "6d7a5072-bfb4-43ab-82cb-3d4a7a0b3ac5",
          "name": "ExtraerID"
        }
      ],
      "connections": {
        "Mensaje": {
          "main": [
            [
              {
                "node": "ClasificarIntencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SwIntent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ExtraerNombre",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ExtraerID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Gasto",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "pago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respuesta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "RegistroNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Resultado ID1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "statusID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoEntender1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agregar a hoja": {
          "main": [
            [
              {
                "node": "Confirm Add Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendient": {
          "main": [
            [
              {
                "node": "Completado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completado": {
          "main": [
            [
              {
                "node": "Confirmar Hecho Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Agregar a hoja",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "show",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pendient",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "show": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pendientes": {
          "main": [
            [
              {
                "node": "Filter1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter1": {
          "main": [
            [
              {
                "node": "Code2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code2": {
          "main": [
            [
              {
                "node": "Recordatorio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ClasificarIntencion": {
          "main": [
            [
              {
                "node": "SwIntent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtraerNombre": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtraerID": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "dfpHMfGuMh8WhiiF"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Schedule Trigger": [
          {
            "json": {
              "timestamp": "2025-11-18T13:00:06.471-05:00",
              "Readable date": "November 18th 2025, 1:00:06 pm",
              "Readable time": "1:00:06 pm",
              "Day of week": "Tuesday",
              "Year": "2025",
              "Month": "November",
              "Day of month": "18",
              "Hour": "13",
              "Minute": "00",
              "Second": "06",
              "Timezone": "America/New_York (UTC-05:00)"
            }
          }
        ],
        "Mensaje": [
          {
            "json": {
              "update_id": 275664806,
              "message": {
                "message_id": 3113,
                "from": {
                  "id": 7654665377,
                  "is_bot": false,
                  "first_name": "Sandra",
                  "last_name": "Maldonado",
                  "language_code": "es"
                },
                "chat": {
                  "id": 7654665377,
                  "first_name": "Sandra",
                  "last_name": "Maldonado",
                  "type": "private"
                },
                "date": 1765169311,
                "text": "Reportar pago"
              }
            }
          }
        ]
      },
      "versionId": "0248ece0-7ecd-4a65-800b-2dcd703ed38a",
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-09-27T19:36:17.624Z",
          "createdAt": "2025-09-27T19:36:17.624Z",
          "role": "workflow:owner",
          "workflowId": "dfpHMfGuMh8WhiiF",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-05-21T05:27:17.000Z",
      "createdAt": "2025-05-17T05:13:17.820Z",
      "id": "dzo3znB00pWNe4mh",
      "name": "TelegramChiq",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json[\"Texto - command\"] }}",
                        "rightValue": "=^(/start|hola|menu|ayuda)$",
                        "operator": {
                          "type": "string",
                          "operation": "regex"
                        },
                        "id": "684e7a84-066e-43f7-a013-56b81446a3ed"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "707b5723-49d1-46a5-89d2-ecefc23406c6",
                        "leftValue": "={{ $json[\"Texto - command\"] }}",
                        "rightValue": "buscar cliente",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "5d1dcacd-9296-47fc-acc9-a8b21ab5f712",
                        "leftValue": "={{ $json[\"Texto - command\"] }}",
                        "rightValue": "registrar pago",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "274d01b4-4fee-4796-8d83-18ca980da057",
                        "leftValue": "={{ $json[\"Texto - command\"] }}",
                        "rightValue": "ingre/gast",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "bcccca57-02e3-4f44-8f9e-08000542cfb4",
                        "leftValue": "={{ $json[\"Texto - command\"] }}",
                        "rightValue": "/Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1300,
            -780
          ],
          "id": "f588b5bd-ef1d-4af6-94b4-19e8ba03b159",
          "name": "Switch"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -1540,
            -760
          ],
          "id": "53be6022-9dac-46e6-8cf9-47cf81935751",
          "name": "Iniciar conversacion",
          "webhookId": "0fc827b7-86cd-493f-a5e5-ee86223a46df",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json[\"Chat IG\"] }}",
            "text": "¡Hola! ¿Qué deseas hacer?",
            "replyMarkup": "inlineKeyboard",
            "inlineKeyboard": {
              "rows": [
                {
                  "row": {
                    "buttons": [
                      {
                        "text": "Buscar Cliente",
                        "additionalFields": {
                          "callback_data": "accion_buscar"
                        }
                      }
                    ]
                  }
                },
                {
                  "row": {
                    "buttons": [
                      {
                        "text": "Registrar Pago",
                        "additionalFields": {
                          "callback_data": "accion_pagar"
                        }
                      }
                    ]
                  }
                },
                {
                  "row": {
                    "buttons": [
                      {
                        "text": "Ingre/Gast",
                        "additionalFields": {
                          "callback_data": "accion_ingr"
                        }
                      }
                    ]
                  }
                },
                {
                  "row": {
                    "buttons": [
                      {
                        "text": "Otro",
                        "additionalFields": {
                          "callback_data": "accion_otro"
                        }
                      }
                    ]
                  }
                }
              ]
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1000,
            -800
          ],
          "id": "d06d5ed1-b74f-4d72-ab08-9f16050d92c7",
          "name": "MainMenu",
          "webhookId": "f86f9d3a-04fa-4f6d-acfd-64e8357caa13",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json[\"Chat IG\"] }}",
            "text": "accion_buscar",
            "replyMarkup": "replyKeyboardRemove",
            "replyKeyboardRemove": {
              "remove_keyboard": true
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -900,
            -680
          ],
          "id": "2cd08b67-9f1d-405d-bc83-91043781f38e",
          "name": "Buscar",
          "webhookId": "f86f9d3a-04fa-4f6d-acfd-64e8357caa13",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.callback_query.message.chat.id }}",
            "text": "accion_pagar",
            "replyMarkup": "replyKeyboardRemove",
            "replyKeyboardRemove": {
              "remove_keyboard": true
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -820,
            -540
          ],
          "id": "bf40a1eb-4a99-42d3-99d9-8b1808d89d82",
          "name": "Pagos",
          "webhookId": "a3e6971d-8c15-4783-ad1d-64dea624864b",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.callback_query.message.chat.id }}",
            "text": "=enlace:\\nhttps://jaybird-maximum-eagerly.ngrok-free.app/form/346594bc-0634-4bd9-9d75-9a2f0b3dec28",
            "replyMarkup": "replyKeyboardRemove",
            "replyKeyboardRemove": {
              "remove_keyboard": true
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -840,
            -380
          ],
          "id": "e317f789-da0e-4445-b30d-db432037d3ce",
          "name": "Ingr/Gast",
          "webhookId": "f86f9d3a-04fa-4f6d-acfd-64e8357caa13",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "62f7bce5-438d-4aed-b71c-e534dc536395",
                  "name": "Texto - command",
                  "value": "={{ \n    // Primero intenta obtener callback_data\n    ($json.callback_query && $json.callback_query.data ? $json.callback_query.data.toLowerCase().trim() : \n        // Si no hay callback_data, intenta obtener message.text\n        ($json.message && $json.message.text ? $json.message.text.toLowerCase().trim() : \"\")\n    )\n}}",
                  "type": "string"
                },
                {
                  "id": "d5b01c15-c6c7-43c8-abd1-faead162bbe3",
                  "name": "Chat IG",
                  "value": "={{ $json.message ? $json.message.chat.id : ($json.callback_query ? $json.callback_query.message.chat.id : null) }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1520,
            -500
          ],
          "id": "e486ae0a-a9ec-417a-9185-3f09bbb7aa2c",
          "name": "LimpiaDatos"
        },
        {
          "parameters": {
            "chatId": "={{ $json.callback_query.message.chat.id }}",
            "text": "=enlace:\\nhttps://jaybird-maximum-eagerly.ngrok-free.app/form/01fe4cf3-e452-4ed0-85dd-cb6512907072",
            "replyMarkup": "replyKeyboardRemove",
            "replyKeyboardRemove": {
              "remove_keyboard": true
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1080,
            -540
          ],
          "id": "bd0edb04-27e7-447b-8b56-764c1fabd2ec",
          "name": "ClienteStatus",
          "webhookId": "f86f9d3a-04fa-4f6d-acfd-64e8357caa13",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.chat_id_actual }}",
            "text": "Me no entender. Tu escribir /menu para ver opciones",
            "replyMarkup": "replyKeyboardRemove",
            "replyKeyboardRemove": {
              "remove_keyboard": true
            },
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1300,
            -480
          ],
          "id": "cedf25d8-40d8-4715-8fc0-20bbf1ffdbac",
          "name": "NoComprende?",
          "webhookId": "f86f9d3a-04fa-4f6d-acfd-64e8357caa13",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "Switch": {
          "main": [
            [
              {
                "node": "MainMenu",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Pagos",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Ingr/Gast",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ClienteStatus",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NoComprende?",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [],
            []
          ]
        },
        "Iniciar conversacion": {
          "main": [
            [
              {
                "node": "LimpiaDatos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LimpiaDatos": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "bd50b03e-4708-4576-a9ba-39ec1a5f33a0",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-17T05:13:17.828Z",
          "createdAt": "2025-05-17T05:13:17.828Z",
          "role": "workflow:owner",
          "workflowId": "dzo3znB00pWNe4mh",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-27T17:16:42.000Z",
      "createdAt": "2025-09-26T17:05:14.363Z",
      "id": "elqmqm0rhyMxLoJa",
      "name": "CorteCyber",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "sales",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "username",
                  "condition": "eq",
                  "keyValue": "={{ $json.body.username }}"
                },
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $json.body.session_id }}"
                }
              ]
            }
          },
          "id": "c6fd364e-f92e-433e-9efb-c3d889f77690",
          "name": "Get Sales",
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -2272,
            160
          ],
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY",
              "mode": "list",
              "cachedResultName": "regis24",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "fecha": "={{ $json.fecha }}",
                "Producto": "={{ $json.Producto }}",
                "Cantidad": "={{ $json.Cantidad }}",
                "Precio": "={{ $json.Precio }}",
                "Total": "={{ $json.total }}",
                "Usuario": "={{ $json.username }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "fecha",
                  "displayName": "fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Producto",
                  "displayName": "Producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Precio",
                  "displayName": "Precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Total",
                  "displayName": "Total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Usuario",
                  "displayName": "Usuario",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "id": "24dcc062-b04a-41b0-8c8b-fdc958efae30",
          "name": "Save to Sheets",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -2064,
            160
          ],
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "corte-caja",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "0cf0f53e-4750-47a6-b408-3b80faac6809",
          "name": "Webhook",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -2480,
            160
          ],
          "webhookId": "1043b127-9e88-430f-ad03-84c30768006f",
          "disabled": true
        }
      ],
      "connections": {
        "Get Sales": {
          "main": [
            [
              {
                "node": "Save to Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save to Sheets": {
          "main": [
            []
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Get Sales",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Webhook": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36",
                "content-length": "112",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "9857dd504a4069fe-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "68a38f6a-ca8c-4824-b947-e341c3b1abcb",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "user_id": 1,
                "username": "admin",
                "fecha": "2025-09-27",
                "session_id": "1_1758942601219",
                "action": "corte_automatico"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/corte-caja",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "2f56227d-144e-42ca-a810-11314ce259fc",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-26T17:05:14.371Z",
          "createdAt": "2025-09-26T17:05:14.371Z",
          "role": "workflow:owner",
          "workflowId": "elqmqm0rhyMxLoJa",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-03T23:34:49.000Z",
      "createdAt": "2025-06-03T18:16:53.393Z",
      "id": "gT3rvXKO1NmZ4ffG",
      "name": "pagoshtml",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json.body['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1200,
            -920
          ],
          "id": "fc4495c6-4c90-4508-862a-e2cf6bb79522",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1020,
            -680
          ],
          "id": "9ccbe6c2-75e7-468b-80a1-7c00d6084d15",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      },
                      {
                        "option": "otro..."
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1640,
            -940
          ],
          "id": "52ec90e5-c5dd-42f2-89eb-c6d72a7d7fb6",
          "name": "CargarPago",
          "webhookId": "2025038e-0666-4f78-a565-52a6da74292d"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2320,
            -940
          ],
          "id": "6c2da239-5591-438f-b03b-b4d249e892f1",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2520,
            -940
          ],
          "id": "138239c5-01f7-45b5-b39d-b0b457f99b8b",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1040,
            -440
          ],
          "id": "62aa90fc-47b1-4991-85cf-fc1415851319",
          "name": "Error",
          "webhookId": "67b8a01b-202c-4c19-9797-a020829e23ae"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('CargarPago').item.json[\"Fecha de pago\"] }}",
            "duration": 31,
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2500,
            -780
          ],
          "id": "cf088843-80d2-498e-bb47-935aa830ec3d",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2320,
            -500
          ],
          "id": "0490d38c-752c-4608-b043-63c6817e94c1",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2720,
            -940
          ],
          "id": "8eac17a8-e9ec-4ca9-ba54-ce5905aa804e",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2720,
            -740
          ],
          "id": "664db2a0-8856-438e-8ec7-149b35a511db",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";'\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2740,
            -540
          ],
          "id": "2cfe1a23-b1a1-4d8d-abd4-3ce309dd0a30",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2940,
            -940
          ],
          "id": "86349cd9-7713-45e7-80e2-30196bf8d7be",
          "name": "Form",
          "webhookId": "c7782f45-318b-452d-b770-8b381a15965d"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2960,
            -700
          ],
          "id": "e25e69a7-4e7a-4739-877f-aa57a296226f",
          "name": "Gmail",
          "webhookId": "3a7bb2ee-b4c7-4398-b003-93fc2b7bf134",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2540,
            -400
          ],
          "id": "4146e91c-582f-46b1-9436-3568497e314a",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            2080,
            -940
          ],
          "id": "8bf2c95d-5d14-43e4-b1b2-03d2edc66988",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            2080,
            -680
          ],
          "id": "25902334-b67b-4857-bc24-26c0e45535f6",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2080,
            -400
          ],
          "id": "c5208964-bb2e-4529-9616-61a3d9040dd1",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1700,
            -400
          ],
          "id": "dbbc6e3d-4e48-49f2-9467-dba87c1404c1",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1880,
            -400
          ],
          "id": "67f435c6-c3b6-4b2e-8896-74c37e5c9f9b",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1200,
            -700
          ],
          "id": "4a86f9d1-4131-4fbf-965e-bd77e6e87ae4",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1260,
            -440
          ],
          "id": "7a36a201-c0c4-41c1-abfe-e067a22ccdd1",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Merge').item.json['Cantidad Pagada'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2520,
            -600
          ],
          "id": "9b6d84e0-50f4-4d13-a32b-44e5de9a7387",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1440,
            -400
          ],
          "id": "9e597fdf-3deb-4ad6-876a-1b278b33e0a3",
          "name": "Error1",
          "webhookId": "d806b69c-5d0b-485f-b106-1e0dd09f7fcf"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2920,
            -540
          ],
          "id": "bb554e0d-f7a5-4ad4-8c27-cdc721e1678f",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2960,
            -380
          ],
          "id": "6146e00b-59cc-4e37-ba61-ffdd2bfffef4",
          "name": "Form1",
          "webhookId": "c1063b82-4f6f-4ad7-897c-6b8ece884df6"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M",
              "mode": "list",
              "cachedResultName": "DatosChiq2",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2740,
            -400
          ],
          "id": "ec78f742-f28d-4a77-aef9-abf889bb4fb7",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Meses Pagados",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "2"
                      },
                      {
                        "option": "3"
                      },
                      {
                        "option": "4"
                      },
                      {
                        "option": "5"
                      },
                      {
                        "option": "6"
                      },
                      {
                        "option": "7"
                      },
                      {
                        "option": "8"
                      },
                      {
                        "option": "9"
                      },
                      {
                        "option": "10"
                      },
                      {
                        "option": "11 +1 Gratis"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Por favor selecciones cuantos meses pago"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1480,
            -620
          ],
          "id": "fa0decfd-e698-4e6d-8497-0dbdbc50e2e4",
          "name": "Meses",
          "webhookId": "c5e9ae74-0686-4639-9e45-a1dbcce82ec1"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('ID Cliente').item.json.body['Reportar Pago Por..'] }}",
                        "rightValue": "1 Mes",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "31265679-e2bc-4527-b882-e4d580ebe2fa"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "65fab1f3-aec3-469c-ad26-f3471d84f5b8",
                        "leftValue": "={{ $('ID Cliente').item.json.body['Reportar Pago Por..'] }}",
                        "rightValue": "Varios Meses",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9b0e9c3-74eb-4700-9d17-4336678d0948",
                        "leftValue": "={{ $('ID Cliente').item.json.body['Reportar Pago Por..'] }}",
                        "rightValue": "Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1420,
            -920
          ],
          "id": "880b7e7d-39b9-4373-a230-1473dc5514a9",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Todo Correcto?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aceptar"
                      },
                      {
                        "option": "Corregir Meses y/o Plan"
                      }
                    ]
                  }
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Cantidad Pagada",
                  "fieldValue": "={{ $json['Meses Pagados'] * $json['Plan Mensual Pagado'] }}"
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Plan Mensual Pagado",
                  "fieldValue": "={{ $json[\"Plan Mensual Pagado\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Antes de continuar verifica que los datos esten correctos",
              "formDescription": "=Cliente: {{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nCantidad Pagada = {{ $json['Meses Pagados'] * $json['Plan Mensual Pagado'] }}\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1660,
            -620
          ],
          "id": "179e7c7a-92bd-412f-9e1b-41cf0ca51887",
          "name": "PagoVarios",
          "webhookId": "6eb20cb2-d948-4ef3-8fbd-9e0bf4c12e20"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json[\"Todo Correcto?\"] }}",
                  "rightValue": "=Aceptar",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1860,
            -620
          ],
          "id": "e1a8bdb1-4b18-4d51-800c-0948cb2e8509",
          "name": "TodoOk?"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1640,
            -780
          ],
          "id": "683ea627-712c-4a1b-b266-3bdbc9a9b821",
          "name": "OtrosPago",
          "webhookId": "fe20acb0-c9be-4315-9134-0e2bf510f8e4"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1860,
            -780
          ],
          "id": "3a7a6b9d-7ede-4595-8d0a-74a04f8fb55c",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1840,
            -940
          ],
          "id": "e8dc3eaa-9a8e-49dc-b268-b72dafaec6c3",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2300,
            -720
          ],
          "id": "9170b9bf-8205-4274-ba1b-e80a8be91b37",
          "name": "MismoPlan"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "pagos",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            1000,
            -920
          ],
          "id": "05b9ddb9-6f9c-4716-87ac-461b8007e8ba",
          "name": "ID Cliente",
          "webhookId": "38a7af23-22aa-492d-b0fd-3fef3830629d"
        },
        {
          "parameters": {
            "respondWith": "redirect",
            "redirectURL": "=https://pagos-2s3.pages.dev/form_meses.html?idCliente={{ $('ID Cliente').item.json.body['ID Cliente'] }}&nombreCliente={{ $('Busca').item.json['Nombre completo'] }}&reportePor={{ $('ID Cliente').item.json.body['Reportar Pago Por..'] }}",
            "options": {
              "responseCode": 302
            }
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.2,
          "position": [
            1460,
            -760
          ],
          "id": "dac3f389-6693-45bf-bc1e-cbfcbdde945e",
          "name": "Meses1"
        }
      ],
      "connections": {
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Meses": {
          "main": [
            [
              {
                "node": "PagoVarios",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "OtrosPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoVarios": {
          "main": [
            [
              {
                "node": "TodoOk?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TodoOk?": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OtrosPago": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "8cccdb6b-cebe-4033-95c7-54ae439400e1",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-03T18:16:53.400Z",
          "createdAt": "2025-06-03T18:16:53.400Z",
          "role": "workflow:owner",
          "workflowId": "gT3rvXKO1NmZ4ffG",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-18T17:32:45.000Z",
      "createdAt": "2025-06-18T03:26:24.877Z",
      "id": "gxZgrYMjpD4tzH31",
      "name": "StatusIDCBackup",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -900,
            -500
          ],
          "id": "4b3e4df7-f60c-4bd8-a453-1b928c5acec9",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "ID Cliente"
                },
                {
                  "name": "idChat"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -1100,
            -540
          ],
          "id": "0995aca7-2b5a-49be-a912-fd0ade9fedca",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.stdout }}",
            "options": {
              "systemMessage": "Eres un asistente experto en reemplazar palabras, tienes ùnicamente la funcion de cambiar algunas palabras en el texto recibido, de la siguiente manera:\nSi Activado:1 entonces cambiar por Activado:Activado\nSi Activado:0 entonces cambiar por Activado:Desactivado\nSi Activado es distinto de 1, 0, cambiar por Activado:error\nSi Conectado:waiting cambiar por Conectado:Desconectado\nSi Conectado:bound cambiar por Conectado:Conectado\nSi Conectado es distinto de waiting, bound, cambiar por Conectado:error\n\nEl text recibido debe conservar su estructura original con las nuevas palabras."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            -980,
            -120
          ],
          "id": "5db59279-84a0-4c08-afdc-3d86fae1fdb3",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -960,
            -260
          ],
          "id": "d8f08f38-c73c-494a-9602-5d3c6dfb9078",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net ':global Mac \"{{ $json[\"MAC ID\"] }}\"; :global Name \"{{ $json[\"ID Cliente\"] }}\"; :put (\"Activado:\" . [/ip hotspot ip-binding print count-only where mac-address=$Mac]); :local leaseId [:pick [/ip dhcp-server lease find where mac-address=$Mac] 0]; :if ($leaseId != \"\") do={ :put (\"Conectado:\" . [/ip dhcp-server lease get $leaseId status]); } else={ :put \"Conectado:no-encontrado\"; }; :local schedulerId [:pick [/system scheduler find where name=$Name] 0]; :if ($schedulerId != \"\") do={ :put (\"FechaCorte:\" . [/system scheduler get $schedulerId start-date]); } else={ :put \"FechaCorte:no-encontrado\"; };'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -1160,
            -80
          ],
          "id": "73fc19fc-d6b9-443a-856f-b0dab47511f7",
          "name": "ConsultaStatus1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8a89165b-be24-4d41-99aa-1a6accd67e92",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1180,
            -280
          ],
          "id": "76499cd4-ef9f-4ef5-84aa-9c717cb4e8ab",
          "name": "If"
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID No encontrado",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -800,
            -300
          ],
          "id": "f6e3ef55-57f9-4ef5-91c5-dd2961fca51c",
          "name": "NoFoud",
          "webhookId": "ae32c846-5b1d-40a6-ab63-7fc277720d86",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID {{ $('Buscar').item.json[\"ID Cliente\"] }} {{ $('Buscar').item.json[\"Nombre completo\"] }} {{ $('Buscar').item.json[\"MAC ID\"] }} {{ $json.output }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -580,
            -20
          ],
          "id": "91e84195-1a14-426c-b5a3-775d1434ed35",
          "name": "Status",
          "webhookId": "2c57630a-555b-46a7-a3b3-c87b699ea4c7",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "Buscar": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "ConsultaStatus1": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "NoFoud",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ConsultaStatus1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "92b338f4-988e-427e-94f8-b59d5f919a55",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-18T03:26:24.886Z",
          "createdAt": "2025-06-18T03:26:24.886Z",
          "role": "workflow:owner",
          "workflowId": "gxZgrYMjpD4tzH31",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-05T18:28:30.582Z",
      "createdAt": "2025-08-05T18:28:30.582Z",
      "id": "kELEPwF12jvRHurm",
      "name": "My workflow",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "options": {
              "queryName": "match_documents"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            -240,
            -480
          ],
          "id": "5b32b7d2-80e3-41db-9f3a-5bff5770e796",
          "name": "Supabase Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "dataType": "binary",
            "loader": "textLoader",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "label",
                    "value": "={{ $json.Etiqueta }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1.1,
          "position": [
            -112,
            -256
          ],
          "id": "be249bae-e226-4c72-8481-12183ca7c34b",
          "name": "Default Data Loader"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -240,
            -256
          ],
          "id": "3fda8e86-5177-40d7-b52a-0ac0324f6456",
          "name": "Embeddings Google Gemini",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "formTitle": "Cargar Archivos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Archivo",
                  "fieldType": "file"
                },
                {
                  "fieldLabel": "Etiqueta",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "empresa"
                      },
                      {
                        "option": "contrata"
                      },
                      {
                        "option": "cobertura"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "Up"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -688,
            -368
          ],
          "id": "9c68bbe4-5ecb-4ffd-bfd5-5e8edc9ba905",
          "name": "Upload",
          "webhookId": "66334b1f-4ca3-4012-9fcd-eb6131fe6e5b"
        },
        {
          "parameters": {
            "jsCode": "for (const item of items) {\n\t if (item.binary && item.binary.Archivo) {\n\t\t // Accede a la metadata del archivo binario\n\t\t item.binary.Archivo.mimeType = 'text/plain';\n\t }\n}\nreturn items;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -464,
            -368
          ],
          "id": "04bdebd7-13c0-4a2b-9f02-9c60f83328c8",
          "name": "Code"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            -1120,
            -16
          ],
          "id": "073d8597-1a86-43c8-be39-a05be66993bc",
          "name": "When chat message received",
          "webhookId": "2ac99ee9-e989-4c92-bbb2-badc605c7765"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1120,
            256
          ],
          "id": "edc98d0e-c035-433e-afcc-7e017522b37b",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -112,
            176
          ],
          "id": "4b8f424e-2a7f-4aa9-9ff6-3198057d93ee",
          "name": "Google Gemini Chat Model1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            16,
            176
          ],
          "id": "e4da920a-5826-4888-b443-0a45d349fad0",
          "name": "Simple Memory"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            224,
            384
          ],
          "id": "e902b9fc-732e-41d1-b5de-77c00741217a",
          "name": "Embeddings Google Gemini1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "inputText": "={{ $json.chatInput }}",
            "categories": {
              "categories": [
                {
                  "category": "empresa"
                },
                {
                  "category": "contrata"
                },
                {
                  "category": "cobertura"
                },
                {
                  "category": "saludo"
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "Clasifica el texto proporcionado por el usuario en una de la siguientes categorías: empresa, cobertura, precios, otros, y usa el formato de instrucciones proporcionado, no expliques y solo entrega el json.\n\nsi el texto proporcionado tiene palabras como \"quien eres\" \"que haces\" \"de donde son\" \"empresa\" \"horarios\" y cuestiones relacionadas a la empresa. usa la categoría empresa\n\nsi el texto proporcionado tiene palabras como \"quiero internet\" \"donde dan servicio\" \"cobertura\" \"tiene servicio\" \"quiero internet\" o cuestiones similares, usa la categoría cobertura.\n\nsi el texto proporcionado tiene palabras como \"Cuanto cuesta\" \"cual es el precio\" \"pagar\" \"donde pago\" \"paquetes\" \"cuales son los planes\" y similares usa la categoría cobertura\n\nsi el texto proporcionado tiene palabras como \"Contratar\" \"que necesito para contratar\" \"quiero el servicio\" \"como lo contrato\" \"informacion para tener el servicio\" y similares usa la categoría contrata\n\nsi el texto proporcionado es un saludo usa la categoria saludo"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "typeVersion": 1.1,
          "position": [
            -784,
            -32
          ],
          "id": "8b6bfb9e-7c65-4d15-b356-b19d908a361d",
          "name": "Intencion"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres un asistente experto en identificar y contestar preguntas sobre la empresa albored, utilizando la herramienta "
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -64,
            -48
          ],
          "id": "196ce2c9-ce3b-4fe6-99b1-12b65e6f8e2b",
          "name": "Empresa"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Tu única función es contestar el saludo de forma breve y cordial preguntando que necesita"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -1072,
            544
          ],
          "id": "09e00d76-7093-42f4-b7b6-c5e988a69980",
          "name": "Saludo"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres un ais"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -784,
            256
          ],
          "id": "9566f598-d638-4cdb-9fc5-1b15aca5eee9",
          "name": "Contrata"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "includeDocumentMetadata": false,
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "empresa"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            144,
            176
          ],
          "id": "9bef1568-c834-46d7-92ce-d16a658b2f5e",
          "name": "VectorEmpresa",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -400,
            48
          ],
          "id": "cb427cf7-ef04-43b2-8e23-913912896bc4",
          "name": "Cobertura"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "cobertura"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            -368,
            304
          ],
          "id": "5c5a1eac-4e85-4e57-9f15-945accd01882",
          "name": "Supabase Vector Store1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -352,
            448
          ],
          "id": "5a25541a-3d70-46f5-8173-8c970d83c31a",
          "name": "Embeddings Google Gemini2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "contrata"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            -720,
            496
          ],
          "id": "b873526c-eb2d-4900-a946-43e165709004",
          "name": "VectorContrata",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -672,
            688
          ],
          "id": "6118f3fb-0014-4e63-bb7b-38ac9bbdc1d8",
          "name": "Embeddings Google Gemini3",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.answerChatMessage",
          "typeVersion": 1,
          "position": [
            -80,
            464
          ],
          "id": "c1cacbc3-326a-4760-a099-b07d5da130b1",
          "name": "Answer Chat Message1"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.answerChatMessage",
          "typeVersion": 1,
          "position": [
            96,
            592
          ],
          "id": "061616cd-6794-45ef-a51f-4caa4debab53",
          "name": "Answer Chat Message2"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.answerChatMessage",
          "typeVersion": 1,
          "position": [
            -464,
            576
          ],
          "id": "992f4df4-79f7-4064-ac07-bec354b2b466",
          "name": "Answer Chat Message3"
        }
      ],
      "connections": {
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Upload": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Intencion",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Saludo",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Empresa",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Contrata",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Cobertura",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "Empresa",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "VectorEmpresa",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Intencion": {
          "main": [
            [
              {
                "node": "Empresa",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Contrata",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Cobertura",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Saludo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "VectorEmpresa": {
          "ai_tool": [
            [
              {
                "node": "Empresa",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store1": {
          "ai_tool": [
            [
              {
                "node": "Cobertura",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini2": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "VectorContrata": {
          "ai_tool": [
            [
              {
                "node": "Contrata",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini3": {
          "ai_embedding": [
            [
              {
                "node": "VectorContrata",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "2a61f8f0-6684-4f71-ab99-01a472cf201c",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-05T18:28:30.590Z",
          "createdAt": "2025-08-05T18:28:30.590Z",
          "role": "workflow:owner",
          "workflowId": "kELEPwF12jvRHurm",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-05T22:16:05.000Z",
      "createdAt": "2025-08-05T21:58:53.087Z",
      "id": "lnkYph3SUVdMgelL",
      "name": "pnecone",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "content": "## Try me out\n1. In Pinecone, create an index with 1536 dimensions and select it in *both* Pinecone nodes\n2. Click 'test workflow' at the bottom of the canvas to load data into the vector store\n3. Click 'chat' at the bottom of the canvas to ask questions about the data",
            "height": 264.61498034081166
          },
          "id": "14c69ad7-a9ce-4110-a4a6-ab8e22494bce",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -288,
            32
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "mode": "insert",
            "pineconeIndex": {
              "__rl": true,
              "value": "albofiles",
              "mode": "list",
              "cachedResultName": "albofiles"
            },
            "options": {
              "clearNamespace": true
            }
          },
          "id": "288fd51b-bbbb-453a-b2fa-55a1d70d73d9",
          "name": "Pinecone Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            528,
            -224
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "id": "7c03eb50-f933-43c6-9444-3d0bdeb82227",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            1008,
            -224
          ],
          "webhookId": "dec328cc-f47e-4727-b1c5-7370be86a958",
          "typeVersion": 1.1
        },
        {
          "parameters": {
            "options": {}
          },
          "id": "c9231055-6c9a-4edd-a478-ed7d99eb045c",
          "name": "Question & Answer",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            1248,
            -224
          ],
          "typeVersion": 1.8
        },
        {
          "parameters": {
            "dataType": "binary",
            "options": {}
          },
          "id": "dfded52f-663b-4fc0-b346-94d47cafd0b5",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "position": [
            576,
            -32
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "chunkSize": 3000,
            "chunkOverlap": 200,
            "options": {}
          },
          "id": "1d5ecb1a-0ba2-4603-826e-8a5c9a8e6d01",
          "name": "Recursive Character Text Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "position": [
            560,
            128
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "bitcoin_paper",
            "toolDescription": "Llama a esta herramienta para obtener informacion y contestar correctamente con informacion precisa ",
            "pineconeIndex": {
              "__rl": true,
              "mode": "id",
              "value": "test-index"
            },
            "includeDocumentMetadata": false,
            "options": {}
          },
          "id": "e1b9432f-d58e-4f5e-97a5-7090efae3a6f",
          "name": "Pinecone Vector Store1",
          "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
          "position": [
            1360,
            -16
          ],
          "typeVersion": 1,
          "credentials": {
            "pineconeApi": {
              "id": "4YWcftU748GucLpn",
              "name": "PineconeApi account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            368,
            16
          ],
          "id": "3ff54247-a81b-4ec7-898b-1fdadfd8d4d4",
          "name": "Embeddings Google Gemini",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-flash-latest",
            "options": {
              "maxOutputTokens": 200,
              "temperature": 0.1
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            1120,
            -16
          ],
          "id": "b782e88b-74a5-4dd4-9802-ae9f53f6d0ab",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            1456,
            192
          ],
          "id": "ddfbf6bd-c005-44c8-b83f-90cdbd2c2573",
          "name": "Embeddings Google Gemini1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "pollTimes": {
              "item": [
                {}
              ]
            },
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "value": "1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2",
              "mode": "list",
              "cachedResultName": "agente",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1azX1U7bNaPluRrXZhRGxlub-a2FTHEe2"
            },
            "event": "folderUpdated"
          },
          "type": "n8n-nodes-base.googleDriveTrigger",
          "typeVersion": 1,
          "position": [
            320,
            -224
          ],
          "id": "23e20395-ebd4-4b9d-9bc8-aa681f29e2bc",
          "name": "Google Drive Trigger",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          }
        }
      ],
      "connections": {
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Pinecone Vector Store1": {
          "ai_tool": [
            [
              {
                "node": "Question & Answer",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "Question & Answer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Question & Answer",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "Pinecone Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive Trigger": {
          "main": [
            [
              {
                "node": "Pinecone Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a90a4935-39a4-4a77-af35-79c493fdd013",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-05T21:58:53.091Z",
          "createdAt": "2025-08-05T21:58:53.091Z",
          "role": "workflow:owner",
          "workflowId": "lnkYph3SUVdMgelL",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-20T00:10:58.000Z",
      "createdAt": "2025-08-10T23:50:58.126Z",
      "id": "lrgXS1WogsKMT01g",
      "name": "carrito2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "52fd61d2-793b-4707-9bf0-a626728cca37",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -720,
            96
          ],
          "id": "710435dc-84d7-4a49-bcc6-8e33708330eb",
          "name": "Switch"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id.toUpperCase() }}",
                "cantidad": "={{ $json.cantidad }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -64,
            496
          ],
          "id": "139d0b38-8245-4c62-857a-a337f7b0ab87",
          "name": "Update row in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $json.id.toUpperCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -480,
            288
          ],
          "id": "3f6f0eb3-46a4-446e-b531-26a51fff01e5",
          "name": "buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $json.result }}",
                  "rightValue": "found",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -16,
            304
          ],
          "id": "5155d48c-d49d-4020-a4fb-890668edc832",
          "name": "existe?",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $('buscar').item.json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -256,
            640
          ],
          "id": "181c2abf-01cd-4eed-90cd-78a21c3b7624",
          "name": "addcar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id }}",
                "producto": "={{ $json.nombre }}",
                "cantidad": "={{ $json.cantidad }}",
                "precio": "={{ $json.precio }}",
                "total": "={{ ($json.cantidad * $json.precio).ceil() }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            416,
            704
          ],
          "id": "59d5983c-ddee-4b46-823b-6e27e750d48e",
          "name": "agregar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id }}",
                "cantidad": "={{ Number($('addcar').item.json.cantidad) + Number($json.cantidad) }}",
                "total": "={{ ((Number($('addcar').item.json.cantidad) + Number($json.cantidad)) * Number($json.precio)).ceil() }}",
                "precio": "={{ $json.precio }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            416,
            512
          ],
          "id": "dc9c182e-7047-484d-bb5e-cd4a02a22d4f",
          "name": "actualizar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('addcar').item.json.id }}",
                  "rightValue": "0",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            192,
            640
          ],
          "id": "5d1fd4f2-4560-487d-8881-25e1e46cdd1e",
          "name": "If"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('buscar').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('buscar').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('buscar').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Switch').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": false
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -32,
            640
          ],
          "id": "a0b3cc4c-440a-4e4a-b93e-a14c71e2ef39",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "clear",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "keepFirstRow": true
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -688,
            640
          ],
          "id": "ce475bdb-f963-47b0-a622-f606d3f1e568",
          "name": "Clear sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            -688,
            432
          ],
          "id": "54cb4133-ef81-4a21-a816-21e71af6e53a",
          "name": "No Operation, do nothing"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            640,
            448
          ],
          "id": "731101b3-8d36-4186-a469-746160981295",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            192,
            448
          ],
          "id": "07df1b77-feac-45b9-a9cd-855f3384576b",
          "name": "carrito",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "let total = 0;\nconst cartItems = [];\n\nconst allInputItems = $input.all();\n\nfor (const inputItemWrapper of allInputItems) {\n    const item = inputItemWrapper.json;\n\n    // Asegúrate de que los campos 'cantidad' y 'precio' existan y sean números.\n    const cantidad = parseFloat(item.cantidad || 0);\n    const precio = parseFloat(item.precio || 0);\n\n    // Calcula el total de la línea (cantidad * precio)\n    const itemTotal = cantidad * precio;\n    \n    // Suma al total del carrito\n    total += itemTotal;\n\n    cartItems.push({\n        id: item.id,\n        productCode: item.producto,\n        quantity: cantidad,\n        price: precio,\n        total: itemTotal // Ahora el total de cada ítem también se calcula correctamente\n    });\n}\n\nreturn [{ json: { currentCart: cartItems, cartTotal: total } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            192,
            272
          ],
          "id": "c75d2b6c-fddf-4f11-b95a-56dff420d920",
          "name": "total"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "da24ee7f-0719-4be1-ae5c-d6d601393539",
                  "name": "text",
                  "value": "Producto añadido/actualizado al carrito.",
                  "type": "string"
                },
                {
                  "id": "329742e7-97b9-4ad9-9858-12b361dd1471",
                  "name": "currentCart",
                  "value": "={{ JSON.stringify($('total').item.json.currentCart) }}",
                  "type": "string"
                },
                {
                  "id": "cart-total-fixed",
                  "name": "cartTotal",
                  "value": "={{ $('total').item.json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "add-update-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            480,
            128
          ],
          "id": "30787de7-1c20-49aa-bdd4-7471d6cdbb9a",
          "name": "Add/Update Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "vaciar-text",
                  "name": "text",
                  "value": "El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "vaciar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "vaciar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "vaciar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -464,
            640
          ],
          "id": "88439662-b866-4078-a27c-7a0ca5f62e55",
          "name": "Vaciar Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "finalizar-text",
                  "name": "text",
                  "value": "Compra finalizada con éxito. El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "finalizar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "finalizar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "finalizar-sale-finalized",
                  "name": "saleFinalized",
                  "value": true,
                  "type": "boolean"
                },
                {
                  "id": "finalizar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -272,
            464
          ],
          "id": "959cdd0a-fee7-4b1c-a847-2c5421302370",
          "name": "Finalizar Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "error-text",
                  "name": "text",
                  "value": "Ha ocurrido un error inesperado.",
                  "type": "string"
                },
                {
                  "id": "error-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "error-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "error-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -160,
            192
          ],
          "id": "bedeb329-4ae7-4dc7-8ead-4798375a75d6",
          "name": "Error Response"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "viewcar-text",
                  "name": "text",
                  "value": "Contenido actual del carrito:",
                  "type": "string"
                },
                {
                  "id": "viewcar-current-cart",
                  "name": "currentCart",
                  "value": "={{ JSON.stringify($('total').item.json.currentCart) }}",
                  "type": "string"
                },
                {
                  "id": "viewcar-cart-total",
                  "name": "cartTotal",
                  "value": "={{ $('total').item.json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "viewcar-type",
                  "name": "type",
                  "value": "info",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            416,
            320
          ],
          "id": "4130d7be-2f34-4211-b5be-e3c1a0297739",
          "name": "View Cart Response"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            640,
            640
          ],
          "id": "a885022a-6fcc-47a2-ba37-0d824f93c723",
          "name": "Merge"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' '); // Esto dividirá la cadena por espacios\n\nconst intencion = parts[0];\nconst id = parts[1];\nconst cantidad = parts[2];\n\n// Devolver un nuevo objeto JSON con las variables separadas\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -944,
            160
          ],
          "id": "4e3ae2d8-77b3-4c9f-8a25-e77a9dd210ee",
          "name": "Intencion"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1136,
            416
          ],
          "id": "14b2381f-29ca-49fa-90e3-438ea0b62df8",
          "name": "BuscaEnd",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1203437505,
              "mode": "list",
              "cachedResultName": "ventas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=1203437505"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "producto": "={{ $json.producto }}",
                "cantidad": "={{ $json.cantidad }}",
                "precio": "={{ $json.precio }}",
                "total": "={{ $json.total.round() }}",
                "fecha": "={{ $now }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "fecha",
                  "displayName": "fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -912,
            416
          ],
          "id": "1c52f4a9-382e-40e1-842f-974443b723c9",
          "name": "Updatend",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1120,
            624
          ],
          "id": "191d5808-ad0a-42d8-b637-fb1df54d02cb",
          "name": "BuscaID",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $('BuscaEnd').item.json.id }}",
                "stock": "=={{ $json.stock }} - {{ $('BuscaEnd').item.json.cantidad }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "nombre",
                  "displayName": "nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "stock",
                  "displayName": "stock",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -912,
            624
          ],
          "id": "871d3482-9e5c-4e29-8e3e-8ff2e4206c6b",
          "name": "UpdateInventory",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "clear",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "keepFirstRow": true
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -496,
            464
          ],
          "id": "a1a65ec1-50ae-4b08-9589-0af1baac02e6",
          "name": "CleanCart",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -480,
            80
          ],
          "id": "aaf1a511-c65f-4b4d-b75f-47afa2c4e0ef",
          "name": "Get row(s) in sheet",
          "executeOnce": false,
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "not-found-text",
                  "name": "text",
                  "value": "={{ $json.mergedText }}",
                  "type": "string"
                },
                {
                  "id": "not-found-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "not-found-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "not-found-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            208,
            96
          ],
          "id": "17dcb21e-51b3-4dfe-be40-396a0041ef4b",
          "name": "Product Not Found Response"
        },
        {
          "parameters": {
            "jsCode": "const result = [];\nfor (const item of items) {\n    result.push(`ID: ${item.json.id}, ${item.json.nombre}, Precio: ${item.json.precio}`);\n}\nreturn [{ json: { mergedText: result.join('\\n') } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -32,
            80
          ],
          "id": "0e03cd20-8824-44ff-b906-efff730e785b",
          "name": "Code",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "jsCode": "if (items[0] && items[0].json && Object.keys(items[0].json).length > 0) {\n  // Si la lista de items no está vacía, devuelve el primer item en la rama 'True'.\n  return [{ json: { result: \"found\" } }];\n} else {\n  // Si la lista está vacía, devuelve un item vacío en la rama 'False'.\n  return [{ json: { result: \"not_found\" } }];\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -288,
            288
          ],
          "id": "eae7ff33-97be-4931-9229-56dd08dc3de5",
          "name": "Code1"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "carrito",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -1152,
            96
          ],
          "id": "465330fe-2e54-4af7-a972-a3320c9d2a27",
          "name": "Caja",
          "webhookId": "8ec8bdc1-39ce-4227-acab-75f614fc64a3"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "a97a246c-07dc-4d4a-924a-0e25098a8e46",
                  "leftValue": "={{ $json.nombre.toLowerCase() }}",
                  "rightValue": "={{ $('Intencion').item.json.id }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -288,
            64
          ],
          "id": "4266cdae-b72b-41a2-af00-a01e4679f42b",
          "name": "Filter",
          "alwaysOutputData": true
        }
      ],
      "connections": {
        "Switch": {
          "main": [
            [
              {
                "node": "buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update row in sheet",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Clear sheet",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "BuscaEnd",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "carrito",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update row in sheet": {
          "main": [
            [
              {
                "node": "carrito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "buscar": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?": {
          "main": [
            [
              {
                "node": "addcar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "addcar": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "agregar": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "actualizar": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "actualizar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "agregar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Clear sheet": {
          "main": [
            [
              {
                "node": "Vaciar Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing": {
          "main": [
            [
              {
                "node": "CleanCart",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "carrito": {
          "main": [
            [
              {
                "node": "total",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "total": {
          "main": [
            [
              {
                "node": "Add/Update Response",
                "type": "main",
                "index": 0
              },
              {
                "node": "View Cart Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add/Update Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Finalizar Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "View Cart Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "carrito",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaEnd": {
          "main": [
            [
              {
                "node": "Updatend",
                "type": "main",
                "index": 0
              },
              {
                "node": "BuscaID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Updatend": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaID": {
          "main": [
            [
              {
                "node": "UpdateInventory",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "UpdateInventory": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CleanCart": {
          "main": [
            [
              {
                "node": "Finalizar Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Product Not Found Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Product Not Found Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Caja": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "3cd7293d-5598-46c0-aba0-5fdbb9505954",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-10T23:50:58.141Z",
          "createdAt": "2025-08-10T23:50:58.141Z",
          "role": "workflow:owner",
          "workflowId": "lrgXS1WogsKMT01g",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-10T20:24:41.000Z",
      "createdAt": "2025-06-10T20:17:23.974Z",
      "id": "o1nu8y5DA5W7ZaQm",
      "name": "PagosChiqOtros",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Reportar Pago Por..",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Varios Meses"
                      },
                      {
                        "option": "Otro"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {}
              ]
            },
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            940,
            -860
          ],
          "id": "bfb0d95e-33ab-493e-bb11-2eaf0f3acc78",
          "name": "ID Cliente",
          "webhookId": "b2b64fdc-4f2d-45ba-b397-0c989162b6d5"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1160,
            -860
          ],
          "id": "f61670bc-9078-4b56-bced-5c9753722b83",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            940,
            -660
          ],
          "id": "19cd3822-5a3d-47b1-b54a-7450fe7e4446",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1580,
            -860
          ],
          "id": "ba95d17d-569b-4954-a4a9-01b4f12f1838",
          "name": "CargarPago",
          "webhookId": "e269da3a-bff4-4499-bf20-82abfd4014c1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2200,
            -860
          ],
          "id": "2d226933-38cc-40c9-986b-1d067587950f",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2400,
            -860
          ],
          "id": "70f5d75e-cd8b-4a7e-95d1-30424a20e846",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            940,
            -220
          ],
          "id": "4737d752-6eb5-491d-85a8-fa68eaa9a7e4",
          "name": "Error",
          "webhookId": "d093c509-bf14-4414-9088-e6493c06568d"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Merge').item.json[\"Fecha de pago\"] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2220,
            -640
          ],
          "id": "c2668bc2-e365-4bcb-9c13-976c7cf209f9",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2420,
            -280
          ],
          "id": "0a33dc2a-12d2-47e2-ad80-69a73894fc73",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2420,
            -660
          ],
          "id": "efef4750-a948-408c-8974-f0c59f7c5cd6",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2620,
            -860
          ],
          "id": "7621ba88-469a-440a-be79-d014ff3feec4",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2840,
            -660
          ],
          "id": "7faf397d-acb1-423b-9a47-730a1ae256bc",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2640,
            -240
          ],
          "id": "f918edc5-9336-4d6a-a2e1-e711de148c51",
          "name": "Form",
          "webhookId": "ef3027b7-27eb-4a6c-b06c-44f63fcfa830"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2780,
            -160
          ],
          "id": "b886a3fa-5a27-4f7d-81b3-2a95fc181d4c",
          "name": "Gmail",
          "webhookId": "2144a6a8-cdb2-4c99-aa40-452c8589b2cb",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2620,
            -640
          ],
          "id": "08c18a7e-393f-4cec-92f8-22aed76b6d6e",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            2000,
            -620
          ],
          "id": "c5bb4ae9-68f2-4598-b408-5060cb890194",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            2180,
            -480
          ],
          "id": "dfceab18-2278-4b51-b5f8-db4d726355db",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2160,
            -220
          ],
          "id": "7b2480db-3437-4e53-8397-f10dabed6985",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1800,
            -280
          ],
          "id": "2ee9f321-aecc-45a7-bc27-5819c2d22066",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1980,
            -220
          ],
          "id": "099cf3ee-c601-44dc-b0e6-a9febc69b29d",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1140,
            -660
          ],
          "id": "fcd773f7-b14d-4547-8219-94e5cf7319b9",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            980,
            -420
          ],
          "id": "1dc32366-9a27-4e12-a9f4-859662f24b18",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Merge').item.json['Cantidad Pagada'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "bbd59a4f-b55e-4e71-9d85-98e04e902024",
                  "name": "NuevoPlan",
                  "value": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                  "type": "string"
                },
                {
                  "id": "e629e409-d239-4505-b5ac-9c1acf5d0037",
                  "name": "SumarMeses",
                  "value": "={{ $('Merge').item.json.SumarMeses }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2800,
            -860
          ],
          "id": "946f0f49-21d4-49de-a10f-27f8cbd718ad",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1100,
            -280
          ],
          "id": "774aa85c-c41c-4618-89d2-7d9b9d48fae8",
          "name": "Error1",
          "webhookId": "7f2447cb-d681-405f-a4ba-56857d79adca"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2840,
            -460
          ],
          "id": "8ce7af8b-9164-4733-8754-60e22fc7aff9",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2860,
            -300
          ],
          "id": "7f16f721-b076-4bb6-9210-e2acd8b9521a",
          "name": "Form1",
          "webhookId": "fcdd99ec-2d00-41cb-8e4a-2df690ce1eae"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2620,
            -440
          ],
          "id": "efce641f-2834-42d7-aa16-329d5135d149",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Meses Pagados",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "2"
                      },
                      {
                        "option": "3"
                      },
                      {
                        "option": "4"
                      },
                      {
                        "option": "5"
                      },
                      {
                        "option": "6"
                      },
                      {
                        "option": "7"
                      },
                      {
                        "option": "8"
                      },
                      {
                        "option": "9"
                      },
                      {
                        "option": "10"
                      },
                      {
                        "option": "11 +1 Gratis"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Por favor selecciones cuantos meses pago"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1600,
            -300
          ],
          "id": "9b3c963b-0f8e-4842-a486-cf742f12e6d7",
          "name": "Meses",
          "webhookId": "54b4756b-81d3-42dc-b3f9-0fdd7e5a480c"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "1 Mes",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "31265679-e2bc-4527-b882-e4d580ebe2fa"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "65fab1f3-aec3-469c-ad26-f3471d84f5b8",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Varios Meses",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9b0e9c3-74eb-4700-9d17-4336678d0948",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1160,
            -440
          ],
          "id": "d35a346b-98a2-4a42-895e-04a910a8b01d",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Todo Correcto?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aceptar"
                      },
                      {
                        "option": "Corregir Meses y/o Plan"
                      }
                    ]
                  }
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Cantidad Pagada",
                  "fieldValue": "={{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}"
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Plan Mensual Pagado",
                  "fieldValue": "={{ $json[\"Plan Mensual Pagado\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Antes de continuar verifica que los datos esten correctos",
              "formDescription": "=Cliente: {{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nCantidad Pagada = {{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}\n "
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1580,
            -520
          ],
          "id": "ab0c6bf8-f794-4f71-997e-5e989dee5e00",
          "name": "PagoVarios",
          "webhookId": "5da12f98-f3ea-481f-b18d-187e2f03af16"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json[\"Todo Correcto?\"] }}",
                  "rightValue": "=Aceptar",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1760,
            -520
          ],
          "id": "3effad94-2db6-4867-b0ea-823a69f434ec",
          "name": "TodoOk?"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1580,
            -680
          ],
          "id": "d48c09f3-ad8c-4c14-b274-b7cbedf30dc9",
          "name": "OtrosPago",
          "webhookId": "1b046f35-8e3f-4280-ae29-9297fef4c4e9"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            1980,
            -840
          ],
          "id": "e1e5361c-f4bd-4aa2-9500-f78fd0b5e709",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                },
                {
                  "id": "1b963156-9b3c-4764-a647-95502c0eb968",
                  "name": "SumarMeses",
                  "value": 1,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -860
          ],
          "id": "50178fcb-2002-444a-996a-010a4cbf06c3",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2400,
            -500
          ],
          "id": "80494266-58ef-4f09-b334-6282199109d5",
          "name": "MismoPlan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "97338f77-1ed1-4a62-b3d6-2341c48a8c75",
                  "name": "SumarMeses",
                  "value": "={{ $('Meses').item.json[\"Meses Pagados\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1960,
            -460
          ],
          "id": "4fa73694-a9d6-4707-a95f-2111797fb440",
          "name": "mesesvarios"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3675b7e2-16ec-4541-805e-f0dadf9481c8",
                  "name": "SumarMeses",
                  "value": "={{ Math.round($json['Cantidad Pagada'] / $json['Plan Mensual Pagado']) }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -680
          ],
          "id": "5aa1b20e-858a-4795-9497-8adadc2a7d83",
          "name": "mesotros"
        },
        {
          "parameters": {
            "chatId": "7654665377",
            "text": "=Pago {{ $('DatosListos').item.json[\"ID Cliente\"] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Meses pagados:{{ $('DatosListos').item.json.SumarMeses }} x Plan pagado:{{ $('DatosListos').item.json.NuevoPlan }} sea igual a ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            2960,
            -160
          ],
          "id": "84ca39e5-048b-4597-a552-a52ea8357e96",
          "name": "Telegram",
          "webhookId": "7cbdcbba-1b97-4dfb-bf17-696732532b3e",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "8193170686",
            "text": "=Pago duplicado, error al intentar reportar pago {{ $json.ID }} {{ $json[\"Cliente/Concepto\"] }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            1260,
            -200
          ],
          "id": "4d05c1ba-da25-4d34-9818-834aa8b19a33",
          "name": "Telegram1",
          "webhookId": "5d979ebc-eea8-49c0-96e1-1c4286a133c4",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Meses": {
          "main": [
            [
              {
                "node": "PagoVarios",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "OtrosPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoVarios": {
          "main": [
            [
              {
                "node": "TodoOk?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TodoOk?": {
          "main": [
            [
              {
                "node": "mesesvarios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OtrosPago": {
          "main": [
            [
              {
                "node": "mesotros",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "mesesvarios": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "mesotros": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Error1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "7db5cecd-1620-4bad-98a0-aa782099cf13",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-10T20:17:23.982Z",
          "createdAt": "2025-06-10T20:17:23.982Z",
          "role": "workflow:owner",
          "workflowId": "o1nu8y5DA5W7ZaQm",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-17T17:00:26.000Z",
      "createdAt": "2025-09-19T20:29:47.754Z",
      "id": "pUUfrS2rb6SHGlDo",
      "name": "LoginBox",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "login",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -816,
            112
          ],
          "id": "01e6aa08-a8ef-4100-92ef-f226e5e5d0f9",
          "name": "LoginWebhook",
          "webhookId": "login-webhook-id"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "users",
            "filters": {
              "conditions": [
                {
                  "keyName": "username",
                  "keyValue": "={{ $json.body.username }}"
                },
                {
                  "keyName": "password",
                  "keyValue": "={{ $json.body.password }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -608,
            112
          ],
          "id": "f58f2f6b-5ca5-457e-adf0-d4021a5a9912",
          "name": "VerifyUser",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "id": "e9e9e5eb-4472-4ba4-93af-9734f70a0088"
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -416,
            112
          ],
          "id": "eb237d20-f998-41b5-bdf6-8b337bc94296",
          "name": "CheckLogin"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "success",
                  "value": false,
                  "type": "boolean"
                },
                {
                  "name": "message",
                  "value": "Usuario o contraseña incorrectos",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -176,
            96
          ],
          "id": "e094ce97-6aee-44bf-b345-cffd3eb0bd3c",
          "name": "LoginFailed"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "name": "success",
                  "value": true,
                  "type": "boolean",
                  "id": "cace978e-f0fb-4563-b8c5-672dd6157930"
                },
                {
                  "name": "message",
                  "value": "Login exitoso",
                  "type": "string",
                  "id": "d46b4c47-d060-40c1-879a-c824d94c3e55"
                },
                {
                  "name": "user_id",
                  "value": "={{ $json.id }}",
                  "type": "number",
                  "id": "39bf1c43-8a57-485b-bba6-32d6a157a30b"
                },
                {
                  "name": "username",
                  "value": "={{ $json.username }}",
                  "type": "string",
                  "id": "9ab697e0-245d-4c76-bdf9-087536ab318f"
                },
                {
                  "name": "token",
                  "value": "={{ $json.username }}_{{ Date.now() }}",
                  "type": "string",
                  "id": "044244f0-ab67-45cf-96ef-bfa708cd6ab0"
                },
                {
                  "id": "cadb01e2-8089-4696-9305-5a6eb11aa746",
                  "name": "rol",
                  "value": "={{ $json.rol }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -176,
            272
          ],
          "id": "d6d5f9ee-6eea-44ff-b602-7c0e6bb1c6b8",
          "name": "LoginSuccess"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            80,
            336
          ],
          "id": "67c31c84-2ab6-4337-bb39-28712320579e",
          "name": "LoginResponse"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "sales",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "username",
                  "condition": "eq",
                  "keyValue": "={{ $json.body.username }}"
                },
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $json.body.session_id }}"
                }
              ]
            }
          },
          "id": "5b6efe06-5d9d-45cc-a086-09193ba192db",
          "name": "Get Sales",
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -688,
            528
          ],
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY",
              "mode": "list",
              "cachedResultName": "regis24",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Sem4Sep1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "fecha": "={{ $('Get Sales').item.json.fecha }}",
                "Producto": "={{ $('Get Sales').item.json.Producto }}",
                "Cantidad": "={{ $('Get Sales').item.json.Cantidad }}",
                "Precio": "={{ $('Get Sales').item.json.Precio }}",
                "Total": "={{ $('Get Sales').item.json.total }}",
                "Usuario": "={{ $('Get Sales').item.json.username }}",
                "recaudado": "={{ $('Code1').item.json.total_recaudado }}",
                "total": "={{ $('Code1').item.json.total }}",
                "diferencia": "={{ $('Code1').item.json.diferencia }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "fecha",
                  "displayName": "fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Producto",
                  "displayName": "Producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Precio",
                  "displayName": "Precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Total",
                  "displayName": "Total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Usuario",
                  "displayName": "Usuario",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "recaudado",
                  "displayName": "recaudado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "diferencia",
                  "displayName": "diferencia",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "id": "605abd85-6732-4c63-87ab-47a52d103f0b",
          "name": "Save to Sheets",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            -272,
            528
          ],
          "executeOnce": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "corte-caja",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "21d1fd6b-8efe-4972-ad69-077eabe93934",
          "name": "Corte",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -896,
            528
          ],
          "webhookId": "1043b127-9e88-430f-ad03-84c30768006f"
        },
        {
          "parameters": {
            "jsCode": "// Calcular totales\nconst sales = $input.all();\nconst totalVentas = sales.reduce((sum, item) => sum + parseFloat(item.json.total || 0), 0);\nconst totalRecaudado = parseFloat($node[\"Corte\"].json[\"body\"][\"total_recaudado\"] || 0);\nconst diferencia = totalRecaudado - totalVentas;\n\nreturn [{\n  json: {\n    total_ventas: totalVentas,\n    total_recaudado: totalRecaudado,\n    diferencia: diferencia,\n    num_transacciones: sales.length,\n    ...sales[0]?.json // mantener datos originales\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            32,
            128
          ],
          "id": "2232fa48-7a12-48eb-a3a2-5c80bc31c572",
          "name": "Code"
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst sessionId = $node[\"Corte\"].json.body.session_id;\nconst totalRecaudado = parseFloat($node[\"Corte\"].json.body.total_recaudado || 0);\nconst totalVentas = items.reduce((sum, item) => sum + parseFloat(item.json.total || 0), 0);\nconst diferencia = totalRecaudado - totalVentas;\n\nreturn items.map(item => ({\n  json: {\n    ...item.json,\n    session_id_update: sessionId,\n    total_recaudado: totalRecaudado,\n    total_ventas_sesion: totalVentas,\n    diferencia: diferencia\n  }\n}));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -480,
            528
          ],
          "id": "d834f6b1-6208-4454-9358-65d545d4a353",
          "name": "Code1"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "sesiones-pendientes",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -832,
            272
          ],
          "id": "fc2af107-95af-44c3-a614-c4b0a5b5e77e",
          "name": "Cortesincierre",
          "webhookId": "4674c7c4-e3b2-44ae-8dda-2f5ff4b215eb"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "sales",
            "returnAll": true,
            "filters": {
              "conditions": [
                {
                  "keyName": "corte_realizado",
                  "condition": "eq",
                  "keyValue": "false"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -624,
            272
          ],
          "id": "4ff7f02c-a6f9-4427-8d6f-7d5f6648392f",
          "name": "Get many rows",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst sesionesUnicas = {};\n\n// Obtener sesiones únicas\nitems.forEach(item => {\n  const sessionId = item.json.session_id;\n  if (!sesionesUnicas[sessionId]) {\n    sesionesUnicas[sessionId] = {\n      session_id: sessionId,\n      username: item.json.username,\n      fecha: item.json.fecha.split('T')[0]\n    };\n  }\n});\n\nreturn Object.values(sesionesUnicas).map(sesion => ({ json: sesion }));\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -416,
            272
          ],
          "id": "4c473830-972a-455b-bdc2-f6c35f67aaee",
          "name": "Code2"
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "sales",
            "filters": {
              "conditions": [
                {
                  "keyName": "session_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Code1').item.json.session_id_update }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "corte_realizado",
                  "fieldValue": "true"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -64,
            528
          ],
          "id": "a46a549f-1fde-47d5-900e-2475b5873372",
          "name": "Update a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY",
              "mode": "list",
              "cachedResultName": "regis24",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 2026865076,
              "mode": "list",
              "cachedResultName": "Inventario",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit#gid=2026865076"
            },
            "options": {
              "dataLocationOnSheet": {
                "values": {
                  "rangeDefinition": "specifyRangeA1",
                  "range": "A:E"
                }
              }
            }
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            176,
            528
          ],
          "id": "3cba41f1-d9cd-4a22-9e58-dad3d1a9e4b4",
          "name": "Get row(s) in sheet",
          "executeOnce": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nreturn items.map(item => ({\n  json: {\n    CODIGO: item.json.CODIGO,\n    EXISTENCIA: item.json.CANTIDAD\n  }\n}));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            416,
            528
          ],
          "id": "0464b858-4974-456c-adcc-3a7ed45f6ca3",
          "name": "Code3"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY",
              "mode": "list",
              "cachedResultName": "regis24",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 2026865076,
              "mode": "list",
              "cachedResultName": "Inventario",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xvSrLxElBVSiSmREyM0D45vBf2JJNoEvB8XzhimZnuY/edit#gid=2026865076"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "CODIGO": "={{ $json.CODIGO }}",
                "CANTIDAD": "={{ $json.EXISTENCIA }}"
              },
              "matchingColumns": [
                "CODIGO"
              ],
              "schema": [
                {
                  "id": "CODIGO",
                  "displayName": "CODIGO",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "NOMBRE DEL PRODUCTO",
                  "displayName": "NOMBRE DEL PRODUCTO",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "CANTIDAD",
                  "displayName": "CANTIDAD",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "PRECIO",
                  "displayName": "PRECIO",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "EXISTENCIA",
                  "displayName": "EXISTENCIA",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            672,
            528
          ],
          "id": "03138f68-0789-45f7-a930-9d6ba362e3d3",
          "name": "Update row in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        }
      ],
      "connections": {
        "LoginWebhook": {
          "main": [
            [
              {
                "node": "VerifyUser",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "VerifyUser": {
          "main": [
            [
              {
                "node": "CheckLogin",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CheckLogin": {
          "main": [
            [
              {
                "node": "LoginFailed",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "LoginSuccess",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LoginFailed": {
          "main": [
            [
              {
                "node": "LoginResponse",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LoginSuccess": {
          "main": [
            [
              {
                "node": "LoginResponse",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Sales": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Corte": {
          "main": [
            [
              {
                "node": "Get Sales",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            []
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Save to Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cortesincierre": {
          "main": [
            [
              {
                "node": "Get many rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many rows": {
          "main": [
            [
              {
                "node": "Code2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update a row": {
          "main": [
            [
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save to Sheets": {
          "main": [
            [
              {
                "node": "Update a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "Code3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code3": {
          "main": [
            [
              {
                "node": "Update row in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "pUUfrS2rb6SHGlDo"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "LoginWebhook": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",
                "content-length": "42",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "98c9463abf006c16-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "b8d24392-0dcf-400e-9d96-ce220359bbfb",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "username": "admin",
                "password": "admin123"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/login",
              "executionMode": "production"
            }
          }
        ],
        "Corte": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0",
                "content-length": "139",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-MX,es;q=0.8,en-US;q=0.5,en;q=0.3",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "99fc2704095ff789-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "7c3b24a1-b0d2-49e3-8129-6f2e8b76e8f3",
                "connection": "keep-alive",
                "content-type": "text/plain;charset=UTF-8",
                "cookie": "rl_session=RudderEncrypt%3AU2FsdGVkX1%2FR31beUZfjTu7TpxgQy5R85Lr5PgxyHbI3lpHbLDFj%2Bqdd8MI39efQosCMECsxGBT8d05yJjbnpGo4a1b20Qn7ejoboWC7BwFk3k5e5BNGyRmi%2FFdyYhxqpdzFz9UeN6OIYoyTUdL7AQ%3D%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX19iKqCxYUn8c4E9vLtwWJHaEVP41uTeK0jLYGLICUer8Zpzz806Uw%2FEddpoGRr8qIoBxkLwN6HGuw%3D%3D; rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX19LOI8zvTJBJztTAqqfgn%2FEF7afIln2soI%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FPqyQbSFV7g1jA36Whw8ra8cxphgd%2FmZg%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX19DvrRzSMC6WUD4%2FzlTsFRCuWnMGKm9%2Bbw9rG6QWZZurww30wNn5mzrAVT5IQYwn7Nbjnr0j9nS5C4xySs36CWhUwjFIOoXj1TXmqPHMbfZg3UGjoP%2FF6%2BEJnFZb%2F%2BreqjqMpO0IFCog90ZbA%2FcYsfCM1v%2FRgBrFNI%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX1%2BpQv8SyUBGysSjwDMDdsejssPt43n6eFTyOY1BFZuVyCHCcJOsfkjVPwTsAc%2FjZPc27MifFqJBI3rAZdKpqxTO%2FQ4cygomOMoYtGxY0M6xKZ3d0jtumOo9xpyDD3RCQIlezhVhJ04bFA%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22af3548b56b1885c5ddb4415f9783e3c82e5cd2cf4498c201fda76a3ebfc51543%239680a89f-b235-48c1-9075-9a4ce990a57e%22%2C%22%24sesid%22%3A%5B1762308483518%2C%22019a51c4-0bef-79c2-9396-461a073e7901%22%2C1762308393942%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fn8n.albored.com%2Fsignin%3Fredirect%3D%25252F%22%7D%7D",
                "origin": "https://box.albored.com",
                "priority": "u=6",
                "referer": "https://box.albored.com/",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "no-cors",
                "sec-fetch-site": "same-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": "{\"user_id\":4,\"username\":\"sindy\",\"fecha\":\"2025-11-17\",\"session_id\":\"4_1763335857947\",\"action\":\"corte_automatico_cierre\",\"total_recaudado\":0}",
              "webhookUrl": "https://n8n.albored.com/webhook/corte-caja",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "bad16c92-db5c-4721-a54e-49083ff01011",
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-09-19T20:29:47.775Z",
          "createdAt": "2025-09-19T20:29:47.775Z",
          "role": "workflow:owner",
          "workflowId": "pUUfrS2rb6SHGlDo",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-06T03:03:46.000Z",
      "createdAt": "2025-08-23T04:01:26.638Z",
      "id": "py25oNpt7AuOmEcc",
      "name": "PagoInterStaCruz",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Pago de Internet",
            "formDescription": "Ingresa Id o Busca por Nombre",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID"
                },
                {
                  "fieldLabel": "NOMBRE"
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "buttonLabel": "Aceptar",
              "path": "car",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -3296,
            896
          ],
          "id": "0ca8265f-e216-4d34-84b4-4805690ec916",
          "name": "On form submission",
          "webhookId": "dd7c0af7-9b9f-4235-98b6-a9f33bc66b75"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "2d77fd42-1873-439d-af09-460c82ce353a",
                  "leftValue": "={{ $json.Nombre.toLowerCase ()}}",
                  "rightValue": "={{ $('On form submission').item.json.NOMBRE }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -3072,
            704
          ],
          "id": "a2c7078d-9ac2-48f8-8cb6-ecc5dc5fa7a1",
          "name": "Filter",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "2c6fbedf-d480-46fd-a4c9-93508dd632d3",
                  "leftValue": "={{ $json.Nombre }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3072,
            1104
          ],
          "id": "7e61fe6f-12ad-4840-b51a-51678557e1e7",
          "name": "If"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "=codigo",
                  "lookupValue": "={{ $('On form submission').item.json.ID.toUpperCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -3264,
            1104
          ],
          "id": "4cdc98bf-2975-47cf-9ea4-4625e95c1272",
          "name": "ID",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -3296,
            704
          ],
          "id": "2244bca9-82f3-4203-b895-9339ced4a796",
          "name": "NOMBRE",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const nameToFind = $('On form submission').first().json.NOMBRE.toLowerCase();\nconst clients = $input.all();\n\n// Verificar si el nombre a buscar está vacío\nif (!nameToFind) {\n  return [{ json: { message: 'Por favor, ingrese un nombre para buscar.' } }];\n}\n\n// Filtrar los clientes que coinciden\nconst filteredClients = clients.filter(client => {\n  const clientName = client.json.Nombre;\n  return clientName && typeof clientName === 'string' && clientName.toLowerCase().includes(nameToFind);\n});\n\n// Si no se encontraron clientes, devolver un mensaje de error\nif (filteredClients.length === 0) {\n  return [{ json: { message: 'No se encontraron clientes con ese nombre.' } }];\n}\n\n// Mapear los clientes filtrados para crear un array de cadenas de texto con la información deseada\nconst clientMessages = filteredClients.map(client => {\n  const name = client.json.Nombre || 'Nombre no disponible';\n  const code = client.json.codigo || 'Código no disponible';\n  return `Nombre: ${name}, Código: ${code}`;\n});\n\n// Unir todos los mensajes en una sola cadena, separándolos con saltos de línea\nconst finalMessage = clientMessages.join('\\n');\n\n// Devolver un solo ítem con el mensaje final\nreturn [{ json: { message: finalMessage } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2848,
            704
          ],
          "id": "ff71f539-f472-4d23-9e5a-f56cd728113c",
          "name": "Code"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "ERROR",
            "completionMessage": "CLIENTE NO ENCONTRADO ",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2848,
            848
          ],
          "id": "511991be-e830-4364-b49d-0183324a3078",
          "name": "no existe",
          "webhookId": "3e4d0b03-d043-44af-a448-77682d6c3378"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.ID }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "c385fd11-d0ea-4311-9ae2-dd1f6e1e2bdd"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0828d583-eb11-4ef6-b6a5-2650bcb4e982",
                        "leftValue": "={{ $json.NOMBRE }}",
                        "rightValue": "=",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -3072,
            880
          ],
          "id": "fbc888ca-b515-4786-839c-fccf036d998e",
          "name": "Switch"
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -2416,
            1248
          ],
          "id": "957622b2-f998-4c53-8a76-607a2d765edd",
          "name": "Merge"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=Encontrados",
            "completionMessage": "={{ $json.message }}",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2656,
            704
          ],
          "id": "f00362cf-44f0-44e2-b9dc-acdf37029fd2",
          "name": "Encontrados",
          "webhookId": "c4216fd3-11eb-4b7a-b584-8c666edaad78"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a5f79a3c-2fe2-4d2a-8ab1-1b9ed4e919e0",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "20",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "36fdb60d-d81f-4751-8699-15fce9d8e1ca",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "120",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "d936e11c-68bb-4c61-8490-7f590626d3a4",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "250",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "03db099a-9f2d-4185-852c-b5229d8e6bb3",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "350",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "ceb38cfd-a3e2-4468-a884-4058a5292237",
                        "leftValue": "={{ $json.Cantidad }}",
                        "rightValue": "450",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -2848,
            1008
          ],
          "id": "c460a548-d995-46c7-a984-dd04bf449c00",
          "name": "Plan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "=Plan2M",
                  "type": "string"
                },
                {
                  "id": "200ca108-4601-4ee3-bdca-a560f390669b",
                  "name": "hrs",
                  "value": 24,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            864
          ],
          "id": "d5b55be9-e75b-4b87-b838-0e5165ead89c",
          "name": "1dia"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan2M",
                  "type": "string"
                },
                {
                  "id": "e0f83a70-09ea-47a6-8667-f3ea698e17ca",
                  "name": "hrs",
                  "value": 168,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1008
          ],
          "id": "23928d47-4f25-4ce6-acce-9f141630654c",
          "name": "1sem"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2416,
            1104
          ],
          "id": "c48b268d-c6e6-4522-af56-98220b1a606f",
          "name": "10Mb"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan5M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1296
          ],
          "id": "6e26defe-3466-4515-9c24-ec5c42ab23c4",
          "name": "18Mb"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "af2ee9d5-5b81-49a3-ae59-d6ecbc4a4262",
                  "name": "PlanPagado",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2624,
            1152
          ],
          "id": "9ae31dd2-40d9-4084-88ef-bc6786494553",
          "name": "14Mb"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Switch').item.json.submittedAt }}",
            "timeUnit": "hours",
            "duration": "={{ $json.hrs }}",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -1984,
            688
          ],
          "id": "affa1cf6-76a3-4db9-9b35-a458b23e0875",
          "name": "Date & Time"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $json.fechaDeCorteFormateada }}",
            "timeUnit": "hours",
            "duration": "={{ $json.hrs  }}",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -2192,
            832
          ],
          "id": "598c3c64-33bb-4e24-8935-29081fff10e8",
          "name": "Date & Time1"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -2416,
            896
          ],
          "id": "cae95710-7422-4522-b471-3e29b6957d00",
          "name": "Merge1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "15fba6b9-f932-428a-aa43-ce39d9f1660b",
                  "leftValue": "={{ $now }}",
                  "rightValue": "={{ $json.fechaDeCorteFormateada }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "afterOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2208,
            1120
          ],
          "id": "ddf0b7e5-4903-4411-a13b-58a699402775",
          "name": "If2"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $now }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -2192,
            976
          ],
          "id": "39249ea5-2750-4b48-89c4-f28bcea957a6",
          "name": "Date & Time2"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $json.fechaDeCorteFormateada }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "corte",
            "options": {
              "includeInputFields": true
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            -1984,
            848
          ],
          "id": "180efb60-0e73-40fd-87c5-a52f3a1a06cd",
          "name": "Date & Time3"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -1776,
            688
          ],
          "id": "b424400c-3fad-46ab-83f5-1ff7c0ae96ad",
          "name": "Merge2"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "49cc61e1-e18b-41e2-b11c-93ac9d032869",
                  "leftValue": "={{ $json.submittedAt }}",
                  "rightValue": "={{ $json.fechaDeCorteFormateada }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "afterOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2208,
            704
          ],
          "id": "70cb226e-f6dd-4742-950a-b90a100ebb4e",
          "name": "If1"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Agregado al Carrito - Presiona Ver Carrito",
            "completionMessage": "=ID {{ $('ActualizaBase').item.json.codigo }} -- {{ $('Edit Fields').item.json.nombre }} -- ${{ $('ActualizaBase').item.json[\"cantidad pagada \"] }} -- Fecha de Corte {{ $('ActualizaBase').item.json[\"fecha de corte\"] }} a las {{ $json[\"start-time\"] }}",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -1600,
            1408
          ],
          "id": "ffe6dd37-ab9a-457c-acbe-d47495b9cca9",
          "name": "Form1",
          "webhookId": "58351bbc-b85a-4c66-ab4f-eeb1f7c04b39"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error ***",
            "completionMessage": "No encontrado",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3280,
            1280
          ],
          "id": "40cd47ab-ec0f-4801-b19d-da59adf8c791",
          "name": "Error404",
          "webhookId": "62378c24-fb9e-4539-96d6-89f4e302c4c7"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "=Cantidad",
                  "fieldType": "number",
                  "placeholder": "={{ $json['cantidad pagada '] }}"
                }
              ]
            },
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formDescription": "=ID  {{ $json.codigo }} - {{ $json.Nombre }} - Corte: {{ $json['fecha de corte'] }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -3040,
            1296
          ],
          "id": "9e7c03f4-c501-4fa1-a4d3-71d6d58b402f",
          "name": "Cantidad",
          "webhookId": "9f4673c8-89c6-4037-be0d-2dc6df593ff9"
        },
        {
          "parameters": {
            "limitWaitTime": true,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "ERROR **",
              "formDescription": "=La cantidad no es correcta",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}\n\n"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -2848,
            1312
          ],
          "id": "d4bbf6da-03b2-4f9f-be71-78cbbb840b93",
          "name": "ErrorCant",
          "webhookId": "d65696fe-c6ab-4144-a97e-d49ceb617643"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene el objeto JSON del nodo 'Merge1' y extrae la fecha de corte.\n// Asegúrate de que el nombre 'Merge1' coincida con tu nodo real.\nconst fechaDeCorte = $node['ID'].json['fecha de corte'];\n\n// El resto del código permanece igual\nconst outputItems = [];\n\nfor (const item of $input.all()) {\n  const originalJson = item.json;\n\n  if (fechaDeCorte) {\n    const parts = fechaDeCorte.split('/');\n    const day = parts[0];\n    const month = parts[1];\n    const year = parts[2];\n\n    const formattedDate = `${year}-${month}-${day}`;\n    \n    originalJson.fechaDeCorteFormateada = formattedDate;\n  }\n\n  outputItems.push({\n    json: originalJson\n  });\n}\n\nreturn outputItems;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2416,
            704
          ],
          "id": "898f7086-b947-4095-b6c5-9200a4312598",
          "name": "formatdate"
        },
        {
          "parameters": {
            "jsCode": "// Obtiene el objeto JSON del nodo 'Merge1' y extrae la fecha de corte.\n// Asegúrate de que el nombre 'Merge1' coincida con tu nodo real.\nconst fechaDeCorte = $node['ID'].json['fecha de corte'];\n\n// El resto del código permanece igual\nconst outputItems = [];\n\nfor (const item of $input.all()) {\n  const originalJson = item.json;\n\n  if (fechaDeCorte) {\n    const parts = fechaDeCorte.split('/');\n    const day = parts[0];\n    const month = parts[1];\n    const year = parts[2];\n\n    const formattedDate = `${year}-${month}-${day}`;\n    \n    originalJson.fechaDeCorteFormateada = formattedDate;\n  }\n\n  outputItems.push({\n    json: originalJson\n  });\n}\n\nreturn outputItems;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2208,
            1264
          ],
          "id": "ce71391a-8f0b-4bd8-b7a7-abb7e10d2b0a",
          "name": "Formatedate"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc",
              "mode": "list",
              "cachedResultName": "PagoInterStaCruz",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1X12mI57th5YgPvQTiH4UyFKxvJfcgtw8WbAfZNaF9uc/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "codigo": "={{ $('If').item.json.codigo }}",
                "cantidad pagada ": "={{ $('Cantidad').item.json.Cantidad }}",
                "fecha de corte": "={{ $json.corte.toDateTime().format('dd/MM/yyyy') }}",
                "fecha de pago ": "={{ $json.submittedAt.toDateTime().format('yyyy-MM-dd') }}",
                "hora de pago": "={{ $json.submittedAt.toDateTime().format('hh:mm:ss') }}"
              },
              "matchingColumns": [
                "codigo"
              ],
              "schema": [
                {
                  "id": "codigo",
                  "displayName": "codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad pagada ",
                  "displayName": "cantidad pagada ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "fecha de pago ",
                  "displayName": "fecha de pago ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "fecha de corte",
                  "displayName": "fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "hora de pago",
                  "displayName": "hora de pago",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Mac",
                  "displayName": "Mac",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ip",
                  "displayName": "Ip",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1600,
            688
          ],
          "id": "9cccdea5-96bc-41ff-bdab-70bac0fa6dc7",
          "name": "ActualizaBase",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "={{ $json.codigo }}"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $('ID').item.json.Nombre }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "1"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json[\"cantidad pagada \"] }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json[\"cantidad pagada \"] }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1808,
            912
          ],
          "id": "f3092564-d3b6-447d-ad51-086b04cfb4b8",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bf85ddee-ad8c-4bd3-8b7e-060f42558a69",
                  "name": "id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "22963fb9-38c8-4c47-be1a-629753d09cf0",
                  "name": "nombre",
                  "value": "={{ $json.product_id }}",
                  "type": "string"
                },
                {
                  "id": "4c71f54f-d766-4cc1-b7ec-86b523a3100e",
                  "name": "cantidad pagada ",
                  "value": "={{ $('ActualizaBase').item.json[\"cantidad pagada \"] }}",
                  "type": "number"
                },
                {
                  "id": "c62b9bde-3cb2-4f68-b10f-21c4b9224c7b",
                  "name": "fecha de corte",
                  "value": "={{ $('ActualizaBase').item.json[\"fecha de corte\"] }}",
                  "type": "string"
                },
                {
                  "id": "5034c9ed-ee7b-4597-8829-2cb77d72981b",
                  "name": "PlanPagado",
                  "value": "={{ $('Merge2').item.json.PlanPagado }}",
                  "type": "string"
                },
                {
                  "id": "665e7581-7881-4001-b2c9-3e25317fc011",
                  "name": "Mac",
                  "value": "={{ $('ID').item.json.Mac }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1616,
            880
          ],
          "id": "2c743775-fc36-467d-b746-9321577ccf5f",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/ip/hotspot/ip-binding?mac-address={{ $json.Mac }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1984,
            976
          ],
          "id": "0ea51ab6-ade9-4cf9-9965-c250409f029f",
          "name": "ipbinding",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/ip/hotspot/ip-binding/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"disabled\": \"no\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -2000,
            1120
          ],
          "id": "893ac5c4-b33e-4582-932f-ab1a77bcc064",
          "name": "active",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/ip/dhcp-server/lease?mac-address={{ $json[\"mac-address\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1984,
            1312
          ],
          "id": "30a59b0e-8947-4ace-91f6-07dbcd8ddfbc",
          "name": "dhcp-server",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/ip/dhcp-server/lease/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"address-lists\": \"{{$('Edit Fields').item.json.PlanPagado}}\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1792,
            1088
          ],
          "id": "76e1e899-0d0d-46d2-a4fa-00056feb400f",
          "name": "addreslist",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "url": "=http://192.168.88.1:8080/rest/system/scheduler?name={{ $('Edit Fields').item.json.id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1616,
            1040
          ],
          "id": "faec7ed1-cc6a-4075-acff-54285763ff13",
          "name": "schedule",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=http://192.168.88.1:8080/rest/system/scheduler/{{ $json[\".id\"] }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"start-date\": \"{{ $json.fechamikro }}\",\n  \"start-time\": \"{{ $json.horamikro }}\"\n}",
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1616,
            1216
          ],
          "id": "c48b1687-b103-4d32-8bb2-d502b780ad8d",
          "name": "fechacorte",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Obtenemos los datos actuales que vienen del nodo \"schedule\".\nconst currentData = items[0].json;\n\n// ¡IMPORTANTE! Obtenemos los datos del nodo específico \"Edit Fields\".\nconst sourceData = $node[\"Edit Fields\"].json;\n\n// Ahora extraemos la fecha de corte desde la fuente de datos correcta.\nconst dateStr = sourceData['fecha de corte'].trim();\n\n// --- Código para formatear la fecha (sin cambios) ---\nconst parts = dateStr.split('/');\nconst day = parts[0];\nconst month = parts[1];\nconst year = parts[2];\nconst dateObj = new Date(year, month - 1, day);\nconst monthNames = [\"jan\", \"feb\", \"mar\", \"apr\", \"may\", \"jun\", \"jul\", \"aug\", \"sep\", \"oct\", \"nov\", \"dec\"];\nconst mikrotikMonth = monthNames[dateObj.getMonth()];\nconst mikrotikDay = String(dateObj.getDate()).padStart(2, '0');\nconst mikrotikYear = dateObj.getFullYear();\nconst formattedDate = `${mikrotikMonth}/${mikrotikDay}/${mikrotikYear}`;\n\n// --- NUEVA PARTE: Definimos la hora ---\n// Aquí puedes poner la hora que necesites en formato HH:MM:SS\n// --- NUEVA PARTE: Obtenemos la HORA ACTUAL ---\nconst now = new Date();\nconst hours = String(now.getHours()).padStart(2, '0');\nconst minutes = String(now.getMinutes()).padStart(2, '0');\nconst seconds = String(now.getSeconds()).padStart(2, '0');\n\n// Construimos la hora en el formato HH:MM:SS que MikroTik necesita\nconst formattedTime = `${hours}:${minutes}:${seconds}`;\n\n// Añadimos la fecha formateada a los datos.\ncurrentData.fechamikro = formattedDate;\n\n// --- NUEVA PARTE: Añadimos también la hora a los datos ---\ncurrentData.horamikro = formattedTime;\n\n// Retornamos los datos combinados para el siguiente nodo.\nreturn [{\n  json: currentData\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1776,
            1264
          ],
          "id": "2bd4b265-8759-4742-8d24-dafc8e88aea0",
          "name": "Code1"
        }
      ],
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Cantidad",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error404",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ID": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "NOMBRE": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Encontrados",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "ID",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "NOMBRE",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "no existe",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Formatedate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan": {
          "main": [
            [
              {
                "node": "1dia",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "1sem",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "10Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "14Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "18Mb",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ErrorCant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "1dia": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "1sem": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "10Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "18Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "14Mb": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Date & Time": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time1": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "formatdate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Date & Time2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Date & Time3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Date & Time2": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Date & Time3": {
          "main": [
            [
              {
                "node": "Merge2",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Merge2": {
          "main": [
            [
              {
                "node": "ActualizaBase",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Date & Time",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Date & Time1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cantidad": {
          "main": [
            [
              {
                "node": "Plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ErrorCant": {
          "main": [
            [
              {
                "node": "Cantidad",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "formatdate": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Formatedate": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaBase": {
          "main": [
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "ipbinding",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ipbinding": {
          "main": [
            [
              {
                "node": "active",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "active": {
          "main": [
            [
              {
                "node": "dhcp-server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "dhcp-server": {
          "main": [
            [
              {
                "node": "addreslist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "addreslist": {
          "main": [
            [
              {
                "node": "schedule",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "schedule": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "fechacorte",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "fechacorte": {
          "main": [
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "6qDeTkqGyaEvvHE7"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "On form submission": [
          {
            "json": {
              "ID": "mahe",
              "NOMBRE": "",
              "submittedAt": "2025-12-05T21:05:04.286-05:00",
              "formMode": "production"
            }
          }
        ]
      },
      "versionId": "038f7ea1-d0e9-4abf-a426-f3be3f5c25eb",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-23T04:01:26.643Z",
          "createdAt": "2025-08-23T04:01:26.643Z",
          "role": "workflow:owner",
          "workflowId": "py25oNpt7AuOmEcc",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-12-04T17:25:57.000Z",
      "createdAt": "2025-11-28T22:13:51.913Z",
      "id": "qwR6WlITUXvHkiGp",
      "name": "ClientesAlbored",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "Basico",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1520,
            1168
          ],
          "id": "97d6b128-f978-4463-b898-33af8378deaf",
          "name": "400"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Premium",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1344,
            1216
          ],
          "id": "7115f41f-a6d8-4109-8ee9-46985b0df269",
          "name": "500"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plus",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1472,
            1312
          ],
          "id": "b4fcfac5-28cb-4b3b-92f2-9a8eda0b8c37",
          "name": "800"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "IDCliente",
                  "lookupValue": "={{ $json[\"ID Cliente\"] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            928,
            784
          ],
          "id": "77512d83-a9d3-43f4-ba39-9e6ba8fd19dc",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $('Code in JavaScript').item.json.fecha }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            960,
            1312
          ],
          "id": "93373ea3-6cba-4219-a90b-19f55e6236e4",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                }
              ]
            },
            "limitWaitTime": true,
            "resumeAmount": 10,
            "resumeUnit": "minutes",
            "options": {
              "formTitle": "={{ $('Existe?').item.json['Nombre completo'] }}",
              "formDescription": "=\nID: {{ $json.IDCliente }}",
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1584,
            784
          ],
          "id": "8f85e222-a2d6-4e93-8a71-46a3c68c1a97",
          "name": "CargarPago",
          "webhookId": "2be449ef-5a47-46df-baaf-e893c4a86f0a"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "=no fue encontrado en nuestra base de datos.",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            736,
            976
          ],
          "id": "3a4631b0-e36c-4e82-97ed-f4c7fcf7e7e4",
          "name": "Error",
          "webhookId": "c8553210-c36a-497c-b403-e7b6cc02a210"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['IDCliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1120,
            784
          ],
          "id": "7197b433-1da8-48cf-9c3d-9e0673bfc1d9",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago {{ $('DatosListos').item.json['ID Cliente'] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Plan Pagado: {{ $('DatosListos').item.json.NuevoPlan }} y Cantidad pagada ${{ $('DatosListos').item.json['Cantidad Pagada'] }}, esten correctos, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            2272,
            1408
          ],
          "id": "8d37341e-5bcf-4ee3-8450-0d4de6e1f917",
          "name": "Sandra",
          "webhookId": "348fa3a7-d62d-4cc0-8925-68be6759c61c",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1656915010,
              "mode": "list",
              "cachedResultName": "Respuestas de formulario 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=1656915010"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "IDCliente": "={{ $json.ID }}",
                "FechaPago": "={{ $json.FechaCorte }}"
              },
              "matchingColumns": [
                "IDCliente"
              ],
              "schema": [
                {
                  "id": "Marca temporal",
                  "displayName": "Marca temporal",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Dirección ",
                  "displayName": "Dirección ",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Numero de teléfono",
                  "displayName": "Numero de teléfono",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Zona",
                  "displayName": "Zona",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Plan",
                  "displayName": "Plan",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Recomendado por..(ID Cliente)",
                  "displayName": "Recomendado por..(ID Cliente)",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Usuario pppoe",
                  "displayName": "Usuario pppoe",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "contraseña",
                  "displayName": "contraseña",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "FechaInstalacion",
                  "displayName": "FechaInstalacion",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "FechaPago",
                  "displayName": "FechaPago",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "IDCliente",
                  "displayName": "IDCliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ConectadoCaja",
                  "displayName": "ConectadoCaja",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Puerto",
                  "displayName": "Puerto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2368,
            784
          ],
          "id": "541834bc-b716-47d7-a631-d64b59e4dd4e",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1968,
            1152
          ],
          "id": "968ebe79-8d0f-42f7-9bb0-b7fd80980622",
          "name": "Form1",
          "webhookId": "6fa51534-80c2-4f06-bd9f-8b5bb5aaf5fc"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2368,
            976
          ],
          "id": "3519f011-71b1-4527-b20f-4cc68f82b4d1",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"IDCliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Code in JavaScript').item.json.fecha }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Code in JavaScript').item.json.cuenta_destino }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Code in JavaScript').item.json.cantidad }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "7ba9f873-305f-4351-a7f0-c230cd35871a",
                  "name": "Usuario pppoe",
                  "value": "={{ $('Existe?').item.json['Usuario pppoe'] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1968,
            784
          ],
          "id": "bce7d83b-d53e-4a1f-b98e-266649690824",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Code in JavaScript').item.json.cantidad }}",
                        "rightValue": "=400",
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Code in JavaScript').item.json.cantidad }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Code in JavaScript').item.json.cantidad }}",
                        "rightValue": "800",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1152,
            1280
          ],
          "id": "2f1b837a-1bd2-4250-a295-a0b67ab8592b",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 215681821,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=215681821"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json['ID Cliente'] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "--": "--",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Cantidad": "={{ $json['Cantidad Pagada'] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Plan",
                  "displayName": "Plan",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Nom",
                  "displayName": "Nom",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ingre",
                  "displayName": "Ingre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "gasto",
                  "displayName": "gasto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Total",
                  "displayName": "Total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Eqvale",
                  "displayName": "Eqvale",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Corresp",
                  "displayName": "Corresp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2176,
            784
          ],
          "id": "a379c1e2-d5f2-415b-94da-56eadeba7b08",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2368,
            1168
          ],
          "id": "e1250734-319c-45cb-8539-3c2064795818",
          "name": "Gmail",
          "webhookId": "8300d660-3e18-4436-8867-0105076d20fb",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "limitWaitTime": true,
            "resumeAmount": 20,
            "resumeUnit": "minutes",
            "options": {
              "customCss": ":root {\n\t--font-family: 'Arial', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 700;\n\t--font-size-body: 16px;\n\t--font-size-label: 18px;\n\t--font-size-test-notice: 16px;\n\t--font-size-input: 18px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 18px;\n\t--font-size-link: 16px;\n\t--font-size-error: 16px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #000000;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #000000;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #007bff;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #000000;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #000000;\n\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 10px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 18px;\n\n\t/* Spacing */\n\t--padding-container-top: 20px;\n\t--padding-card: 20px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 20px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 20px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 350px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 8px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n    --font-weight-label: 600; \n    --font-weight-submit-btn: 700; \n    --font-weight-headings: 700; \n}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2192,
            1168
          ],
          "id": "64714d3c-7368-4d2d-b2a2-5abfeb670781",
          "name": "Form",
          "webhookId": "defa5022-2ebe-4b2d-95df-92e0b2b5fed9"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            1984,
            1312
          ],
          "id": "6a38a282-caf5-44b3-acfb-bcaf5cacde7c",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Code in JavaScript').item.json.fecha }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            1696,
            1328
          ],
          "id": "080ae3ee-bb83-4c32-b45b-c56e7d4efb23",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json.FechaPago }}",
            "timeUnit": "months",
            "duration": "=1",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            1792,
            1008
          ],
          "id": "fc0ee39b-a5aa-40b3-b2a6-ebb81e84e099",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Code in JavaScript').item.json.fecha }}",
                  "rightValue": "={{ $('Existe?').item.json.FechaPago }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1712,
            1168
          ],
          "id": "ee4a8bd3-78cc-4473-ba27-9af8494ff9da",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "formTitle": "Ingresa ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente"
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "Pagos"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.3,
          "position": [
            736,
            784
          ],
          "id": "d7e8ac7f-604e-43f5-a817-5b538f00554c",
          "name": "On form submission",
          "webhookId": "f5d012e7-b34a-40ed-a8e5-32e3264e4d99"
        },
        {
          "parameters": {
            "resource": "image",
            "operation": "analyze",
            "modelId": {
              "__rl": true,
              "value": "models/gemini-2.5-pro",
              "mode": "list",
              "cachedResultName": "models/gemini-2.5-pro"
            },
            "text": "De la siguiente imagen extrae los siguientes datos y separalos en variables independientes:\nfecha de la operacion\nCantida\nCuenta destino\nConcepto\nReferencia\n\nDevuelve el resultado ÚNICAMENTE en formato JSON con la siguiente estructura: { \"fecha\": \"...\", \"cantidad\": \"...\", \"cuenta_destino\": \"...\", \"referencia\": \"...\" }. No incluyas texto adicional.",
            "inputType": "binary",
            "binaryPropertyName": "Cargar_comprobante",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.googleGemini",
          "typeVersion": 1,
          "position": [
            1776,
            784
          ],
          "id": "9736a09d-9b89-4e7d-879e-a94c054519e7",
          "name": "Analyze an image",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// 1. Obtenemos el texto crudo\nconst rawText = items[0].json.content.parts[0].text;\n\n// 2. Limpieza básica\nconst cleanText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();\n\nlet data;\ntry {\n    data = JSON.parse(cleanText);\n\n    if (data.cantidad) {\n        // Convertimos a número limpiando el signo de pesos\n        let valorNumerico = parseFloat(String(data.cantidad).replace(/[^0-9.]/g, ''));\n\n        // --- REGLAS DE NORMALIZACIÓN BLINDADAS ---\n\n        // CASO 1: Si es menor a 400, guardamos el valor exacto y NO hacemos nada más.\n        if (valorNumerico < 400) {\n            data.cantidad = valorNumerico;\n        }\n        // CASO 2: Rango 400 (De 400 a 424.99) -> Se baja a 400\n        else if (valorNumerico >= 400 && valorNumerico < 425) {\n            data.cantidad = 400;\n        }\n        // CASO 3: Rango 500 (De 500 a 524.99) -> Se baja a 500\n        else if (valorNumerico >= 500 && valorNumerico < 525) {\n            data.cantidad = 500;\n        }\n        // CASO 4: Rango 800 (De 800 a 824.99) -> Se baja a 800\n        else if (valorNumerico >= 800 && valorNumerico < 825) {\n            data.cantidad = 800;\n        }\n        // CASO 5: Cualquier otro número mayor (ej. 450, 1000) se queda igual\n        else {\n            data.cantidad = valorNumerico;\n        }\n    }\n\n} catch (error) {\n    data = { error: \"Error procesando\", raw: rawText };\n}\n\nreturn [\n  {\n    json: data\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            960,
            976
          ],
          "id": "121418f2-145a-49d6-b2c5-f8b4b944f28e",
          "name": "Code in JavaScript"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Datos Correctos?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "SI"
                      },
                      {
                        "option": "NO"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formTitle": "={{ $('Existe?').item.json.IDCliente }} {{ $('Existe?').item.json['Nombre completo'] }}",
              "formDescription": "={{ $('Code in JavaScript').item.json.fecha }} Cantidad Pagada ${{ $('Code in JavaScript').item.json.cantidad }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            960,
            1152
          ],
          "id": "35739591-7adb-4833-8252-790af56f2861",
          "name": "Correcto?",
          "webhookId": "37d24f42-c93c-42a2-81cb-14df6f41506a"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "738a5bb6-4f05-44ea-8759-563557805b5b",
                  "leftValue": "={{ $json['Datos Correctos?'] }}",
                  "rightValue": "SI",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1152,
            1136
          ],
          "id": "363495fa-dad3-43ce-9a1b-2dbd6ecff77f",
          "name": "If"
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            1584,
            992
          ],
          "id": "71e84b5d-9db9-4536-9f9c-a9555a785d49",
          "name": "Merge"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -T -p 9090 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/system scheduler add name=\\\"{{ $('Limpiar').item.json.IDCliente }}\\\" start-date=\\\"{{ $('Limpiar').item.json.DatePay }}\\\" interval=31d on-event=\\\"/ppp secret disable [find name={{ $('Limpiar').item.json[\"Usuario pppoe\"] }}]\\\"\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2176,
            976
          ],
          "id": "49f9c264-8265-44c0-9ef2-56db6f8c7015",
          "name": "Execute Command1"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -T -p 9090 -o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \"/ppp secret enable [find name=tester]\\\""
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            1984,
            976
          ],
          "id": "1f69cf7e-90cb-4127-9781-a4fe7e8204df",
          "name": "PPPSecret"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw",
              "mode": "list",
              "cachedResultName": "ClientesDepas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 215681821,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HsIQBKyIFecFcAocdZlq-jCI_6KlOnq_BIYsXmMnWrw/edit#gid=215681821"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $('Existe?').item.json.IDCliente }}"
                },
                {
                  "lookupColumn": "Fecha",
                  "lookupValue": "={{ $json.fecha }}"
                },
                {
                  "lookupColumn": "Referencia",
                  "lookupValue": "={{ $json.referencia }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            1376,
            976
          ],
          "id": "39a9211d-92ca-41ae-861e-f4f9cccda3d0",
          "name": "Get row(s) in sheet",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "a17ef629-f910-4e1a-afe9-6ec47f786ec3",
                  "leftValue": "={{ $json.isEmpty() }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            736,
            1168
          ],
          "id": "e0ad3fd0-66cd-4157-8ea9-2dcd80972efb",
          "name": "If1"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Pago Duplicado",
            "completionMessage": "El pago ya ha sido reportado",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            736,
            1312
          ],
          "id": "ad1ab774-1559-40f4-aa5a-f542489274a2",
          "name": "Duplicado",
          "webhookId": "9fc6069e-acec-484a-a681-5f03e7f7a340"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "10d35791-1b7c-420c-a864-505f05c28f1b",
                  "leftValue": "={{ $json.cantidad }}",
                  "rightValue": 400,
                  "operator": {
                    "type": "number",
                    "operation": "lt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1152,
            960
          ],
          "id": "14cdeae8-e08c-4389-958c-9bb6fac7d77d",
          "name": "MontoCorrecto?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Cantidad Incorrecta",
            "completionMessage": "Errror, cantidad incorrecta o foto borrosa. ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            1360,
            784
          ],
          "id": "b4b64a6e-062f-463d-879e-a5dbeb1c8bae",
          "name": "CantidadIncorrecta",
          "webhookId": "b6976ea0-63a0-48ba-8407-29ad31c3bdde"
        }
      ],
      "connections": {
        "400": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "500": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "800": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "Analyze an image",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "PPPSecret",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "400",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "500",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "800",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Sandra",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Analyze an image": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "MontoCorrecto?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Correcto?": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ],
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PPPSecret": {
          "main": [
            [
              {
                "node": "Execute Command1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Correcto?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Duplicado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute Command1": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MontoCorrecto?": {
          "main": [
            [
              {
                "node": "CantidadIncorrecta",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a1ee4469-5f74-41e8-ad8a-e1c385bd3384",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-28T22:13:51.916Z",
          "createdAt": "2025-11-28T22:13:51.916Z",
          "role": "workflow:owner",
          "workflowId": "qwR6WlITUXvHkiGp",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-11-22T05:32:41.927Z",
          "createdAt": "2025-11-22T05:32:41.927Z",
          "id": "REkbHNk0nSWbCGDS",
          "name": "Depas"
        }
      ]
    },
    {
      "updatedAt": "2025-08-05T18:19:36.000Z",
      "createdAt": "2025-08-04T21:11:28.545Z",
      "id": "rSBvsYhJOI9W9lXP",
      "name": "NewRag",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "options": {
              "queryName": "match_documents"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            -896,
            320
          ],
          "id": "add20370-8ba0-4e45-9f0c-d4157f73e773",
          "name": "Supabase Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "dataType": "binary",
            "loader": "textLoader",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "label",
                    "value": "={{ $json.Etiqueta }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1.1,
          "position": [
            -720,
            512
          ],
          "id": "bafef5fb-1d34-4c9f-b487-620e6eaa293f",
          "name": "Default Data Loader"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            -896,
            512
          ],
          "id": "66d5dcc8-1061-46f6-84fd-deac6b7089eb",
          "name": "Embeddings Google Gemini",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "formTitle": "Cargar Archivos",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Archivo",
                  "fieldType": "file"
                },
                {
                  "fieldLabel": "Etiqueta",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "empresa"
                      },
                      {
                        "option": "contrata"
                      },
                      {
                        "option": "cobertura"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "appendAttribution": false,
              "path": "Up"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -944,
            96
          ],
          "id": "776a3325-8f16-4dee-871c-61d3717c2ce8",
          "name": "Upload",
          "webhookId": "66334b1f-4ca3-4012-9fcd-eb6131fe6e5b"
        },
        {
          "parameters": {
            "jsCode": "for (const item of items) {\n  if (item.binary && item.binary.Archivo) {\n    // Accede a la metadata del archivo binario\n    item.binary.Archivo.mimeType = 'text/plain';\n  }\n}\nreturn items;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -752,
            96
          ],
          "id": "30941eab-530b-4113-bfff-140dd8294073",
          "name": "Code"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            -528,
            96
          ],
          "id": "89678522-0fce-4587-88b2-c7445421e799",
          "name": "When chat message received",
          "webhookId": "2ac99ee9-e989-4c92-bbb2-badc605c7765"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {
              "maxOutputTokens": 50,
              "temperature": 0
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -528,
            320
          ],
          "id": "9a19114e-d067-475c-a485-343c1b994e7d",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            96,
            256
          ],
          "id": "b17428a6-b2c9-446d-a209-463aa10b749a",
          "name": "Google Gemini Chat Model1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            240,
            272
          ],
          "id": "99c7becc-9516-45df-bc4e-335e614967e8",
          "name": "Simple Memory"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            400,
            336
          ],
          "id": "5c2a2068-87c8-42e7-890e-71c22daa5b10",
          "name": "Embeddings Google Gemini1",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "inputText": "={{ $json.chatInput }}",
            "categories": {
              "categories": [
                {
                  "category": "empresa"
                },
                {
                  "category": "contrata"
                },
                {
                  "category": "cobertura"
                },
                {
                  "category": "saludo"
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "Clasifica el texto proporcionado por el usuario en una de la siguientes categorías: empresa, cobertura, precios, otros, y usa el formato de instrucciones proporcionado, no expliques y solo entrega el json.\n\nsi el texto proporcionado tiene palabras como \"quien eres\" \"que haces\" \"de donde son\" \"empresa\" \"horarios\" y cuestiones relacionadas a la empresa. usa la categoría empresa\n\nsi el texto proporcionado tiene palabras como \"quiero internet\" \"donde dan servicio\" \"cobertura\" \"tiene servicio\" \"quiero internet\" o cuestiones similares, usa la categoría cobertura.\n\nsi el texto proporcionado tiene palabras como \"Cuanto cuesta\" \"cual es el precio\" \"pagar\" \"donde pago\" \"paquetes\" \"cuales son los planes\" y similares usa la categoría cobertura\n\nsi el texto proporcionado tiene palabras como \"Contratar\" \"que necesito para contratar\" \"quiero el servicio\" \"como lo contrato\" \"informacion para tener el servicio\" y similares usa la categoría contrata\n\nsi el texto proporcionado es un saludo usa la categoria saludo"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "typeVersion": 1.1,
          "position": [
            -336,
            96
          ],
          "id": "b645d9fe-5a73-4595-b831-77b9a3809079",
          "name": "Intencion"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres un asistente experto en identificar y contestar preguntas sobre la empresa albored, utilizando la herramienta VectorEmpresa"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            80,
            80
          ],
          "id": "b82e1d94-9f0b-4554-a8b6-e55061209689",
          "name": "Empresa"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres un ais"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -352,
            336
          ],
          "id": "f5119207-0030-4bbc-92eb-9b76439b7bf5",
          "name": "Contrata",
          "disabled": true
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "empresa"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            336,
            208
          ],
          "id": "6605c94f-fe27-4740-a3b4-b4869c152510",
          "name": "VectorEmpresa",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            192,
            640
          ],
          "id": "d5908d81-9c8a-4a3d-8c52-55ded66ba57a",
          "name": "Google Gemini Chat Model2",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            336,
            656
          ],
          "id": "9b5a606a-5317-4e9d-9370-11499d214c39",
          "name": "Simple Memory1"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "typeVersion": 1,
          "position": [
            576,
            592
          ],
          "id": "190401a1-29f9-40d5-8856-bc2bf34dc01a",
          "name": "Embeddings Google Gemini3",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Eres un asistente experto en identificar y contestar preguntas sobre la cobertura de albored, utilizando la herramienta "
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            240,
            464
          ],
          "id": "aac1640e-49ab-44dd-b2ee-ea025912e7af",
          "name": "Cobertura"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolDescription": "={{ $json.chatInput }}",
            "tableName": {
              "__rl": true,
              "value": "asisalbo",
              "mode": "list",
              "cachedResultName": "asisalbo"
            },
            "includeDocumentMetadata": false,
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "categoria",
                    "value": "cobertura"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.3,
          "position": [
            640,
            464
          ],
          "id": "083862a8-379c-4801-8bab-3678783c8787",
          "name": "VectorCobertura",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "message": "={{ $json.output }}",
            "options": {
              "memoryConnection": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.chat",
          "typeVersion": 1,
          "position": [
            592,
            96
          ],
          "id": "1ce6de9a-53db-4831-93c5-21e1f957d36b",
          "name": "Respond to Chat"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            608,
            288
          ],
          "id": "35b0acdf-dcc2-4afa-bb41-ec4570df3511",
          "name": "Simple Memory2"
        }
      ],
      "connections": {
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Upload": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Intencion",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Empresa",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "Empresa",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "VectorEmpresa",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Intencion": {
          "main": [
            [
              {
                "node": "Empresa",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Contrata",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Cobertura",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "VectorEmpresa": {
          "ai_tool": [
            [
              {
                "node": "Empresa",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Cobertura",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory1": {
          "ai_memory": [
            [
              {
                "node": "Cobertura",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini3": {
          "ai_embedding": [
            [
              {
                "node": "VectorCobertura",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "VectorCobertura": {
          "ai_tool": [
            [
              {
                "node": "Cobertura",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Empresa": {
          "main": [
            []
          ]
        },
        "Simple Memory2": {
          "ai_memory": [
            [
              {
                "node": "Respond to Chat",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Respond to Chat": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "8b92d08e-019c-4c04-9bc4-e34ef17a99d1",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-04T21:11:28.554Z",
          "createdAt": "2025-08-04T21:11:28.554Z",
          "role": "workflow:owner",
          "workflowId": "rSBvsYhJOI9W9lXP",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-23T01:46:20.000Z",
      "createdAt": "2025-09-17T01:28:40.862Z",
      "id": "ruFj9RNs2nWqgwCp",
      "name": "My workflow 7",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            0,
            0
          ],
          "id": "a1c1d4be-8d64-49c2-a068-a2a04fdf21c1",
          "name": "When clicking ‘Execute workflow’"
        },
        {
          "parameters": {
            "url": "http://192.168.88.1:8080/rest/system/identity",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {
              "allowUnauthorizedCerts": true
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            832,
            0
          ],
          "id": "2b95ee1d-510a-44e0-9ad4-053df066cc46",
          "name": "HTTP Request",
          "credentials": {
            "httpBasicAuth": {
              "id": "vt34Aqbd6SsIaX7K",
              "name": "mikrohttp"
            }
          }
        },
        {
          "parameters": {
            "command": "/ip hotspot ip-binding disable [find mac-address=\"38:6B:1C:D4:2F:0D\"]"
          },
          "type": "n8n-nodes-base.ssh",
          "typeVersion": 1,
          "position": [
            624,
            0
          ],
          "id": "d207ba19-5f4f-4bd4-85f1-26ae0b2c041f",
          "name": "Execute a command",
          "credentials": {
            "sshPassword": {
              "id": "N2WEvngWDZDXU8U1",
              "name": "SSH Mikrotik"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "jsCode": "const net = require('net');\n\nconst client = new net.Socket();\nconst host = '192.168.88.1';\nconst port = 8728;\n\n// Credenciales seguras desde n8n\nconst user = $credentials.mikrotik.user;\nconst pass = $credentials.mikrotik.password;\nconst comment = 'nombre-usuario'; // Cambia esto\n\nreturn new Promise((resolve, reject) => {\n    client.connect(port, host, () => {\n        const cmd = Buffer.from(`/ip/hotspot/ip-binding/disable\\n=comment=${comment}\\n\\n`, 'utf8');\n        client.write(cmd);\n    });\n    \n    client.on('data', (data) => {\n        resolve({ success: true });\n        client.destroy();\n    });\n    \n    client.on('error', (error) => {\n        resolve({ success: false, error: error.message });\n    });\n});\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            416,
            0
          ],
          "id": "4e6b48e4-8b21-43bd-9ff2-cdf77dd11537",
          "name": "Code",
          "disabled": true
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "90c0c6cd-0acd-4fe5-903a-54535cf83a5d",
                  "name": "VasosDeseclables",
                  "value": "boxboxbox",
                  "type": "string"
                },
                {
                  "id": "658d596a-ffa2-4b7c-8677-17504253db60",
                  "name": "Cucharas",
                  "value": "canino8816",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            208,
            0
          ],
          "id": "435b2892-c5cc-438e-8215-f2e3a4c181b9",
          "name": "Edit Fields"
        }
      ],
      "connections": {
        "When clicking ‘Execute workflow’": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute a command": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Execute a command",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "dedf8e9e-f2c8-4f91-8976-7b9480455868",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-09-17T01:28:40.868Z",
          "createdAt": "2025-09-17T01:28:40.868Z",
          "role": "workflow:owner",
          "workflowId": "ruFj9RNs2nWqgwCp",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-02T03:00:45.000Z",
      "createdAt": "2025-11-02T02:44:29.967Z",
      "id": "s5d2cbbpwR4wb6WV",
      "name": "ActivarID",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -896,
            -496
          ],
          "id": "872c0ee2-8cc2-4a5f-881a-732b4511fc49",
          "name": "Buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "ID Cliente"
                },
                {
                  "name": "idChat"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -1136,
            -544
          ],
          "id": "b7aa1014-3479-4dd1-a04a-9c594cce5700",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8a89165b-be24-4d41-99aa-1a6accd67e92",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1136,
            -288
          ],
          "id": "4a7c9857-1490-4e2f-a37c-770aa3ed2c76",
          "name": "If"
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID No encontrado",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -800,
            -256
          ],
          "id": "c27bdd37-5b96-47e7-a4a9-636f12735eed",
          "name": "NoFoud",
          "webhookId": "a7a0369b-07f4-498e-a241-dd4301b3713c",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('When Executed by Another Workflow').item.json.idChat }}",
            "text": "=ID {{ $('Buscar').item.json[\"ID Cliente\"] }} {{ $('Buscar').item.json[\"Nombre completo\"] }} {{ $('Buscar').item.json[\"MAC ID\"] }} Activo: {{ $json.status_binding }} Conectado: {{ $json.status_conexion }} Fecha de corte: {{ $json.fecha_corte }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -704,
            0
          ],
          "id": "10a10516-f509-4edc-bb45-e9c834a7d59d",
          "name": "Status",
          "webhookId": "cab20199-38f8-4b86-9575-18a13d2bf804",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global Mac \"{{ $json['MAC ID'] }}\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -1152,
            -112
          ],
          "id": "77b5cedd-5f60-4425-a552-44b8ac10211c",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "jsCode": "// Obtener la salida única del comando\nconst stdout = $json.stdout;\n\n// Asignar cada parte a una variable para mayor claridad.\nconst out_binding = (parts[0] || \"\").trim();\n\n// Crear un objeto para guardar los resultados finales\nconst resultados = {};\n\n// --- 1. LÓGICA CORREGIDA PARA EL ESTADO DEL BINDING ---\n// Buscamos si la línea de texto contiene \"flags=X\"\nif (out_binding === '') {\n  resultados.status_binding = 'NO ENCONTRADO EN BINDING';\n} else if (out_binding.includes(' XP ')) { // <-- LA CORRECCIÓN CLAVE AQUÍ\n  resultados.status_binding = 'DESACTIVADO';\n} else {\n  resultados.status_binding = 'ACTIVADO';\n}\n\n// --- 2. LÓGICA CORREGIDA PARA EL ESTADO DE CONEXIÓN DHCP ---\n// Solo consideramos \"CONECTADO\" si el status es exactamente \"bound\"\nif (out_conexion.includes('status=bound')) { // <-- LA CORRECCIÓN CLAVE AQUÍ\n  resultados.status_conexion = 'CONECTADO';\n} else if (out_conexion.includes('status=offered')) {\n  resultados.status_conexion = 'INESTABLE';\n} else {\n  // Si no está \"bound\", no está conectado, sin importar si está \"waiting\" o no existe.\n  resultados.status_conexion = 'DESCONECTADO';\n}\n\n// --- 3. LÓGICA PARA LA FECHA DE CORTE (esta ya era correcta) ---\nif (out_fecha === '') {\n  resultados.fecha_corte = 'NO ENCONTRADA';\n} else {\n  const match = out_fecha.match(/start-date=([^\\s]+)/);\n  resultados.fecha_corte = match ? match[1] : 'FECHA MALFORMADA';\n}\n\n// Devolver un único item con todos los datos procesados\nreturn [{\n  json: {\n    ...$item.json,\n    ...resultados\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -944,
            -96
          ],
          "id": "54af5de1-641e-4b15-8613-e541ba3cf9ce",
          "name": "Code"
        }
      ],
      "connections": {
        "Buscar": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "NoFoud",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "When Executed by Another Workflow": [
          {
            "json": {
              "ID Cliente": "c729",
              "idChat": "8193170686"
            }
          }
        ]
      },
      "versionId": "86d22b36-4d2c-42e0-9974-1690de354ec4",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-02T02:44:29.974Z",
          "createdAt": "2025-11-02T02:44:29.974Z",
          "role": "workflow:owner",
          "workflowId": "s5d2cbbpwR4wb6WV",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-11-02T02:44:21.343Z",
          "createdAt": "2025-11-02T02:44:21.343Z",
          "id": "vXjVUnKx0maaFRba",
          "name": "chiquis"
        }
      ]
    },
    {
      "updatedAt": "2025-09-18T22:21:51.000Z",
      "createdAt": "2025-08-06T16:28:55.373Z",
      "id": "t7DwaNkLdaEGHTut",
      "name": "comida",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.message.text }} {{ $json.data.text }}",
            "options": {
              "systemMessage": "=## [YOUR_BUSINESS_NAME] Assistant\n\nYou are [ASSISTANT_NAME], the friendly and efficient virtual assistant for [YOUR_BUSINESS_NAME] in [YOUR_CITY], [YOUR_COUNTRY]. Always:\n✅ Use simple, polite language\n✅ Send responses in plain text (NO markdown *, _, `)\n✅ Use only 1–2 emojis per message for warmth\n✅ Display time in [YOUR_TIMEZONE] (e.g., EST = UTC-5)\n✅ Ensure order records match Google Sheets format\n\n🍔 MENU & PRICES ([YOUR_CURRENCY])\n[CATEGORY_1]\n- [ITEM_1] – [CURRENCY_SYMBOL][PRICE_1]\n- [ITEM_2] – [CURRENCY_SYMBOL][PRICE_2]\n- [ITEM_3] – [CURRENCY_SYMBOL][PRICE_3]\n\n[CATEGORY_2]\n- [ITEM_4] – [CURRENCY_SYMBOL][PRICE_4]\n- [ITEM_5] – [CURRENCY_SYMBOL][PRICE_5]\n\nOthers\n- [ITEM_6] – [CURRENCY_SYMBOL][PRICE_6]\n- [ITEM_7] – [CURRENCY_SYMBOL][PRICE_7]\n- [ITEM_8] – [CURRENCY_SYMBOL][PRICE_8]\n- Delivery Fee – [CURRENCY_SYMBOL][DELIVERY_FEE]\n\n📝 ORDER FLOW\n1️⃣ Greet the customer:\n\"Hi! I'm [ASSISTANT_NAME] from [YOUR_BUSINESS_NAME] 😊 What would you like to order today?\"\n\n2️⃣ Clarify orders:\n- Ask for type when they mention general categories\n- Confirm all combos and add-ons\n\n3️⃣ Confirm order:\nSummarize like this:\nYour order:\n1x [ITEM] – [CURRENCY_SYMBOL][PRICE]\n1x [ITEM] – [CURRENCY_SYMBOL][PRICE]\nDelivery – [CURRENCY_SYMBOL][DELIVERY_FEE]\nTOTAL: [CURRENCY_SYMBOL][TOTAL]\n💳 Pay to: [YOUR_PAYMENT_DETAILS]\nReply \"Paid\" after sending payment\n\n4️⃣ Collect delivery info:\n\"Almost done! Please send:\nFull name\nPhone number (for delivery)\nDelivery address\"\n\n5️⃣ When they send delivery information:\nReply: \"Thank you for providing your details! We're now verifying your order. Please send your payment screenshot for confirmation 😊\"\n\n6️⃣ When they send a payment screenshot:\nReply:\n⌛ Thanks for your payment! Verifying with [YOUR_PAYMENT_PROVIDER]... (2–3 mins) 😊\n(This message happens automatically when payment screenshot is detected)\n\n7️⃣ HUMAN-IN-THE-LOOP DECISION:\nWhen staff approves the payment through the Check Feedback node:\n- The system will automatically send:\n  \"✅ Payment confirmed! Your order will arrive by [deliveryTime] 🚚\"\n  (Delivery time is 1 hour from now, e.g. \"16:45\")\n\n- The system will then automatically log this data to Google Sheets:\n  Format: Order id|Customer Name|Chat ID|Phone Number|Delivery Address|Order info|Total Price|Payment Status|Order Status|Timestamp\n  Example: [PREFIX]-1712345678|John|1085503473|+1234567890|123 Main St|1x Burger|25.00|Confirmed|Preparing|10/07/2024 16:45\n\n8️⃣ If staff rejects the payment:\nReply:\n❌ Sorry, we couldn't verify your payment. Please send a clearer screenshot or try again.\n\n📌 STATUS RESPONSES:\nWhen user types \"Status?\":\n⏳ Still verifying! We'll notify you as soon as it's confirmed 💛\n\nWhen user types \"Agent\":\nConnecting you to @[YOUR_SUPPORT_HANDLE] 💬\n\nWhen user asks for FAQ or information about [YOUR_BUSINESS_NAME]:\n📍 Location: [YOUR_ADDRESS]\n⏰ Hours: [YOUR_HOURS]\n📞 Contact: [YOUR_PHONE]\n📧 Email: [YOUR_EMAIL]\n\n📊 SHEET FORMAT (strict):\nOrder id | Customer Name | Chat ID | Phone Number | Delivery Address | Order info | Total Price | Payment Status | Order Status | Timestamp\nTimestamp format = MM/DD/YYYY HH:MM (24hr [YOUR_TIMEZONE])\n\n## APPROVAL HANDLING\nIf $json.data.text is \"Approved\", then:\n- Calculate the delivery time (1 hour from current time)\n- Send: \"✅ Payment confirmed! Your order will arrive by [deliveryTime] 🚚\"\n- Log the order data to Google Sheets, making sure to include the Chat ID ({{ $json.message.from.id }} or {{ $json.chat.id }})"
            }
          },
          "id": "723990be-057a-4d46-9a14-29af2bb1b841",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            -2160,
            -96
          ],
          "typeVersion": 1.8
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}  ",
            "contextWindowLength": 10
          },
          "id": "8b488128-7891-4abd-9b20-79dfd3ea24c3",
          "name": "Simple Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            -1456,
            0
          ],
          "typeVersion": 1.3
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "id": "fd672ddd-3952-486b-a13a-8a71e27583be",
          "name": "Telegram Trigger",
          "type": "n8n-nodes-base.telegramTrigger",
          "position": [
            -2592,
            -16
          ],
          "webhookId": "dd966a62-ffb5-4c52-a830-5cf7e96e946a",
          "typeVersion": 1.1,
          "credentials": {
            "telegramApi": {
              "id": "zw8x3sw3diiq8YH3",
              "name": "Telegram account 2"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "mode": "list",
              "value": "[YOUR_GOOGLE_SHEET_ID]",
              "cachedResultName": "Order Details Sheet"
            },
            "sheetName": {
              "__rl": true,
              "mode": "list",
              "value": "gid=0",
              "cachedResultName": "Sheet1"
            },
            "columns": {
              "value": {
                "Chat id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Chat_id', ``, 'string') }}",
                "Order id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Order_id', ``, 'string') }}",
                "Timestamp": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Timestamp', ``, 'string') }}",
                "timestamp": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('timestamp', ``, 'string') }}",
                "Total Price": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Total_Price', ``, 'string') }}",
                "  Order info": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('__Order_info', ``, 'string') }}",
                "Order Status": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Order_Status', ``, 'string') }}",
                "phone number": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('phone_number', ``, 'string') }}",
                "Customer Name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Customer_Name', ``, 'string') }}",
                "Payment Status": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Payment_Status', ``, 'string') }}",
                "Delivery Address": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Delivery_Address', ``, 'string') }}"
              },
              "schema": [
                {
                  "id": "Order id",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Order id",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Customer Name",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Customer Name",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Chat id",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Chat id",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Delivery Address",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Delivery Address",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "  Order info",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "  Order info",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Total Price",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Total Price",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Payment Status",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Payment Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Order Status",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Order Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Timestamp",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "Timestamp",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "phone number",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "phone number",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "timestamp",
                  "type": "string",
                  "display": true,
                  "required": false,
                  "displayName": "timestamp",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "id": "885de0ed-dbf9-4fa9-9d5f-502fff8f031a",
          "name": "Google Sheets",
          "type": "n8n-nodes-base.googleSheetsTool",
          "position": [
            -1328,
            0
          ],
          "typeVersion": 4.5
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "={{ $json.output }} ",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "id": "0243ed5f-718c-472e-9f08-d2f44bf8f376",
          "name": "Telegram",
          "type": "n8n-nodes-base.telegram",
          "position": [
            -1840,
            -96
          ],
          "webhookId": "4a058acc-6544-49bc-9981-c484756f0d42",
          "typeVersion": 1.2
        },
        {
          "parameters": {
            "inputText": "={{ $json.data.text }}",
            "categories": {
              "categories": [
                {
                  "category": "approved",
                  "description": "admin approves the order"
                },
                {
                  "category": "declined",
                  "description": "admin declined the order"
                }
              ]
            },
            "options": {}
          },
          "id": "62d798fa-e3ea-4034-b75e-ef0cf412cbbb",
          "name": "Check Feedback",
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "position": [
            -1600,
            192
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "modelName": "models/gemini-2.0-flash-exp",
            "options": {}
          },
          "id": "7a399b18-cc2f-4926-bc7e-2b4471a58b38",
          "name": "Google Gemini Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            -1616,
            32
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "operation": "sendAndWait",
            "message": "Payment received for order. Approve or decline?",
            "responseType": "freeText",
            "options": {
              "appendAttribution": false
            }
          },
          "id": "e769d4ad-f70c-4267-ab25-018d4a4ec146",
          "name": "Admin Approval Request",
          "type": "n8n-nodes-base.telegram",
          "position": [
            -1840,
            192
          ],
          "webhookId": "d0ca05e5-391f-4f67-b00f-40e72a5de2aa",
          "typeVersion": 1.2
        },
        {
          "parameters": {
            "operation": "sendPhoto",
            "file": "={{ $json.message.photo[0].file_id }}",
            "additionalFields": {
              "caption": "={{ $('Telegram Trigger').item.json.message.caption }}"
            }
          },
          "id": "302d6e1e-4d23-474a-9bf2-43622f71c33f",
          "name": "Forward Payment Screenshot",
          "type": "n8n-nodes-base.telegram",
          "position": [
            -2112,
            192
          ],
          "webhookId": "e8df6e57-dfef-424b-ac17-d32b8ecddfc8",
          "typeVersion": 1.2
        },
        {
          "parameters": {
            "content": "## AI Tools & Memory",
            "height": 220,
            "width": 440,
            "color": 5
          },
          "id": "41e16711-fe54-46ff-a673-244a7f120684",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1648,
            -80
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "02d9bd52-4f62-4f32-b0c3-a4723f913b46",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.message.photo[0] }} {{ $json.message.caption }}",
                  "rightValue": ""
                },
                {
                  "id": "d50f068a-c563-4a95-a6e6-2e3514028e28",
                  "operator": {
                    "type": "string",
                    "operation": "notExists",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.message.text }}",
                  "rightValue": ""
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "id": "70526f6e-6496-4f3b-834a-21d87f6e763a",
          "name": "Payment Screenshot Check",
          "type": "n8n-nodes-base.if",
          "position": [
            -2352,
            -16
          ],
          "typeVersion": 2.2
        },
        {
          "parameters": {
            "content": "## Payment Verification Flow",
            "height": 180,
            "width": 932
          },
          "id": "b8ad6770-c6d7-4bd2-b458-0bb41cad2b61",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2208,
            144
          ],
          "typeVersion": 1
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "❌ Sorry, we couldn't verify your payment. Please send a clearer screenshot or try again.",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "id": "3896ae5c-6c0a-411f-b18a-55f4cd57e304",
          "name": "Payment Declined",
          "type": "n8n-nodes-base.telegram",
          "position": [
            -1216,
            192
          ],
          "webhookId": "74f30de0-1908-4640-b6c5-13325e770462",
          "typeVersion": 1.2
        },
        {
          "parameters": {
            "content": "## AI Assistant Brain",
            "height": 280,
            "width": 580,
            "color": 3
          },
          "id": "d37b7ea0-e0d7-490c-916a-9da086c3c93a",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2208,
            -144
          ],
          "typeVersion": 1
        }
      ],
      "connections": {
        "AI Agent": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Check Feedback": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Payment Declined",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Telegram Trigger": {
          "main": [
            [
              {
                "node": "Payment Screenshot Check",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Admin Approval Request": {
          "main": [
            [
              {
                "node": "Check Feedback",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Check Feedback",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Payment Screenshot Check": {
          "main": [
            [
              {
                "node": "Forward Payment Screenshot",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Forward Payment Screenshot": {
          "main": [
            [
              {
                "node": "Admin Approval Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "6c532875-745c-45ae-b9f6-afcf361e39c2",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-06T16:28:55.383Z",
          "createdAt": "2025-08-06T16:28:55.383Z",
          "role": "workflow:owner",
          "workflowId": "t7DwaNkLdaEGHTut",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-18T01:27:57.000Z",
      "createdAt": "2025-09-09T00:25:47.066Z",
      "id": "tIC1L1oc8Hq5DHMF",
      "name": "My workflow 5",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            352,
            -80
          ],
          "id": "05a1a609-b2a4-4740-938d-6fcc9b4ec104",
          "name": "Get row(s) in sheet1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const items = [];\n\n// Recorre cada elemento del nodo anterior (Google Sheets de \"invitar\")\nfor (const item of $input.all()) {\n  const rowData = item.json;\n\n  // Crea un nuevo objeto con las columnas que quieres.\n  // Asegúrate de que los nombres de las llaves coincidan\n  // exactamente con los nombres de las columnas de tu tabla\n  // en la nueva hoja de Google Sheets.\n  const newRow = {\n    Id: rowData.Id,\n    Numero: rowData.Numero,\n    Nombre: rowData.Nombre,\n    Mensaje: rowData.Mensaje,\n    Fecha: rowData.Fecha\n  };\n\n  // Agrega el nuevo objeto a la lista de items\n  items.push({\n    json: newRow\n  });\n}\n\n// Devuelve los datos formateados para el siguiente nodo\nreturn items;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            592,
            -80
          ],
          "id": "1d739055-1dfb-4aad-a476-649a3ccfc189",
          "name": "Code3"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Id": "={{ $json.Id }}",
                "Numero": "={{ $json.Numero }}",
                "Nombre": "={{ $json.Nombre }}",
                "Mensaje": "={{ $json.Mensaje }}",
                "Fecha": "={{ $json.Fecha }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Numero",
                  "displayName": "Numero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Mensaje",
                  "displayName": "Mensaje",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            768,
            -64
          ],
          "id": "2f43ebd4-0024-44ed-ae57-2d4ca7c35134",
          "name": "Append row in sheet1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        }
      ],
      "connections": {
        "Get row(s) in sheet1": {
          "main": [
            [
              {
                "node": "Code3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code3": {
          "main": [
            [
              {
                "node": "Append row in sheet1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "e5d94edf-9404-4a54-b3cb-7b3cf0909a5d",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-09-09T00:25:47.071Z",
          "createdAt": "2025-09-09T00:25:47.071Z",
          "role": "workflow:owner",
          "workflowId": "tIC1L1oc8Hq5DHMF",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-28T18:10:40.000Z",
      "createdAt": "2025-06-26T18:24:23.843Z",
      "id": "uXKiHWtVgt16L3mZ",
      "name": "PagosChiqVarios",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Por favor ingresa tu ID de Cliente",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "ID Cliente",
                  "placeholder": "a000",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Reportar Pago Por..",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Varios Meses"
                      },
                      {
                        "option": "Otro"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "options": {
              "appendAttribution": false,
              "path": "Varios"
            }
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            880,
            -860
          ],
          "id": "894c3287-fe99-4c75-8eea-2487c2c43934",
          "name": "ID Cliente",
          "webhookId": "aa4190e4-b147-4f7e-9705-d1f1ca9710e7"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1080,
            -860
          ],
          "id": "9321a743-1053-4037-a4bd-7a1908aaa140",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d73b0245-6b70-439a-a99d-51c47bb71f41",
                  "leftValue": "={{ $json['ID Cliente'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            900,
            -640
          ],
          "id": "5bb88cb5-2f54-43e1-a681-a78804701335",
          "name": "Existe?",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1340,
            -860
          ],
          "id": "7f0c00fb-dd8b-4d39-ae04-3328d7dcd501",
          "name": "CargarPago",
          "webhookId": "6e3887c3-4d0c-401f-a9c6-7bb00dd5b8d6"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5796cb75-d38c-404c-91cb-3dc0ef1253c1",
                  "leftValue": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "rightValue": "={{ $('Existe?').item.json[\"Fecha de corte\"] }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "beforeOrEquals"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2220,
            -840
          ],
          "id": "c866c549-9fa1-4590-bcc0-2a9fe52f1f5b",
          "name": "PagoTardio"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Existe?').item.json['Fecha de corte'] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2420,
            -840
          ],
          "id": "00691dc5-a47d-4734-9254-acd1bc688f59",
          "name": "ActualizaMes"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error: Cliente no encontrado El ID de Cliente ",
            "completionMessage": "={{ $('ID Cliente').item.json[\"ID Cliente\"] }} no fue encontrado en nuestra base de datos.",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            900,
            -260
          ],
          "id": "7654c75c-77a5-45ea-aec1-c0e2ccfbc52b",
          "name": "Error",
          "webhookId": "66b72c77-3b4d-4921-9ba6-007b3c6e052f"
        },
        {
          "parameters": {
            "operation": "addToDate",
            "magnitude": "={{ $('Merge').item.json[\"Fecha de pago\"] }}",
            "timeUnit": "months",
            "duration": "={{ $('Merge').item.json.SumarMeses }}",
            "outputFieldName": "FechaCorteActualizada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2240,
            -660
          ],
          "id": "364951b1-aaae-4cb6-9259-5b0d60948d56",
          "name": "ActualizaFecha"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2440,
            -300
          ],
          "id": "52f70551-00a7-4161-ba28-93a831b4176a",
          "name": "PlanNuevo"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2440,
            -680
          ],
          "id": "306c86ee-dfb7-4114-8b75-2c3f252b3669",
          "name": "FechaCorteAct"
        },
        {
          "parameters": {
            "operation": "formatDate",
            "date": "={{ $json.FechaCorteActualizada }}",
            "format": "custom",
            "customFormat": "LLL/dd/yyyy",
            "outputFieldName": "fechaCorteFormateada",
            "options": {}
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            2640,
            -840
          ],
          "id": "fa5d2117-71ef-4380-913a-64517b479732",
          "name": "FormateaFecha"
        },
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global clientKey \"{{ $json[\"ID Cliente\"] }}\";\n:global Mac \"{{ $('DatosListos').item.json[\"MAC ID\"] }}\";\n:global dateToSet \"{{ $('DatosListos').item.json.fechaCorteFormateada }}\";\n:global Plan \"{{ $json.Paquete }}\";\n/ip dhcp-server lease set [find mac-address=\"$Mac\"] address-lists=\"$Plan\";\n/ip hotspot ip-binding set [find mac-address=$Mac] disabled=no;\n/system scheduler set [find name=$clientKey] start-date=$dateToSet;'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            2860,
            -680
          ],
          "id": "702757fc-5a8c-4c65-a984-18324e548812",
          "name": "ActivarCliente",
          "alwaysOutputData": true,
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Reporte Exitoso",
            "completionMessage": "=El pago del cliente: {{ $('DatosListos').item.json.Nombre }} ha sido exitoso. Su pròxima fecha de pago: {{ $('DatosListos').item.json.fechaCorteFormateada }}. Muchas Gracias",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2620,
            -260
          ],
          "id": "b008e23f-418e-4082-ba20-2beaa2d89ff9",
          "name": "Form",
          "webhookId": "0d70c28c-0be4-4d48-be21-e2956b758ae3"
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "={{ $('DatosListos').item.json[\"ID Cliente\"] }} {{ $('DatosListos').item.json.fecha }}",
            "message": "={{ $('DatosListos').item.json.Nombre }} Depositò en: {{ $('DatosListos').item.json.Cuenta }} ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }} el dia: {{ $('DatosListos').item.json.fecha }} Comprobante: {{ $('DatosListos').item.json.Comprobante }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            2760,
            -180
          ],
          "id": "99208c34-0f66-4b5b-becf-62d908e007b6",
          "name": "Gmail",
          "webhookId": "3d87d95f-f9f0-4948-a8b8-016dcd60e812",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "--": "--",
                "Fecha": "={{ $json.fecha }}",
                "ID": "={{ $json[\"ID Cliente\"] }}",
                "Cliente/Concepto": "={{ $json.Nombre }}",
                "Comprobante": "={{ $json.Comprobante }}",
                "FechaCorte": "={{ $json.fechaCorteFormateada }}",
                "Lup-Ing": "={{ $json.LupIng }}",
                "Ber-Ing": "={{ $json.BerIng }}",
                "Ald-Ing": "={{ $json.AldIng }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cliente/Concepto",
                  "displayName": "Cliente/Concepto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Comprobante",
                  "displayName": "Comprobante",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "--",
                  "displayName": "--",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "FechaCorte",
                  "displayName": "FechaCorte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Ing",
                  "displayName": "Lup-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Lup-Gas",
                  "displayName": "Lup-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ber-Ing",
                  "displayName": "Ber-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ber-Gas",
                  "displayName": "Ber-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Ald-Ing",
                  "displayName": "Ald-Ing",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Ald-Gas",
                  "displayName": "Ald-Gas",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2640,
            -660
          ],
          "id": "d3b77826-be4b-4630-bb5e-27832454d139",
          "name": "RegistraPago",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputDataFieldName": "=Cargar_comprobante",
            "name": "={{ $('Existe?').item.json[\"Nombre completo\"] }} {{ $json[\"Fecha de pago\"] }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "value": "1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH",
              "mode": "list",
              "cachedResultName": "Comprobantes",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1WBa79W6yjtRUOxB0elzxQ5yUEozRLulH"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            2000,
            -660
          ],
          "id": "d1428145-8bf8-4e98-9ebf-191f3e543132",
          "name": "GuardarComprob",
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "SjBU6k5lfBVVO4EK",
              "name": "Google Drive account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "={{ $('Existe?').item.json.Cantidad }}",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "467a5ab7-1393-4f16-a036-6138234d751c"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "efdc1a96-2c66-45cc-8134-987bd175c779",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "300",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b4a6aab5-bd23-4ec9-b204-f59c7fb5218f",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "400",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "loose",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9cdde34c-3ebe-485f-b075-7329d38d3e4d",
                        "leftValue": "={{ $('Merge').item.json[\"Plan Mensual Pagado\"] }}",
                        "rightValue": "500",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "looseTypeValidation": true,
            "options": {
              "fallbackOutput": "extra",
              "allMatchingOutputs": false
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            2200,
            -500
          ],
          "id": "3a64fbce-2cd4-4069-98ca-ace7f3519de5",
          "name": "PlanPagado1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan2M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2240,
            -240
          ],
          "id": "91d1b8cd-1a9b-4744-b4f7-5ba086f1307f",
          "name": "Plan2M1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan5M",
                  "type": "string"
                },
                {
                  "id": "db855eb6-b2e6-47b8-bfdb-25865729cedf",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1980,
            -480
          ],
          "id": "87d512f9-3292-4cd5-bce7-5fb094e3d5d9",
          "name": "Plan5M3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "921445a6-3573-424e-a56f-47115152c2a7",
                  "name": "NuevoPlan",
                  "value": "Plan3M",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2000,
            -340
          ],
          "id": "3fbff16f-9cbb-45b2-8d1d-dd7f9256b8a6",
          "name": "Plan3M2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 274566422,
              "mode": "list",
              "cachedResultName": "Corte",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=274566422"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID",
                  "lookupValue": "={{ $json[\"ID Cliente\"].toLowerCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1080,
            -660
          ],
          "id": "68dd0e6e-8fd9-4045-9919-53604ed607c6",
          "name": "BuscaDuplicados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json.ID }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            920,
            -420
          ],
          "id": "d1da6b64-4b45-4c5e-8747-0071b9410fac",
          "name": "duplicado?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe2dad46-5cd4-4402-9626-c53de7e5519f",
                  "name": "ID Cliente",
                  "value": "={{ $('Existe?').item.json[\"ID Cliente\"] }}",
                  "type": "string"
                },
                {
                  "id": "8f6afa7b-97a7-4b3b-9731-0ecf55b748d1",
                  "name": "Nombre",
                  "value": "={{ $('Existe?').item.json[\"Nombre completo\"] }}",
                  "type": "string"
                },
                {
                  "id": "5d4bac6b-7942-491a-953d-1619cd94f3cc",
                  "name": "fecha",
                  "value": "={{ $('Merge').item.json['Fecha de pago'] }}",
                  "type": "string"
                },
                {
                  "id": "2fb4b0f5-2bec-4466-957e-e9e385b8f8ce",
                  "name": "LupIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Ma. Gpe. term -0274 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "e6be0de0-1ad3-4720-a03c-35244f1f932a",
                  "name": "BerIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Bertin term -9712 Azte' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "69786c33-d258-4118-be17-8fb890d7c848",
                  "name": "AldIng",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] == 'Aldo term -5905 Sant.' ? $('Merge').item.json['Cantidad Pagada'] : null }}",
                  "type": "string"
                },
                {
                  "id": "063a4a33-2cc7-48e4-9ab8-7ecf212bce25",
                  "name": "Comprobante",
                  "value": "={{ $('GuardarComprob').item.json.webViewLink }}",
                  "type": "string"
                },
                {
                  "id": "37dfd783-55b5-4686-9279-3e9f72fdb9ed",
                  "name": "MAC ID",
                  "value": "={{ $('Busca').item.json[\"MAC ID\"] }}",
                  "type": "string"
                },
                {
                  "id": "962510e7-d4f4-4c8d-9f21-0faa6981dc53",
                  "name": "Cuenta",
                  "value": "={{ $('Merge').item.json['Cuenta en la que hizo el pago'] }}",
                  "type": "string"
                },
                {
                  "id": "79d91eb7-a5c0-4f7f-a57f-2f0163b87fea",
                  "name": "Cantidad Pagada",
                  "value": "={{ $('Merge').item.json['Cantidad Pagada'] }}",
                  "type": "string"
                },
                {
                  "id": "77b0ff2d-9d94-4152-9501-4fafa0c98ede",
                  "name": "fechaCorteFormateada",
                  "value": "={{ $json.fechaCorteFormateada }}",
                  "type": "string"
                },
                {
                  "id": "bbd59a4f-b55e-4e71-9d85-98e04e902024",
                  "name": "NuevoPlan",
                  "value": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                  "type": "string"
                },
                {
                  "id": "e629e409-d239-4505-b5ac-9c1acf5d0037",
                  "name": "SumarMeses",
                  "value": "={{ $('Merge').item.json.SumarMeses }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2820,
            -860
          ],
          "id": "cdc60be3-1fd8-4b36-8e23-57d14d9f462a",
          "name": "DatosListos"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=PAGO DUPLICADO!! ... El pago de este periodo para el usuario:",
            "completionMessage": "={{ $('Existe?').item.json[\"Nombre completo\"] }}, con ID: {{ $('Existe?').item.json['ID Cliente'] }}... ya ha sido registrado. Fecha de corte: {{ $json.FechaCorte }}\n\nSi parece que esto es un error, favor de contactar a soporte ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1100,
            -280
          ],
          "id": "1b9b14b6-2101-4a2d-adc8-9161bab1fa53",
          "name": "Error1",
          "webhookId": "24de9950-324e-4372-8929-040bc1b3666d"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c3da7c1e-25b1-4d4e-9fec-530d54a00025",
                  "leftValue": "={{ $json.error === undefined }}",
                  "rightValue": "=",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2860,
            -480
          ],
          "id": "f84cfdbc-12cf-46d3-b0dd-2349e93405c2",
          "name": "ActivarOK?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error",
            "completionMessage": "Error al activar y modificar fecha de corte",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            2880,
            -320
          ],
          "id": "3aebcec9-3745-4a1b-a335-37727916633f",
          "name": "Form1",
          "webhookId": "bcdfe370-38b8-4439-972f-f83998b21cc0"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zak_weBKxDWu48WSEJRBijJpYIoIGAdH6sB9eHBWc5M/edit#gid=1072981452"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Paquete": "={{ $('PlanNuevo').item.json.NuevoPlan }}",
                "ID Cliente": "={{ $('DatosListos').item.json[\"ID Cliente\"] }}",
                "Fecha de corte": "={{ $('DatosListos').item.json.fechaCorteFormateada }}",
                "Cuenta": "={{ $('DatosListos').item.json.Cuenta }}",
                "Cantidad": "={{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}"
              },
              "matchingColumns": [
                "ID Cliente"
              ],
              "schema": [
                {
                  "id": "ID Cliente",
                  "displayName": "ID Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre completo",
                  "displayName": "Nombre completo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Fecha de corte",
                  "displayName": "Fecha de corte",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cuenta",
                  "displayName": "Cuenta",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Paquete",
                  "displayName": "Paquete",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "MAC ID",
                  "displayName": "MAC ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2640,
            -460
          ],
          "id": "d82403c1-4062-4fdd-ba88-4cc7def941c0",
          "name": "ActCliente",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Meses Pagados",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "2"
                      },
                      {
                        "option": "3"
                      },
                      {
                        "option": "4"
                      },
                      {
                        "option": "5"
                      },
                      {
                        "option": "6"
                      },
                      {
                        "option": "7"
                      },
                      {
                        "option": "8"
                      },
                      {
                        "option": "9"
                      },
                      {
                        "option": "10"
                      },
                      {
                        "option": "11 +1 Gratis"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {
              "formTitle": "Por favor selecciones cuantos meses pago"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1320,
            -520
          ],
          "id": "47234764-881a-4648-a64a-410ae6d1cf5d",
          "name": "Meses",
          "webhookId": "b5cf749d-65a9-413a-a2f1-36b7cbbe47c1"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "1 Mes",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "31265679-e2bc-4527-b882-e4d580ebe2fa"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "65fab1f3-aec3-469c-ad26-f3471d84f5b8",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Varios Meses",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9b0e9c3-74eb-4700-9d17-4336678d0948",
                        "leftValue": "={{ $('ID Cliente').item.json['Reportar Pago Por..'] }}",
                        "rightValue": "Otro",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1100,
            -440
          ],
          "id": "f06acfe9-fc48-4c8d-a68d-1a7b641dbc92",
          "name": "Switch"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Todo Correcto?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aceptar"
                      },
                      {
                        "option": "Corregir Meses y/o Plan"
                      }
                    ]
                  }
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Cantidad Pagada",
                  "fieldValue": "={{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}"
                },
                {
                  "fieldType": "hiddenField",
                  "fieldName": "Plan Mensual Pagado",
                  "fieldValue": "={{ $json[\"Plan Mensual Pagado\"] }}"
                }
              ]
            },
            "options": {
              "formTitle": "Antes de continuar verifica que los datos esten correctos",
              "formDescription": "=Cliente: {{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nCantidad Pagada = {{ ($json['Meses Pagados'] == '11 +1 Gratis' ? 11 : parseInt($json['Meses Pagados'])) * $json['Plan Mensual Pagado'] }}\n "
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1340,
            -700
          ],
          "id": "baf47deb-ee69-4c05-be18-480043ee8cc7",
          "name": "PagoVarios",
          "webhookId": "6db91034-b63d-4f4a-8bf6-c77c21fad482"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8e937f3c-d549-44ae-80d3-0014a4e288b4",
                  "leftValue": "={{ $json[\"Todo Correcto?\"] }}",
                  "rightValue": "=Aceptar",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1520,
            -820
          ],
          "id": "8e74772b-bd99-41df-a81e-14a402d9fcf2",
          "name": "TodoOk?"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Codigo de Descuento",
                  "placeholder": "Si tiene un còdigo ingresalo AQUI"
                },
                {
                  "fieldLabel": "Cantidad Pagada",
                  "fieldType": "number",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Plan Mensual Pagado",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "300"
                      },
                      {
                        "option": "400"
                      },
                      {
                        "option": "500"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Cuenta en la que hizo el pago",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Aldo term -5905 Sant."
                      },
                      {
                        "option": "Ma. Gpe. term -0274 Azte"
                      },
                      {
                        "option": "Bertin term -9712 Azte"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Cargar comprobante",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "requiredField": true
                },
                {
                  "fieldLabel": "Fecha de pago",
                  "fieldType": "date",
                  "requiredField": "={{ true }}"
                }
              ]
            },
            "options": {
              "formTitle": "Ingresa los datos para el cliente:",
              "formDescription": "={{ $('Existe?').item.json['Nombre completo'] }}\nID: {{ $('Existe?').item.json[\"ID Cliente\"] }}\n\nAntes de continuar verifica que los datos esten correctos"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1520,
            -640
          ],
          "id": "b2a32530-0c9f-4199-971f-e75442679549",
          "name": "OtrosPago",
          "webhookId": "d6517fbe-a3dc-417b-919a-363908986b55"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            2000,
            -860
          ],
          "id": "b471a0b4-002d-40bf-b919-a58f737d60f6",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a9ba24a2-380e-414c-a7de-1ca921fcd589",
                  "name": "Cantidad Pagada",
                  "value": "={{ $json[\"Plan Mensual Pagado\"] }}",
                  "type": "string"
                },
                {
                  "id": "1b963156-9b3c-4764-a647-95502c0eb968",
                  "name": "SumarMeses",
                  "value": 1,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -860
          ],
          "id": "c009ec87-bcd2-434a-9e6a-7536e52ba304",
          "name": "AddCant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04696675-0ef4-4656-bf78-6e6803cbf9ca",
                  "name": "NuevoPlan",
                  "value": "={{ $('Existe?').item.json.Paquete }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2420,
            -520
          ],
          "id": "c0ecb080-6675-4239-9926-7d7bde01d1ea",
          "name": "MismoPlan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "97338f77-1ed1-4a62-b3d6-2341c48a8c75",
                  "name": "SumarMeses",
                  "value": "={{ $('Meses').item.json[\"Meses Pagados\"] }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -720
          ],
          "id": "22e3c547-1abf-4b47-86ee-b3892cd37eaf",
          "name": "mesesvarios"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3675b7e2-16ec-4541-805e-f0dadf9481c8",
                  "name": "SumarMeses",
                  "value": "={{ Math.round($json['Cantidad Pagada'] / $json['Plan Mensual Pagado']) }}",
                  "type": "string"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -560
          ],
          "id": "729fa393-5a88-4205-8914-39bcd2134496",
          "name": "mesotros"
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago {{ $('DatosListos').item.json[\"ID Cliente\"] }}, {{ $('DatosListos').item.json.Nombre }}, Cuenta: {{ $('DatosListos').item.json.Cuenta }}, Revisar que Meses pagados:{{ $('DatosListos').item.json.SumarMeses }} x Plan pagado:{{ $('DatosListos').item.json.NuevoPlan }} sea igual a ${{ $('DatosListos').item.json[\"Cantidad Pagada\"] }}, Corte: {{ $('DatosListos').item.json.fechaCorteFormateada }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            2920,
            -140
          ],
          "id": "566e5a77-a4dd-475b-a0d7-bc434c314392",
          "name": "Telegram",
          "webhookId": "8520b3ef-879f-4363-9082-0796d3e00448",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "7654665377, 8193170686",
            "text": "=Pago duplicado, error al intentar reportar pago {{ $json.ID }} {{ $json[\"Cliente/Concepto\"] }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            1280,
            -280
          ],
          "id": "0dd05c1c-0b52-46d7-8330-6cc557abb1ae",
          "name": "Telegram1",
          "webhookId": "b15ac8cb-21dc-415d-81b8-91e842c453ef",
          "credentials": {
            "telegramApi": {
              "id": "6HzIzA4mF0oIQqHQ",
              "name": "Telegram account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "53c30423-e2e3-4950-b84a-013255fd74af",
                  "leftValue": "={{ $json[\"Codigo de Descuento\"] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1540,
            -440
          ],
          "id": "e5fdc5d5-8f8a-4b15-aba5-34fe73a880c0",
          "name": "If"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b1bde4a3-bb5c-4a13-ad26-a15d4be37077",
                  "leftValue": "={{ $json.Codigo }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1680,
            -200
          ],
          "id": "b15190cc-c207-4059-8933-c1cff8a218f2",
          "name": "If1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Codigo",
                  "lookupValue": "={{ $json[\"Codigo de Descuento\"].toUpperCase() }}"
                },
                {
                  "lookupColumn": "Estado",
                  "lookupValue": "Pendiente"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1520,
            -280
          ],
          "id": "4bd3bebd-5e40-414a-ba42-877630f8bfa1",
          "name": "Codigo?",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Error. El còdigo no existe o ya ha sido usado",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1820,
            -280
          ],
          "id": "e2ef1a73-b86f-42f1-a1c8-666483e6e7cb",
          "name": "noexiste",
          "webhookId": "21ce6b92-7aee-4ae7-961b-f28c92bc3e4a"
        },
        {
          "parameters": {
            "options": {
              "formTitle": "Descuento aplicado",
              "formDescription": "=Còdigo  {{ $json.Codigo }} usado con èxito descuento por: ${{ $json.Cantidad }}",
              "buttonLabel": "Continuar"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            1880,
            -160
          ],
          "id": "daa8dfba-f831-494a-9976-f973efa4632a",
          "name": "aplicado",
          "webhookId": "2313840d-2edb-4617-b77f-72f8e446d951"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1746535005,
              "mode": "list",
              "cachedResultName": "Bonos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1746535005"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ID": "={{ $('If1').item.json.ID }}",
                "Estado": "={{ $now.format('yyyy-MM-dd') }}"
              },
              "matchingColumns": [
                "ID"
              ],
              "schema": [
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "ID",
                  "displayName": "ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Codigo",
                  "displayName": "Codigo",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Cantidad",
                  "displayName": "Cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "Estado",
                  "displayName": "Estado",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Por recomendar a:",
                  "displayName": "Por recomendar a:",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2040,
            -160
          ],
          "id": "1bec626e-2ae4-43ec-bd83-7b5557b78307",
          "name": "Google Sheets",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3675b7e2-16ec-4541-805e-f0dadf9481c8",
                  "name": "SumarMeses",
                  "value": 1,
                  "type": "number"
                }
              ]
            },
            "includeOtherFields": true,
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1760,
            -420
          ],
          "id": "fb0978e8-af0a-4ae1-8fc5-46c2985a9831",
          "name": "otrocod"
        }
      ],
      "connections": {
        "ID Cliente": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "BuscaDuplicados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "CargarPago": {
          "main": [
            [
              {
                "node": "AddCant",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "PagoTardio": {
          "main": [
            [
              {
                "node": "ActualizaMes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ActualizaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaMes": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaFecha": {
          "main": [
            [
              {
                "node": "FechaCorteAct",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "PlanNuevo": {
          "main": [
            [
              {
                "node": "PagoTardio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FechaCorteAct": {
          "main": [
            [
              {
                "node": "FormateaFecha",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormateaFecha": {
          "main": [
            [
              {
                "node": "DatosListos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarCliente": {
          "main": [
            [
              {
                "node": "ActivarOK?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RegistraPago": {
          "main": [
            [
              {
                "node": "ActCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GuardarComprob": {
          "main": [
            [
              {
                "node": "PlanPagado1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PlanPagado1": {
          "main": [
            [
              {
                "node": "MismoPlan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan2M1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan3M2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan5M3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan2M1": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan3M2": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Plan5M3": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "BuscaDuplicados": {
          "main": [
            [
              {
                "node": "duplicado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "duplicado?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DatosListos": {
          "main": [
            [
              {
                "node": "RegistraPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActivarOK?": {
          "main": [
            [
              {
                "node": "Form",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Form1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Form1": {
          "main": [
            []
          ]
        },
        "ActCliente": {
          "main": [
            [
              {
                "node": "ActivarCliente",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Meses": {
          "main": [
            [
              {
                "node": "PagoVarios",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "CargarPago",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "OtrosPago",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PagoVarios": {
          "main": [
            [
              {
                "node": "TodoOk?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TodoOk?": {
          "main": [
            [
              {
                "node": "mesesvarios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Meses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OtrosPago": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "GuardarComprob",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AddCant": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MismoPlan": {
          "main": [
            [
              {
                "node": "PlanNuevo",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Telegram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "mesesvarios": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "mesotros": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Error1": {
          "main": [
            [
              {
                "node": "Telegram1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "mesotros",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Codigo?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Codigo?": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "noexiste",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "aplicado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "aplicado": {
          "main": [
            [
              {
                "node": "Google Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets": {
          "main": [
            [
              {
                "node": "otrocod",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "otrocod": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 3
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "e69ed2a4-29ab-44a6-a21c-1c6e4d54e1a3",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-26T18:24:23.858Z",
          "createdAt": "2025-06-26T18:24:23.858Z",
          "role": "workflow:owner",
          "workflowId": "uXKiHWtVgt16L3mZ",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-15T03:50:19.000Z",
      "createdAt": "2025-08-15T03:11:51.370Z",
      "id": "vHCOxQakFJudF4K0",
      "name": "My workflow 4",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "a9a6b563-a52f-454d-9323-96d5ccaf6136",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "hola",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "b9a6b563-a52f-454d-9323-96d5ccaf6137",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver carrito",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1968,
            -400
          ],
          "id": "334b6d25-7474-47b2-9ab5-fb4dc602c81c",
          "name": "Switch"
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id.toUpperCase() }}",
                "cantidad": "={{ $json.cantidad }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "TOTALVENTA",
                  "displayName": "TOTALVENTA",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1520,
            -272
          ],
          "id": "57f63157-a510-46c0-a0f9-9631d8992769",
          "name": "Update row in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1760,
            -96
          ],
          "id": "f02d2c2a-7885-4275-9fbb-63bb907bbd36",
          "name": "Get row(s) in sheet2",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1203437505,
              "mode": "list",
              "cachedResultName": "ventas",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=1203437505"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "producto": "={{ $('Get row(s) in sheet2').item.json.producto }}",
                "cantidad": "={{ $('Get row(s) in sheet2').item.json.cantidad }}",
                "precio": "={{ $('Get row(s) in sheet2').item.json.precio }}",
                "total": "={{ $('Get row(s) in sheet2').item.json.total.round() }}",
                "fecha": "={{ $now }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "fecha",
                  "displayName": "fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1744,
            80
          ],
          "id": "c48d5828-3f1c-4d07-a52a-4717d94f1f07",
          "name": "Append row in sheet1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $json.id.toUpperCase() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1520,
            -416
          ],
          "id": "2b29ab7c-61c8-464c-9909-7679d28c4b1b",
          "name": "buscar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $('buscar').last() }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1312,
            -416
          ],
          "id": "cd2907f4-4f2f-48d3-bf35-ffc586bb1223",
          "name": "existe?",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1104,
            -416
          ],
          "id": "4ead998b-a528-4517-b4ee-7b3927c1112f",
          "name": "addcar",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id }}",
                "producto": "={{ $json.nombre }}",
                "cantidad": "={{ $json.cantidad }}",
                "precio": "={{ $json.precio }}",
                "total": "={{ ($json.cantidad * $json.precio).round() }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "TOTALVENTA",
                  "displayName": "TOTALVENTA",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "368",
                  "displayName": "368",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -912,
            128
          ],
          "id": "538bebed-1532-4ac0-acfb-fe85220d014f",
          "name": "agregar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $json.id }}",
                "cantidad": "=={{ Number($('addcar').item.json.cantidad) + Number($json.cantidad) }}",
                "total": "=={{ (Number($('addcar').item.json.cantidad) + Number($json.cantidad)) * Number($json.precio) }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "cantidad",
                  "displayName": "cantidad",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total",
                  "displayName": "total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "TOTALVENTA",
                  "displayName": "TOTALVENTA",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -912,
            -128
          ],
          "id": "111f9575-f030-46b0-a117-2689a90a551c",
          "name": "actualizar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('addcar').item.json.id }}",
                  "rightValue": "0",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1104,
            -112
          ],
          "id": "7e1957ca-9d7f-4dfe-b8d8-032a8f651c18",
          "name": "If"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('buscar').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('buscar').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('buscar').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Code (Parse Message)').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -912,
            -416
          ],
          "id": "a16188ee-88ba-40da-859e-8122c6b50c61",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "clear",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "keepFirstRow": true
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1296,
            -240
          ],
          "id": "aa382666-314b-44b2-baa7-d71627813719",
          "name": "Clear sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "id": "={{ $('Get row(s) in sheet').item.json.id }}",
                "stock": "=={{ Number($('Get row(s) in sheet').item.json.stock) - Number($('Get row(s) in sheet2').item.json.cantidad) }}"
              },
              "matchingColumns": [
                "id"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "nombre",
                  "displayName": "nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "precio",
                  "displayName": "precio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": true
                },
                {
                  "id": "stock",
                  "displayName": "stock",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "row_number",
                  "displayName": "row_number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "number",
                  "canBeUsedToMatch": true,
                  "readOnly": true,
                  "removed": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1536,
            48
          ],
          "id": "26f9c3f6-1518-4a24-bbc0-2e9b65a19314",
          "name": "Update row in sheet1",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Productos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "id",
                  "lookupValue": "={{ $('Get row(s) in sheet2').item.json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -1520,
            -112
          ],
          "id": "4d854d82-3ae4-4557-a261-199b1c6c5d39",
          "name": "Get row(s) in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            -1280,
            -64
          ],
          "id": "912a17f6-765f-4274-8032-5d6f64d2fb1c",
          "name": "No Operation, do nothing"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "carrito",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -2480,
            -368
          ],
          "id": "f66ef0b8-1bde-4ec7-891d-d1968e00fec1",
          "name": "Webhook",
          "webhookId": "8ec8bdc1-39ce-4227-acab-75f614fc64a3"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            -304,
            -416
          ],
          "id": "1bb8e81b-761a-415a-982d-3ff84c6fa81e",
          "name": "Respond to Webhook (Final)"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' '); // Esto dividirá la cadena por espacios\n\nlet intencion = parts[0];\nlet id = null;\nlet cantidad = null;\n\nif (parts.length > 1) {\n    id = parts[1];\n}\nif (parts.length > 2) {\n    cantidad = parseInt(parts[2]);\n}\n\n// Manejar comandos de una sola palabra como 'hola' o 'vaciar'\nif (intencion === 'vaciar' || intencion === 'finalizar' || intencion === 'hola' || (intencion === 'ver' && parts[1] === 'carrito')) {\n    // Si es 'ver carrito', la intención es 'ver carrito' completa\n    if (intencion === 'ver' && parts[1] === 'carrito') {\n        intencion = 'ver carrito';\n    }\n    // Si es 'vaciar' o 'finalizar' o 'hola', no hay ID ni cantidad específicos\n    return [{\n        json: {\n            intencion: intencion\n        }\n    }];\n}\n\n// Para comandos como 'añadir', 'modificar', etc., con ID y cantidad\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2192,
            -240
          ],
          "id": "6e234773-0fb2-4acb-b2af-e04e0da84447",
          "name": "Code (Parse Message)"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA",
              "mode": "list",
              "cachedResultName": "Catalogo",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 816777636,
              "mode": "list",
              "cachedResultName": "carrito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wmi18eONDZxURvzmh_YyJeuPianqVsqAuLZd0nQbDdA/edit#gid=816777636"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            -704,
            -416
          ],
          "id": "2397e694-15dd-4faf-9004-f23d8991068d",
          "name": "Get Current Cart State",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "let totalCart = 0;\nconst currentCartItems = [];\n\nlet responseText = \"Acción realizada.\";\nlet responseType = 'success';\nlet saleFinalized = false;\n\n// Try to get intention from the start of the flow\nconst initialIntention = $('Code (Parse Message)').item.json.intencion;\n\n// Check if the 'No' (producto no encontrado) branch was taken\n// This occurs if 'existe?' node did not find the product\nif ($('existe?').item && $('existe?').item.json.length === 0 && initialIntention === 'añadir') {\n    responseText = \"Error: El producto no se encontró en el catálogo.\";\n    responseType = 'error';\n} else {\n    // Determine the appropriate message based on the initial intention\n    if (initialIntention === 'añadir') {\n        responseText = \"Producto añadido/actualizado en el carrito.\";\n    } else if (initialIntention === 'vaciar') {\n        responseText = \"Carrito vaciado correctamente.\";\n    } else if (initialIntention === 'finalizar') {\n        responseText = \"Venta finalizada y carrito vaciado.\";\n        saleFinalized = true;\n    } else if (initialIntention === 'hola' || initialIntention === 'ver carrito') {\n        responseText = \"Estado actual del carrito:\";\n    } else if (initialIntention === 'modificar') {\n        responseText = \"Producto modificado en el carrito.\";\n    }\n\n    // Only process cart items if it's not an error state from 'no existe'\n    // And Get Current Cart State exists and has data\n    if ($('Get Current Cart State').item && $('Get Current Cart State').item.json) {\n        for (const item of $('Get Current Cart State').item.json) {\n            // Skip empty rows if Google Sheets returns them\n            if (!item.id) continue;\n\n            const quantity = parseInt(item.cantidad) || 0;\n            const price = parseFloat(item.precio) || 0;\n            const itemTotal = parseFloat(item.total) || 0;\n\n            totalCart += itemTotal;\n\n            currentCartItems.push({\n                productCode: item.id,\n                quantity: quantity,\n                price: price,\n                productName: item.producto // Assuming 'producto' column exists\n            });\n        }\n    }\n}\n\nreturn [{\n    json: {\n        text: responseText,\n        type: responseType,\n        currentCart: currentCartItems,\n        cartTotal: totalCart,\n        saleFinalized: saleFinalized\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -512,
            -416
          ],
          "id": "8c238d62-156a-47a5-ab24-551ca93017c9",
          "name": "Prepare Webhook Response"
        }
      ],
      "connections": {
        "Switch": {
          "main": [
            [
              {
                "node": "buscar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update row in sheet",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Clear sheet",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get row(s) in sheet2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update row in sheet": {
          "main": [
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet2": {
          "main": [
            [
              {
                "node": "Append row in sheet1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Append row in sheet1": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "buscar": {
          "main": [
            [
              {
                "node": "existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?": {
          "main": [
            [
              {
                "node": "addcar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "addcar": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "agregar": {
          "main": [
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "actualizar": {
          "main": [
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "actualizar",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "agregar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Clear sheet": {
          "main": [
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update row in sheet1": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "Update row in sheet1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing": {
          "main": [
            [
              {
                "node": "Get Current Cart State",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Code (Parse Message)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code (Parse Message)": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Webhook Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook (Final)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "a710c030-21be-4fc3-a913-ad720d334d07",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-15T03:11:51.379Z",
          "createdAt": "2025-08-15T03:11:51.379Z",
          "role": "workflow:owner",
          "workflowId": "vHCOxQakFJudF4K0",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-11-26T00:48:54.000Z",
      "createdAt": "2025-09-01T16:58:05.627Z",
      "id": "x6mGdmsT9TbNZmEA",
      "name": "ChanequeDonations",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -3440,
            -720
          ],
          "id": "f161f18e-0722-401f-82a5-bf904e953959",
          "name": "Telegram Trigger",
          "webhookId": "79c70227-99d7-47bc-a648-d2b1368643f8",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "modelName": "models/gemini-flash-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -3056,
            -144
          ],
          "id": "4b79f214-a1fe-422a-9da8-b4115412d23e",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const messages = [];\n\n// Obtener el ID del usuario\nconst userId = $json.message.from.id;\n\n// Obtener el nombre del usuario\nconst userName = $json.message.from.first_name;\n\n// Obtener el mensaje de texto\nconst userMessage = $json.message.text;\n\n// Obtener el número de teléfono si existe (los usuarios tienen que compartirlo explícitamente)\nconst phoneNumber = $json.message.contact ? $json.message.contact.phone_number : 'N/A';\n\n// Obtener la fecha y hora del mensaje\nconst date = new Date($json.message.date * 1000).toISOString();\n\nmessages.push({\n    userId,\n    userName,\n    phoneNumber,\n    userMessage,\n    date\n});\n\nreturn messages;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -3232,
            -720
          ],
          "id": "37e2a04b-3690-43b4-bb06-1c8224e2b1ba",
          "name": "Code"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "135c03bd-1e11-43e7-9caa-2a81b32dd351",
                  "leftValue": "={{ $json.Id }}",
                  "rightValue": "\"\"",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3264,
            -544
          ],
          "id": "5bee376b-0cdd-4d6c-b9f0-4307deeb0f18",
          "name": "If"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Mensaje": "={{ $('Code').item.json.userMessage }}",
                "Fecha": "={{ $('Code').item.json.date }}",
                "Id": "={{ $('Code').item.json.userId }}",
                "Numero": "={{ $('Code').item.json.phoneNumber }}",
                "Nombre": "={{ $('Code').item.json.userName }}"
              },
              "matchingColumns": [
                "Id"
              ],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Numero",
                  "displayName": "Numero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Mensaje",
                  "displayName": "Mensaje",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2976,
            -720
          ],
          "id": "b60749fc-1b28-4c64-a180-1597e565d81d",
          "name": "ActualizaBase",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('ActualizaBase').first().json.Id }}",
            "text": "={{ $json.mensaje }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2176,
            -720
          ],
          "id": "626c14d6-7208-4d0d-8dbd-5861e4b3332c",
          "name": "MyDonations",
          "webhookId": "40a3f7b4-9238-490b-af5c-cf3a3a483390",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1904984712,
              "mode": "list",
              "cachedResultName": "Eventos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1904984712"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Donante",
                  "lookupValue": "={{ $('ActualizaBase').item.json.Nombre }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2560,
            -720
          ],
          "id": "59424d93-84c1-4f4d-a930-3df380932039",
          "name": "MisDonations",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Id",
                  "lookupValue": "={{ $json.userId }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -3440,
            -512
          ],
          "id": "6448e156-be1f-455c-a788-b00a2043e33d",
          "name": "Existe",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "=[Registra movimiento aquí](https://n8n.albored.com/form/mov)",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "Markdown"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2704,
            -176
          ],
          "id": "99ddd230-bfd9-48c7-af4f-ecdf5c4832d1",
          "name": "entradas / salidas",
          "webhookId": "40a3f7b4-9238-490b-af5c-cf3a3a483390",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
            "text": "Hola soy el bot de Donaciones de Chaneque Despierta, solo puedo mostrar informacion sobre tus donaciones  --  Mostrar donaciones de otros  -- Si tienes una propuesta puedes registrarla y tambien puedo mostrarte las propuestas de otros",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2768,
            -720
          ],
          "id": "81c1e68b-5ace-4c98-b587-4c8996ce9ae3",
          "name": "Saluda",
          "webhookId": "7d473ec4-e0d4-4c92-8cf0-35b48fe73aac",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "Lo siento no entendi tu peticion, si quieres ver las instrucciones escribe un saludo",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2576,
            -288
          ],
          "id": "29201f11-a2f8-458b-9e27-4ced824eb2f9",
          "name": "Desconocido",
          "webhookId": "40a3f7b4-9238-490b-af5c-cf3a3a483390",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "=No toy",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2912,
            -144
          ],
          "id": "9b7cc8e7-8efd-42c3-a00b-16ecfe705310",
          "name": "Error",
          "webhookId": "3c75bf52-c3e9-4668-bef0-cc1481753f53",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "=Hola {{ $('Code').item.json.userName }}, Necesitas una invitación para interactuar con éste bot. ",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -3440,
            -352
          ],
          "id": "eb364e77-1544-4aca-ad65-54a0a3f69ffd",
          "name": "Invitado?",
          "webhookId": "87c06879-03eb-43da-8a1b-9ff799ebeac1",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Id": "={{ $('Code').item.json.userId }}",
                "Nombre": "={{ $('Code').item.json.userName }}",
                "Numero": "={{ $('Code').item.json.phoneNumber }}",
                "Mensaje": "={{ $('Code').item.json.userMessage }}",
                "Fecha": "={{ $('Code').item.json.date }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Numero",
                  "displayName": "Numero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Mensaje",
                  "displayName": "Mensaje",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -3232,
            -192
          ],
          "id": "7bbeadbf-ce50-4923-abab-24cbb29368ad",
          "name": "Pendientes",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "e2c4b226-d963-41be-8662-7ed7dbb82b27",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -3440,
            -176
          ],
          "id": "84e2dc97-4829-4172-9d71-326ef47f56d6",
          "name": "If1"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Id",
                  "lookupValue": "={{ $json.result.chat.id.toString() }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -3232,
            -352
          ],
          "id": "bc9bcf6e-062b-46b0-9f1d-7a270f408401",
          "name": "Invita",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "291fbba7-12aa-4164-9d8f-e99c604034c0",
                  "leftValue": "={{ $('Invitado?1').item.json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2272,
            -272
          ],
          "id": "76fbdfc0-3341-458f-8787-d73ff2ed92f2",
          "name": "If2"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Id",
                  "lookupValue": "={{ $json.parameter }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2464,
            -384
          ],
          "id": "92108a69-f89d-48d0-9013-29fdb0780379",
          "name": "Invitado?1",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1968,
            -688
          ],
          "id": "5a03c552-e7da-4b19-952d-c05ab0109ec5",
          "name": "Invitados",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
            "text": "={{ $json.formattedData }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2000,
            -304
          ],
          "id": "f9c5cc88-21f2-409e-8fb0-4db491813a8a",
          "name": "Lista",
          "webhookId": "552cc893-2911-40df-863f-fd50d6229dce",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "={{ $('AgregaInvitado').item.json.Id }} {{ $('AgregaInvitado').item.json.Nombre }} Ha sido Invitad@",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -1952,
            -112
          ],
          "id": "169ccb0a-d482-4e80-b38b-a637be930b38",
          "name": "Invitado",
          "webhookId": "552cc893-2911-40df-863f-fd50d6229dce",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "BaseDatos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Id": "={{ $json.Id }}",
                "Numero": "={{ $json.Numero }}",
                "Nombre": "={{ $json.Nombre }}",
                "Mensaje": "={{ $json.Mensaje }}",
                "Fecha": "={{ $json.Fecha }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Id",
                  "displayName": "Id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Numero",
                  "displayName": "Numero",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Nombre",
                  "displayName": "Nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Mensaje",
                  "displayName": "Mensaje",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Fecha",
                  "displayName": "Fecha",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2400,
            -192
          ],
          "id": "60e09aad-3965-49be-a583-7730ade3ef04",
          "name": "AgregaInvitado",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "delete",
            "documentId": {
              "__rl": true,
              "value": "1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8",
              "mode": "list",
              "cachedResultName": "Contactos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1249331970,
              "mode": "list",
              "cachedResultName": "Invitar",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g52xAGw19050Ig1zKSSWnjaiwnJ9inrf1kFzNSVuvL8/edit#gid=1249331970"
            },
            "startIndex": "={{ $('Invitado?1').item.json.row_number }}"
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -2112,
            -160
          ],
          "id": "bb0ebca8-2801-4df3-bb3c-02a0695ab607",
          "name": "EliminaInvita",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const output = items.map(item => {\n  const sheetData = item.json;\n  \n  // Asegúrate de que los nombres de los campos coincidan\n  const id = sheetData['Id'];\n  const nombre = sheetData['Nombre'];\n  const fecha = sheetData['Fecha'];\n\n  // Formatea el string para cada elemento\n  return `ID: ${id} Nombre: ${nombre}. fecha: ${fecha}`;\n}).join('\\n'); // Une todos los strings con saltos de línea\n\n// Devuelve un solo elemento con la cadena de texto completa\nreturn [{\n  json: {\n    formattedData: output\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2032,
            -480
          ],
          "id": "75b44012-8c63-4716-bffa-4a5861f9c78f",
          "name": "lista"
        },
        {
          "parameters": {
            "jsCode": "// Obtener el mensaje completo del nodo que está antes del Switch\n// Para acceder a los datos de otro nodo, se usa el nombre del nodo.\n// En este caso, el nodo 'Code' original que procesa la información de Telegram.\nconst userMessage = $('Code').item.json.userMessage;\n\n// Dividir el mensaje en partes\nconst parts = userMessage.split(' ');\n\n// Obtener el comando (primera palabra) y el parámetro (segunda palabra)\nconst command = parts[0];\nconst parameter = parts[1];\n\n// Devolver un nuevo objeto con los valores divididos\nreturn [{\n  json: {\n    command: command,\n    parameter: parameter\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2688,
            -400
          ],
          "id": "b5968396-aa43-4092-81f8-d9e9681f8348",
          "name": "ExtraeNum"
        },
        {
          "parameters": {
            "jsCode": "const resultados = $input.all();\n\nif (!resultados || resultados.length === 0) {\n    return [{ json: { mensaje: \"❌ No se encontraron coincidencias\" } }];\n}\n\nconst nombre = resultados[0].json.Donante || 'Usuario';\nlet mensaje = `📊 *Resultados para ${nombre}*\\n\\n`;\n\n// 1. DONACIONES (INGRESOS)\nconst ingresos = resultados.filter(r => r.json.Evento === 'INGRESO');\nif (ingresos.length > 0) {\n    mensaje += `📥 *Donaciones (cantidad ${ingresos.length})*\\n`;\n    ingresos.forEach(r => {\n        const fecha = r.json.Timestamp ? new Date(r.json.Timestamp).toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit', year: '2-digit'}) : 'Sin fecha';\n        mensaje += `• ${fecha}`;\n        \n        if (r.json.Especie && r.json.Especie.trim() !== '') {\n            mensaje += ` - ${r.json.Especie} (cantidad ${r.json.Cantidad || 0})`;\n        }\n        \n        if (r.json.Dinero && parseFloat(r.json.Dinero) > 0) {\n            mensaje += ` $${parseFloat(r.json.Dinero)}`;\n        }\n        \n        mensaje += '\\n';\n    });\n    mensaje += '\\n';\n}\n\n// 2. USADO (GASTOS)\nconst gastos = resultados.filter(r => r.json.Evento === 'GASTO');\nif (gastos.length > 0) {\n    mensaje += `📤 *Usado (cantidad ${gastos.length})*\\n`;\n    gastos.forEach(r => {\n        const fecha = r.json.Timestamp ? new Date(r.json.Timestamp).toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit', year: '2-digit'}) : 'Sin fecha';\n        mensaje += `• ${fecha}`;\n        \n        if (r.json.Especie && r.json.Especie.trim() !== '') {\n            mensaje += ` - ${r.json.Especie} (cantidad ${r.json.Cantidad || 0})`;\n        } else if (r.json.Dinero && parseFloat(r.json.Dinero) > 0) {\n            mensaje += ` $${parseFloat(r.json.Dinero)}`;\n        }\n        \n        if (r.json.Uso && r.json.Uso.trim() !== '') {\n            mensaje += ` → ${r.json.Uso}`;\n        }\n        \n        mensaje += '\\n';\n    });\n} else if (ingresos.length === 0) {\n    mensaje += \"No se encontraron registros de donaciones o gastos.\";\n}\n\nreturn [{ json: { mensaje: mensaje.trim() } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -2368,
            -720
          ],
          "id": "1fd8adc5-cf14-46b0-82a0-36b986d5a9cb",
          "name": "UneTodo"
        },
        {
          "parameters": {
            "inputText": "={{ $json.Mensaje }}",
            "categories": {
              "categories": [
                {
                  "category": "SALUDO",
                  "description": "Si el texto se trata de un saludo"
                },
                {
                  "category": "MY_DONATIONS",
                  "description": "Si dice algo similar a mis donaciones, mis donasiones"
                },
                {
                  "category": "GLOBAL_DONATION",
                  "description": "relacionado con donaciones o donasiones de otros, muestrame todas las donasiones o todas las donaciones"
                },
                {
                  "category": "PROPUESTA",
                  "description": "Para texto que diga quiero hacer una propuesta o algo similar, quiero ver las propuestas, quiero apoyar una propuesta"
                },
                {
                  "category": "REPORTAR_ING/GAS",
                  "description": "si el texto tiene reportar movimiento, reportar gasto, reportar ingles o similares"
                },
                {
                  "category": "INVITAR 8",
                  "description": "para el texto que contenga la palabra invitar seguida de un numero"
                },
                {
                  "category": "DESCONOCIDO",
                  "description": "Si no entra en ninguna categoria"
                },
                {
                  "category": "FALLBACK",
                  "description": "Para todo lo demas que no entre en las categorias anteriores"
                }
              ]
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "typeVersion": 1.1,
          "position": [
            -3040,
            -512
          ],
          "id": "8e07e7fd-1cdd-4c86-87b9-9f0c45199b7c",
          "name": "Intencion"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c693a78-4d9b-4291-b661-e37633e544ab",
                  "leftValue": "={{ $json.Mensaje.toLowerCase() }}",
                  "rightValue": "=ver",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                },
                {
                  "id": "a3bc4e4e-0d61-49e7-9f4e-bba77080dc11",
                  "leftValue": "={{ $json.Mensaje.toLowerCase() }}",
                  "rightValue": "muestra",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -2480,
            -528
          ],
          "id": "b98d1623-f1ba-4f52-b8e8-6cd92a43d19e",
          "name": "If3"
        },
        {
          "parameters": {
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "text": "=[Para ver las propuestas haz clic aquí](https://albowtch.github.io/ChanequeDonaciones/propuestas-dashboard.html?source=n8n&user_id={{ $json.Id }})",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "Markdown"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2272,
            -592
          ],
          "id": "554b3c74-0d83-478e-86ba-3e73a07f636e",
          "name": "VerPropuestas",
          "webhookId": "40a3f7b4-9238-490b-af5c-cf3a3a483390",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $('Intencion').item.json.Id }}",
            "text": "[Para ver todas las Donaciones clic aquí](https://albowtch.github.io/ChanequeDonaciones/dashboardChan.html?source=n8n)",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2656,
            -576
          ],
          "id": "5c4990f2-84dd-4d3d-91fd-d73f161f8134",
          "name": "TodasDonat",
          "webhookId": "7cedff48-a261-4a76-add4-8189fdb90ada",
          "executeOnce": true,
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        },
        {
          "parameters": {
            "chatId": "={{ $json.Id }}",
            "text": "=[Para ir a Propuestas clic aquí](https://n8n.albored.com/form/prop?Id={{ $json.Id }})",
            "additionalFields": {
              "appendAttribution": false,
              "parse_mode": "Markdown"
            }
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -2272,
            -432
          ],
          "id": "eb02453f-7a84-43b7-b432-204e326f19d8",
          "name": "HacerPropuestas",
          "webhookId": "40a3f7b4-9238-490b-af5c-cf3a3a483390",
          "credentials": {
            "telegramApi": {
              "id": "o04rue0zhKCmMMic",
              "name": "Chaneque"
            }
          }
        }
      ],
      "connections": {
        "Telegram Trigger": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Intencion",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Existe",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "ActualizaBase",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Invitado?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ActualizaBase": {
          "main": [
            [
              {
                "node": "Intencion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "MyDonations": {
          "main": [
            []
          ]
        },
        "MisDonations": {
          "main": [
            [
              {
                "node": "UneTodo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Desconocido": {
          "main": [
            []
          ]
        },
        "Invitado?": {
          "main": [
            [
              {
                "node": "Invita",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Invita": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Invitados",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "AgregaInvitado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Invitado?1": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Invitados": {
          "main": [
            [
              {
                "node": "lista",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AgregaInvitado": {
          "main": [
            [
              {
                "node": "EliminaInvita",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "EliminaInvita": {
          "main": [
            [
              {
                "node": "Invitado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "lista": {
          "main": [
            [
              {
                "node": "Lista",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ExtraeNum": {
          "main": [
            [
              {
                "node": "Invitado?1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "UneTodo": {
          "main": [
            [
              {
                "node": "MyDonations",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion": {
          "main": [
            [
              {
                "node": "Saluda",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "MisDonations",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "TodasDonat",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "entradas / salidas",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ExtraeNum",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Desconocido",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "VerPropuestas",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "HacerPropuestas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "x6mGdmsT9TbNZmEA"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Telegram Trigger": [
          {
            "json": {
              "update_id": 96408517,
              "message": {
                "message_id": 306,
                "from": {
                  "id": 7972655827,
                  "is_bot": false,
                  "first_name": "Albo",
                  "language_code": "es"
                },
                "chat": {
                  "id": 7972655827,
                  "first_name": "Albo",
                  "type": "private"
                },
                "date": 1759886501,
                "text": "invitar 8"
              }
            }
          }
        ]
      },
      "versionId": "fcb083b4-9540-42e1-bf3e-dbb9a38da4e7",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-01T16:58:05.632Z",
          "createdAt": "2025-09-01T16:58:05.632Z",
          "role": "workflow:owner",
          "workflowId": "x6mGdmsT9TbNZmEA",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-06-21T18:30:40.000Z",
      "createdAt": "2025-05-27T03:44:21.136Z",
      "id": "xB5k8lNiGd17TIji",
      "name": "BuscarChiq2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -500,
            -380
          ],
          "id": "84a7412c-e349-4d65-b073-60edc29e53ef",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3c9b5506-4c2e-4535-b13f-448b3c141d19",
                  "leftValue": "={{ $json['Nombre completo'].trim().toLowerCase() }}",
                  "rightValue": "={{ $('TelegramBuscar').item.json.Nombre.trim().toLowerCase() }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -240,
            -380
          ],
          "id": "9443251e-ad75-4933-bb6d-72ad4dd70690",
          "name": "Existe?",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "Nombre"
                },
                {
                  "name": "IdChat"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -780,
            -380
          ],
          "id": "574a6019-0739-4422-af6f-ce226357cf1b",
          "name": "TelegramBuscar"
        },
        {
          "parameters": {
            "jsCode": "// $items() obtiene TODOS los ítems que llegan a este nodo Code\n// (que son los ítems que pasaron el filtro \"Existe?\")\nconst todosLosResultados = $items(); \n\nlet mensajePrincipal = \"\";\n\nif (todosLosResultados.length > 0) {\n  mensajePrincipal = \"Se encontró:\\n\" + \n                     todosLosResultados.map(item => {\n                       // Acceder directamente a las propiedades del 'item.json' actual\n                       const nombre = item.json['Nombre completo'] || \"N/D\"; // Correcto\n                       const id = item.json['ID Cliente'] || \"N/D\";         // Correcto\n                       \n                       return `${nombre} (ID: ${id})`;\n                     }).join('\\n');\n} else {\n  mensajePrincipal = \"No se encontraron clientes que coincidan con su búsqueda.\";\n}\n\n// CONSTRUIMOS EL MENSAJE FINAL QUE ESTE NODO \"CODE\" DEVOLVERÁ\nconst mensajeFinalQueDevuelveEsteNodo = mensajePrincipal \n// Devolver UN ÚNICO ÍTEM.\n// La propiedad se llamará \"mensajeParaTelegram\".\nreturn [{ json: { mensajeParaTelegram: mensajeFinalQueDevuelveEsteNodo } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -20,
            -380
          ],
          "id": "8dbc56f6-5123-46f2-a0d4-862f12024a48",
          "name": "Code"
        }
      ],
      "connections": {
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TelegramBuscar": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "86f4265d-c244-4cd5-b3a5-0624e73754be",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-27T03:44:21.149Z",
          "createdAt": "2025-05-27T03:44:21.149Z",
          "role": "workflow:owner",
          "workflowId": "xB5k8lNiGd17TIji",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-10-11T15:55:04.000Z",
      "createdAt": "2025-08-22T17:03:34.856Z",
      "id": "xGD9BnScI9zH8fCg",
      "name": "box",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "carrit2",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            3808,
            3232
          ],
          "id": "f142aaf3-0802-4850-aded-8631b5113b54",
          "name": "Caja",
          "webhookId": "8ec8bdc1-39ce-4227-acab-75f614fc64a3"
        },
        {
          "parameters": {
            "jsCode": "const action = $('Switch1').item.json.intencion;\nconst cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nlet message, type;\n\nswitch(action) {\n  case 'modificar':\n    message = 'Cantidad modificada en el carrito.';\n    type = 'success';\n    break;\n  case 'vaciar':\n    message = 'El carrito ha sido vaciado.';\n    type = 'success';\n    break;\n  case 'finalizar':\n    if (cartItems.length === 0) {\n      message = 'No se puede finalizar: el carrito está vacío.';\n      type = 'error';\n    } else {\n      message = 'Compra finalizada exitosamente.';\n      type = 'success';\n    }\n    break;\n  case 'ver':\n    message = 'Contenido actual del carrito:';\n    type = 'info';\n    break;\n  default:\n    message = 'Operación completada.';\n    type = 'info';\n}\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: message,\n            currentCart: [],\n            cartTotal: 0,\n            type: type\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.id} -- ${item.json.product_id}, ${cantidad} * $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        text: message,\n        currentCart: formattedItems,\n        cartTotal: Math.round(totalGeneral),\n        type: type\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4928,
            3472
          ],
          "id": "d77eeb34-749f-4d4a-895e-41968133fe78",
          "name": "FormatOtherResponses"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "añadir",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2e1295f1-03f0-42b5-ba06-6e4db9073f56"
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "848f6e71-754a-4e03-bd46-05b1a490dd9b",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "modificar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9905b355-76c8-4cc9-91f7-8be185d30d4d",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "vaciar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9a96b563-a52f-454d-9323-96d5ccaf6135",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "finalizar",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "52fd61d2-793b-4707-9bf0-a626728cca37",
                        "leftValue": "={{ $json.intencion }}",
                        "rightValue": "ver",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            4240,
            3184
          ],
          "id": "e362dac9-f42e-47d2-91b9-d68e1a6d0fe0",
          "name": "Switch1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "0d56e39d-16fa-4333-9023-058d10e05bbd",
                  "leftValue": "={{ $('Find1').item.json }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4688,
            2960
          ],
          "id": "26495446-5896-4065-9caf-618c2c308ade",
          "name": "If2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "76cf323f-cd85-478a-a5e3-82277e6d3fd1",
                  "name": "id",
                  "value": "={{ $('Buscar1').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "37b0ed23-f6b3-4fe5-aa6a-b0629f968ca5",
                  "name": "nombre",
                  "value": "={{ $('Buscar1').item.json.nombre }}",
                  "type": "string"
                },
                {
                  "id": "3506361a-1ef1-48a9-af3e-c0b0f8264491",
                  "name": "precio",
                  "value": "={{ $('Buscar1').item.json.precio }}",
                  "type": "number"
                },
                {
                  "id": "c6d5e934-7ebf-45c3-89d1-7184bb996bbb",
                  "name": "cantidad",
                  "value": "={{ $('Switch1').item.json.cantidad }}",
                  "type": "number"
                },
                {
                  "id": "b7bcd327-ff43-493d-83c8-951ef2d130de",
                  "name": "Registrado",
                  "value": "={{ $now }}",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": false
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4464,
            2960
          ],
          "id": "08ae841a-f85b-474e-b072-98a3af916089",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            5200,
            3584
          ],
          "id": "4d2b5995-b71c-4d16-8a24-9bfe08ec78f8",
          "name": "Respond to Webhook1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "da24ee7f-0719-4be1-ae5c-d6d601393539",
                  "name": "text",
                  "value": "Producto añadido/actualizado al carrito.",
                  "type": "string"
                },
                {
                  "id": "329742e7-97b9-4ad9-9858-12b361dd1471",
                  "name": "currentCart",
                  "value": "={{ $('total1').item.json.currentCart }}",
                  "type": "array"
                },
                {
                  "id": "cart-total-fixed",
                  "name": "cartTotal",
                  "value": "={{ $('total1').item.json.cartTotal }}",
                  "type": "number"
                },
                {
                  "id": "add-update-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {
              "ignoreConversionErrors": true
            }
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            5120,
            3344
          ],
          "id": "a46e1801-0cba-437c-86ca-1085dcbb11e8",
          "name": "Add/Update Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "vaciar-text",
                  "name": "text",
                  "value": "El carrito ha sido vaciado.",
                  "type": "string"
                },
                {
                  "id": "vaciar-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "vaciar-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "vaciar-type",
                  "name": "type",
                  "value": "success",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4464,
            3472
          ],
          "id": "0f96c8cc-3f08-4807-a144-f03dd689c846",
          "name": "Vaciar Response1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "error-text",
                  "name": "text",
                  "value": "Ha ocurrido un error inesperado.",
                  "type": "string"
                },
                {
                  "id": "error-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "error-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "error-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4688,
            3472
          ],
          "id": "37e5d3e8-870a-44e5-8b01-228f9b8c7940",
          "name": "Error Response1"
        },
        {
          "parameters": {
            "jsCode": "const message = $input.first().json.body.message;\nconst parts = message.split(' ');\n\nconst intencion = parts[0];\nconst id = parts[1];\nconst cantidad = parseInt(parts[2]) || 1;\n\n// Capturar datos del usuario del body\nconst user_id = $input.first().json.body.user_id;\nconst session_id = $input.first().json.body.session_id;\nconst username = $input.first().json.body.username;\n\nreturn [{\n  json: {\n    intencion: intencion,\n    id: id,\n    cantidad: cantidad,\n    user_id: user_id,\n    session_id: session_id,\n    username: username\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4032,
            3232
          ],
          "id": "1d03ea93-0c43-4b28-9e79-015e545d18cf",
          "name": "Intencion1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "not-found-text",
                  "name": "text",
                  "value": "={{ $json.mergedText }}",
                  "type": "string"
                },
                {
                  "id": "not-found-current-cart",
                  "name": "currentCart",
                  "value": "[]",
                  "type": "json"
                },
                {
                  "id": "not-found-cart-total",
                  "name": "cartTotal",
                  "value": 0,
                  "type": "number"
                },
                {
                  "id": "not-found-type",
                  "name": "type",
                  "value": "error",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4912,
            3280
          ],
          "id": "6804ca19-29ab-4272-a15d-ec1c1f53ede0",
          "name": "Product Not Found Response1"
        },
        {
          "parameters": {
            "jsCode": "if (!items || items.length === 0) {\n    return [{ json: { mergedText: `No se encontraron productos con: ${$('Switch1').item.json.id}` } }];\n}\n\nconst result = [];\nfor (const item of items) {\n    if (item.json && item.json.id) {\n        result.push(`ID: ${item.json.id}, ${item.json.nombre}, Precio: ${item.json.precio}`);\n    }\n}\n\nreturn [{ json: { mergedText: result.length > 0 ? result.join('\\n') : 'No se encontraron productos válidos' } }];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            4688,
            3136
          ],
          "id": "55067f44-23ad-4615-99e1-7ff8966951db",
          "name": "Code1",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "jsCode": "const cartItems = items.filter(item => item.json && Object.keys(item.json).length > 0);\n\nif (cartItems.length === 0) {\n    return [{\n        json: {\n            text: \"El carrito está vacío.\",\n            currentCart: [],\n            cartTotal: 0,\n            type: \"info\"\n        }\n    }];\n}\n\nlet totalGeneral = 0;\nconst formattedItems = cartItems.map(item => {\n    const cantidad = parseFloat(item.json.cantidad) || 0;\n    const precio = parseFloat(item.json.precio) || 0;\n    const itemTotal = cantidad * precio;\n    totalGeneral += itemTotal;\n    \n    return `${item.json.id} -- ${item.json.product_id}, ${cantidad} * $${precio.toFixed(2)} = $${itemTotal.toFixed(2)}`;\n});\n\nreturn [{\n    json: {\n        currentCart: formattedItems,\n        cartTotal: Math.round(totalGeneral)\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            5120,
            3152
          ],
          "id": "2f01c6d5-f599-4c80-a16c-4f0ecb9196d1",
          "name": "total1"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "product",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Switch1').item.json.id.toUpperCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3824,
            3040
          ],
          "id": "4f68b853-6b67-4455-bbc2-e719b07f02dc",
          "name": "Buscar1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4240,
            2960
          ],
          "id": "3264fd6f-0d56-44b0-b0f8-46148a229825",
          "name": "Find1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "cart",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "id",
                  "fieldValue": "={{ $json.id }}"
                },
                {
                  "fieldId": "product_id",
                  "fieldValue": "={{ $json.nombre }}"
                },
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.precio * $json.cantidad }}"
                },
                {
                  "fieldId": "user_sesion_id",
                  "fieldValue": "={{ $('Switch1').item.json.user_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4912,
            2944
          ],
          "id": "4438cdc7-ff7d-4695-a04d-d03e81f774d5",
          "name": "Create a row2",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "product",
            "limit": 10,
            "filters": {
              "conditions": [
                {
                  "keyName": "nombre",
                  "condition": "fullText",
                  "searchFunction": "plfts",
                  "keyValue": "={{ $('Switch1').item.json.id.toLowerCase() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4464,
            3120
          ],
          "id": "f4780602-7308-4c19-b03b-57796911109b",
          "name": "BuscaNombre1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart",
            "limit": 30
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            5120,
            2944
          ],
          "id": "def6a318-d8dd-439b-a125-1432612c31b3",
          "name": "GetCart1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $json.id.toUpperCase() }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4688,
            3312
          ],
          "id": "794142d0-804e-400a-b35a-25b81cbc9fff",
          "name": "Modifica1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "cart",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $('Buscar1').item.json.id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "cantidad",
                  "fieldValue": "={{ $('Find1').item.json.cantidad + $json.cantidad }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4912,
            3120
          ],
          "id": "1bb4de39-b1a9-4f39-8b23-a417bc8623a1",
          "name": "Update1",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "cart"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3824,
            3472
          ],
          "id": "7651dacf-a5e9-4dc8-9979-a77b8459c8f7",
          "name": "TraerCarrito1",
          "executeOnce": true,
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "b984b098-802a-45cf-8405-4083ec6ba7b6",
                  "leftValue": "={{ $('Buscar1').item.json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4016,
            3056
          ],
          "id": "21ae40f9-b78f-4d1b-a33e-f56e3942b39d",
          "name": "existe?1",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "cart",
            "filterType": "string",
            "filterString": "id=not.is.null"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4464,
            3312
          ],
          "id": "99620b54-ea0d-417f-871a-e159bbd76df0",
          "name": "Delete a row1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5f4d63ef-8888-4fc9-9d59-d0ea3b0062f0",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            4016,
            3488
          ],
          "id": "039a9a87-082f-415d-ab56-c6fbc4e04444",
          "name": "If3"
        },
        {
          "parameters": {
            "tableId": "sales",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "Producto",
                  "fieldValue": "={{ $json.product_id }}"
                },
                {
                  "fieldId": "Cantidad",
                  "fieldValue": "={{ $json.cantidad }}"
                },
                {
                  "fieldId": "total",
                  "fieldValue": "={{ $json.total }}"
                },
                {
                  "fieldId": "Precio",
                  "fieldValue": "={{ $json.precio }}"
                },
                {
                  "fieldId": "user_id",
                  "fieldValue": "={{ $('Intencion1').item.json.user_id }}"
                },
                {
                  "fieldId": "username",
                  "fieldValue": "={{ $('Intencion1').item.json.username }}"
                },
                {
                  "fieldId": "session_id",
                  "fieldValue": "={{ $('Intencion1').item.json.session_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            4240,
            3504
          ],
          "id": "69f33288-2c17-46a3-ae86-d1c7784bce9e",
          "name": "Create a row3",
          "credentials": {
            "supabaseApi": {
              "id": "L8RjsgAIEl5kvBc7",
              "name": "Supabase account"
            }
          }
        }
      ],
      "connections": {
        "Caja": {
          "main": [
            [
              {
                "node": "Intencion1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FormatOtherResponses": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Buscar1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Modifica1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "TraerCarrito1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Error Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Create a row2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add/Update Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Vaciar Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Intencion1": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Product Not Found Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Product Not Found Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "total1": {
          "main": [
            [
              {
                "node": "Add/Update Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar1": {
          "main": [
            [
              {
                "node": "existe?1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find1": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row2": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BuscaNombre1": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GetCart1": {
          "main": [
            [
              {
                "node": "total1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modifica1": {
          "main": [
            [
              {
                "node": "FormatOtherResponses",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update1": {
          "main": [
            [
              {
                "node": "GetCart1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TraerCarrito1": {
          "main": [
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "existe?1": {
          "main": [
            [
              {
                "node": "BuscaNombre1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Find1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row1": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "Vaciar Response1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row3": {
          "main": [
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Caja": [
          {
            "json": {
              "headers": {
                "host": "n8n.albored.com",
                "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36",
                "content-length": "85",
                "accept": "*/*",
                "accept-encoding": "gzip, br",
                "accept-language": "es-419,es;q=0.9,en;q=0.8",
                "cdn-loop": "cloudflare; loops=1",
                "cf-connecting-ip": "38.7.23.3",
                "cf-ipcountry": "MX",
                "cf-ray": "9857db018a87b795-DFW",
                "cf-visitor": "{\"scheme\":\"https\"}",
                "cf-warp-tag-id": "68a38f6a-ca8c-4824-b947-e341c3b1abcb",
                "connection": "keep-alive",
                "content-type": "application/json",
                "origin": "http://0.0.0.0:8080",
                "priority": "u=1, i",
                "referer": "http://0.0.0.0:8080/",
                "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"Linux\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "cross-site",
                "x-forwarded-for": "38.7.23.3",
                "x-forwarded-proto": "https"
              },
              "params": {},
              "query": {},
              "body": {
                "message": "finalizar",
                "user_id": 1,
                "username": "admin",
                "session_id": "1_1758942601219"
              },
              "webhookUrl": "https://n8n.albored.com/webhook/carrit2",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "0f6e082f-aa10-4a00-ae1b-ffb5f85fc076",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-22T17:03:34.863Z",
          "createdAt": "2025-08-22T17:03:34.863Z",
          "role": "workflow:owner",
          "workflowId": "xGD9BnScI9zH8fCg",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-05-27T03:42:24.000Z",
      "createdAt": "2025-05-27T03:39:08.549Z",
      "id": "xK9FD3yadXcKNoPI",
      "name": "MikrotikChiqi2",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "command": "=sshpass -f /home/albo/.mikrotik_pw ssh -p 9091 \\\n-o StrictHostKeyChecking=no -o ConnectTimeout=10 pagos8816@hf209bhmpwh.sn.mynetname.net \\\n':global Mac \"{{ $json[\"MAC ID\"] }}\"; :global Name \"{{ $json[\"ID Cliente\"] }}\";\n:local bindingState [/ip hotspot ip-binding get [find mac-address=$Mac] disabled];\n:if ($bindingState) do={ :put \"Activado:disabled\"; } else={ :put \"Activado:active\"; }\n\n:put (\"Conectado:\" . [/ip dhcp-server lease get [find mac-address=$Mac] status]);\n\n:put (\"FechaCorte:\" . [/system scheduler get [find name=$Name] next-run]);'"
          },
          "type": "n8n-nodes-base.executeCommand",
          "typeVersion": 1,
          "position": [
            -900,
            -220
          ],
          "id": "6f411547-9e8f-4d55-b621-a65d5e8a42da",
          "name": "ConsultaStatus"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "ID Cliente",
                  "lookupValue": "={{ $json['ID Cliente'] }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -620,
            -420
          ],
          "id": "823b755b-1de6-4821-b1ad-c98fdb869f06",
          "name": "Buscar",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Resultado",
            "completionMessage": "={{ $('Buscar').item.json[\"ID Cliente\"] }} {{ $('Buscar').item.json[\"Nombre completo\"] }} {{ $('Buscar').item.json[\"MAC ID\"] }} {{ $json.stdout }} ",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -540,
            -140
          ],
          "id": "35b46ec4-825b-413e-a348-b5f38cc50e06",
          "name": "Resultado",
          "webhookId": "a4dae797-710e-4aae-8e0c-b8a9687f3e89"
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "ID Cliente"
                },
                {
                  "name": "chat_id"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -860,
            -440
          ],
          "id": "6d8ba799-d066-421a-b6d0-b8bde06e4783",
          "name": "When Executed by Another Workflow"
        }
      ],
      "connections": {
        "ConsultaStatus": {
          "main": [
            [
              {
                "node": "Resultado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Buscar": {
          "main": [
            [
              {
                "node": "ConsultaStatus",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Buscar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "fb9c7be4-ea7d-4226-a7a3-2a328d2dd6bb",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-27T03:39:08.560Z",
          "createdAt": "2025-05-27T03:39:08.560Z",
          "role": "workflow:owner",
          "workflowId": "xK9FD3yadXcKNoPI",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-09-25T07:03:24.000Z",
      "createdAt": "2025-09-25T06:14:07.561Z",
      "id": "ylsZNBLBLbl0Osj2",
      "name": "Mikro",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            0,
            0
          ],
          "id": "eb6b335c-80b8-46bd-9a1c-52d3ea9d4d2e",
          "name": "When chat message received",
          "webhookId": "1c641d2e-8180-478a-9d4e-20fcf47c18d4"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "=Eres un agente especializado en administrar routers Mikrotik usando la tool \"mikrotik\" (Hadidiz-AI Mikrotik). Y la tool clientes para buscar el id, que consta de 3 o 4 letras y el nombre del cliente.\n\nSolo puedes realizar las siguientes acciones, siempre usando el ID del cliente o usuario:\n\n1. Activar usuarios en \"ip hotspot ip binding\".\n2. Cambiar la address list de un usuario en \"ip dhcp-server\".\n3. Modificar la fecha de corte de un cliente en \"scheduler\".\n4. Realizar ping a la IP de un cliente.\n5. Consultar el estado de un usuario en \"ip binding\" y en \"ip dhcp-server\".\n\nNo realices ninguna otra acción ni modifiques configuraciones fuera de estas tareas. No ejecutes comandos no relacionados. Si se solicita una acción diferente, responde indicando que solo puedes realizar las tareas permitidas."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            240,
            0
          ],
          "id": "12eb10ae-ed08-4a3b-bc6f-d5e0ff00794d",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            112,
            208
          ],
          "id": "e562dbb4-1602-4dd0-b40b-b728c0071606",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            256,
            208
          ],
          "id": "4c973b75-ef6e-4300-8f78-8887d61be047",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "host": "192.168.88.1",
            "port": 2222,
            "username": "boxboxbox",
            "password": "canino8816",
            "command": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Command', ``, 'string') }}",
            "workingDirectory": ""
          },
          "type": "n8n-nodes-sshv2.hadidizAiTool",
          "typeVersion": 1,
          "position": [
            400,
            208
          ],
          "id": "18fc77ea-2d91-4441-9381-3cd4692bdf11",
          "name": "Mikrotik"
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Mikrotik": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "7ab7618d-c32b-4ea2-9b83-26b69314b7b4",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-09-25T06:14:07.574Z",
          "createdAt": "2025-09-25T06:14:07.574Z",
          "role": "workflow:owner",
          "workflowId": "ylsZNBLBLbl0Osj2",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-05-23T18:23:19.000Z",
      "createdAt": "2025-05-19T05:03:43.210Z",
      "id": "zGxTDJnlRtjzqtZn",
      "name": "BuscarChiq",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "formTitle": "Buscar Por Nombre",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Nombre",
                  "placeholder": "Ingresa el nombre",
                  "requiredField": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -620,
            -300
          ],
          "id": "ea439e74-3db4-4b51-8087-6376de48d3cf",
          "name": "Nombre?",
          "webhookId": "f77a6d45-2bf1-4dd7-bc1f-b0002ec4a788"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4",
              "mode": "list",
              "cachedResultName": "DatosChiq",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1072981452,
              "mode": "list",
              "cachedResultName": "Clientes",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14ShQi5nJTcE0PGAOdopFvguxMwmzO3thCPelyJ_Ikj4/edit#gid=1072981452"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            -440,
            -300
          ],
          "id": "fbdbc42a-c962-4c63-b3fe-6ef22ab0e24f",
          "name": "Busca",
          "alwaysOutputData": true,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "j0vWC1Yyy9M2QbHP",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3c9b5506-4c2e-4535-b13f-448b3c141d19",
                  "leftValue": "={{ $json['Nombre completo'].trim().toLowerCase() }}",
                  "rightValue": "={{ $('Nombre?').item.json.Nombre.trim().toLowerCase() }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -620,
            -80
          ],
          "id": "5aff5ccb-aa34-47c0-afd4-c3f2044354eb",
          "name": "Existe?",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Resultado",
            "completionMessage": "={{\n  $input.all().length > 0\n    ? \"Se encontrò:\\n\" + $input.all().map(item => item.json['Nombre completo'] + \" (ID: \" + item.json['ID Cliente'] + \")\").join('\\n')\n    : \"No se encontraron clientes que coincidan con su búsqueda.\"\noutput += \"\\n\\nPara realizar otra búsqueda, visita:\\n\" + \"https://jaybird-maximum-eagerly.ngrok-free.app/form/f77a6d45-2bf1-4dd7-bc1f-b0002ec4a788\";\n}}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            -440,
            -80
          ],
          "id": "57321565-bb80-4d49-81ab-af588d07fe33",
          "name": "Resultado",
          "webhookId": "2eabf375-0181-44cf-913e-74ab3364b43f"
        }
      ],
      "connections": {
        "Nombre?": {
          "main": [
            [
              {
                "node": "Busca",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca": {
          "main": [
            [
              {
                "node": "Existe?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Existe?": {
          "main": [
            [
              {
                "node": "Resultado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "2ab132f3-f68a-459c-923e-7b0d959aeeaa",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-19T05:03:43.220Z",
          "createdAt": "2025-05-19T05:03:43.220Z",
          "role": "workflow:owner",
          "workflowId": "zGxTDJnlRtjzqtZn",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    },
    {
      "updatedAt": "2025-08-08T05:02:14.000Z",
      "createdAt": "2025-08-08T01:51:39.941Z",
      "id": "zM5fQxbh3lcNrP4o",
      "name": "agentpage",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "public": true,
            "mode": "webhook",
            "options": {}
          },
          "id": "2bd9801b-f753-4321-a412-008c84e2704d",
          "name": "Chat Trigger",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -16,
            1344
          ],
          "webhookId": "f406671e-c954-4691-b39a-66c90aa2f103",
          "typeVersion": 1
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Eres el agente de servicio y soporte de un sitio web. tienes varias herramientas para usar.\n\n1.- Gmail. Utiliza esta herramienta para enviar correos al equipo de soporte de servicio al cliente.\n\n2.- pregunta-rag. Utiliza esta herramienta para contestar preguntas genrales de la empresa, el negocio y servicos. Preguntas faq\n\n"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            192,
            1344
          ],
          "id": "9cb983ee-962b-4c31-ab3d-8e183afc4d72",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "modelName": "models/gemini-1.5-pro-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            64,
            1552
          ],
          "id": "63169f62-c1dc-4acd-82f6-357960411561",
          "name": "Google Gemini Chat Model",
          "credentials": {
            "googlePalmApi": {
              "id": "Qb0BWRGgsfuWYlIi",
              "name": "Google Gemini(PaLM) Api account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
          "typeVersion": 1.3,
          "position": [
            208,
            1552
          ],
          "id": "3f334651-559e-4648-b888-463df92731bd",
          "name": "Postgres Chat Memory",
          "credentials": {
            "postgres": {
              "id": "j24zbTzefEUTw1dT",
              "name": "Postgres account"
            }
          }
        },
        {
          "parameters": {
            "sendTo": "albowtch@gmail.com",
            "subject": "ticket support pagina",
            "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
            "options": {
              "appendAttribution": false
            }
          },
          "type": "n8n-nodes-base.gmailTool",
          "typeVersion": 2.1,
          "position": [
            352,
            1552
          ],
          "id": "7033aad6-c310-4e67-8067-cc50d2bbd301",
          "name": "Send a message in Gmail",
          "webhookId": "1e716f4e-ae5e-4311-a2ba-282b6d49a6ad",
          "credentials": {
            "gmailOAuth2": {
              "id": "q7gmbjEwzEplUpKO",
              "name": "Gmail account"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://prod-1-data.ke.pinecone.io/assistant/chat/albored",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Api-Key",
                  "value": "pcsk_qPyxW_BKz2se1sjuVVUzydCA1VB4ykSkjtqfv9CmiLrnZiHeBrmBTu9zZPTTPuBE8k2xm"
                },
                {
                  "name": "Content-Type",
                  "value": "application/json"
                },
                {
                  "name": "X-Pinecone-API-Version",
                  "value": "2025-04"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"{pregunta-rag}\"\n    }\n  ],\n  \"stream\": false,\n  \"model\": \"gpt-4o\"\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            512,
            1520
          ],
          "id": "8594ee90-d209-45e1-a333-ac231cd20792",
          "name": "pregunta-rag"
        }
      ],
      "connections": {
        "Chat Trigger": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Postgres Chat Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Send a message in Gmail": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "pregunta-rag": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "3d512328-6a60-4b59-8758-b42f8f568e5f",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-08-08T01:51:39.954Z",
          "createdAt": "2025-08-08T01:51:39.954Z",
          "role": "workflow:owner",
          "workflowId": "zM5fQxbh3lcNrP4o",
          "projectId": "TjuQfSHvehy5o07W"
        }
      ],
      "tags": []
    }
  ],
  "nextCursor": null,
  "repo_path": "workflows/",
  "repo_owner": "albowtch",
  "repo_name": "n8nbackup"
}